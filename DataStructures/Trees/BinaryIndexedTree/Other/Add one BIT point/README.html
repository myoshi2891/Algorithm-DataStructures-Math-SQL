<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BITæœ¨æ§‹é€ ã®è©³ç´°è§£æ</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                min-height: 100vh;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 30px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            h2 {
                color: #34495e;
                border-bottom: 3px solid #3498db;
                padding-bottom: 10px;
                margin-top: 40px;
            }

            h3 {
                color: #2980b9;
                margin-top: 30px;
            }

            .tree-container {
                display: flex;
                justify-content: center;
                margin: 30px 0;
                background: #f8f9fa;
                padding: 20px;
                border-radius: 15px;
                box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
                overflow-x: auto;
            }

            .tree {
                position: relative;
                width: 900px;
                height: 300px;
            }

            .node {
                position: absolute;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                color: white;
                font-size: 14px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .node:hover {
                transform: scale(1.2);
                z-index: 10;
            }

            .node.root {
                background: #e74c3c;
            }

            .node.level1 {
                background: #3498db;
            }

            .node.level2 {
                background: #2ecc71;
            }

            .node.level3 {
                background: #f39c12;
            }

            .svg-node {
                transition: all 0.3s ease;
            }

            .svg-node:hover {
                filter: brightness(1.2) drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
            }

            .svg-highlighted {
                filter: brightness(1.3) drop-shadow(0 0 15px rgba(255, 107, 107, 0.8));
                animation: svgPulse 2s infinite;
            }

            @keyframes svgPulse {
                0% {
                    filter: brightness(1.3) drop-shadow(0 0 15px rgba(255, 107, 107, 0.8));
                }

                50% {
                    filter: brightness(1.5) drop-shadow(0 0 20px rgba(255, 107, 107, 1));
                }

                100% {
                    filter: brightness(1.3) drop-shadow(0 0 15px rgba(255, 107, 107, 0.8));
                }
            }

            .edge {
                position: absolute;
                background: #34495e;
                height: 2px;
                border-radius: 1px;
                z-index: 1;
            }

            .code-block {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 20px;
                border-radius: 10px;
                font-family: 'Courier New', monospace;
                margin: 20px 0;
                overflow-x: auto;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                font-size: 14px;
            }

            .example {
                background: #ecf0f1;
                padding: 20px;
                border-left: 5px solid #3498db;
                margin: 20px 0;
                border-radius: 0 10px 10px 0;
            }

            .step {
                background: linear-gradient(45deg, #74b9ff, #0984e3);
                color: #ffffff;
                padding: 15px;
                margin: 10px 0;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .step strong {
                color: #ffffff;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            }

            .bit-explanation {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin: 20px 0;
            }

            .bit-card {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: #ffffff !important;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            }

            .bit-card h4 {
                color: #ffffff !important;
                margin-top: 0;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
                font-weight: bold;
            }

            .bit-card p {
                color: #ffffff !important;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
                font-weight: 500;
            }

            .bit-card strong {
                color: #ffeb3b !important;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
                font-weight: bold;
            }

            .formula {
                background: #ffffff !important;
                border: 3px solid #3498db;
                padding: 20px;
                text-align: center;
                font-family: 'Times New Roman', serif;
                font-size: 20px;
                margin: 15px 0;
                border-radius: 10px;
                font-weight: bold;
                color: #2c3e50 !important;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .interactive-demo {
                background: #fff;
                border: 2px solid #3498db;
                border-radius: 15px;
                padding: 20px;
                margin: 20px 0;
            }

            .demo-input {
                padding: 10px;
                border: 2px solid #bdc3c7;
                border-radius: 5px;
                margin: 5px;
                font-size: 16px;
                width: 80px;
            }

            .demo-button {
                background: #3498db;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                margin: 5px;
                transition: background 0.3s ease;
            }

            .demo-button:hover {
                background: #2980b9;
            }

            .path-visualization {
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 20px 0;
                flex-wrap: wrap;
            }

            .path-node {
                background: #3498db;
                color: #ffffff;
                padding: 8px 12px;
                margin: 3px;
                border-radius: 20px;
                font-weight: bold;
                min-width: 20px;
                text-align: center;
                text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
            }

            .path-arrow {
                font-size: 20px;
                color: #e74c3c;
                margin: 0 5px;
                font-weight: bold;
            }

            .calculation-step {
                background: #f8f9fa;
                border: 2px solid #e9ecef;
                padding: 15px;
                margin: 10px 0;
                border-radius: 8px;
                font-family: monospace;
                color: #2c3e50;
                line-height: 1.8;
            }

            .calculation-step strong {
                color: #e74c3c;
                font-weight: bold;
            }

            .binary-display {
                background: #2c3e50;
                color: #1abc9c;
                padding: 15px;
                border-radius: 8px;
                font-family: 'Courier New', monospace;
                margin: 10px 0;
                border: 2px solid #34495e;
                font-size: 14px;
                line-height: 1.6;
                text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>ğŸŒ³ BITæœ¨æ§‹é€ ã®è©³ç´°è§£æ</h1>

            <h2>1. BITï¼ˆBinary Indexed Treeï¼‰ã®åŸºæœ¬æ§‹é€ </h2>

            <div class="example">
                <strong>BITã¨ã¯ï¼Ÿ</strong><br>
                Binary Indexed Treeï¼ˆãƒ•ã‚§ãƒ³ã‚¦ã‚£ãƒƒã‚¯æœ¨ï¼‰ã¯ã€é…åˆ—ã®è¦ç´ ã«å¯¾ã™ã‚‹<strong>ä¸€ç‚¹æ›´æ–°</strong>ã¨<strong>åŒºé–“å’Œã‚¯ã‚¨ãƒª</strong>ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚
                å„ãƒãƒ¼ãƒ‰ã¯ç‰¹å®šã®ç¯„å›²ã®å’Œã‚’ä¿æŒã—ã€æœ¨æ§‹é€ ã«ã‚ˆã‚Šé«˜é€Ÿãªæ“ä½œãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
            </div>

            <h3>1.1 é…åˆ—ã‹ã‚‰BITæœ¨ã¸ã®å¤‰æ›éç¨‹ï¼ˆn=8ã®å ´åˆï¼‰</h3>

            <div class="tree-container">
                <svg width="800" height="350" viewBox="0 0 800 350">
                    <!-- å®šç¾©ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#34495e" />
                        </marker>
                    </defs>

                    <!-- ã‚¨ãƒƒã‚¸ï¼ˆç·šï¼‰ -->
                    <!-- æ ¹ã‹ã‚‰ç¬¬1ãƒ¬ãƒ™ãƒ«ã¸ -->
                    <line x1="400" y1="50" x2="200" y2="120" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />
                    <line x1="400" y1="50" x2="320" y2="120" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />
                    <line x1="400" y1="50" x2="480" y2="120" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />
                    <line x1="400" y1="50" x2="600" y2="120" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />

                    <!-- ç¬¬1ãƒ¬ãƒ™ãƒ«ã‹ã‚‰ç¬¬2ãƒ¬ãƒ™ãƒ«ã¸ -->
                    <line x1="200" y1="150" x2="120" y2="220" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />
                    <line x1="320" y1="150" x2="280" y2="220" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />
                    <line x1="480" y1="150" x2="440" y2="220" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />
                    <line x1="600" y1="150" x2="560" y2="220" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)" />

                    <!-- ãƒãƒ¼ãƒ‰ -->
                    <!-- æ ¹ãƒãƒ¼ãƒ‰ -->
                    <circle cx="400" cy="50" r="25" fill="#e74c3c" stroke="white" stroke-width="3" onclick="highlightPath(0)" style="cursor: pointer;" class="svg-node" data-vertex="0" />
                    <text x="400" y="57" text-anchor="middle" fill="white" font-weight="bold" font-size="16">0</text>

                    <!-- ç¬¬1ãƒ¬ãƒ™ãƒ« -->
                    <circle cx="200" cy="140" r="25" fill="#3498db" stroke="white" stroke-width="3" onclick="highlightPath(2)" style="cursor: pointer;" class="svg-node" data-vertex="2" />
                    <text x="200" y="147" text-anchor="middle" fill="white" font-weight="bold" font-size="16">2</text>

                    <circle cx="320" cy="140" r="25" fill="#3498db" stroke="white" stroke-width="3" onclick="highlightPath(4)" style="cursor: pointer;" class="svg-node" data-vertex="4" />
                    <text x="320" y="147" text-anchor="middle" fill="white" font-weight="bold" font-size="16">4</text>

                    <circle cx="480" cy="140" r="25" fill="#3498db" stroke="white" stroke-width="3" onclick="highlightPath(6)" style="cursor: pointer;" class="svg-node" data-vertex="6" />
                    <text x="480" y="147" text-anchor="middle" fill="white" font-weight="bold" font-size="16">6</text>

                    <circle cx="600" cy="140" r="25" fill="#3498db" stroke="white" stroke-width="3" onclick="highlightPath(8)" style="cursor: pointer;" class="svg-node" data-vertex="8" />
                    <text x="600" y="147" text-anchor="middle" fill="white" font-weight="bold" font-size="16">8</text>

                    <!-- ç¬¬2ãƒ¬ãƒ™ãƒ«ï¼ˆè‘‰ãƒãƒ¼ãƒ‰ï¼‰ -->
                    <circle cx="120" cy="230" r="25" fill="#2ecc71" stroke="white" stroke-width="3" onclick="highlightPath(1)" style="cursor: pointer;" class="svg-node" data-vertex="1" />
                    <text x="120" y="237" text-anchor="middle" fill="white" font-weight="bold" font-size="16">1</text>

                    <circle cx="280" cy="230" r="25" fill="#2ecc71" stroke="white" stroke-width="3" onclick="highlightPath(3)" style="cursor: pointer;" class="svg-node" data-vertex="3" />
                    <text x="280" y="237" text-anchor="middle" fill="white" font-weight="bold" font-size="16">3</text>

                    <circle cx="440" cy="230" r="25" fill="#2ecc71" stroke="white" stroke-width="3" onclick="highlightPath(5)" style="cursor: pointer;" class="svg-node" data-vertex="5" />
                    <text x="440" y="237" text-anchor="middle" fill="white" font-weight="bold" font-size="16">5</text>

                    <circle cx="560" cy="230" r="25" fill="#2ecc71" stroke="white" stroke-width="3" onclick="highlightPath(7)" style="cursor: pointer;" class="svg-node" data-vertex="7" />
                    <text x="560" y="237" text-anchor="middle" fill="white" font-weight="bold" font-size="16">7</text>

                    <!-- ãƒ¬ãƒ™ãƒ«è¡¨ç¤º -->
                    <text x="50" y="60" fill="#666" font-size="14" font-weight="bold">æ ¹</text>
                    <text x="50" y="150" fill="#666" font-size="14" font-weight="bold">ãƒ¬ãƒ™ãƒ«1</text>
                    <text x="50" y="240" fill="#666" font-size="14" font-weight="bold">ãƒ¬ãƒ™ãƒ«2</text>

                    <!-- èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ -->
                    <text x="650" y="80" fill="#333" font-size="12">
                        <tspan x="650" dy="0">è¦ªå­é–¢ä¿‚:</tspan>
                        <tspan x="650" dy="20">1 â†’ 2 â†’ 4 â†’ 8 â†’ 0</tspan>
                        <tspan x="650" dy="20">3 â†’ 4 â†’ 8 â†’ 0</tspan>
                        <tspan x="650" dy="20">5 â†’ 6 â†’ 8 â†’ 0</tspan>
                        <tspan x="650" dy="20">7 â†’ 8 â†’ 0</tspan>
                    </text>
                </svg>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <p style="color: #666; margin: 10px 0;">
                    ğŸ’¡ å„ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãã®ãƒãƒ¼ãƒ‰ã‹ã‚‰æ ¹ã¾ã§ã®ãƒ‘ã‚¹ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã¾ã™
                </p>
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; border-radius: 50%; background: #e74c3c;"></div>
                        <span>æ ¹ãƒãƒ¼ãƒ‰</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; border-radius: 50%; background: #3498db;"></div>
                        <span>ä¸­é–“ãƒãƒ¼ãƒ‰</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; border-radius: 50%; background: #2ecc71;"></div>
                        <span>è‘‰ãƒãƒ¼ãƒ‰</span>
                    </div>
                </div>
            </div>

            <h3>1.2 è¦ªå­é–¢ä¿‚ã®æ•°å­¦çš„è§£æ</h3>

            <div class="bit-explanation">
                <div class="bit-card">
                    <h4>ğŸ”¢ ãƒ“ãƒƒãƒˆæ¼”ç®—ã®æ ¸å¿ƒ</h4>
                    <div class="formula">
                        è¦ª = i + (i & -i)
                    </div>
                    <p><strong>i & -i</strong> ã¯ã€Œiã®æœ€ä¸‹ä½ã®1ãƒ“ãƒƒãƒˆã€ã‚’å–å¾—ã™ã‚‹æ¼”ç®—ã§ã™</p>
                    <div class="binary-display">
                        ä¾‹: 6 & -6 = 010â‚‚ = 2<br>
                        6 = 110â‚‚, -6 = 010â‚‚, 6&-6 = 010â‚‚ = 2
                    </div>
                </div>

                <div class="bit-card">
                    <h4>ğŸ¯ 2ã®è£œæ•°ã«ã‚ˆã‚‹è¨ˆç®—</h4>
                    <div class="code-block">
                        æ•°å€¤ 5 ã®å ´åˆ:
                        5 = 101â‚‚ (binary)
                        -5 = 011â‚‚ (2ã®è£œæ•°)
                        5 & -5 = 001â‚‚ = 1
                        è¦ª = 5 + 1 = 6
                    </div>
                </div>
            </div>

            <h2>2. æœ€çŸ­ãƒ‘ã‚¹æ¢ç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è©³ç´°</h2>

            <h3>2.1 ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ã‚¹è¨ˆç®—</h3>

            <div class="interactive-demo">
                <h4>ğŸ” ãƒ‘ã‚¹è¨ˆç®—ãƒ‡ãƒ¢</h4>
                <div style="margin: 15px 0;">
                    <label>é…åˆ—ã‚µã‚¤ã‚º n: </label>
                    <input type="number" id="array-size" class="demo-input" value="8" min="1" max="20">
                    <label>é–‹å§‹é ‚ç‚¹: </label>
                    <input type="number" id="start-vertex" class="demo-input" value="3" min="1">
                    <button class="demo-button" onclick="calculatePath()">ãƒ‘ã‚¹ã‚’è¨ˆç®—</button>
                    <button class="demo-button" onclick="showAllPaths()">å…¨ãƒ‘ã‚¹è¡¨ç¤º</button>
                </div>

                <div id="path-result"></div>
                <div id="step-by-step"></div>
            </div>

            <h3>2.2 å…¸å‹çš„ãªãƒ‘ã‚¹æ¢ç´¢ä¾‹</h3>

            <div class="step">
                <strong>ä¾‹1: é ‚ç‚¹1ã‹ã‚‰ã®ãƒ‘ã‚¹ (n=8)</strong>
                <div class="path-visualization">
                    <div class="path-node">1</div>
                    <div class="path-arrow">â†’</div>
                    <div class="path-node">2</div>
                    <div class="path-arrow">â†’</div>
                    <div class="path-node">4</div>
                    <div class="path-arrow">â†’</div>
                    <div class="path-node">8</div>
                    <div class="path-arrow">â†’</div>
                    <div class="path-node">0</div>
                </div>
                <div class="calculation-step">
                    <strong>è¨ˆç®—éç¨‹:</strong><br>
                    1: 1 & -1 = 1, è¦ª = 1 + 1 = 2<br>
                    2: 2 & -2 = 2, è¦ª = 2 + 2 = 4<br>
                    4: 4 & -4 = 4, è¦ª = 4 + 4 = 8<br>
                    8: 8 > n=8, æ ¹(0)åˆ°é”
                </div>
            </div>

            <div class="step">
                <strong>ä¾‹2: é ‚ç‚¹5ã‹ã‚‰ã®ãƒ‘ã‚¹ (n=8)</strong>
                <div class="path-visualization">
                    <div class="path-node">5</div>
                    <div class="path-arrow">â†’</div>
                    <div class="path-node">6</div>
                    <div class="path-arrow">â†’</div>
                    <div class="path-node">8</div>
                    <div class="path-arrow">â†’</div>
                    <div class="path-node">0</div>
                </div>
                <div class="calculation-step">
                    <strong>è¨ˆç®—éç¨‹:</strong><br>
                    5: 5 & -5 = 1, è¦ª = 5 + 1 = 6<br>
                    6: 6 & -6 = 2, è¦ª = 6 + 2 = 8<br>
                    8: 8 > n=8, æ ¹(0)åˆ°é”
                </div>
            </div>

            <h2>3. ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è¨ˆç®—é‡è§£æ</h2>

            <div class="bit-explanation">
                <div class="bit-card">
                    <h4>â±ï¸ æ™‚é–“è¨ˆç®—é‡</h4>
                    <div class="formula">O(log n) per query</div>
                    <p>å„é ‚ç‚¹ã‹ã‚‰æ ¹ã¾ã§ã®è·é›¢ã¯æœ€å¤§ã§logâ‚‚(n)ã§ã™ã€‚ã“ã‚Œã¯æ•°å€¤ã®2é€²è¡¨ç¾ã®ãƒ“ãƒƒãƒˆæ•°ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</p>
                </div>

                <div class="bit-card">
                    <h4>ğŸ’¾ ç©ºé–“è¨ˆç®—é‡</h4>
                    <div class="formula">O(log n)</div>
                    <p>ãƒ‘ã‚¹ã®é•·ã•ãŒæœ€å¤§logâ‚‚(n) + 1ãªã®ã§ã€æ ¼ç´ã«å¿…è¦ãªç©ºé–“ã‚‚åŒç¨‹åº¦ã§ã™ã€‚</p>
                </div>
            </div>

            <h2>4. å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®è©³ç´°è§£èª¬</h2>

            <div class="code-block">
                def find_path_to_root(n: int, start_vertex: int) -> List[int]:
                path: List[int] = [] # ãƒ‘ã‚¹ã‚’æ ¼ç´ã™ã‚‹ãƒªã‚¹ãƒˆ
                current: int = start_vertex # ç¾åœ¨ã®é ‚ç‚¹

                while current != 0: # æ ¹ã«åˆ°é”ã™ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—
                path.append(current) # ç¾åœ¨ã®é ‚ç‚¹ã‚’ãƒ‘ã‚¹ã«è¿½åŠ 

                # è¦ªã®è¨ˆç®—ï¼šæœ€ä¸‹ä½ãƒ“ãƒƒãƒˆã‚’åŠ ç®—
                parent: int = current + (current & -current)

                if parent > n: # è¦ªãŒnè¶…éãªã‚‰æ ¹åˆ°é”
                current = 0
                else:
                current = parent

                path.append(0) # æ ¹(0)ã‚’è¿½åŠ 
                return path
            </div>

            <h2>5. BITæœ¨æ§‹é€ ã®åˆ©ç‚¹</h2>

            <div class="example">
                <strong>ãªãœBITãŒåŠ¹ç‡çš„ãªã®ã‹ï¼Ÿ</strong><br>
                1. <strong>ãƒãƒ©ãƒ³ã‚¹æ€§</strong>: å®Œå…¨ã«å¹³è¡¡ãªæœ¨æ§‹é€ ã«ã‚ˆã‚Šå®‰å®šã—ãŸæ€§èƒ½<br>
                2. <strong>å±€æ‰€æ€§</strong>: æ›´æ–°æ™‚ã«å½±éŸ¿ã™ã‚‹é ‚ç‚¹ãŒå¯¾æ•°å€‹ã«é™å®š<br>
                3. <strong>ãƒ“ãƒƒãƒˆæ¼”ç®—</strong>: é«˜é€Ÿãªè¦ªå­é–¢ä¿‚ã®è¨ˆç®—ãŒå¯èƒ½<br>
                4. <strong>ãƒ¡ãƒ¢ãƒªåŠ¹ç‡</strong>: é…åˆ—ãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ãŒè‰¯ã„
            </div>

            <div class="step">
                <strong>ğŸ‰ ã¾ã¨ã‚</strong><br>
                BITã®æœ¨æ§‹é€ ã«ãŠã‘ã‚‹æœ€çŸ­ãƒ‘ã‚¹æ¢ç´¢ã¯ã€ãƒ“ãƒƒãƒˆæ¼”ç®—ã‚’å·§å¦™ã«æ´»ç”¨ã™ã‚‹ã“ã¨ã§å¯¾æ•°æ™‚é–“ã§ã®åŠ¹ç‡çš„ãªå®Ÿè¡Œã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚
                ã“ã®ç†è§£ã«ã‚ˆã‚Šã€ã‚ˆã‚Šé«˜åº¦ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¸ã®å¿œç”¨ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
            </div>
        </div>

        <script>
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆçŠ¶æ…‹ã‚’ç®¡ç†
            let highlightedNodes = [];

            function highlightPath(startVertex) {
                // æ—¢å­˜ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ã‚¯ãƒªã‚¢
                clearHighlights();

                if (startVertex === 0) {
                    // æ ¹ã®å ´åˆã¯æ ¹ã®ã¿ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    const rootNode = document.querySelector('[data-vertex="0"]');
                    if (rootNode) rootNode.classList.add('svg-highlighted');
                    highlightedNodes.push(rootNode);
                    return;
                }

                const n = 8; // ãƒ‡ãƒ¢ç”¨ã®å›ºå®šå€¤
                const path = [];
                let current = startVertex;

                while (current !== 0) {
                    path.push(current);
                    const parent = current + (current & -current);
                    if (parent > n) {
                        current = 0;
                    } else {
                        current = parent;
                    }
                }
                path.push(0);

                // ãƒ‘ã‚¹ä¸Šã®ãƒãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                path.forEach(vertex => {
                    const node = document.querySelector(`[data-vertex="${vertex}"]`);
                    if (node) {
                        node.classList.add('svg-highlighted');
                        highlightedNodes.push(node);
                    }
                });
            }

            function clearHighlights() {
                highlightedNodes.forEach(node => {
                    node.classList.remove('svg-highlighted');
                });
                highlightedNodes = [];
            }

            function calculatePath() {
                const n = parseInt(document.getElementById('array-size').value);
                const start = parseInt(document.getElementById('start-vertex').value);

                if (isNaN(n) || isNaN(start) || start > n || start < 1) {
                    document.getElementById('path-result').innerHTML =
                        '<div style="color: red; padding: 10px;">ã‚¨ãƒ©ãƒ¼: æœ‰åŠ¹ãªå€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆé–‹å§‹é ‚ç‚¹ã¯1ã‹ã‚‰nã®ç¯„å›²ï¼‰</div>';
                    return;
                }

                const path = [];
                const steps = [];
                let current = start;
                let stepCount = 1;

                while (current !== 0) {
                    path.push(current);
                    const lowbit = current & -current;
                    const parent = current + lowbit;

                    steps.push(`
                    <div class="calculation-step">
                        <strong>ã‚¹ãƒ†ãƒƒãƒ—${stepCount}:</strong> é ‚ç‚¹${current}<br>
                        ${current} & -${current} = ${lowbit} (2é€²æ•°: ${lowbit.toString(2)})<br>  
                        è¦ª = ${current} + ${lowbit} = ${parent}
                        ${parent > n ? ' â†’ n=' + n + 'ã‚’è¶…éã®ãŸã‚æ ¹(0)åˆ°é”' : ''}
                    </div>
                `);

                    stepCount++;

                    if (parent > n) {
                        current = 0;
                    } else {
                        current = parent;
                    }
                }

                path.push(0);

                document.getElementById('path-result').innerHTML = `
                <h4>ğŸ¯ è¨ˆç®—çµæœ:</h4>
                <div class="path-visualization">
                    ${path.map((node, index) =>
                    `<div class="path-node">${node}</div>${index < path.length - 1 ? '<div class="path-arrow">â†’</div>' : ''}`
                ).join('')}
                </div>
                <p><strong>ãƒ‘ã‚¹é•·:</strong> ${path.length}å€‹ã®é ‚ç‚¹</p>
                <p><strong>ãƒ‘ã‚¹é…åˆ—:</strong> [${path.join(', ')}]</p>
            `;

                document.getElementById('step-by-step').innerHTML = `
                <h4>ğŸ“Š æ®µéšçš„è¨ˆç®—éç¨‹:</h4>
                ${steps.join('')}
            `;
            }

            function showAllPaths() {
                const n = parseInt(document.getElementById('array-size').value);

                if (isNaN(n) || n < 1 || n > 20) {
                    document.getElementById('path-result').innerHTML =
                        '<div style="color: red; padding: 10px;">ã‚¨ãƒ©ãƒ¼: nã¯1ã‹ã‚‰20ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
                    return;
                }

                let allPathsHtml = '<h4>ğŸŒ å…¨é ‚ç‚¹ã®ãƒ‘ã‚¹ä¸€è¦§:</h4>';

                for (let i = 1; i <= n; i++) {
                    const path = [];
                    let current = i;

                    while (current !== 0) {
                        path.push(current);
                        const parent = current + (current & -current);
                        if (parent > n) {
                            current = 0;
                        } else {
                            current = parent;
                        }
                    }
                    path.push(0);

                    allPathsHtml += `
                    <div class="calculation-step">
                        <strong>é ‚ç‚¹${i}:</strong> 
                        <div class="path-visualization" style="justify-content: flex-start;">
                            ${path.map((node, index) =>
                        `<div class="path-node" style="font-size: 12px; padding: 4px 8px;">${node}</div>${index < path.length - 1 ? '<div class="path-arrow" style="font-size: 16px;">â†’</div>' : ''}`
                    ).join('')}
                        </div>
                        é•·ã•: ${path.length}
                    </div>
                `;
                }

                document.getElementById('path-result').innerHTML = allPathsHtml;
                document.getElementById('step-by-step').innerHTML = '';
            }

            // åˆæœŸè¨ˆç®—ã‚’å®Ÿè¡Œ
            document.addEventListener('DOMContentLoaded', function () {
                calculatePath();
            });
        </script>
    </body>

</html>