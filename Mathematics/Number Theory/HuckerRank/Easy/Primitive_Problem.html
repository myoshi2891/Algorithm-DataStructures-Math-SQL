<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>原始根の発見 - HackerRank問題解説</title>

        <!-- Tailwind CSS -->
        <!-- Tailwind CSS -->
        <script
            src="https://cdn.tailwindcss.com/3.4.1"
            integrity="sha384-rMhvFknC0AhqKZXwSCyPeIirpE1IhTafmLXTvTCai5pxjAqFcqEAAqKH/2lXrFVP"
            crossorigin="anonymous"
        ></script>

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&family=Source+Code+Pro:wght@400;600&display=swap"
            rel="stylesheet"
        />

        <!-- Prism.js CSS -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css"
        />

        <!-- React & ReactDOM -->
        <!-- React & ReactDOM -->
        <script
            crossorigin
            src="https://unpkg.com/react@18/umd/react.production.min.js"
            integrity="sha384-nVQePqH/QE94Buf4g/4MI5NrqDYjdqT76Db87Fa6eINIs+Uk31kgOEWzrnD1NTqU"
            crossorigin="anonymous"
        ></script>
        <script
            crossorigin
            src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
            integrity="sha384-MUPX27At97Bs+bFaX2430abc2842R4tKjE2Frtj/z5r8v8lT1oI5ls55Dk7c21DD"
            crossorigin="anonymous"
        ></script>

        <!-- Babel Standalone -->
        <!-- Babel Standalone -->
        <script
            src="https://unpkg.com/@babel/standalone/babel.min.js"
            integrity="sha384-GHqeMh1FknC0AhqKZXwSCyPeIirpE1IhTafmLXTvTCai5pxjAqFcqEAAqKH/2lXrFVP"
            crossorigin="anonymous"
        ></script>

        <style>
            html {
                scroll-behavior: smooth;
            }

            body {
                font-family: 'Inter', sans-serif;
                background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%);
                min-height: 100vh;
                padding: 2rem 1rem;
            }

            code,
            pre {
                font-family: 'JetBrains Mono', 'Source Code Pro', monospace;
            }

            /* Prism toolbar customization */
            div.code-toolbar > .toolbar {
                opacity: 1;
                right: 1rem;
                top: 1rem;
            }

            div.code-toolbar > .toolbar button {
                background: #10b981 !important;
                color: white !important;
                padding: 0.5rem 1rem !important;
                border-radius: 0.5rem !important;
                border: none !important;
                font-weight: 600 !important;
                cursor: pointer !important;
                transition: all 0.2s !important;
            }

            div.code-toolbar > .toolbar button:hover {
                background: #059669 !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3) !important;
            }
        </style>
    </head>
    <body>
        <div style="max-width: 1400px; margin: 0 auto">
            <!-- Header -->
            <header
                id="header"
                class="mb-8 rounded-2xl p-8 shadow-[0_10px_30px_rgba(16,185,129,0.10)] bg-[linear-gradient(135deg,#d1fae5,#bfdbfe)]"
            >
                <h1 class="text-[2.5rem] font-bold text-teal-800 mb-2">原始根の発見</h1>
                <p class="text-xl text-cyan-700 font-semibold mt-2">
                    素因数分解と累乗剰余による O(√p + k·d·log p) 実装
                </p>
                <div class="mt-4 text-slate-700">
                    <span class="font-semibold">HackerRank</span> - 数論・原始根判定
                </div>

                <nav class="flex flex-wrap gap-4 mt-6">
                    <a
                        href="#overview"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        aria-label="概要セクションへ移動"
                    >
                        概要
                    </a>
                    <a
                        href="#steps"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        aria-label="ステップ解説へ移動"
                    >
                        ステップ解説
                    </a>
                    <a
                        href="#code"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        aria-label="コード例へ移動"
                    >
                        コード例
                    </a>
                    <a
                        href="#diagram"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        aria-label="フローチャートへ移動"
                    >
                        フローチャート
                    </a>
                    <a
                        href="#complexity"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        aria-label="計算量分析へ移動"
                    >
                        計算量
                    </a>
                </nav>
            </header>

            <!-- Overview Section -->
            <section id="overview" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    アルゴリズム概要
                </h2>

                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-bold text-teal-800 mb-3">問題の説明</h3>
                        <p class="text-slate-700 leading-7">
                            <strong>原始根（Primitive Root）</strong>とは、素数 p に対して、g の累乗
                            g<sup>1</sup>, g<sup>2</sup>, ..., g<sup>p-1</sup> を p
                            で割った余りが、すべて異なる値になるような整数 g のことです。
                        </p>
                        <p class="text-slate-700 leading-7 mt-3">
                            例えば p = 7 の場合、g = 3 は以下のように原始根になります：
                        </p>
                        <ul class="list-disc list-inside text-slate-700 ml-4 mt-2 space-y-1">
                            <li>3<sup>1</sup> mod 7 = 3</li>
                            <li>3<sup>2</sup> mod 7 = 2</li>
                            <li>3<sup>3</sup> mod 7 = 6</li>
                            <li>3<sup>4</sup> mod 7 = 4</li>
                            <li>3<sup>5</sup> mod 7 = 5</li>
                            <li>3<sup>6</sup> mod 7 = 1</li>
                        </ul>
                        <p class="text-slate-700 leading-7 mt-3">
                            これらはすべて異なる値（1, 2, 3, 4, 5, 6）になるため、3 は 7
                            の原始根です。
                        </p>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold text-teal-800 mb-3">入出力例</h3>
                        <div class="bg-slate-50 rounded-lg p-4 border-l-4 border-emerald-500">
                            <div class="mb-3">
                                <span class="font-semibold text-slate-700">入力:</span>
                                <pre class="mt-1 bg-slate-100 p-2 rounded"><code>7</code></pre>
                            </div>
                            <div>
                                <span class="font-semibold text-slate-700">出力:</span>
                                <pre class="mt-1 bg-slate-100 p-2 rounded"><code>3 2</code></pre>
                            </div>
                            <p class="text-slate-600 mt-3 text-sm">
                                7 の原始根は 3 と 5 の2つあり、最小は 3 です。
                            </p>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold text-teal-800 mb-3">制約条件</h3>
                        <ul class="list-disc list-inside text-slate-700 ml-4 space-y-1">
                            <li>p は素数</li>
                            <li>2 ≤ p ≤ 10<sup>9</sup></li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold text-teal-800 mb-3">解法の戦略</h3>
                        <p class="text-slate-700 leading-7 mb-3">
                            原始根を効率的に判定するために、数学的な性質を活用します：
                        </p>
                        <ol class="list-decimal list-inside text-slate-700 ml-4 space-y-2">
                            <li>
                                <strong>原始根の判定条件</strong>: g が原始根である ⇔ すべての (p-1)
                                の素因数 q に対して、g<sup>(p-1)/q</sup> ≢ 1 (mod p)
                            </li>
                            <li>
                                <strong>(p-1) の素因数分解</strong>: まず (p-1)
                                を素因数分解します（O(√p) 時間）
                            </li>
                            <li>
                                <strong>最小原始根の探索</strong>: g = 2
                                から順に上記の判定条件をチェック
                            </li>
                            <li>
                                <strong>原始根の総数</strong>: オイラーのトーシェント関数 φ(p-1)
                                で計算
                            </li>
                        </ol>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold text-teal-800 mb-3">主要ポイント</h3>
                        <div
                            class="bg-gradient-to-r from-emerald-50 to-cyan-50 rounded-lg p-6 border border-emerald-200"
                        >
                            <ul class="space-y-3 text-slate-700">
                                <li class="flex items-start">
                                    <span class="text-emerald-600 font-bold mr-2">⏱</span>
                                    <div>
                                        <strong>時間計算量:</strong> O(√p + k·d·log p)
                                        <br />
                                        <span class="text-sm text-slate-600"
                                            >k = 最小原始根の値、d = (p-1)の素因数の個数</span
                                        >
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-cyan-600 font-bold mr-2">💾</span>
                                    <div>
                                        <strong>空間計算量:</strong> O(d)
                                        <br />
                                        <span class="text-sm text-slate-600"
                                            >素因数リストの保存のみ</span
                                        >
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-purple-600 font-bold mr-2">🔧</span>
                                    <div>
                                        <strong>最適化手法:</strong> Pythonの組み込み関数 pow(base,
                                        exp, mod) を使用した高速累乗剰余演算
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Steps Section (React Component) -->
            <section id="steps" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    ステップバイステップ解説
                </h2>
                <div id="react-steps-root"></div>
            </section>

            <!-- Code Section -->
            <section id="code" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    Python実装
                </h2>
                <pre class="line-numbers"><code class="language-python">#!/bin/python3

import math
import os
import random
import re
import sys

from typing import List

def prime_factors(n: int) -> List[int]:
    """
    nの素因数をリストで返す（重複なし）

    Time Complexity: O(√n)
    """
    factors = []
    # 2で割り切れる場合
    if n % 2 == 0:
        factors.append(2)
        while n % 2 == 0:
            n //= 2

    # 3以降の奇数でチェック
    i = 3
    while i * i <= n:
        if n % i == 0:
            factors.append(i)
            while n % i == 0:
                n //= i
        i += 2

    # nが1より大きければ、それ自体が素数
    if n > 1:
        factors.append(n)

    return factors

def is_primitive_root(g: int, p: int, prime_divisors: List[int]) -> bool:
    """
    gがpの原始根かどうかを判定

    Args:
        g: 判定対象の整数
        p: 素数
        prime_divisors: (p-1)の素因数リスト

    Returns:
        gが原始根ならTrue

    Time Complexity: O(d·log p) where d = len(prime_divisors)
    """
    phi = p - 1

    # 各素因数qについて、g^((p-1)/q) ≢ 1 (mod p) を確認
    for q in prime_divisors:
        if pow(g, phi // q, p) == 1:
            return False

    return True

def euler_phi(n: int) -> int:
    """
    オイラーのトーシェント関数 φ(n) を計算

    Time Complexity: O(√n)
    """
    result = n
    p = 2
    while p * p <= n:
        if n % p == 0:
            while n % p == 0:
                n //= p
            result -= result // p
        p += 1

    if n > 1:
        result -= result // n

    return result

def solve_competitive(p: int) -> tuple:
    """
    競技プログラミング向け実装

    Args:
        p: 素数

    Returns:
        (最小原始根, 原始根の総数)

    Time Complexity: O(√p + k·d·log p)
        where k = 最小原始根の値, d = (p-1)の素因数の個数
    Space Complexity: O(d)
    """
    # (p-1)の素因数を求める
    prime_divisors = prime_factors(p - 1)

    # 最小原始根を探索
    smallest_root = 0
    for g in range(2, p):
        if is_primitive_root(g, p, prime_divisors):
            smallest_root = g
            break

    # 原始根の総数 = φ(p-1)
    total_count = euler_phi(p - 1)

    return smallest_root, total_count

if __name__ == '__main__':
    p = int(input().strip())

    smallest, total = solve_competitive(p)
    print(f"{smallest} {total}")
</code></pre>
            </section>

            <!-- Diagram Section -->
            <section id="diagram" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    フローチャート
                </h2>
                <div class="mt-[20px] overflow-x-auto">
                    <svg
                        viewBox="0 0 1100 1450"
                        style="max-width: 100%; height: auto; color: #333"
                        role="img"
                        aria-label="原始根発見アルゴリズム フローチャート"
                    >
                        <defs>
                            <marker
                                id="arrow"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                            </marker>
                            <marker
                                id="arrowGreen"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                            </marker>
                            <marker
                                id="arrowRed"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#dc2626" />
                            </marker>
                            <marker
                                id="arrowBlue"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#0284c7" />
                            </marker>
                        </defs>

                        <!-- ステップ番号の背景 -->
                        <g id="step-badges">
                            <circle cx="50" cy="50" r="24" fill="#0284c7" />
                            <text
                                x="50"
                                y="55"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                1
                            </text>

                            <circle cx="50" cy="170" r="24" fill="#0284c7" />
                            <text
                                x="50"
                                y="175"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                2
                            </text>

                            <circle cx="50" cy="320" r="24" fill="#0284c7" />
                            <text
                                x="50"
                                y="325"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                3
                            </text>

                            <circle cx="50" cy="440" r="24" fill="#f59e0b" />
                            <text
                                x="50"
                                y="445"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                4
                            </text>

                            <circle cx="50" cy="620" r="24" fill="#0284c7" />
                            <text
                                x="50"
                                y="625"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                5
                            </text>

                            <circle cx="50" cy="840" r="24" fill="#f59e0b" />
                            <text
                                x="50"
                                y="845"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                6
                            </text>

                            <circle cx="50" cy="1120" r="24" fill="#0284c7" />
                            <text
                                x="50"
                                y="1125"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                7
                            </text>

                            <circle cx="50" cy="1260" r="24" fill="#10b981" />
                            <text
                                x="50"
                                y="1265"
                                text-anchor="middle"
                                dominant-baseline="middle"
                                font-size="16"
                                font-weight="bold"
                                fill="white"
                            >
                                8
                            </text>
                        </g>

                        <!-- ステップ1: 開始 -->
                        <ellipse
                            cx="550"
                            cy="50"
                            rx="70"
                            ry="35"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="55"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#059669"
                        >
                            開始
                        </text>

                        <!-- ステップ2: 入力 -->
                        <path
                            d="M 550 85 L 550 130"
                            stroke="#64748b"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <rect
                            x="420"
                            y="130"
                            width="260"
                            height="80"
                            rx="10"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="155"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#0c4a6e"
                        >
                            入力: 素数 p
                        </text>
                        <text
                            x="550"
                            y="185"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#475569"
                        >
                            素数 p を読み込む
                        </text>

                        <!-- ステップ3: (p-1)の素因数分解 -->
                        <path
                            d="M 550 210 L 550 260"
                            stroke="#64748b"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <rect
                            x="380"
                            y="260"
                            width="340"
                            height="100"
                            rx="10"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="285"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#0c4a6e"
                        >
                            (p-1) の素因数分解
                        </text>
                        <text
                            x="550"
                            y="315"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#475569"
                        >
                            関数: prime_factors(p-1)
                        </text>
                        <text
                            x="550"
                            y="340"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            fill="#64748b"
                        >
                            結果: [q₁, q₂, ..., qₐ] の素因数リスト
                        </text>

                        <!-- ステップ4: g = 2 初期化 -->
                        <path
                            d="M 550 360 L 550 400"
                            stroke="#64748b"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <rect
                            x="420"
                            y="400"
                            width="260"
                            height="80"
                            rx="10"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="425"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#92400e"
                        >
                            g = 2 に初期化
                        </text>
                        <text
                            x="550"
                            y="455"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#78350f"
                        >
                            原始根の候補を2から開始
                        </text>

                        <!-- ステップ5: 原始根判定ループ開始 -->
                        <path
                            d="M 550 480 L 550 560"
                            stroke="#64748b"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- ループA領域の背景 -->
                        <rect
                            x="320"
                            y="520"
                            width="460"
                            height="560"
                            rx="15"
                            fill="#f8fafc"
                            stroke="#94a3b8"
                            stroke-width="2"
                            stroke-dasharray="8,4"
                            opacity="0.5"
                        />
                        <text
                            x="330"
                            y="545"
                            text-anchor="start"
                            font-size="14"
                            font-weight="bold"
                            fill="#64748b"
                        >
                            【ループA: 候補gをチェック】
                        </text>

                        <rect
                            x="380"
                            y="560"
                            width="340"
                            height="120"
                            rx="10"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="590"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#0c4a6e"
                        >
                            原始根判定
                        </text>
                        <text
                            x="550"
                            y="620"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#475569"
                        >
                            【ループB: 各素因数qで確認】
                        </text>
                        <text
                            x="550"
                            y="645"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            fill="#64748b"
                        >
                            すべてのqについて
                        </text>
                        <text
                            x="550"
                            y="665"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            fill="#64748b"
                        >
                            g^((p-1)/q) mod p ≠ 1 をチェック
                        </text>

                        <!-- ステップ6: 原始根判定の分岐 -->
                        <path
                            d="M 550 680 L 550 740"
                            stroke="#64748b"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <path
                            d="M 550 740 L 660 820 L 550 900 L 440 820 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="810"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#92400e"
                        >
                            原始根?
                        </text>
                        <text
                            x="550"
                            y="835"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            fill="#78350f"
                        >
                            すべてのqで≠1
                        </text>

                        <!-- はい -> 原始根発見 -->
                        <path
                            d="M 660 820 L 850 820"
                            stroke="#059669"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="755"
                            y="810"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#059669"
                            font-weight="bold"
                        >
                            はい
                        </text>

                        <rect
                            x="850"
                            y="780"
                            width="200"
                            height="80"
                            rx="10"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="3"
                        />
                        <text
                            x="950"
                            y="805"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#065f46"
                        >
                            最小原始根発見!
                        </text>
                        <text
                            x="950"
                            y="835"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#059669"
                        >
                            smallest_root = g
                        </text>

                        <!-- いいえ -> g++ -->
                        <path
                            d="M 550 900 L 550 970"
                            stroke="#dc2626"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="580"
                            y="935"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#dc2626"
                            font-weight="bold"
                        >
                            いいえ
                        </text>

                        <rect
                            x="420"
                            y="970"
                            width="260"
                            height="80"
                            rx="10"
                            fill="#f1f5f9"
                            stroke="#64748b"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="995"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#1e293b"
                        >
                            g = g + 1
                        </text>
                        <text
                            x="550"
                            y="1025"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#475569"
                        >
                            次の候補に進む
                        </text>

                        <!-- ループバック（シンプルな矢印） -->
                        <path
                            d="M 420 1010 L 280 1010 L 280 620 L 380 620"
                            stroke="#0284c7"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrowBlue)"
                            stroke-dasharray="6,6"
                        />
                        <text
                            x="330"
                            y="815"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            fill="#0284c7"
                            font-weight="bold"
                        >
                            ループバック
                        </text>

                        <!-- ステップ7: φ(p-1)計算 -->
                        <path
                            d="M 950 860 L 950 1060"
                            stroke="#059669"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <rect
                            x="820"
                            y="1060"
                            width="260"
                            height="100"
                            rx="10"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="3"
                        />
                        <text
                            x="950"
                            y="1090"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#0c4a6e"
                        >
                            φ(p-1) を計算
                        </text>
                        <text
                            x="950"
                            y="1120"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#475569"
                        >
                            関数: euler_phi(p-1)
                        </text>
                        <text
                            x="950"
                            y="1145"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            fill="#64748b"
                        >
                            結果: 原始根の総数
                        </text>

                        <!-- ステップ8: 結果出力 -->
                        <path
                            d="M 950 1160 L 950 1240 L 680 1240"
                            stroke="#059669"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <rect
                            x="420"
                            y="1200"
                            width="260"
                            height="80"
                            rx="10"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="1225"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#0c4a6e"
                        >
                            結果出力
                        </text>
                        <text
                            x="550"
                            y="1255"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#475569"
                        >
                            (smallest_root, total_count)
                        </text>

                        <!-- 終了 -->
                        <path
                            d="M 550 1280 L 550 1320"
                            stroke="#059669"
                            stroke-width="3"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <ellipse
                            cx="550"
                            cy="1350"
                            rx="70"
                            ry="35"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="3"
                        />
                        <text
                            x="550"
                            y="1355"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="20"
                            font-weight="bold"
                            fill="#059669"
                        >
                            終了
                        </text>
                    </svg>
                </div>

                <div
                    class="mt-8 bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl p-6 border-2 border-cyan-200"
                >
                    <p class="font-[Source_Code_Pro] text-[20px] font-semibold leading-relaxed">
                        <strong class="text-2xl text-cyan-700"
                            >📋 ステップバイステップの流れ：</strong
                        >
                    </p>
                    <div class="mt-4 space-y-3">
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-cyan-600 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >1</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>開始</strong> - アルゴリズムの実行を開始</span
                            >
                        </div>
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-cyan-600 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >2</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>入力</strong> - 素数 p を読み込む</span
                            >
                        </div>
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-cyan-600 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >3</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>素因数分解</strong> - (p-1) の素因数を求める → [q₁, q₂,
                                ..., qₐ]</span
                            >
                        </div>
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-amber-500 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >4</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>初期化</strong> - 候補 g を 2 に初期化</span
                            >
                        </div>
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-cyan-600 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >5</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>原始根判定</strong> - 各素因数 q について g^((p-1)/q) mod p
                                ≠ 1 をチェック（ループB）</span
                            >
                        </div>
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-amber-500 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >6</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>判定結果</strong> - 原始根なら発見して次へ、そうでなければ
                                g++ してループA に戻る</span
                            >
                        </div>
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-cyan-600 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >7</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>総数計算</strong> - φ(p-1)
                                を計算して原始根の総数を求める</span
                            >
                        </div>
                        <div class="flex items-start">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-emerald-600 text-white font-bold text-sm mr-3 flex-shrink-0"
                                >8</span
                            >
                            <span class="text-slate-700 text-lg pt-1"
                                ><strong>出力と終了</strong> - (最小原始根, 総数)
                                を出力してアルゴリズム終了</span
                            >
                        </div>
                    </div>
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <p class="text-slate-600 text-base">
                            <strong class="text-blue-700">💡 初学者向けポイント：</strong><br />
                            • <strong>ループA</strong>は候補 g を順番にチェックする外側のループ<br />
                            • <strong>ループB</strong>は各素因数 q で判定する内側のループ<br />
                            • ループバックの矢印は g++ 後に判定ステップに戻ることを示す<br />
                            • ステップ番号で処理の順序が一目でわかる
                        </p>
                    </div>
                </div>
            </section>

            <!-- Complexity Section -->
            <section id="complexity" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    計算量分析
                </h2>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gradient-to-r from-emerald-100 to-cyan-100">
                                <th
                                    class="border-2 border-emerald-300 px-4 py-3 text-left font-bold text-teal-800"
                                >
                                    項目
                                </th>
                                <th
                                    class="border-2 border-emerald-300 px-4 py-3 text-left font-bold text-teal-800"
                                >
                                    本実装
                                </th>
                                <th
                                    class="border-2 border-emerald-300 px-4 py-3 text-left font-bold text-teal-800"
                                >
                                    全探索（素朴）
                                </th>
                                <th
                                    class="border-2 border-emerald-300 px-4 py-3 text-left font-bold text-teal-800"
                                >
                                    備考
                                </th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-700">
                            <tr class="hover:bg-emerald-50 transition">
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    時間計算量
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded"
                                        >O(√p + k·d·log p)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code class="bg-red-100 text-red-800 px-2 py-1 rounded"
                                        >O(p²·log p)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3 text-sm">
                                    k = 最小原始根（通常小さい）<br />
                                    d = (p-1)の素因数個数
                                </td>
                            </tr>
                            <tr class="hover:bg-emerald-50 transition">
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    空間計算量
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded"
                                        >O(d)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded"
                                        >O(p)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3 text-sm">
                                    素因数リストのみ保存
                                </td>
                            </tr>
                            <tr class="hover:bg-emerald-50 transition">
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    実装コスト
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <span
                                        class="inline-block bg-yellow-100 text-yellow-800 px-3 py-1 rounded font-semibold"
                                        >中</span
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <span
                                        class="inline-block bg-emerald-100 text-emerald-800 px-3 py-1 rounded font-semibold"
                                        >低</span
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3 text-sm">
                                    素因数分解が必要
                                </td>
                            </tr>
                            <tr class="hover:bg-emerald-50 transition">
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    p=10⁹での実用性
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <span
                                        class="inline-block bg-emerald-100 text-emerald-800 px-3 py-1 rounded font-semibold"
                                        >◎ 高速</span
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <span
                                        class="inline-block bg-red-100 text-red-800 px-3 py-1 rounded font-semibold"
                                        >× TLE</span
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3 text-sm">
                                    制約の上限で性能差が顕著
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div
                    class="mt-8 bg-gradient-to-r from-emerald-50 to-cyan-50 rounded-lg p-6 border-l-4 border-emerald-500"
                >
                    <h3 class="text-xl font-bold text-teal-800 mb-3">最適化のポイント</h3>
                    <ul class="space-y-2 text-slate-700">
                        <li class="flex items-start">
                            <span class="text-emerald-600 font-bold mr-2">✓</span>
                            <span
                                ><strong>素因数分解の活用:</strong> (p-1)
                                の素因数だけをチェックすることで、判定回数を大幅削減</span
                            >
                        </li>
                        <li class="flex items-start">
                            <span class="text-emerald-600 font-bold mr-2">✓</span>
                            <span
                                ><strong>高速累乗剰余:</strong> Python の組み込み関数 pow(g, exp, p)
                                を使用（C実装で高速）</span
                            >
                        </li>
                        <li class="flex items-start">
                            <span class="text-emerald-600 font-bold mr-2">✓</span>
                            <span
                                ><strong>早期終了:</strong>
                                最小原始根が見つかった時点で探索を終了</span
                            >
                        </li>
                        <li class="flex items-start">
                            <span class="text-emerald-600 font-bold mr-2">✓</span>
                            <span
                                ><strong>数学的性質:</strong> オイラーのトーシェント関数で総数を
                                O(√p) で計算</span
                            >
                        </li>
                    </ul>
                </div>
            </section>

            <!-- Footer -->
            <footer class="text-center text-slate-600 mt-12 pb-8">
                <p class="text-sm">Created with React 18 + Tailwind CSS + Prism.js</p>
                <p class="text-xs mt-2">© 2026 Algorithm Visualization Project</p>
            </footer>
        </div>

        <!-- Prism.js Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

        <!-- React Component -->
        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            // ステップデータ
            const stepsData = [
                {
                    step: 1,
                    title: '入力と初期確認',
                    desc: '素数 p = 7 を入力として受け取ります。この問題では、7 の原始根を見つけることが目標です。',
                    visual: {
                        type: 'input',
                        p: 7,
                    },
                },
                {
                    step: 2,
                    title: '(p-1)の素因数分解',
                    desc: 'p-1 = 6 を素因数分解します。6 = 2 × 3 なので、素因数は [2, 3] です。これらは後の判定で使用します。',
                    visual: {
                        type: 'factorize',
                        p: 7,
                        pMinus1: 6,
                        factors: [2, 3],
                    },
                },
                {
                    step: 3,
                    title: '候補 g=2 の判定開始',
                    desc: '最初の候補 g = 2 が原始根かどうかを判定します。各素因数 q について、2^((p-1)/q) mod p ≠ 1 を確認します。',
                    visual: {
                        type: 'checkCandidate',
                        p: 7,
                        g: 2,
                        factors: [2, 3],
                        checks: [
                            { q: 2, exp: 3, result: 1, pass: false },
                            { q: 3, exp: 2, result: 4, pass: true },
                        ],
                        isPrimitive: false,
                    },
                },
                {
                    step: 4,
                    title: 'g=2 は原始根でない',
                    desc: '2^3 mod 7 = 1 となり、素因数 2 のチェックで失敗しました。したがって g=2 は原始根ではありません。次の候補 g=3 に進みます。',
                    visual: {
                        type: 'failedCandidate',
                        p: 7,
                        g: 2,
                        reason: '2^((7-1)/2) = 2^3 = 8 ≡ 1 (mod 7)',
                    },
                },
                {
                    step: 5,
                    title: '候補 g=3 の判定',
                    desc: 'g = 3 について判定します。3^3 mod 7 = 6 ≠ 1、3^2 mod 7 = 2 ≠ 1 となり、すべての素因数でチェックをパスします。',
                    visual: {
                        type: 'checkCandidate',
                        p: 7,
                        g: 3,
                        factors: [2, 3],
                        checks: [
                            { q: 2, exp: 3, result: 6, pass: true },
                            { q: 3, exp: 2, result: 2, pass: true },
                        ],
                        isPrimitive: true,
                    },
                },
                {
                    step: 6,
                    title: '最小原始根を発見',
                    desc: 'g = 3 はすべてのチェックをパスしたため、7 の最小原始根は 3 です。これを記録します。',
                    visual: {
                        type: 'foundSmallest',
                        p: 7,
                        smallest: 3,
                        powers: [
                            { exp: 1, result: 3 },
                            { exp: 2, result: 2 },
                            { exp: 3, result: 6 },
                            { exp: 4, result: 4 },
                            { exp: 5, result: 5 },
                            { exp: 6, result: 1 },
                        ],
                    },
                },
                {
                    step: 7,
                    title: '原始根の総数を計算',
                    desc: 'オイラーのトーシェント関数 φ(p-1) = φ(6) を計算します。φ(6) = 6 × (1 - 1/2) × (1 - 1/3) = 2 となります。',
                    visual: {
                        type: 'eulerPhi',
                        p: 7,
                        pMinus1: 6,
                        factors: [2, 3],
                        calculation: 'φ(6) = 6 × (1 - 1/2) × (1 - 1/3) = 6 × 1/2 × 2/3 = 2',
                        result: 2,
                    },
                },
                {
                    step: 8,
                    title: '結果を出力',
                    desc: '最小原始根 3 と総数 2 を出力します。実際、7 の原始根は 3 と 5 の2つです。',
                    visual: {
                        type: 'result',
                        p: 7,
                        smallest: 3,
                        total: 2,
                        allRoots: [3, 5],
                    },
                },
            ];

            // 可視化コンポーネント
            function StepVisualization({ visual }) {
                if (visual.type === 'input') {
                    return (
                        <svg
                            viewBox="0 0 600 200"
                            style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                        >
                            <rect
                                x="200"
                                y="50"
                                width="200"
                                height="100"
                                rx="10"
                                fill="#e0f2fe"
                                stroke="#0284c7"
                                strokeWidth="2"
                            />
                            <text
                                x="300"
                                y="85"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="20"
                                fontWeight="bold"
                                fill="#0c4a6e"
                            >
                                入力: p = {visual.p}
                            </text>
                            <text
                                x="300"
                                y="115"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="16"
                                fill="#475569"
                            >
                                素数を受け取る
                            </text>
                        </svg>
                    );
                }

                if (visual.type === 'factorize') {
                    return (
                        <svg
                            viewBox="0 0 600 300"
                            style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                        >
                            <defs>
                                <marker
                                    id="arrow"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="9"
                                    refY="3"
                                    orient="auto"
                                    markerUnits="strokeWidth"
                                >
                                    <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                                </marker>
                            </defs>
                            <rect
                                x="50"
                                y="50"
                                width="200"
                                height="80"
                                rx="10"
                                fill="#fef3c7"
                                stroke="#f59e0b"
                                strokeWidth="2"
                            />
                            <text
                                x="150"
                                y="75"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fontWeight="bold"
                                fill="#92400e"
                            >
                                p - 1 = {visual.pMinus1}
                            </text>
                            <text
                                x="150"
                                y="100"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="16"
                                fill="#78350f"
                            >
                                素因数分解する
                            </text>

                            <path
                                d="M 250 90 L 320 90"
                                stroke="#64748b"
                                strokeWidth="2"
                                fill="none"
                                markerEnd="url(#arrow)"
                            />
                            <text
                                x="285"
                                y="80"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="14"
                                fill="#64748b"
                            >
                                分解
                            </text>

                            <rect
                                x="320"
                                y="50"
                                width="230"
                                height="80"
                                rx="10"
                                fill="#d1fae5"
                                stroke="#10b981"
                                strokeWidth="2"
                            />
                            <text
                                x="435"
                                y="75"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fontWeight="bold"
                                fill="#065f46"
                            >
                                素因数リスト
                            </text>
                            <text
                                x="435"
                                y="100"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="20"
                                fill="#059669"
                            >
                                [{visual.factors.join(', ')}]
                            </text>

                            <rect
                                x="150"
                                y="180"
                                width="300"
                                height="80"
                                rx="10"
                                fill="#e0f2fe"
                                stroke="#0284c7"
                                strokeWidth="2"
                            />
                            <text
                                x="300"
                                y="205"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="16"
                                fontWeight="bold"
                                fill="#0c4a6e"
                            >
                                計算過程
                            </text>
                            <text
                                x="300"
                                y="230"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="14"
                                fill="#475569"
                            >
                                {visual.pMinus1} = {visual.factors.join(' × ')}
                            </text>
                        </svg>
                    );
                }

                if (visual.type === 'checkCandidate') {
                    const yStart = 80;
                    const yGap = 100;
                    return (
                        <svg
                            viewBox="0 0 600 400"
                            style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                        >
                            <rect
                                x="50"
                                y="20"
                                width="180"
                                height="60"
                                rx="10"
                                fill="#e0f2fe"
                                stroke="#0284c7"
                                strokeWidth="2"
                            />
                            <text
                                x="140"
                                y="40"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fontWeight="bold"
                                fill="#0c4a6e"
                            >
                                候補: g = {visual.g}
                            </text>
                            <text
                                x="140"
                                y="60"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="14"
                                fill="#475569"
                            >
                                p = {visual.p}
                            </text>

                            {visual.checks.map((check, idx) => {
                                const y = yStart + idx * yGap;
                                const color = check.pass ? '#059669' : '#dc2626';
                                const bgColor = check.pass ? '#d1fae5' : '#fee2e2';
                                const label = check.pass ? '✓ パス' : '✗ 失敗';

                                return (
                                    <g key={idx}>
                                        <rect
                                            x="50"
                                            y={y}
                                            width="500"
                                            height="80"
                                            rx="10"
                                            fill={bgColor}
                                            stroke={color}
                                            strokeWidth="2"
                                        />
                                        <text
                                            x="300"
                                            y={y + 25}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fontSize="16"
                                            fontWeight="bold"
                                            fill={color}
                                        >
                                            素因数 q = {check.q}: {visual.g}^((p-1)/{check.q}) ={' '}
                                            {visual.g}^{check.exp} mod {visual.p}
                                        </text>
                                        <text
                                            x="300"
                                            y={y + 50}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fontSize="18"
                                            fill={color}
                                        >
                                            結果: {check.result} {check.pass ? '≠' : '='} 1 →{' '}
                                            {label}
                                        </text>
                                    </g>
                                );
                            })}

                            <rect
                                x="150"
                                y="300"
                                width="300"
                                height="70"
                                rx="10"
                                fill={visual.isPrimitive ? '#d1fae5' : '#fee2e2'}
                                stroke={visual.isPrimitive ? '#10b981' : '#dc2626'}
                                strokeWidth="3"
                            />
                            <text
                                x="300"
                                y="325"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="20"
                                fontWeight="bold"
                                fill={visual.isPrimitive ? '#065f46' : '#991b1b'}
                            >
                                {visual.isPrimitive ? '✓ 原始根です！' : '✗ 原始根ではない'}
                            </text>
                            <text
                                x="300"
                                y="350"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="14"
                                fill={visual.isPrimitive ? '#059669' : '#b91c1c'}
                            >
                                {visual.isPrimitive ? 'すべてのチェックをパス' : 'チェックに失敗'}
                            </text>
                        </svg>
                    );
                }

                if (visual.type === 'failedCandidate') {
                    return (
                        <svg
                            viewBox="0 0 600 250"
                            style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                        >
                            <rect
                                x="100"
                                y="50"
                                width="400"
                                height="100"
                                rx="10"
                                fill="#fee2e2"
                                stroke="#dc2626"
                                strokeWidth="3"
                            />
                            <text
                                x="300"
                                y="80"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="20"
                                fontWeight="bold"
                                fill="#991b1b"
                            >
                                g = {visual.g} は原始根ではない
                            </text>
                            <text
                                x="300"
                                y="110"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="16"
                                fill="#b91c1c"
                            >
                                理由: {visual.reason}
                            </text>

                            <rect
                                x="150"
                                y="180"
                                width="300"
                                height="50"
                                rx="10"
                                fill="#f1f5f9"
                                stroke="#64748b"
                                strokeWidth="2"
                            />
                            <text
                                x="300"
                                y="205"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fontWeight="bold"
                                fill="#1e293b"
                            >
                                → 次の候補 g = {visual.g + 1} へ
                            </text>
                        </svg>
                    );
                }

                if (visual.type === 'foundSmallest') {
                    const cellWidth = 80;
                    const cellHeight = 60;
                    const startX = 60;
                    const startY = 120;

                    return (
                        <svg
                            viewBox="0 0 600 400"
                            style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                        >
                            <rect
                                x="100"
                                y="20"
                                width="400"
                                height="70"
                                rx="10"
                                fill="#d1fae5"
                                stroke="#10b981"
                                strokeWidth="3"
                            />
                            <text
                                x="300"
                                y="45"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="22"
                                fontWeight="bold"
                                fill="#065f46"
                            >
                                最小原始根発見: g = {visual.smallest}
                            </text>
                            <text
                                x="300"
                                y="70"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="16"
                                fill="#059669"
                            >
                                p = {visual.p} の原始根
                            </text>

                            <text
                                x="300"
                                y="110"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="16"
                                fontWeight="bold"
                                fill="#0c4a6e"
                            >
                                g = {visual.smallest} の累乗結果（すべて異なる値）
                            </text>

                            {visual.powers.map((pow, idx) => {
                                const x = startX + (idx % 3) * (cellWidth + 10);
                                const y = startY + Math.floor(idx / 3) * (cellHeight + 10);

                                return (
                                    <g key={idx}>
                                        <rect
                                            x={x}
                                            y={y}
                                            width={cellWidth}
                                            height={cellHeight}
                                            rx="8"
                                            fill="#e0f2fe"
                                            stroke="#0284c7"
                                            strokeWidth="2"
                                        />
                                        <text
                                            x={x + cellWidth / 2}
                                            y={y + 20}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fontSize="14"
                                            fontWeight="bold"
                                            fill="#0c4a6e"
                                        >
                                            {visual.smallest}^{pow.exp}
                                        </text>
                                        <text
                                            x={x + cellWidth / 2}
                                            y={y + 45}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fontSize="18"
                                            fill="#0284c7"
                                        >
                                            {pow.result}
                                        </text>
                                    </g>
                                );
                            })}
                        </svg>
                    );
                }

                if (visual.type === 'eulerPhi') {
                    return (
                        <svg
                            viewBox="0 0 600 350"
                            style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                        >
                            <rect
                                x="100"
                                y="30"
                                width="400"
                                height="70"
                                rx="10"
                                fill="#fef3c7"
                                stroke="#f59e0b"
                                strokeWidth="2"
                            />
                            <text
                                x="300"
                                y="55"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="20"
                                fontWeight="bold"
                                fill="#92400e"
                            >
                                オイラーのトーシェント関数
                            </text>
                            <text
                                x="300"
                                y="80"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fill="#78350f"
                            >
                                φ({visual.pMinus1}) を計算
                            </text>

                            <rect
                                x="10"
                                y="130"
                                width="580"
                                height="100"
                                rx="10"
                                fill="#e0f2fe"
                                stroke="#0284c7"
                                strokeWidth="2"
                            />
                            <text
                                x="300"
                                y="155"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="16"
                                fontWeight="bold"
                                fill="#0c4a6e"
                            >
                                計算式
                            </text>
                            <text
                                x="300"
                                y="180"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fill="#475569"
                                fontFamily="'JetBrains Mono', monospace"
                            >
                                {visual.calculation}
                            </text>
                            <text
                                x="300"
                                y="210"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="14"
                                fill="#64748b"
                            >
                                素因数 [{visual.factors.join(', ')}] を使用
                            </text>

                            <rect
                                x="150"
                                y="260"
                                width="300"
                                height="70"
                                rx="10"
                                fill="#d1fae5"
                                stroke="#10b981"
                                strokeWidth="3"
                            />
                            <text
                                x="300"
                                y="285"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="20"
                                fontWeight="bold"
                                fill="#065f46"
                            >
                                原始根の総数
                            </text>
                            <text
                                x="300"
                                y="310"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="28"
                                fill="#059669"
                                fontWeight="bold"
                            >
                                {visual.result}
                            </text>
                        </svg>
                    );
                }

                if (visual.type === 'result') {
                    return (
                        <svg
                            viewBox="0 0 600 300"
                            style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                        >
                            <rect
                                x="100"
                                y="30"
                                width="400"
                                height="80"
                                rx="10"
                                fill="#d1fae5"
                                stroke="#10b981"
                                strokeWidth="3"
                            />
                            <text
                                x="300"
                                y="55"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="22"
                                fontWeight="bold"
                                fill="#065f46"
                            >
                                p = {visual.p} の原始根
                            </text>
                            <text
                                x="300"
                                y="85"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fill="#059669"
                            >
                                すべての原始根: {visual.allRoots.join(', ')}
                            </text>

                            <rect
                                x="80"
                                y="140"
                                width="200"
                                height="120"
                                rx="10"
                                fill="#e0f2fe"
                                stroke="#0284c7"
                                strokeWidth="2"
                            />
                            <text
                                x="180"
                                y="165"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fontWeight="bold"
                                fill="#0c4a6e"
                            >
                                最小原始根
                            </text>
                            <text
                                x="180"
                                y="210"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="48"
                                fill="#0284c7"
                                fontWeight="bold"
                            >
                                {visual.smallest}
                            </text>

                            <rect
                                x="320"
                                y="140"
                                width="200"
                                height="120"
                                rx="10"
                                fill="#e0f2fe"
                                stroke="#0284c7"
                                strokeWidth="2"
                            />
                            <text
                                x="420"
                                y="165"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="18"
                                fontWeight="bold"
                                fill="#0c4a6e"
                            >
                                原始根の総数
                            </text>
                            <text
                                x="420"
                                y="210"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="48"
                                fill="#0284c7"
                                fontWeight="bold"
                            >
                                {visual.total}
                            </text>
                        </svg>
                    );
                }

                return null;
            }

            // メインコンポーネント
            function StepsComponent() {
                const [activeStep, setActiveStep] = useState(1);
                const [isPlaying, setIsPlaying] = useState(false);
                const timerRef = useRef(null);

                const currentStepData =
                    stepsData.find((s) => s.step === activeStep) || stepsData[0];

                useEffect(() => {
                    if (isPlaying) {
                        if (activeStep > stepsData.length) {
                            setIsPlaying(false);
                            setActiveStep(1);
                            return;
                        }

                        timerRef.current = setTimeout(() => {
                            if (activeStep === stepsData.length) {
                                setActiveStep(1);
                                setIsPlaying(false);
                            } else {
                                setActiveStep((prev) => prev + 1);
                            }
                        }, 2000);
                    }
                    return () => {
                        if (timerRef.current) clearTimeout(timerRef.current);
                    };
                }, [isPlaying, activeStep]);

                const handlePlay = () => {
                    if (isPlaying) return;
                    setActiveStep(1);
                    setIsPlaying(true);
                };

                const handlePrev = () => {
                    if (activeStep > 1) {
                        setActiveStep((prev) => prev - 1);
                        setIsPlaying(false);
                    }
                };

                const handleNext = () => {
                    if (activeStep < stepsData.length) {
                        setActiveStep((prev) => prev + 1);
                        setIsPlaying(false);
                    }
                };

                const handleReset = () => {
                    setActiveStep(1);
                    setIsPlaying(false);
                };

                const handleStepClick = (step) => {
                    setActiveStep(step);
                    setIsPlaying(false);
                };

                return (
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8 mt-2">
                        <div>
                            <h3 className="mt-0 mb-4 text-teal-800 text-xl font-semibold">
                                ステップ一覧
                            </h3>
                            <div className="space-y-2">
                                {stepsData.map((step) => {
                                    const isActive = activeStep === step.step;
                                    return (
                                        <button
                                            key={step.step}
                                            type="button"
                                            className={[
                                                'w-full text-left text-[0.95rem] rounded-xl border-2 transition cursor-pointer px-4 py-4',
                                                'bg-white border-slate-200 hover:border-emerald-500 hover:translate-x-1',
                                                isActive
                                                    ? 'bg-[linear-gradient(135deg,#d1fae5,#a7f3d0)] border-emerald-500 shadow-[0_4px_12px_rgba(16,185,129,0.20)]'
                                                    : '',
                                            ].join(' ')}
                                            onClick={() => handleStepClick(step.step)}
                                            aria-label={`ステップ${step.step}: ${step.title}`}
                                            aria-current={isActive ? 'step' : undefined}
                                        >
                                            <div
                                                className={[
                                                    'font-bold mb-1',
                                                    isActive ? 'text-emerald-900' : 'text-teal-800',
                                                ].join(' ')}
                                            >
                                                Step {step.step}: {step.title}
                                            </div>
                                            <div className="text-slate-500 text-sm mt-1">
                                                {step.desc.substring(0, 50)}
                                                {step.desc.length > 50 ? '...' : ''}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="my-auto">
                            <div className="rounded-2xl p-8 mt-10 border-2 border-emerald-200 bg-[linear-gradient(135deg,#ecfdf5,#f0f9ff)]">
                                <h3 className="mt-0 text-teal-800 text-xl font-semibold">
                                    Step {currentStepData.step}: {currentStepData.title}
                                </h3>
                                <p className="text-slate-600 leading-7">{currentStepData.desc}</p>
                            </div>

                            <StepVisualization visual={currentStepData.visual} />

                            <div className="flex flex-wrap justify-center gap-2 mt-1">
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#10b981,#059669)]"
                                    onClick={handlePlay}
                                    disabled={isPlaying}
                                    aria-label="自動再生"
                                >
                                    ▶ Play
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-slate-700 transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(100,116,139,0.20)] bg-white border-2 border-slate-300"
                                    onClick={handlePrev}
                                    disabled={activeStep === 1}
                                    aria-label="前のステップ"
                                >
                                    ◀ Prev
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-slate-700 transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(100,116,139,0.20)] bg-white border-2 border-slate-300"
                                    onClick={handleNext}
                                    disabled={activeStep === stepsData.length}
                                    aria-label="次のステップ"
                                >
                                    Next ▶
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(100,116,139,0.30)] bg-[linear-gradient(135deg,#64748b,#475569)]"
                                    onClick={handleReset}
                                    aria-label="リセット"
                                >
                                    ⟲ Reset
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // マウント
            const root = ReactDOM.createRoot(document.getElementById('react-steps-root'));
            root.render(<StepsComponent />);
        </script>
    </body>
</html>
