では、先ほどの **TypeScript版 trap関数** の各処理を、図を使ってわかりやすく分解して説明します。
アルゴリズムは **two-pointer法** です。

---

## 1. 問題のイメージ

高さ配列（例）：

```
height = [0,1,0,2,1,0,1,3,2,1,2,1]
```

棒グラフとして表すとこんな感じです（`#` = 柱, `.` = 空白, `~` = 水）：

```
        #..
    #..~##.#
~.#~##~#####
############
0 1 2 3 4 5 6 7 8 9 10 11
```

目的：
**各マスの左右にある最高の柱の高さ**を求め、その最小値から現在の高さを引くことで水の量を計算します。
この作業を左右ポインタで同時に進めることで、1回の走査で計算できます。

---

## 2. 初期化

```typescript
let left = 0;
let right = n - 1;
let leftMax = 0;
let rightMax = 0;
let water = 0;
```

図：

```
L                                                R
↓                                                ↓
[0, 1, 0, 2, 1, 0, 1, 3, 2, 1, 2, 1]
leftMax = 0
rightMax = 0
water = 0
```

- **left** → 左端から右へ移動
- **right** → 右端から左へ移動
- **leftMax** / **rightMax** → これまでの最大柱高さの記録
- **water** → 最終的な水の総量

---

## 3. ループ条件

```typescript
while (left < right) {
```

- **左右ポインタが交差するまで繰り返す**
- 小さい側を基準に処理すると、その側の最大高さとの差を安全に計算できる

---

## 4. 左右どちらを動かすかの判定

```typescript
if (height[left] < height[right]) {
    // 左側が低いので左を処理
} else {
    // 右側が低いので右を処理
}
```

図（例1回目）：

```
L                                                R
↓                                                ↓
0                                                1
```

- 左の高さ(0) < 右の高さ(1) → 左側を処理
- この時点では、右側に十分高い柱があるので左の水量は確定できる

---

## 5. 左側を処理する場合

```typescript
if (height[left] >= leftMax) {
    leftMax = height[left];
} else {
    water += leftMax - height[left];
}
left++;
```

### 図解例（1回目の左処理）：

```
leftMax = 0
height[left] = 0 → 0 >= 0 → leftMax更新 (0)
water = 0
```

```
  ~ ← 水はまだなし
[#]
```

- leftMax更新後、leftを1つ右へ移動

---

## 6. 水を加算する場合（左）

もし `height[left] < leftMax` なら、その差が水の量です。

例：

```
leftMax = 1
height[left] = 0 → 差 = 1 - 0 = 1 → water += 1
```

図：

```
  ~ ← この分の水が溜まる
[#]
```

---

## 7. 右側を処理する場合

```typescript
if (height[right] >= rightMax) {
    rightMax = height[right];
} else {
    water += rightMax - height[right];
}
right--;
```

右も同様に、rightMaxとの差で水を計算します。

---

## 8. 全体の流れ（例: height = \[0,1,0,2,1,0,1,3,2,1,2,1]）

| step | left | right | leftMax | rightMax | height\[left] | height\[right] | water増分 | water合計 |
| ---- | ---- | ----- | ------- | -------- | ------------- | -------------- | --------- | --------- |
| 1    | 0    | 11    | 0       | 0        | 0             | 1              | 0         | 0         |
| 2    | 1    | 11    | 1       | 0        | 1             | 1              | 0         | 0         |
| 3    | 2    | 11    | 1       | 0        | 0             | 1              | 1         | 1         |
| 4    | 3    | 11    | 2       | 0        | 2             | 1              | 0         | 1         |
| 5    | ...  | ...   | ...     | ...      | ...           | ...            | ...       | ...       |

最後に water = **6** になります。

---

## 9. 処理の可視化（全体イメージ）

```
height:     [0,1,0,2,1,0,1,3,2,1,2,1]
water:      [0,0,1,0,1,2,1,0,0,1,0,0]
total water = 6
```

図：

```
        #..
    #..~##.#
~.#~##~#####
############
```

- 青い部分(`~`)が計算で得られる水の量
- 左右の最大高さの差を使って安全に求められる

---

これで各処理がどのように水の計算に結びつくかがわかると思います。
