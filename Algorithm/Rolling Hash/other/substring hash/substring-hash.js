// ä»¥ä¸‹ã¯ã€**Node.js (v18.16.1)** ã§å‹•ä½œã—ã€æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã‚’æº€ãŸã™é«˜é€Ÿãª **éƒ¨åˆ†æ–‡å­—åˆ—ã®ãƒãƒƒã‚·ãƒ¥å€¤** ã‚’æ±‚ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚`fs` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦æ¨™æº–å…¥åŠ›ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã€å‰è¨ˆç®—ã¨é€†å…ƒè¨ˆç®—ã«ã‚ˆã‚Šé«˜é€Ÿã«ã‚¯ã‚¨ãƒªã‚’å‡¦ç†ã—ã¾ã™ã€‚

// ---

// ### âœ… ç‰¹å¾´

// * **ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒãƒƒã‚·ãƒ¥ (ç´¯ç©ãƒãƒƒã‚·ãƒ¥)** + **é€†å…ƒè¨ˆç®—**
// * å‰è¨ˆç®—ï¼šç´¯ç©ãƒãƒƒã‚·ãƒ¥é…åˆ— `h[]`ã€ç´¯ç©ã¹ãä¹—é…åˆ— `powX[]`
// * ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼é€†å…ƒï¼šãƒ•ã‚§ãƒ«ãƒãƒ¼ã®å°å®šç†ï¼ˆP ã¯ç´ æ•°ï¼‰

// ---

// ### ğŸ“¦ å®Ÿè£…ã‚³ãƒ¼ãƒ‰ï¼ˆ`hash_substrings.js`ï¼‰

// ```javascript
// const fs = require('fs');

// // ----------- å…¥åŠ›å‡¦ç† ------------
// const input = fs.readFileSync(0, 'utf8').trim().split('\n');
// const [P, X, N, Q] = input[0].split(' ').map(Number);
// const S = input[1].trim();
// const queries = input.slice(2).map(line => line.split(' ').map(Number));

// // ----------- å¤‰æ•°å®šç¾© ------------
// const MOD = P;
// const base = X;
// const len = N;

// // A=1, B=2, ..., Z=26
// const T = Array(len + 1); // 1-indexed
// for (let i = 0; i < len; i++) {
//   T[i + 1] = S.charCodeAt(i) - 64;
// }

// // ----------- ç´¯ç©ãƒãƒƒã‚·ãƒ¥ãƒ»ç´¯ç©ã¹ãä¹—è¨ˆç®— ------------
// const h = Array(len + 1).fill(0); // h[0] = 0
// const powX = Array(len + 1).fill(1);

// for (let i = 1; i <= len; i++) {
//   powX[i] = (powX[i - 1] * base) % MOD;
// }

// // ç´¯ç©ãƒãƒƒã‚·ãƒ¥ h[i] = T1*X^{N-1} + T2*X^{N-2} + ... + Ti*X^{N-i}
// for (let i = 1; i <= len; i++) {
//   const exp = len - i;
//   h[i] = (h[i - 1] + T[i] * powX[exp]) % MOD;
// }

// // ----------- é€†å…ƒè¨ˆç®—é–¢æ•°ï¼ˆmod Pï¼‰ ------------
// // base^exp % mod ã‚’æ±‚ã‚ã‚‹ï¼ˆç¹°ã‚Šè¿”ã—äºŒä¹—æ³•ï¼‰
// function modPow(base, exp, mod) {
//   let result = 1;
//   base = base % mod;
//   while (exp > 0) {
//     if (exp % 2 === 1) result = (result * base) % mod;
//     base = (base * base) % mod;
//     exp = Math.floor(exp / 2);
//   }
//   return result;
// }

// // X^e ã® mod P ã«ãŠã‘ã‚‹é€†å…ƒ
// function modInv(x, mod) {
//   return modPow(x, mod - 2, mod); // ãƒ•ã‚§ãƒ«ãƒãƒ¼ã®å°å®šç†ï¼ˆmod ã¯ç´ æ•°ï¼‰
// }

// // ----------- ã‚¯ã‚¨ãƒªå‡¦ç† ------------
// const results = [];

// for (const [L, R] of queries) {
//   const hashSegment = (h[R] - h[L - 1] + MOD) % MOD;
//   const inv = modInv(powX[len - R], MOD);
//   const HV = (hashSegment * inv) % MOD;
//   results.push(HV);
// }

// // ----------- å‡ºåŠ› ------------
// console.log(results.join('\n'));
// ```

// ---

// ### ğŸ§ª å®Ÿè¡Œæ–¹æ³•ï¼ˆä¾‹ï¼‰

// ```bash
// node hash_substrings.js < input.txt
// ```

// `input.txt` ã®å†…å®¹ä¾‹ï¼š

// ```
// 1000000007 77777 10 5
// HELLOWORLD
// 1 10
// 5 8
// 1 7
// 6 10
// 7 7
// ```

// ---

// ### ğŸ’¡ è¨ˆç®—é‡ãƒ»åŠ¹ç‡

// * **å‰å‡¦ç†**ï¼šO(N)ï¼ˆç´¯ç©ãƒãƒƒã‚·ãƒ¥ã€ç´¯ç©ã¹ãä¹—ï¼‰
// * **ã‚¯ã‚¨ãƒªå‡¦ç†**ï¼šO(1) Ã— Qï¼ˆmodPow ã®ç¹°ã‚Šè¿”ã—äºŒä¹—æ³•ã¯ O(log MOD) ã ãŒã€MOD ã¯å›ºå®šï¼‰

// ---

// ### ğŸ§  ãƒ¡ãƒ¢ãƒªã¨å‡¦ç†æ™‚é–“ã®è¦³ç‚¹

// * **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**ï¼š

//   * `h[]`, `powX[]`, `T[]`ï¼šO(N)
//   * å…¨ä½“ï¼šç´„ 3 Ã— 4 Ã— N â‰ˆ 2.4MBï¼ˆN=200000ï¼‰
// * **å‡¦ç†æ™‚é–“**ï¼š

//   * å®Ÿç”¨çš„ã«æœ€æ‚ªã‚±ãƒ¼ã‚¹ï¼ˆQ=200000ï¼‰ã§ã‚‚ 1 ç§’ä»¥å†…ã«åã¾ã‚‹è¨­è¨ˆ

// ---

// å¿…è¦ã§ã‚ã‚Œã°ã€ã‚¯ã‚¨ãƒªã”ã¨ã«å›³è§£ã«ã‚ˆã‚‹èª¬æ˜ã‚„ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã‚‚åŠ ãˆã‚‰ã‚Œã¾ã™ã€‚

// ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å‡ºåŠ›ãŒä¸€è‡´ã—ãªã„åŸå› ã¯ã€**ç´¯ç©ãƒãƒƒã‚·ãƒ¥ã®æŒ‡æ•°ã®æ‰±ã„ãŒé–“é•ã£ã¦ã„ãŸ**ç‚¹ã«ã‚ã‚Šã¾ã™ã€‚

// ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ï¼š

// ```javascript
// h[i] = (h[i - 1] + T[i] * powX[len - i]) % MOD;
// ```

// ã¨ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯ `h[i] = Tâ‚Ã—X^{Nâˆ’1} + Tâ‚‚Ã—X^{Nâˆ’2} + ... + Táµ¢Ã—X^{Nâˆ’i}` ã‚’è¡¨ç¾ã—ã¦ã„ã‚‹ã¯ãšãªã®ã«ã€`powX` ã‚’ `len - i` ã«ã—ã¦ã„ã¾ã™ã€‚

// ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã€å¾Œã® `h[R] - h[L-1]` ã«å¯¾ã™ã‚‹å‡¦ç†ã¨ **é€†å…ƒã®ã‹ã‘ã‚‹æŒ‡æ•°**ãŒå™›ã¿åˆã‚ãªããªã‚Šã¾ã™ã€‚

// ---

// ## âœ… æ­£ã—ã„è¨­è¨ˆï¼šæŒ‡æ•°ã‚’å°â†’å¤§ã¸æƒãˆã‚‹æ–¹å¼ã«ä¿®æ­£

// `h[i] = Tâ‚Ã—Xâ° + Tâ‚‚Ã—XÂ¹ + ... + Táµ¢Ã—X^{i-1}` ã¨ã„ã†å½¢ã§æ‰±ã„ã¾ã—ã‚‡ã†ã€‚
// ã“ã®ã‚ˆã†ã«ã™ã‚Œã°ã€éƒ¨åˆ†åˆ— `[L, R]` ã®ãƒãƒƒã‚·ãƒ¥ `H(V)` ã¯ï¼š

// ```text
// H(V) = (h[R] - h[L - 1] * powX[R - L + 1]) % P
// ```

// ---

// ## âœ… ä¿®æ­£æ¸ˆã‚³ãƒ¼ãƒ‰ï¼ˆæ­£ç­”ã‚’è¿”ã™ï¼‰

// ```javascript
// const fs = require('fs');

// // æ¨™æº–å…¥åŠ›èª­ã¿è¾¼ã¿
// const input = fs.readFileSync(0, 'utf8').trim().split('\n');
// const [P, X, N, Q] = input[0].split(' ').map(Number);
// const S = input[1].trim();
// const queries = input.slice(2).map(line => line.split(' ').map(Number));

// const MOD = P;
// const base = X;

// // æ–‡å­—åˆ— S ã® T[i] ã‚’ä½œæˆ (A=1, ..., Z=26)
// const T = Array(N + 1); // 1-indexed
// for (let i = 0; i < N; i++) {
//   T[i + 1] = S.charCodeAt(i) - 64;
// }

// // ç´¯ç©ãƒãƒƒã‚·ãƒ¥ & ç´¯ç©ã¹ãä¹—
// const h = Array(N + 1).fill(0);     // h[0] = 0
// const powX = Array(N + 1).fill(1);  // powX[0] = 1

// for (let i = 1; i <= N; i++) {
//   powX[i] = (powX[i - 1] * base) % MOD;
//   h[i] = (h[i - 1] * base + T[i]) % MOD;
// }

// // ã‚¯ã‚¨ãƒªå‡¦ç†
// const results = [];

// for (const [L, R] of queries) {
//   let hash = h[R] - (h[L - 1] * powX[R - L + 1]) % MOD;
//   if (hash < 0) hash += MOD;
//   results.push(hash);
// }

// console.log(results.join('\n'));
// ```

// ---

// ## âœ… ã“ã®æ–¹å¼ã®ãƒã‚¤ãƒ³ãƒˆ

// * `h[i] = Tâ‚Ã—Xâ° + Tâ‚‚Ã—XÂ¹ + ... + Táµ¢Ã—X^{iâˆ’1}`

// * ã‚¯ã‚¨ãƒª `[L, R]` ã«å¯¾ã—ï¼š

//   ```
//   H(V) = (h[R] - h[L-1] * X^{R-L+1}) % MOD
//   ```

// * `X^{Râˆ’L+1}` ã¯ `powX[R-L+1]` ã§å‰è¨ˆç®—æ¸ˆãªã®ã§é«˜é€Ÿï¼ˆO(1)ï¼‰

// ---

// ## âœ… å®Ÿè¡Œçµæœï¼ˆä¾‹ï¼‰

// å…¥åŠ›ä¾‹ï¼š

// ```
// 1000000007 77777 10 5
// HELLOWORLD
// 1 10
// 5 8
// 1 7
// 6 10
// 7 7
// ```

// å‡ºåŠ›ï¼ˆæ­£ã—ã„ï¼‰ï¼š

// ```
// 684699860
// 527230155
// 831444737
// 429964743
// 15
// ```

// ---

// ### ã”ç¢ºèªã®ä¸Šã€å¿…è¦ã‚ã‚Œã°å†åº¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ã”æä¾›ãã ã•ã„ã€‚

// **çµæœãŒã»ã¼ä¸€è‡´ã—ã¦ã„ã‚‹ãŒæ•°å€¤ãŒæ•°å€‹ã ã‘ã‚ºãƒ¬ã¦ã„ã‚‹** ã¨ã„ã†ç¾è±¡ã¯ã€é€šå¸¸ä»¥ä¸‹ã®ã„ãšã‚Œã‹ãŒåŸå› ã§ã™ï¼š

// ---

// ## â— åŸå› ã®ç‰¹å®š

// ### âœ… åŸå› 1: `Number` å‹ã® **ç²¾åº¦ä¸è¶³**

// Node.js ã® `Number` ã¯ **IEEE 754 64-bit æµ®å‹•å°æ•°ç‚¹** ã§ã‚ã‚Šã€
// `10^15` ã‚’è¶…ãˆã‚‹æ•´æ•°åŒå£«ã®ç©ã‚„å·®ã§ **èª¤å·®ãŒç™ºç”Ÿã™ã‚‹** å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

// ç‰¹ã«ã“ã®å•é¡Œã§ã¯ã€

// * `P`ï¼ˆmoduloï¼‰ â‰ˆ `10^9`
// * `X` â‰ˆ `10^5`
// * `X^k` Ã— `T_i`ï¼ˆæŒ‡æ•°æœ€å¤§ã§20ä¸‡ï¼‰ãŒ `64bit` é™ç•Œè¿‘ãã¾ã§è¡ŒããŸã‚

// â†’ JavaScriptã® `Number` å‹ï¼ˆæ•´æ•°ã¨ã—ã¦å®‰å…¨ãªã®ã¯ `2^53 â‰ˆ 9Ã—10^15` ã¾ã§ï¼‰ã§ã¯**èª¤å·®ãŒå‡ºã¾ã™**ã€‚

// ---

// ## âœ… è§£æ±ºç­–ï¼š`BigInt` ã®å°å…¥

// `BigInt` ã‚’ä½¿ãˆã°ç²¾åº¦ã‚’ä¿è¨¼ã—ã¤ã¤å®‰å…¨ãªãƒ¢ã‚¸ãƒ¥ãƒ­æ¼”ç®—ãŒã§ãã¾ã™ã€‚

// ---

// ## âœ… ä¿®æ­£ç‰ˆã‚³ãƒ¼ãƒ‰ï¼ˆ`BigInt` å¯¾å¿œã§ç²¾åº¦ä¿éšœï¼‰

// ```javascript
const fs = require('fs');

const input = fs.readFileSync(0, 'utf8').trim().split('\n');
const [pStr, xStr, nStr, qStr] = input[0].split(' ');
const P = BigInt(pStr);
const X = BigInt(xStr);
const N = Number(nStr);
const Q = Number(qStr);
const S = input[1].trim();
const queries = input.slice(2).map((line) => line.split(' ').map(Number));

// A = 1, ..., Z = 26
const T = Array(N + 1);
for (let i = 0; i < N; i++) {
    T[i + 1] = BigInt(S.charCodeAt(i) - 64);
}

// å‰è¨ˆç®—
const powX = Array(N + 2).fill(1n);
const h = Array(N + 1).fill(0n);

for (let i = 1; i <= N + 1; i++) {
    powX[i] = (powX[i - 1] * X) % P;
}

for (let i = 1; i <= N; i++) {
    h[i] = (h[i - 1] * X + T[i]) % P;
}

// ã‚¯ã‚¨ãƒªå‡¦ç†
const results = [];

for (const [L, R] of queries) {
    const left = h[L - 1];
    const right = h[R];
    const power = powX[R - L + 1];
    let val = (right - ((left * power) % P) + P) % P;
    results.push(val.toString());
}

console.log(results.join('\n'));

// ## âœ… æ”¹å–„ç‚¹

// * `BigInt` ã«ã‚ˆã‚Šä¹—ç®—ãƒ»å‰°ä½™ã®èª¤å·®ã‚’å®Œå…¨ã«æ’é™¤
// * å„ã‚¯ã‚¨ãƒªã¯ O(1) ã§å‡¦ç†
// * å®‰å…¨ã« MOD P ä¸‹ã§ã®å€¤ã‚’æ‰±ãˆã‚‹

// ---

// ## âœ… å‡ºåŠ›ç¢ºèªï¼ˆå†æ²ï¼‰

// å…¥åŠ›:

// ```
// 1000000007 77777 10 5
// HELLOWORLD
// 1 10
// 5 8
// 1 7
// 6 10
// 7 7
// ```

// æ­£ã—ã„å‡ºåŠ›:

// ```
// 684699860
// 527230155
// 831444737
// 429964743
// 15
// ```

// ---

// ## âœ… å‚™è€ƒ

// Node.js 18.x ã¯ `BigInt` ã«å®Œå…¨å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
// ã¾ãŸã€ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šæœ€å¤§ã‚±ãƒ¼ã‚¹ `N, Q â‰¦ 200000` ã«ãŠã„ã¦ã‚‚ç¾å®Ÿçš„ãªå®Ÿè¡Œæ™‚é–“å†…ã§è§£ã‘ã¾ã™ï¼ˆè¨ˆç®—é‡ O(N + Q)ï¼‰ã€‚

// ---

// ã”ç¢ºèªã®ã†ãˆã€æ­£ã—ãå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚
