<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LeetCode 9: Palindrome Number - 数値反転による回文判定</title>

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&family=Source+Code+Pro:wght@400;600&display=swap"
            rel="stylesheet"
        />

        <!-- Prism.js -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            rel="stylesheet"
            crossorigin="anonymous"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"
            rel="stylesheet"
            crossorigin="anonymous"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css"
            rel="stylesheet"
            crossorigin="anonymous"
        />

        <style>
            html {
                scroll-behavior: smooth;
            }

            code[class*='language-'],
            pre[class*='language-'] {
                font-family: 'JetBrains Mono', 'Source Code Pro', monospace;
                font-size: 0.95rem;
            }

            div.code-toolbar > .toolbar {
                opacity: 1;
            }

            div.code-toolbar > .toolbar .toolbar-item > button,
            div.code-toolbar > .toolbar .toolbar-item > a {
                background: #fff;
                border: 1px solid #e6e8ef;
                border-radius: 10px;
                padding: 1rem 1.5rem;
                margin: 1rem 1rem 0 0;
                font:
                    600 13px/1.2 Inter,
                    system-ui,
                    sans-serif;
                color: #334155;
                box-shadow: 0 2px 6px rgba(20, 32, 70, 0.06);
                transition:
                    transform 0.15s,
                    box-shadow 0.15s,
                    background 0.15s;
            }

            div.code-toolbar > .toolbar .toolbar-item > button:hover {
                transform: translateY(-1px);
                box-shadow: 0 10px 28px rgba(20, 32, 70, 0.08);
                background: linear-gradient(180deg, #e8fff6, #c8f1e1);
            }
        </style>
    </head>
    <body
        class="min-h-screen p-8 sm:p-6 font-[Inter] text-slate-800 leading-relaxed bg-[linear-gradient(135deg,#f0fdf4_0%,#dbeafe_100%)]"
    >
        <div style="max-width: 1400px; margin: 0 auto">
            <!-- Header -->
            <header
                id="header"
                class="mb-8 rounded-2xl p-8 shadow-[0_10px_30px_rgba(16,185,129,0.10)] bg-[linear-gradient(135deg,#d1fae5,#bfdbfe)]"
            >
                <h1 class="text-[2.5rem] font-bold text-teal-800 mb-2">Palindrome Number</h1>
                <p class="text-xl text-cyan-700 font-semibold mt-2">
                    数値反転による O(d) 回文判定実装
                </p>
                <nav class="flex flex-wrap gap-4 mt-6">
                    <a
                        href="#overview"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >概要</a
                    >
                    <a
                        href="#steps"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >ステップ解説</a
                    >
                    <a
                        href="#code"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >コード例</a
                    >
                    <a
                        href="#diagram"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >フローチャート</a
                    >
                    <a
                        href="#complexity"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >計算量</a
                    >
                </nav>
            </header>

            <!-- Overview -->
            <section id="overview" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    アルゴリズム概要
                </h2>

                <p class="mb-4">
                    整数
                    <code class="px-2 py-1 bg-slate-100 rounded text-emerald-700 font-mono">x</code>
                    が 10 進表記で回文（左右対称）かどうかを判定します。
                </p>

                <div class="bg-slate-50 p-6 rounded-xl mb-6">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">入出力例</h3>
                    <pre
                        class="bg-white p-4 rounded-lg border-2 border-slate-200"
                    ><code>例1: x = 121  → true  (121は左右対称)
例2: x = -121 → false (負数は先頭に-が付く)
例3: x = 10   → false (01とは読めない)</code></pre>
                </div>

                <div class="bg-emerald-50 p-6 rounded-xl mb-6">
                    <h3 class="text-lg font-semibold text-teal-800 mb-3">制約条件</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-700">
                        <li>
                            <code class="px-2 py-1 bg-white rounded text-emerald-700 font-mono"
                                >-2³¹ ≤ x ≤ 2³¹ - 1</code
                            >
                        </li>
                        <li>Follow up: 文字列変換なしで解けるか？</li>
                    </ul>
                </div>

                <div class="bg-sky-50 p-6 rounded-xl">
                    <h3 class="text-lg font-semibold text-cyan-800 mb-3">戦略</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-700">
                        <li><strong>早期リターン</strong>: 負数と末尾0（0自身を除く）を先に弾く</li>
                        <li>
                            <strong>半分反転</strong>: 右半分だけを数値のまま反転し、左半分と比較
                        </li>
                        <li><strong>偶数/奇数桁対応</strong>: 中央の1桁を考慮した判定</li>
                        <li><strong>時間 O(d)</strong>: d = 桁数 ≒ log₁₀(|x|)</li>
                        <li><strong>空間 O(1)</strong>: 定数個の整数変数のみ使用</li>
                    </ul>
                </div>
            </section>

            <!-- Steps -->
            <section id="steps" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    ステップバイステップ解説
                </h2>
                <div id="steps-root"></div>
            </section>

            <!-- Code -->
            <section id="code" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    Python実装
                </h2>
                <pre class="line-numbers"><code class="language-python">class Solution:
    def isPalindrome(self, x: int) -> bool:
        """
        整数 x が 10 進表記で回文かどうかを判定する。

        Args:
            x: 判定対象の整数（32bit 符号付き整数）

        Returns:
            x が 10 進表記で回文であれば True、そうでなければ False。

        Time Complexity: O(d)  （d は x の桁数 ≒ log10(|x|)）
        Space Complexity: O(1)  追加メモリは定数個の整数のみ。
        """
        # 負数、0 以外で末尾が 0 の数は回文にならない
        if x < 0 or (x % 10 == 0 and x != 0):
            return False

        # 0〜9 は 1 桁なので必ず回文
        if x < 10:
            return True

        rev: int = 0

        # 右半分を反転しつつ、左半分と比較できる状態まで進める
        # ループを抜ける条件:
        #   - 偶数桁: x と rev が同じ桁数になった時点で x <= rev
        #   - 奇数桁: 中央 1 桁を含んだ rev の方が 1 桁多くなった時点で x < rev
        while x > rev:
            digit: int = x % 10  # 末尾 1 桁を取得
            rev = rev * 10 + digit  # rev に桁を追加
            x //= 10  # 整数除算で末尾 1 桁を削除

        # 偶数桁: x == rev
        # 奇数桁: 中央 1 桁を無視するため、rev // 10 と比較
        return x == rev or x == rev // 10</code></pre>
            </section>

            <!-- Diagram -->
            <section id="diagram" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    フローチャート
                </h2>
                <div class="mt-[20px] overflow-x-auto">
                    <svg
                        viewBox="0 0 840 950"
                        style="max-width: 100%; height: auto; color: #333"
                        role="img"
                        aria-label="Palindrome Number フローチャート"
                    >
                        <defs>
                            <marker
                                id="arrow"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                            </marker>
                            <marker
                                id="arrowGreen"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                            </marker>
                            <marker
                                id="arrowRed"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#dc2626" />
                            </marker>
                            <marker
                                id="arrowPurple"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#a855f7" />
                            </marker>
                        </defs>

                        <!-- 開始ノード -->
                        <ellipse
                            cx="420"
                            cy="50"
                            rx="100"
                            ry="35"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="50"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="18"
                            font-weight="600"
                        >
                            開始
                        </text>

                        <!-- Start → Neg -->
                        <path
                            d="M 420 85 L 420 120"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- Neg条件分岐 (x < 0) -->
                        <path
                            d="M 420 120 L 520 170 L 420 220 L 320 170 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="170"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">x &lt; 0?</tspan>
                            <tspan x="420" dy="18">負数判定</tspan>
                        </text>

                        <!-- Neg → RetF (はい - 左側に配置) -->
                        <path
                            d="M 320 170 L 200 170"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="260"
                            y="160"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#dc2626"
                        >
                            はい
                        </text>

                        <rect
                            x="100"
                            y="140"
                            width="100"
                            height="60"
                            rx="8"
                            fill="#fee2e2"
                            stroke="#dc2626"
                            stroke-width="2"
                        />
                        <text
                            x="150"
                            y="170"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="150" dy="-8">Return</tspan>
                            <tspan x="150" dy="18">False</tspan>
                        </text>

                        <!-- Neg → Trail (いいえ) -->
                        <path
                            d="M 420 220 L 420 280"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="390"
                            y="250"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#059669"
                        >
                            いいえ
                        </text>

                        <!-- Trail条件分岐 (x % 10 == 0 and x != 0) -->
                        <path
                            d="M 420 280 L 520 330 L 420 380 L 320 330 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="330"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-12">x % 10 == 0</tspan>
                            <tspan x="420" dy="16">and x != 0?</tspan>
                            <tspan x="420" dy="16">末尾0判定</tspan>
                        </text>

                        <!-- Trail → RetF (はい - 左側のRetFへ) -->
                        <path
                            d="M 320 330 L 150 330 L 150 200"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="225"
                            y="320"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#dc2626"
                        >
                            はい
                        </text>

                        <!-- Trail → Single (いいえ) -->
                        <path
                            d="M 420 380 L 420 440"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="390"
                            y="410"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#059669"
                        >
                            いいえ
                        </text>

                        <!-- Single条件分岐 (x < 10) -->
                        <path
                            d="M 420 440 L 520 490 L 420 540 L 320 490 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="490"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">x &lt; 10?</tspan>
                            <tspan x="420" dy="18">1桁数判定</tspan>
                        </text>

                        <!-- Single → RetT (はい - 右側に配置) -->
                        <path
                            d="M 520 490 L 690 490"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="630"
                            y="480"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#059669"
                        >
                            はい
                        </text>

                        <rect
                            x="690"
                            y="460"
                            width="100"
                            height="60"
                            rx="8"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="740"
                            y="490"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="740" dy="-8">Return</tspan>
                            <tspan x="740" dy="18">True</tspan>
                        </text>

                        <!-- Single → Init (いいえ) -->
                        <path
                            d="M 420 540 L 420 620"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="390"
                            y="580"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#dc2626"
                        >
                            いいえ
                        </text>

                        <!-- Init処理 (rev = 0) -->
                        <rect
                            x="370"
                            y="620"
                            width="100"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="650"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">初期化</tspan>
                            <tspan x="420" dy="18">rev = 0</tspan>
                        </text>

                        <!-- Init → Loop -->
                        <path
                            d="M 420 680 L 420 730"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- Loop条件分岐 (x > rev) - 下に移動 -->
                        <path
                            d="M 420 730 L 520 780 L 420 830 L 320 780 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="780"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">x &gt; rev?</tspan>
                            <tspan x="420" dy="18">ループ継続</tspan>
                        </text>

                        <!-- Loop → Extract (はい) -->
                        <path
                            d="M 520 780 L 600 780"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="560"
                            y="770"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#059669"
                        >
                            はい
                        </text>

                        <!-- Extract処理 (digit = x % 10) -->
                        <rect
                            x="600"
                            y="750"
                            width="120"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="660"
                            y="780"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            font-weight="600"
                        >
                            <tspan x="660" dy="-8">digit取得</tspan>
                            <tspan x="660" dy="18">x % 10</tspan>
                        </text>

                        <!-- Extract → Update (右回りで上に) -->
                        <path
                            d="M 720 780 L 800 780 L 800 420 L 600 420"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- Update処理 (rev = rev * 10 + digit) -->
                        <rect
                            x="460"
                            y="390"
                            width="140"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="530"
                            y="420"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                        >
                            <tspan x="530" dy="-8">rev更新</tspan>
                            <tspan x="530" dy="18">rev*10 + digit</tspan>
                        </text>

                        <!-- Update → Divide -->
                        <path
                            d="M 530 390 L 530 290"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- Divide処理 (x = x // 10) -->
                        <rect
                            x="470"
                            y="230"
                            width="120"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="530"
                            y="260"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            font-weight="600"
                        >
                            <tspan x="530" dy="-8">x縮小</tspan>
                            <tspan x="530" dy="18">x //= 10</tspan>
                        </text>

                        <!-- Divide → Loop (ループバック - 左側を通る) -->
                        <path
                            d="M 470 260 L 250 260 L 250 780 L 320 780"
                            stroke="#a855f7"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowPurple)"
                        />
                        <text
                            x="210"
                            y="520"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#a855f7"
                        >
                            次の反復へ
                        </text>

                        <!-- Loop → Check (いいえ) -->
                        <path
                            d="M 420 830 L 420 880"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="390"
                            y="855"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#dc2626"
                        >
                            いいえ
                        </text>

                        <!-- Check条件分岐 (x == rev or x == rev // 10) -->
                        <path
                            d="M 420 880 L 495 910 L 420 940 L 345 910 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="910"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="13"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">x == rev</tspan>
                            <tspan x="420" dy="16">or rev//10?</tspan>
                        </text>

                        <!-- Check → RetT (はい) -->
                        <path
                            d="M 495 910 L 740 910 L 740 520"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="617"
                            y="900"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#059669"
                        >
                            はい
                        </text>

                        <!-- Check → RetF (いいえ - 左側のRetFへ) -->
                        <path
                            d="M 345 910 L 60 910 L 60 170 L 100 170"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="202"
                            y="900"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#dc2626"
                        >
                            いいえ
                        </text>
                    </svg>
                </div>

                <p class="mt-8 font-[Source_Code_Pro] text-[20px] font-semibold">
                    <strong class="text-2xl">フローの説明：</strong><br />
                    1. 基底条件で負数・末尾0・1桁数を早期判定<br />
                    2. rev = 0 で初期化し、ループに入る<br />
                    3. x > rev の間、右側の桁を反転して rev に積み上げる<br />
                    4. 同時に x を縮小し、x <= rev になったらループ終了<br />
                    5. 最後に x == rev または x == rev // 10 で回文判定<br />
                    6. 左側の紫色の矢印でループバックし、次の反復へ進む
                </p>
            </section>

            <!-- Complexity -->
            <section id="complexity" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    計算量分析
                </h2>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-emerald-100">
                                <th
                                    class="border-2 border-emerald-200 px-4 py-3 text-left font-semibold text-teal-800"
                                >
                                    項目
                                </th>
                                <th
                                    class="border-2 border-emerald-200 px-4 py-3 text-left font-semibold text-teal-800"
                                >
                                    本実装（数値反転）
                                </th>
                                <th
                                    class="border-2 border-emerald-200 px-4 py-3 text-left font-semibold text-teal-800"
                                >
                                    代替案（文字列変換）
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    時間計算量
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code
                                        class="px-2 py-1 bg-emerald-50 rounded text-emerald-700 font-mono"
                                        >O(d)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code
                                        class="px-2 py-1 bg-sky-50 rounded text-cyan-700 font-mono"
                                        >O(d)</code
                                    >
                                </td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    空間計算量
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code
                                        class="px-2 py-1 bg-emerald-50 rounded text-emerald-700 font-mono"
                                        >O(1)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    <code
                                        class="px-2 py-1 bg-sky-50 rounded text-cyan-700 font-mono"
                                        >O(d)</code
                                    >
                                    (文字列生成)
                                </td>
                            </tr>
                            <tr>
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    Follow up対応
                                </td>
                                <td
                                    class="border-2 border-slate-200 px-4 py-3 text-emerald-700 font-semibold"
                                >
                                    ✓ 満たす
                                </td>
                                <td
                                    class="border-2 border-slate-200 px-4 py-3 text-red-600 font-semibold"
                                >
                                    ✗ 満たさない
                                </td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="border-2 border-slate-200 px-4 py-3 font-semibold">
                                    実装コスト
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    中（ループロジック）
                                </td>
                                <td class="border-2 border-slate-200 px-4 py-3">
                                    低（str()＋スライス）
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-6 bg-slate-50 p-6 rounded-xl">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">補足</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-700">
                        <li><strong>d</strong> は桁数（≒ log₁₀(|x|)）</li>
                        <li>数値反転版はメモリ効率が優れており、追加データ構造を使わない</li>
                        <li>文字列版は実装が簡単だが、Follow upの要件を満たさない</li>
                        <li>LeetCode環境では実行時間にノイズがあり、両者の実測差は小さい</li>
                    </ul>
                </div>
            </section>
        </div>

        <!-- React & Babel -->
        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script
            crossorigin
            src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
        ></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <!-- Prism.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

        <!-- React Component -->
        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            const stepsData = [
                {
                    step: 1,
                    title: '入力と基底条件確認',
                    desc: 'x = 121 の場合を例とする。負数でなく、末尾も0でなく、2桁以上なので基底条件をパス。',
                    visual: {
                        type: 'init',
                        x: 121,
                        rev: 0,
                        message: 'x = 121, rev = 0',
                    },
                },
                {
                    step: 2,
                    title: '反転ループ開始（1回目）',
                    desc: 'x > rev なのでループ継続。x の末尾1桁（1）を取り出し、rev = 0 * 10 + 1 = 1。その後 x = 121 // 10 = 12。',
                    visual: {
                        type: 'loop1',
                        x: 12,
                        rev: 1,
                        digit: 1,
                        message: 'digit = 1 を取得、rev = 1',
                    },
                },
                {
                    step: 3,
                    title: '反転ループ継続（2回目）',
                    desc: 'x = 12 > rev = 1 なのでループ継続。x の末尾1桁（2）を取り出し、rev = 1 * 10 + 2 = 12。その後 x = 12 // 10 = 1。',
                    visual: {
                        type: 'loop2',
                        x: 1,
                        rev: 12,
                        digit: 2,
                        message: 'digit = 2 を取得、rev = 12',
                    },
                },
                {
                    step: 4,
                    title: 'ループ終了と判定',
                    desc: 'x = 1 <= rev = 12 となったのでループ終了。奇数桁なので x == rev // 10 を確認。1 == 12 // 10 = 1 なので True を返す。',
                    visual: {
                        type: 'result',
                        x: 1,
                        rev: 12,
                        result: true,
                        message: 'x == rev // 10 → 回文',
                    },
                },
            ];

            function StepVisualization({ visual }) {
                if (!visual) return null;

                const boxWidth = 100;
                const boxHeight = 80;

                return (
                    <svg
                        viewBox="0 0 600 280"
                        style={{ maxWidth: '100%', height: 'auto', marginTop: '20px' }}
                    >
                        <defs>
                            <marker
                                id="arrowPurple"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#a855f7" />
                            </marker>
                        </defs>

                        {/* タイトル */}
                        <text
                            x="300"
                            y="30"
                            textAnchor="middle"
                            dominantBaseline="middle"
                            fontSize="18"
                            fontWeight="600"
                            fill="#0f766e"
                        >
                            {visual.message || ''}
                        </text>

                        {/* x の表示 */}
                        <rect
                            x="150"
                            y="80"
                            width={boxWidth}
                            height={boxHeight}
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            strokeWidth="2"
                        />
                        <text
                            x="200"
                            y="105"
                            textAnchor="middle"
                            dominantBaseline="middle"
                            fontSize="16"
                            fontWeight="600"
                            fill="#0c4a6e"
                        >
                            x
                        </text>
                        <text
                            x="200"
                            y="135"
                            textAnchor="middle"
                            dominantBaseline="middle"
                            fontSize="22"
                            fontWeight="700"
                            fill="#0284c7"
                        >
                            {visual.x ?? 0}
                        </text>

                        {/* rev の表示 */}
                        <rect
                            x="350"
                            y="80"
                            width={boxWidth}
                            height={boxHeight}
                            rx="8"
                            fill="#d1fae5"
                            stroke="#10b981"
                            strokeWidth="2"
                        />
                        <text
                            x="400"
                            y="105"
                            textAnchor="middle"
                            dominantBaseline="middle"
                            fontSize="16"
                            fontWeight="600"
                            fill="#065f46"
                        >
                            rev
                        </text>
                        <text
                            x="400"
                            y="135"
                            textAnchor="middle"
                            dominantBaseline="middle"
                            fontSize="22"
                            fontWeight="700"
                            fill="#059669"
                        >
                            {visual.rev ?? 0}
                        </text>

                        {/* digit の表示（loop時のみ） */}
                        {visual.digit !== undefined && (
                            <>
                                <path
                                    d="M 200 160 L 200 200"
                                    stroke="#a855f7"
                                    strokeWidth="2"
                                    fill="none"
                                    markerEnd="url(#arrowPurple)"
                                />
                                <text
                                    x="200"
                                    y="220"
                                    textAnchor="middle"
                                    dominantBaseline="middle"
                                    fontSize="16"
                                    fontWeight="600"
                                    fill="#a855f7"
                                >
                                    取得: digit = {visual.digit}
                                </text>
                            </>
                        )}

                        {/* 結果の表示（result時のみ） */}
                        {visual.result !== undefined && (
                            <text
                                x="300"
                                y="200"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fontSize="20"
                                fontWeight="700"
                                fill={visual.result ? '#059669' : '#dc2626'}
                            >
                                判定結果: {visual.result ? 'True (回文)' : 'False (非回文)'}
                            </text>
                        )}

                        {/* 説明テキスト */}
                        <text
                            x="300"
                            y="250"
                            textAnchor="middle"
                            dominantBaseline="middle"
                            fontSize="15"
                            fill="#64748b"
                        >
                            {visual.type === 'init' && '初期状態'}
                            {visual.type === 'loop1' && '1回目の反転: x から末尾を取得'}
                            {visual.type === 'loop2' && '2回目の反転: x をさらに縮小'}
                            {visual.type === 'result' && 'x <= rev でループ終了、判定実行'}
                        </text>
                    </svg>
                );
            }

            function StepsInteractive() {
                const [activeStep, setActiveStep] = useState(1);
                const [isPlaying, setIsPlaying] = useState(false);
                const timerRef = useRef(null);

                useEffect(() => {
                    if (isPlaying) {
                        if (activeStep > stepsData.length) {
                            setIsPlaying(false);
                            setActiveStep(1);
                            return;
                        }
                        timerRef.current = setTimeout(() => {
                            setActiveStep((prev) => prev + 1);
                        }, 2000);
                    }
                    return () => {
                        if (timerRef.current) {
                            clearTimeout(timerRef.current);
                            timerRef.current = null;
                        }
                    };
                }, [isPlaying, activeStep]);

                const handlePlay = () => {
                    if (isPlaying) return;
                    setActiveStep(1);
                    setIsPlaying(true);
                };

                const handlePrev = () => {
                    setIsPlaying(false);
                    if (timerRef.current) {
                        clearTimeout(timerRef.current);
                        timerRef.current = null;
                    }
                    setActiveStep((prev) => Math.max(1, prev - 1));
                };

                const handleNext = () => {
                    setIsPlaying(false);
                    if (timerRef.current) {
                        clearTimeout(timerRef.current);
                        timerRef.current = null;
                    }
                    setActiveStep((prev) => Math.min(stepsData.length, prev + 1));
                };

                const handleReset = () => {
                    setIsPlaying(false);
                    if (timerRef.current) {
                        clearTimeout(timerRef.current);
                        timerRef.current = null;
                    }
                    setActiveStep(1);
                };

                const handleStepClick = (step) => {
                    setIsPlaying(false);
                    if (timerRef.current) {
                        clearTimeout(timerRef.current);
                        timerRef.current = null;
                    }
                    setActiveStep(step);
                };

                const currentStepData =
                    stepsData.find((s) => s.step === activeStep) || stepsData[0];

                if (!currentStepData) return null;

                return (
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8 mt-2">
                        <div>
                            <h3 className="mt-0 mb-4 text-teal-800 text-xl font-semibold">
                                ステップ一覧
                            </h3>
                            <div className="space-y-2">
                                {stepsData.map((step) => {
                                    const isActive = activeStep === step.step;
                                    return (
                                        <button
                                            key={step.step}
                                            type="button"
                                            className={[
                                                'w-full text-left text-[0.95rem] rounded-xl border-2 transition cursor-pointer px-4 py-4',
                                                'bg-white border-slate-200 hover:border-emerald-500 hover:translate-x-1',
                                                isActive
                                                    ? 'bg-[linear-gradient(135deg,#d1fae5,#a7f3d0)] border-emerald-500 shadow-[0_4px_12px_rgba(16,185,129,0.20)]'
                                                    : '',
                                            ].join(' ')}
                                            onClick={() => handleStepClick(step.step)}
                                            aria-label={`ステップ${step.step}: ${step.title}`}
                                            aria-current={isActive ? 'step' : undefined}
                                        >
                                            <div
                                                className={[
                                                    'font-bold mb-1',
                                                    isActive ? 'text-emerald-900' : 'text-teal-800',
                                                ].join(' ')}
                                            >
                                                Step {step.step}: {step.title}
                                            </div>
                                            <div className="text-slate-500 text-sm mt-1">
                                                {step.desc.substring(0, 50)}
                                                {step.desc.length > 50 ? '...' : ''}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="my-auto">
                            <div className="rounded-2xl p-8 mt-10 border-2 border-emerald-200 bg-[linear-gradient(135deg,#ecfdf5,#f0f9ff)]">
                                <h3 className="mt-0 text-teal-800 text-xl font-semibold">
                                    Step {currentStepData.step}: {currentStepData.title}
                                </h3>
                                <p className="text-slate-600 leading-7">{currentStepData.desc}</p>
                            </div>

                            <StepVisualization visual={currentStepData.visual} />

                            <div className="flex flex-wrap justify-center gap-2 mt-1">
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#10b981,#059669)]"
                                    onClick={handlePlay}
                                    disabled={isPlaying}
                                    aria-label="自動再生"
                                >
                                    ▶ Play
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#0ea5e9,#0284c7)]"
                                    onClick={handlePrev}
                                    disabled={activeStep === 1}
                                    aria-label="前のステップ"
                                >
                                    ◀ Prev
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#0ea5e9,#0284c7)]"
                                    onClick={handleNext}
                                    disabled={activeStep === stepsData.length}
                                    aria-label="次のステップ"
                                >
                                    Next ▶
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#64748b,#475569)]"
                                    onClick={handleReset}
                                    aria-label="リセット"
                                >
                                    ↺ Reset
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // DOM読み込み完了後にReactをマウント
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initReact);
            } else {
                initReact();
            }

            function initReact() {
                const rootElement = document.getElementById('steps-root');
                if (rootElement) {
                    const root = ReactDOM.createRoot(rootElement);
                    root.render(<StepsInteractive />);
                }
            }
        </script>
    </body>
</html>
