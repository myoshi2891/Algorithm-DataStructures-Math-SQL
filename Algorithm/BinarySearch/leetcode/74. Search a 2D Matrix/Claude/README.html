<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>2D Matrix Binary Search - 技術解説</title>

        <!-- External CDN Resources -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
            rel="stylesheet"
        />

        <style>
            :root {
                --bg-primary: #0f0f0f;
                --bg-secondary: #1a1a1a;
                --bg-tertiary: #2a2a2a;
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --text-muted: #808080;
                --accent-primary: #3b82f6;
                --accent-secondary: #10b981;
                --accent-warning: #f59e0b;
                --accent-danger: #ef4444;
                --border-color: #333333;
                --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: var(--bg-primary);
                color: var(--text-primary);
                line-height: 1.6;
                overflow-x: hidden;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            }

            /* Header */
            .header {
                background: var(--gradient);
                padding: 60px 0;
                text-align: center;
                position: relative;
                overflow: hidden;
            }

            .header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23ffffff" stroke-width="0.5" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
                animation: gridMove 20s linear infinite;
            }

            @keyframes gridMove {
                0% {
                    transform: translateX(0) translateY(0);
                }
                100% {
                    transform: translateX(-10px) translateY(-10px);
                }
            }

            .header h1 {
                font-size: 3rem;
                font-weight: 700;
                margin-bottom: 20px;
                position: relative;
                z-index: 1;
            }

            .header .subtitle {
                font-size: 1.2rem;
                opacity: 0.9;
                position: relative;
                z-index: 1;
            }

            /* Navigation */
            .nav {
                background: var(--bg-secondary);
                padding: 15px 0;
                border-bottom: 1px solid var(--border-color);
                position: sticky;
                top: 0;
                z-index: 100;
                backdrop-filter: blur(10px);
            }

            .nav-list {
                display: flex;
                list-style: none;
                justify-content: center;
                gap: 30px;
                flex-wrap: wrap;
            }

            .nav-link {
                color: var(--text-secondary);
                text-decoration: none;
                padding: 10px 15px;
                border-radius: 8px;
                transition: all 0.3s ease;
                position: relative;
            }

            .nav-link:hover,
            .nav-link.active {
                color: var(--accent-primary);
                background: rgba(59, 130, 246, 0.1);
            }

            /* Main Content */
            .main {
                padding: 40px 0;
            }

            .section {
                margin-bottom: 60px;
                opacity: 0;
                transform: translateY(30px);
                animation: fadeInUp 0.8s ease forwards;
            }

            @keyframes fadeInUp {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .section:nth-child(2) {
                animation-delay: 0.2s;
            }
            .section:nth-child(3) {
                animation-delay: 0.4s;
            }
            .section:nth-child(4) {
                animation-delay: 0.6s;
            }

            .section-title {
                font-size: 2.5rem;
                margin-bottom: 30px;
                color: var(--accent-primary);
                position: relative;
                padding-left: 20px;
            }

            .section-title::before {
                content: '';
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                width: 4px;
                background: var(--gradient);
                border-radius: 2px;
            }

            /* Algorithm Overview */
            .algo-overview {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 30px;
                margin: 30px 0;
            }

            .overview-card {
                background: var(--bg-secondary);
                padding: 30px;
                border-radius: 15px;
                border: 1px solid var(--border-color);
                transition:
                    transform 0.3s ease,
                    box-shadow 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .overview-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 3px;
                background: var(--gradient);
            }

            .overview-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow);
            }

            .card-icon {
                font-size: 2.5rem;
                color: var(--accent-primary);
                margin-bottom: 15px;
            }

            .card-title {
                font-size: 1.5rem;
                margin-bottom: 15px;
                color: var(--text-primary);
            }

            .card-description {
                color: var(--text-secondary);
                line-height: 1.6;
            }

            /* Step by Step */
            .steps-container {
                margin: 40px 0;
            }

            .step {
                background: var(--bg-secondary);
                margin: 20px 0;
                border-radius: 15px;
                border: 1px solid var(--border-color);
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .step:hover {
                border-color: var(--accent-primary);
                box-shadow: var(--shadow);
            }

            .step-header {
                padding: 20px 30px;
                background: var(--bg-tertiary);
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 15px;
                transition: background 0.3s ease;
            }

            .step-header:hover {
                background: rgba(59, 130, 246, 0.1);
            }

            .step-number {
                background: var(--gradient);
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
            }

            .step-title {
                font-size: 1.2rem;
                flex-grow: 1;
            }

            .step-toggle {
                font-size: 1.2rem;
                transition: transform 0.3s ease;
            }

            .step.active .step-toggle {
                transform: rotate(180deg);
            }

            .step-content {
                padding: 0 30px;
                max-height: 0;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .step.active .step-content {
                padding: 30px;
                max-height: 1000px;
            }

            /* Code Blocks */
            .code-container {
                position: relative;
                margin: 30px 0;
                border-radius: 12px;
                overflow: hidden;
                background: var(--bg-tertiary);
                border: 1px solid var(--border-color);
            }

            .code-header {
                background: var(--bg-secondary);
                padding: 15px 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid var(--border-color);
            }

            .code-title {
                color: var(--text-primary);
                font-weight: 600;
            }

            .copy-btn {
                background: var(--accent-primary);
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 0.9rem;
                transition: all 0.3s ease;
            }

            .copy-btn:hover {
                background: var(--accent-secondary);
                transform: translateY(-2px);
            }

            .code-block {
                font-family: 'Fira Code', 'Consolas', monospace !important;
                margin: 0 !important;
                background: var(--bg-tertiary) !important;
                border-radius: 0 !important;
            }

            /* Visual Diagrams */
            .diagram-container {
                background: var(--bg-secondary);
                padding: 40px;
                border-radius: 15px;
                margin: 30px 0;
                border: 1px solid var(--border-color);
                text-align: center;
            }

            .matrix-visual {
                display: inline-block;
                margin: 20px;
                background: var(--bg-tertiary);
                padding: 20px;
                border-radius: 10px;
                border: 2px solid var(--border-color);
            }

            .matrix-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
                margin: 15px 0;
            }

            .matrix-cell {
                width: 50px;
                height: 50px;
                background: var(--bg-primary);
                border: 2px solid var(--border-color);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                border-radius: 8px;
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .matrix-cell:hover {
                background: var(--accent-primary);
                color: white;
            }

            .matrix-cell.highlight {
                background: var(--accent-secondary) !important;
                color: white;
                box-shadow: 0 0 10px var(--accent-secondary);
            }

            .matrix-cell.target {
                background: var(--accent-warning) !important;
                color: white;
                animation: pulse 1s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
            }

            /* Complexity Analysis */
            .complexity-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }

            .complexity-card {
                background: var(--bg-secondary);
                padding: 25px;
                border-radius: 12px;
                border-left: 4px solid var(--accent-primary);
                transition: transform 0.3s ease;
            }

            .complexity-card:hover {
                transform: translateX(5px);
            }

            .complexity-title {
                font-size: 1.3rem;
                margin-bottom: 15px;
                color: var(--accent-primary);
            }

            .complexity-value {
                font-size: 2rem;
                font-weight: bold;
                color: var(--accent-secondary);
                font-family: 'Fira Code', monospace;
            }

            /* Interactive Demo */
            .demo-container {
                background: var(--bg-secondary);
                padding: 30px;
                border-radius: 15px;
                margin: 30px 0;
                border: 1px solid var(--border-color);
            }

            .demo-controls {
                display: flex;
                gap: 15px;
                margin-bottom: 30px;
                flex-wrap: wrap;
                align-items: center;
            }

            .demo-input {
                background: var(--bg-tertiary);
                border: 1px solid var(--border-color);
                color: var(--text-primary);
                padding: 10px 15px;
                border-radius: 8px;
                font-size: 1rem;
            }

            .demo-button {
                background: var(--gradient);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1rem;
                transition: all 0.3s ease;
            }

            .demo-button:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow);
            }

            .demo-button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            /* Animation States */
            .step-animation {
                animation: stepHighlight 2s ease-in-out;
            }

            @keyframes stepHighlight {
                0%,
                100% {
                    background: var(--bg-secondary);
                }
                50% {
                    background: rgba(59, 130, 246, 0.2);
                }
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .header h1 {
                    font-size: 2rem;
                }

                .nav-list {
                    gap: 15px;
                }

                .section-title {
                    font-size: 2rem;
                }

                .algo-overview {
                    grid-template-columns: 1fr;
                }

                .demo-controls {
                    flex-direction: column;
                }

                .matrix-cell {
                    width: 40px;
                    height: 40px;
                    font-size: 0.9rem;
                }
            }

            /* Scrollbar Styling */
            ::-webkit-scrollbar {
                width: 8px;
            }

            ::-webkit-scrollbar-track {
                background: var(--bg-primary);
            }

            ::-webkit-scrollbar-thumb {
                background: var(--bg-tertiary);
                border-radius: 4px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: var(--accent-primary);
            }
        </style>
    </head>
    <body>
        <!-- Header -->
        <header class="header">
            <div class="container">
                <h1 class="animate__animated animate__fadeInDown">
                    <i class="fas fa-search"></i> 2D Matrix Binary Search
                </h1>
                <p class="subtitle animate__animated animate__fadeInUp animate__delay-1s">
                    効率的な二分探索アルゴリズムの技術解説
                </p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <div class="container">
                <ul class="nav-list">
                    <li>
                        <a href="#overview" class="nav-link active"
                            ><i class="fas fa-info-circle"></i> 概要</a
                        >
                    </li>
                    <li>
                        <a href="#steps" class="nav-link"
                            ><i class="fas fa-list-ol"></i> ステップ解説</a
                        >
                    </li>
                    <li>
                        <a href="#code" class="nav-link"><i class="fas fa-code"></i> コード例</a>
                    </li>
                    <li>
                        <a href="#demo" class="nav-link"><i class="fas fa-play"></i> デモ</a>
                    </li>
                    <li>
                        <a href="#complexity" class="nav-link"
                            ><i class="fas fa-chart-line"></i> 計算量</a
                        >
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <div class="container">
                <!-- Algorithm Overview -->
                <section id="overview" class="section">
                    <h2 class="section-title"><i class="fas fa-lightbulb"></i> アルゴリズム概要</h2>
                    <div class="algo-overview">
                        <div class="overview-card">
                            <div class="card-icon">
                                <i class="fa-solid fa-circle-exclamation"></i>
                            </div>
                            <h3 class="card-title">問題設定</h3>
                            <p class="card-description">
                                ソート済み2次元行列において、指定されたターゲット値を効率的に検索する。
                                各行は昇順ソート、かつ各行の先頭要素は前行の末尾要素より大きい。
                            </p>
                        </div>
                        <div class="overview-card">
                            <div class="card-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <h3 class="card-title">アプローチ</h3>
                            <p class="card-description">
                                2次元行列を1次元配列として扱い、座標変換を使用して二分探索を実行。
                                O(log(m×n))の時間計算量を実現。
                            </p>
                        </div>
                        <div class="overview-card">
                            <div class="card-icon">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <h3 class="card-title">最適化</h3>
                            <p class="card-description">
                                Python固有の特性を活用し、整数演算の効率性と型ヒントによる可読性を両立。
                                メモリ使用量O(1)で実装。
                            </p>
                        </div>
                    </div>
                </section>

                <!-- Step by Step -->
                <section id="steps" class="section">
                    <h2 class="section-title">
                        <i class="fas fa-list-ol"></i> ステップバイステップ解説
                    </h2>
                    <div class="steps-container">
                        <div class="step">
                            <div class="step-header" onclick="toggleStep(this)">
                                <div class="step-number">1</div>
                                <div class="step-title">入力検証とサイズ取得</div>
                                <div class="step-toggle">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="step-content">
                                <p>
                                    まず、入力行列が空でないことを確認し、行数（n）と列数（m）を取得します。
                                </p>
                                <div class="code-container">
                                    <div class="code-header">
                                        <span class="code-title">Step 1: Input Validation</span>
                                        <button class="copy-btn" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i> コピー
                                        </button>
                                    </div>
                                    <pre><code class="language-python code-block">if not matrix or not matrix[0]:
    return False

n, m = len(matrix), len(matrix[0])  # n=行数, m=列数</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-header" onclick="toggleStep(this)">
                                <div class="step-number">2</div>
                                <div class="step-title">二分探索の初期化</div>
                                <div class="step-toggle">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="step-content">
                                <p>
                                    1次元配列として扱うため、leftを0、rightを(n×m-1)に設定します。
                                </p>
                                <div class="code-container">
                                    <div class="code-header">
                                        <span class="code-title"
                                            >Step 2: Binary Search Initialization</span
                                        >
                                        <button class="copy-btn" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i> コピー
                                        </button>
                                    </div>
                                    <pre><code class="language-python code-block">left, right = 0, n * m - 1  # 1次元配列のインデックス範囲</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-header" onclick="toggleStep(this)">
                                <div class="step-number">3</div>
                                <div class="step-title">座標変換と値の取得</div>
                                <div class="step-toggle">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="step-content">
                                <p>
                                    1次元インデックスmidを2次元座標に変換し、該当する値を取得します。
                                </p>
                                <div class="code-container">
                                    <div class="code-header">
                                        <span class="code-title"
                                            >Step 3: Coordinate Conversion</span
                                        >
                                        <button class="copy-btn" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i> コピー
                                        </button>
                                    </div>
                                    <pre><code class="language-python code-block">mid = (left + right) // 2
# 座標変換: 1D index → 2D coordinates
row = mid // m  # 行インデックス
col = mid % m   # 列インデックス
val = matrix[row][col]  # 実際の値を取得</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-header" onclick="toggleStep(this)">
                                <div class="step-number">4</div>
                                <div class="step-title">値の比較と範囲更新</div>
                                <div class="step-toggle">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="step-content">
                                <p>
                                    取得した値とターゲットを比較し、探索範囲を半分に絞り込みます。
                                </p>
                                <div class="code-container">
                                    <div class="code-header">
                                        <span class="code-title">Step 4: Value Comparison</span>
                                        <button class="copy-btn" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i> コピー
                                        </button>
                                    </div>
                                    <pre><code class="language-python code-block">if val == target:
    return True  # 見つかった！
elif val < target:
    left = mid + 1  # 右半分を探索
else:
    right = mid - 1  # 左半分を探索</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Code Example -->
                <section id="code" class="section">
                    <h2 class="section-title"><i class="fas fa-code"></i> 完全なコード実装</h2>
                    <div class="code-container">
                        <div class="code-header">
                            <span class="code-title">
                                <i class="fab fa-python"></i> Python Implementation
                            </span>
                            <button class="copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i> コピー
                            </button>
                        </div>
                        <pre><code class="language-python code-block">from typing import List

class Solution:
    def searchMatrix(self, matrix: List[List[int]], target: int) -> bool:
        """
        2D行列内を二分探索で探索する
        行列は「各行がソート済み」「行の先頭が前行の末尾より大きい」という条件を満たす

        時間計算量: O(log(m * n))
        空間計算量: O(1)
        """
        # Step 1: 入力検証
        if not matrix or not matrix[0]:
            return False

        # Step 2: 行列のサイズを取得
        n, m = len(matrix), len(matrix[0])

        # Step 3: 二分探索の初期化
        left, right = 0, n * m - 1

        # Step 4: 二分探索のメインループ
        while left <= right:
            # 中央のインデックスを計算
            mid = (left + right) // 2

            # 1D → 2D 座標変換
            row = mid // m
            col = mid % m
            val = matrix[row][col]

            # 値を比較して探索範囲を更新
            if val == target:
                return True
            elif val < target:
                left = mid + 1
            else:
                right = mid - 1

        # Step 5: 見つからなかった場合
        return False

# 使用例とテストケース
def test_search_matrix():
    solution = Solution()

    # Test Case 1
    matrix1 = [[1,3,5,7],[10,11,16,20],[23,30,34,60]]
    assert solution.searchMatrix(matrix1, 3) == True
    assert solution.searchMatrix(matrix1, 13) == False

    # Test Case 2
    matrix2 = [[1,4,7,11,15],[2,5,8,12,19],[3,6,9,16,22],[10,13,14,17,24],[18,21,23,26,30]]
    assert solution.searchMatrix(matrix2, 5) == True
    assert solution.searchMatrix(matrix2, 20) == False

    print("All test cases passed! ✅")

if __name__ == "__main__":
    test_search_matrix()</code></pre>
                    </div>
                </section>

                <!-- Interactive Demo -->
                <section id="demo" class="section">
                    <h2 class="section-title"><i class="fas fa-play"></i> インタラクティブデモ</h2>
                    <div class="demo-container">
                        <div class="demo-controls">
                            <label for="targetInput">ターゲット値:</label>
                            <input
                                type="number"
                                id="targetInput"
                                class="demo-input"
                                value="3"
                                min="1"
                                max="60"
                            />
                            <button class="demo-button" onclick="startDemo()">
                                <i class="fas fa-play"></i> デモ開始
                            </button>
                            <button class="demo-button" onclick="resetDemo()">
                                <i class="fas fa-undo"></i> リセット
                            </button>
                        </div>

                        <div class="diagram-container">
                            <h3>2D行列の視覚化</h3>
                            <div class="matrix-visual">
                                <div class="matrix-grid" id="matrixGrid">
                                    <!-- JavaScript で動的生成 -->
                                </div>
                                <p id="statusText">デモを開始してください</p>
                            </div>

                            <div
                                id="stepsInfo"
                                style="margin-top: 20px; text-align: left; display: none"
                            >
                                <h4>探索ステップ:</h4>
                                <div id="stepsList"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Complexity Analysis -->
                <section id="complexity" class="section">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> 計算量解析</h2>
                    <div class="complexity-grid">
                        <div class="complexity-card">
                            <h3 class="complexity-title">時間計算量</h3>
                            <div class="complexity-value">O(log(m×n))</div>
                            <p>二分探索により、各ステップで探索範囲を半分に削減</p>
                        </div>
                        <div class="complexity-card">
                            <h3 class="complexity-title">空間計算量</h3>
                            <div class="complexity-value">O(1)</div>
                            <p>固定数の変数のみ使用、入力サイズに依存しない</p>
                        </div>
                        <div class="complexity-card">
                            <h3 class="complexity-title">最大ステップ数</h3>
                            <div class="complexity-value">⌈log₂(m×n)⌉</div>
                            <p>例: 3×4行列では最大4ステップで完了</p>
                        </div>
                    </div>

                    <div class="diagram-container">
                        <h3>計算量の比較</h3>
                        <div
                            style="
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                                gap: 20px;
                                margin-top: 20px;
                            "
                        >
                            <div
                                style="
                                    text-align: center;
                                    padding: 20px;
                                    background: var(--bg-tertiary);
                                    border-radius: 10px;
                                "
                            >
                                <h4 style="color: var(--accent-danger)">Linear Search</h4>
                                <div
                                    style="
                                        font-size: 1.5rem;
                                        color: var(--accent-danger);
                                        margin: 10px 0;
                                    "
                                >
                                    O(m×n)
                                </div>
                                <p style="font-size: 0.9rem; color: var(--text-secondary)">
                                    最悪: 全要素チェック
                                </p>
                            </div>
                            <div
                                style="
                                    text-align: center;
                                    padding: 20px;
                                    background: var(--bg-tertiary);
                                    border-radius: 10px;
                                "
                            >
                                <h4 style="color: var(--accent-secondary)">Binary Search</h4>
                                <div
                                    style="
                                        font-size: 1.5rem;
                                        color: var(--accent-secondary);
                                        margin: 10px 0;
                                    "
                                >
                                    O(log(m×n))
                                </div>
                                <p style="font-size: 0.9rem; color: var(--text-secondary)">
                                    効率的: 毎回半分に削減
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Performance Analysis -->
                <section class="section">
                    <h2 class="section-title">
                        <i class="fas fa-tachometer-alt"></i> パフォーマンス分析
                    </h2>
                    <div class="overview-card" style="margin-bottom: 30px">
                        <h3 style="color: var(--accent-primary); margin-bottom: 15px">
                            Python固有の最適化ポイント
                        </h3>
                        <div
                            style="
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                                gap: 20px;
                            "
                        >
                            <div>
                                <h4 style="color: var(--accent-secondary)">✅ 効率的な演算</h4>
                                <ul style="color: var(--text-secondary); padding-left: 20px">
                                    <li>
                                        整数除算 <code>//</code> とモジュロ <code>%</code> の活用
                                    </li>
                                    <li>CPythonのC実装による高速化</li>
                                    <li>ビットシフトより可読性重視</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="color: var(--accent-secondary)">📝 可読性の向上</h4>
                                <ul style="color: var(--text-secondary); padding-left: 20px">
                                    <li>型ヒントによる静的解析対応</li>
                                    <li>明確な変数名の使用</li>
                                    <li>ドキュメント文字列の充実</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="code-container">
                        <div class="code-header">
                            <span class="code-title">最適化比較例</span>
                            <button class="copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i> コピー
                            </button>
                        </div>
                        <pre><code class="language-python code-block"># ❌ 非効率な実装例
def searchMatrix_slow(matrix, target):
    for row in matrix:
        for val in row:
            if val == target:
                return True
    return False  # O(m×n) - 全要素をチェック

# ✅ 最適化された実装
def searchMatrix_optimized(matrix, target):
    if not matrix or not matrix[0]:
        return False

    n, m = len(matrix), len(matrix[0])
    left, right = 0, n * m - 1

    while left <= right:
        mid = (left + right) // 2  # C実装で高速
        val = matrix[mid // m][mid % m]  # 効率的な座標変換

        if val == target:
            return True
        elif val < target:
            left = mid + 1
        else:
            right = mid - 1

    return False  # O(log(m×n)) - 指数的に高速</code></pre>
                    </div>
                </section>
            </div>
        </main>

        <!-- Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

        <script>
            // Sample matrix for demo
            const sampleMatrix = [
                [1, 3, 5, 7],
                [10, 11, 16, 20],
                [23, 30, 34, 60],
            ];

            let demoSteps = [];
            let currentStep = 0;
            let demoRunning = false;

            // Initialize matrix visualization
            function initMatrix() {
                const grid = document.getElementById('matrixGrid');
                grid.innerHTML = '';

                sampleMatrix.flat().forEach((val, index) => {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    cell.textContent = val;
                    cell.id = `cell-${index}`;
                    grid.appendChild(cell);
                });
            }

            // Binary search simulation
            function binarySearchSimulation(target) {
                const steps = [];
                const n = sampleMatrix.length;
                const m = sampleMatrix[0].length;
                let left = 0;
                let right = n * m - 1;

                while (left <= right) {
                    const mid = Math.floor((left + right) / 2);
                    const row = Math.floor(mid / m);
                    const col = mid % m;
                    const val = sampleMatrix[row][col];

                    steps.push({
                        left,
                        right,
                        mid,
                        row,
                        col,
                        val,
                        comparison: val === target ? 'found' : val < target ? 'less' : 'greater',
                    });

                    if (val === target) {
                        break;
                    } else if (val < target) {
                        left = mid + 1;
                    } else {
                        right = mid - 1;
                    }
                }

                return steps;
            }

            // Start demo
            function startDemo() {
                const target = parseInt(document.getElementById('targetInput').value);

                if (demoRunning) return;

                // Reset everything first
                resetDemoCompletely();

                demoRunning = true;

                // Generate steps
                demoSteps = binarySearchSimulation(target);
                currentStep = 0;

                // Show steps info
                document.getElementById('stepsInfo').style.display = 'block';

                // Start animation
                animateStep();
            }

            // Animate each step
            function animateStep() {
                console.log(
                    '🎬 animateStep called, currentStep:',
                    currentStep,
                    'total steps:',
                    demoSteps.length,
                );
                console.log('🎭 demoRunning status:', demoRunning);

                // 安全チェック: demoRunningがfalseなら停止
                if (!demoRunning) {
                    console.log('⚠️ Demo not running, stopping animation');
                    return;
                }

                if (currentStep >= demoSteps.length) {
                    console.log('🏁 Animation completed');
                    demoRunning = false;
                    return;
                }

                const step = demoSteps[currentStep];
                const cellId = `cell-${step.mid}`;
                const cell = document.getElementById(cellId);

                console.log(
                    '🎯 Processing step:',
                    currentStep + 1,
                    'cellId:',
                    cellId,
                    'value:',
                    step.val,
                );

                // Clear previous highlights
                document.querySelectorAll('.matrix-cell').forEach((c) => {
                    c.classList.remove('highlight', 'target');
                });

                // Highlight current cell
                cell.classList.add('highlight');

                // Update status
                const statusText = document.getElementById('statusText');
                const comparison =
                    step.comparison === 'found'
                        ? '見つかった！'
                        : step.comparison === 'less'
                          ? `${step.val} < ${
                                document.getElementById('targetInput').value
                            }, 右半分を探索`
                          : `${step.val} > ${
                                document.getElementById('targetInput').value
                            }, 左半分を探索`;

                statusText.innerHTML = `
                     Step ${currentStep + 1}:
                     位置[${step.row}][${step.col}] = ${step.val}<br>
                     ${comparison}
                 `;

                // Add to steps list - 要素の取得を毎回行う
                const stepsList = document.getElementById('stepsList');
                if (!stepsList) {
                    console.error('❌ stepsList not found!');
                    return;
                }

                console.log('📋 Adding step to list, current children:', stepsList.children.length);

                const stepDiv = document.createElement('div');
                stepDiv.className = 'demo-step-item';
                stepDiv.style.cssText =
                    'padding: 10px; margin: 5px 0; background: var(--bg-tertiary); border-radius: 5px; border-left: 3px solid var(--accent-primary);';
                stepDiv.innerHTML = `
                     <strong>Step ${currentStep + 1}:</strong>
                     left=${step.left}, right=${step.right}, mid=${step.mid}<br>
                     <small>matrix[${step.row}][${step.col}] = ${step.val} ${comparison}</small>
                 `;

                try {
                    stepsList.appendChild(stepDiv);
                    console.log('✅ Step added, new children count:', stepsList.children.length);
                } catch (error) {
                    console.error('❌ Error adding step:', error);
                }

                // Scroll to latest step
                stepDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

                if (step.comparison === 'found') {
                    cell.classList.remove('highlight');
                    cell.classList.add('target');
                    statusText.innerHTML +=
                        '<br><strong style="color: var(--accent-secondary);">🎉 ターゲットが見つかりました！</strong>';
                    console.log('🎉 Target found! Stopping demo.');
                    demoRunning = false;
                    return;
                }

                currentStep++;

                // Continue after delay
                setTimeout(() => {
                    if (!demoRunning) {
                        console.log('⚠️ Demo stopped during timeout');
                        return;
                    }

                    if (currentStep >= demoSteps.length) {
                        statusText.innerHTML +=
                            '<br><strong style="color: var(--accent-danger);">❌ ターゲットが見つかりませんでした</strong>';
                        console.log('❌ Target not found');
                        demoRunning = false;
                    } else {
                        animateStep();
                    }
                }, 2000);
            }

            // Reset demo completely (新しい関数)
            function resetDemoCompletely() {
                demoRunning = false;
                currentStep = 0;
                demoSteps = [];

                // ✅ セルのハイライトをクリア
                document.querySelectorAll('.matrix-cell').forEach((cell) => {
                    cell.classList.remove('highlight', 'target');
                });

                // ✅ ステータステキストを初期状態に戻す
                document.getElementById('statusText').textContent = 'デモを開始してください';

                // ✅ ステップ情報を非表示にして完全クリア
                const stepsInfo = document.getElementById('stepsInfo');
                stepsInfo.style.display = 'none';

                // ✅ ステップリストを完全にクリア（DOMから全削除）
                const stepsList = document.getElementById('stepsList');
                while (stepsList.firstChild) {
                    stepsList.removeChild(stepsList.firstChild);
                }
            }

            // Reset demo (既存の関数も残す)
            function resetDemo() {
                resetDemoCompletely();
            }

            // Toggle step content
            function toggleStep(header) {
                const step = header.parentElement;
                step.classList.toggle('active');
            }

            // Copy code to clipboard
            async function copyCode(button) {
                const codeBlock = button.closest('.code-container').querySelector('code');
                const text = codeBlock.textContent;

                try {
                    await navigator.clipboard.writeText(text);
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check"></i> コピー完了';
                    button.style.background = 'var(--accent-secondary)';

                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.background = 'var(--accent-primary)';
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            }

            // Smooth scrolling for navigation
            document.querySelectorAll('.nav-link').forEach((link) => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);

                    // Update active nav
                    document
                        .querySelectorAll('.nav-link')
                        .forEach((l) => l.classList.remove('active'));
                    link.classList.add('active');

                    // Smooth scroll
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start',
                    });
                });
            });

            // Update active nav on scroll
            window.addEventListener('scroll', () => {
                const sections = document.querySelectorAll('.section');
                const navLinks = document.querySelectorAll('.nav-link');

                let current = '';
                sections.forEach((section) => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    if (scrollY >= sectionTop - 200) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach((link) => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            });

            // Initialize on load
            document.addEventListener('DOMContentLoaded', () => {
                initMatrix();

                // Add line numbers to code blocks
                document.querySelectorAll('pre code').forEach((block) => {
                    block.parentElement.classList.add('line-numbers');
                });
            });

            // Add intersection observer for animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px',
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationDelay = '0s';
                        entry.target.classList.add('animate__fadeInUp');
                    }
                });
            }, observerOptions);

            // Observe all cards and containers
            document.addEventListener('DOMContentLoaded', () => {
                document
                    .querySelectorAll('.overview-card, .step, .complexity-card')
                    .forEach((el) => {
                        observer.observe(el);
                    });
            });
        </script>
    </body>
</html>
