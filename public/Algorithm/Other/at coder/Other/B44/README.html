<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Grid Operations Visualization</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                margin: 0;
                padding: 20px;
                min-height: 100vh;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 30px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .demo-section {
                margin: 40px 0;
                padding: 25px;
                background: #f8f9fa;
                border-radius: 15px;
                border-left: 5px solid #3498db;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            }

            .demo-section h2 {
                color: #2c3e50;
                margin-bottom: 20px;
                font-size: 1.8em;
            }

            .grid-container {
                display: flex;
                justify-content: space-around;
                align-items: flex-start;
                flex-wrap: wrap;
                gap: 30px;
                margin: 20px 0;
            }

            .grid-display {
                text-align: center;
                background: white;
                padding: 20px;
                border-radius: 12px;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
                min-width: 200px;
            }

            .grid-title {
                font-weight: bold;
                margin-bottom: 15px;
                color: #34495e;
                font-size: 1.1em;
            }

            .grid {
                display: inline-block;
                border: 3px solid #3498db;
                border-radius: 8px;
                overflow: hidden;
            }

            .grid-row {
                display: flex;
            }

            .grid-cell {
                width: 50px;
                height: 50px;
                border: 1px solid #bdc3c7;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 18px;
                transition: all 0.3s ease;
            }

            .grid-cell.highlight {
                background-color: #f39c12;
                color: white;
                transform: scale(1.1);
                z-index: 1;
                position: relative;
            }

            .grid-cell.row-highlight {
                background-color: #e74c3c;
                color: white;
            }

            .mapping-display {
                margin: 20px 0;
                padding: 15px;
                background: #ecf0f1;
                border-radius: 8px;
                font-family: 'Courier New', monospace;
            }

            .mapping-array {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin: 10px 0;
            }

            .mapping-cell {
                width: 60px;
                height: 40px;
                border: 2px solid #95a5a6;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #ffffff;
                border-radius: 6px;
                font-weight: bold;
                transition: all 0.3s ease;
            }

            .mapping-cell.changed {
                background-color: #e67e22;
                color: white;
                border-color: #d35400;
                transform: scale(1.05);
            }

            .operation-log {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 20px;
                border-radius: 8px;
                font-family: 'Courier New', monospace;
                margin: 20px 0;
                max-height: 300px;
                overflow-y: auto;
            }

            .controls {
                text-align: center;
                margin: 30px 0;
            }

            .btn {
                background: linear-gradient(45deg, #3498db, #2980b9);
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 16px;
                margin: 5px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

            .btn:active {
                transform: translateY(0);
            }

            .step-counter {
                text-align: center;
                font-size: 1.3em;
                color: #2c3e50;
                margin: 20px 0;
                font-weight: bold;
            }

            .complexity-info {
                background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                padding: 20px;
                border-radius: 12px;
                margin: 20px 0;
            }

            .complexity-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                background: white;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            }

            .complexity-table th,
            .complexity-table td {
                padding: 12px;
                text-align: center;
                border-bottom: 1px solid #ecf0f1;
            }

            .complexity-table th {
                background: #34495e;
                color: white;
                font-weight: bold;
            }

            .complexity-table tr:hover {
                background: #f8f9fa;
            }

            .result-display {
                background: #27ae60;
                color: white;
                padding: 15px;
                border-radius: 8px;
                text-align: center;
                font-size: 1.2em;
                font-weight: bold;
                margin: 10px 0;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸ”„ Grid Operations Visualization</h1>

            <div class="demo-section">
                <h2>ğŸ“Š ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åŠ¹ç‡æ€§åˆ†æ</h2>
                <div class="complexity-info">
                    <h3>æ™‚é–“ãƒ»ç©ºé–“è¨ˆç®—é‡</h3>
                    <table class="complexity-table">
                        <thead>
                            <tr>
                                <th>æ“ä½œ</th>
                                <th>å¾“æ¥æ‰‹æ³•ï¼ˆç‰©ç†çš„äº¤æ›ï¼‰</th>
                                <th>æœ¬æ‰‹æ³•ï¼ˆãƒãƒƒãƒ”ãƒ³ã‚°é…åˆ—ï¼‰</th>
                                <th>æ”¹å–„åŠ¹æœ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>è¡Œäº¤æ›</td>
                                <td>O(N)</td>
                                <td>O(1)</td>
                                <td>ğŸš€ Nå€é«˜é€ŸåŒ–</td>
                            </tr>
                            <tr>
                                <td>å€¤å–å¾—</td>
                                <td>O(1)</td>
                                <td>O(1)</td>
                                <td>âœ… åŒç­‰</td>
                            </tr>
                            <tr>
                                <td>ç©ºé–“ä½¿ç”¨é‡</td>
                                <td>O(NÂ²)</td>
                                <td>O(NÂ² + N)</td>
                                <td>ğŸ“ˆ +O(N)ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="demo-section">
                <h2>ğŸ® ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢</h2>
                <div class="step-counter" id="stepCounter">ã‚¹ãƒ†ãƒƒãƒ— 0 / 7</div>

                <div class="grid-container">
                    <div class="grid-display">
                        <div class="grid-title">è«–ç†çš„ãªè¡¨ç¤º</div>
                        <div class="grid" id="logicalGrid"></div>
                    </div>

                    <div class="grid-display">
                        <div class="grid-title">ç‰©ç†çš„ãªãƒ¡ãƒ¢ãƒª</div>
                        <div class="grid" id="physicalGrid"></div>
                    </div>
                </div>

                <div class="mapping-display">
                    <div style="text-align: center; font-weight: bold; margin-bottom: 10px">
                        rowMapping é…åˆ—ï¼ˆè«–ç†è¡Œ â†’ ç‰©ç†è¡Œï¼‰
                    </div>
                    <div class="mapping-array" id="mappingArray"></div>
                </div>

                <div class="controls">
                    <button class="btn" onclick="previousStep()">â¬…ï¸ å‰ã®ã‚¹ãƒ†ãƒƒãƒ—</button>
                    <button class="btn" onclick="nextStep()">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— â¡ï¸</button>
                    <button class="btn" onclick="resetDemo()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                    <button class="btn" onclick="autoPlay()">â–¶ï¸ è‡ªå‹•å†ç”Ÿ</button>
                </div>

                <div class="operation-log" id="operationLog"></div>

                <div class="result-display" id="resultDisplay" style="display: none"></div>
            </div>

            <div class="demo-section">
                <h2>ğŸ” ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</h2>
                <div class="complexity-info">
                    <h3>ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ã®æœ€é©åŒ–</h3>
                    <ul>
                        <li>
                            <strong>å±€æ‰€æ€§ã®ä¿æŒ:</strong>
                            rowMappingé…åˆ—ã¯å°ã•ãã€é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãŸã‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å¸¸é§
                        </li>
                        <li>
                            <strong>ãƒ‡ãƒ¼ã‚¿ã®ä¸å¤‰æ€§:</strong>
                            å®Ÿéš›ã®gridé…åˆ—ã¯å¤‰æ›´ã•ã‚Œãªã„ãŸã‚ã€ãƒ¡ãƒ¢ãƒªã®æ–­ç‰‡åŒ–ã‚’é˜²æ­¢
                        </li>
                        <li>
                            <strong>æœ€å°é™ã®ã‚¢ã‚¯ã‚»ã‚¹:</strong> äº¤æ›æ“ä½œã§ã¯2ã¤ã®é…åˆ—è¦ç´ ã®ã¿ã‚’æ“ä½œ
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <script>
            // ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
            let physicalGrid = [
                [1, 2, 3],
                [4, 5, 6],
                [7, 8, 9],
            ];

            let rowMapping = [0, 1, 2];
            let currentStep = 0;
            let results = [];
            let autoPlayInterval = null;

            // æ“ä½œã‚·ãƒ¼ã‚±ãƒ³ã‚¹
            const operations = [
                { type: 'init', desc: 'åˆæœŸçŠ¶æ…‹: N=3ã®ã‚°ãƒªãƒƒãƒ‰ã¨rowMappingé…åˆ—ã‚’åˆæœŸåŒ–' },
                { type: 'query', row: 2, col: 1, desc: 'å–å¾—æ“ä½œ: (2,1)ã®å€¤ã‚’å–å¾— â†’ 4' },
                { type: 'swap', row1: 1, row2: 2, desc: 'äº¤æ›æ“ä½œ: 1è¡Œç›®ã¨2è¡Œç›®ã‚’äº¤æ›' },
                { type: 'query', row: 2, col: 1, desc: 'å–å¾—æ“ä½œ: (2,1)ã®å€¤ã‚’å–å¾— â†’ 1' },
                { type: 'query', row: 1, col: 3, desc: 'å–å¾—æ“ä½œ: (1,3)ã®å€¤ã‚’å–å¾— â†’ 6' },
                { type: 'swap', row1: 2, row2: 3, desc: 'äº¤æ›æ“ä½œ: 2è¡Œç›®ã¨3è¡Œç›®ã‚’äº¤æ›' },
                { type: 'query', row: 2, col: 3, desc: 'å–å¾—æ“ä½œ: (2,3)ã®å€¤ã‚’å–å¾— â†’ 9' },
                { type: 'query', row: 3, col: 2, desc: 'å–å¾—æ“ä½œ: (3,2)ã®å€¤ã‚’å–å¾— â†’ 2' },
            ];

            function initializeDisplay() {
                updateGridDisplay();
                updateMappingDisplay();
                updateOperationLog();
                updateStepCounter();
            }

            function updateGridDisplay() {
                // è«–ç†çš„ãªã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
                const logicalGrid = document.getElementById('logicalGrid');
                logicalGrid.innerHTML = '';

                for (let i = 0; i < 3; i++) {
                    const row = document.createElement('div');
                    row.className = 'grid-row';
                    for (let j = 0; j < 3; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell';
                        const physicalRowIndex = rowMapping[i];
                        cell.textContent = physicalGrid[physicalRowIndex][j];

                        // ãƒã‚¤ãƒ©ã‚¤ãƒˆå‡¦ç†
                        const currentOp = operations[currentStep];
                        if (currentOp && currentOp.type === 'query') {
                            if (i === currentOp.row - 1 && j === currentOp.col - 1) {
                                cell.classList.add('highlight');
                            }
                        } else if (currentOp && currentOp.type === 'swap') {
                            if (i === currentOp.row1 - 1 || i === currentOp.row2 - 1) {
                                cell.classList.add('row-highlight');
                            }
                        }

                        row.appendChild(cell);
                    }
                    logicalGrid.appendChild(row);
                }

                // ç‰©ç†çš„ãªã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
                const physicalGridEl = document.getElementById('physicalGrid');
                physicalGridEl.innerHTML = '';

                for (let i = 0; i < 3; i++) {
                    const row = document.createElement('div');
                    row.className = 'grid-row';
                    for (let j = 0; j < 3; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell';
                        cell.textContent = physicalGrid[i][j];
                        row.appendChild(cell);
                    }
                    physicalGridEl.appendChild(row);
                }
            }

            function updateMappingDisplay() {
                const mappingArray = document.getElementById('mappingArray');
                mappingArray.innerHTML = '';

                // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ©ãƒ™ãƒ«
                const indexRow = document.createElement('div');
                indexRow.style.display = 'flex';
                indexRow.style.justifyContent = 'center';
                indexRow.style.gap = '10px';
                indexRow.style.marginBottom = '5px';
                indexRow.style.fontSize = '12px';
                indexRow.style.color = '#7f8c8d';

                for (let i = 0; i < 3; i++) {
                    const indexLabel = document.createElement('div');
                    indexLabel.style.width = '60px';
                    indexLabel.style.textAlign = 'center';
                    indexLabel.textContent = `[${i}]`;
                    indexRow.appendChild(indexLabel);
                }
                mappingArray.appendChild(indexRow);

                // ãƒãƒƒãƒ”ãƒ³ã‚°å€¤
                const valueRow = document.createElement('div');
                valueRow.style.display = 'flex';
                valueRow.style.justifyContent = 'center';
                valueRow.style.gap = '10px';

                for (let i = 0; i < 3; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'mapping-cell';
                    cell.textContent = rowMapping[i];

                    // å¤‰æ›´ã•ã‚ŒãŸã‚»ãƒ«ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    const currentOp = operations[currentStep];
                    const prevOp = currentStep > 0 ? operations[currentStep - 1] : null;
                    if (prevOp && prevOp.type === 'swap') {
                        if (i === prevOp.row1 - 1 || i === prevOp.row2 - 1) {
                            cell.classList.add('changed');
                        }
                    }

                    valueRow.appendChild(cell);
                }
                mappingArray.appendChild(valueRow);
            }

            function updateOperationLog() {
                const log = document.getElementById('operationLog');
                let logText = '';

                for (let i = 0; i <= currentStep && i < operations.length; i++) {
                    const op = operations[i];
                    const isActive = i === currentStep;

                    logText += `${isActive ? 'ğŸ”¸' : 'âœ…'} ã‚¹ãƒ†ãƒƒãƒ— ${i}: ${op.desc}\n`;

                    if (op.type === 'query' && i <= currentStep) {
                        const row = op.row - 1;
                        const col = op.col - 1;
                        const physicalRowIndex = rowMapping[row];
                        const value = physicalGrid[physicalRowIndex][col];
                        results.push(value);
                        logText += `   â†’ rowMapping[${row}] = ${physicalRowIndex}\n`;
                        logText += `   â†’ grid[${physicalRowIndex}][${col}] = ${value}\n`;
                        logText += `   â†’ çµæœ: ${value}\n`;
                    } else if (op.type === 'swap' && i <= currentStep) {
                        const row1 = op.row1 - 1;
                        const row2 = op.row2 - 1;
                        logText += `   â†’ rowMapping[${row1}] ã¨ rowMapping[${row2}] ã‚’äº¤æ›\n`;
                        logText += `   â†’ æ–°ã—ã„ãƒãƒƒãƒ”ãƒ³ã‚°: [${rowMapping.join(', ')}]\n`;
                    }

                    logText += '\n';
                }

                log.textContent = logText;
                log.scrollTop = log.scrollHeight;
            }

            function updateStepCounter() {
                const counter = document.getElementById('stepCounter');
                counter.textContent = `ã‚¹ãƒ†ãƒƒãƒ— ${currentStep} / ${operations.length - 1}`;
            }

            function updateResultDisplay() {
                const resultDiv = document.getElementById('resultDisplay');
                if (results.length > 0) {
                    resultDiv.style.display = 'block';
                    resultDiv.textContent = `å–å¾—æ“ä½œã®çµæœ: [${results.join(', ')}]`;
                } else {
                    resultDiv.style.display = 'none';
                }
            }

            function nextStep() {
                if (currentStep < operations.length - 1) {
                    currentStep++;
                    const op = operations[currentStep];

                    if (op.type === 'swap') {
                        // äº¤æ›æ“ä½œã‚’å®Ÿè¡Œ
                        const row1 = op.row1 - 1;
                        const row2 = op.row2 - 1;
                        const temp = rowMapping[row1];
                        rowMapping[row1] = rowMapping[row2];
                        rowMapping[row2] = temp;
                    }

                    updateGridDisplay();
                    updateMappingDisplay();
                    updateOperationLog();
                    updateStepCounter();
                    updateResultDisplay();
                }
            }

            function previousStep() {
                if (currentStep > 0) {
                    const currentOp = operations[currentStep];

                    if (currentOp.type === 'swap') {
                        // äº¤æ›æ“ä½œã‚’å…ƒã«æˆ»ã™
                        const row1 = currentOp.row1 - 1;
                        const row2 = currentOp.row2 - 1;
                        const temp = rowMapping[row1];
                        rowMapping[row1] = rowMapping[row2];
                        rowMapping[row2] = temp;
                    } else if (currentOp.type === 'query') {
                        // çµæœé…åˆ—ã‹ã‚‰æœ€å¾Œã®è¦ç´ ã‚’å‰Šé™¤
                        results.pop();
                    }

                    currentStep--;
                    updateGridDisplay();
                    updateMappingDisplay();
                    updateOperationLog();
                    updateStepCounter();
                    updateResultDisplay();
                }
            }

            function resetDemo() {
                if (autoPlayInterval) {
                    clearInterval(autoPlayInterval);
                    autoPlayInterval = null;
                }

                currentStep = 0;
                rowMapping = [0, 1, 2];
                results = [];
                physicalGrid = [
                    [1, 2, 3],
                    [4, 5, 6],
                    [7, 8, 9],
                ];

                updateGridDisplay();
                updateMappingDisplay();
                updateOperationLog();
                updateStepCounter();
                updateResultDisplay();
            }

            function autoPlay() {
                if (autoPlayInterval) {
                    clearInterval(autoPlayInterval);
                    autoPlayInterval = null;
                    return;
                }

                autoPlayInterval = setInterval(() => {
                    if (currentStep < operations.length - 1) {
                        nextStep();
                    } else {
                        clearInterval(autoPlayInterval);
                        autoPlayInterval = null;
                    }
                }, 2000);
            }

            // åˆæœŸåŒ–
            initializeDisplay();
        </script>
    </body>
</html>
