<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LeetCode 7: Reverse Integer - 文字列反転法</title>
        <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&family=Source+Code+Pro:wght@400;600&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css"
        />
        <style>
            html {
                scroll-behavior: smooth;
            }

            code[class*='language-'],
            pre[class*='language-'] {
                font-family: 'JetBrains Mono', 'Source Code Pro', monospace;
                font-size: 0.95rem;
            }

            div.code-toolbar > .toolbar {
                opacity: 1;
            }

            div.code-toolbar > .toolbar .toolbar-item > button,
            div.code-toolbar > .toolbar .toolbar-item > a {
                background: #fff;
                border: 1px solid #e6e8ef;
                border-radius: 10px;
                padding: 1rem 1.5rem;
                margin: 1rem 1rem 0 0;
                font:
                    600 13px/1.2 Inter,
                    system-ui,
                    sans-serif;
                color: #334155;
                box-shadow: 0 2px 6px rgba(20, 32, 70, 0.06);
                transition:
                    transform 0.15s,
                    box-shadow 0.15s,
                    background 0.15s;
            }

            div.code-toolbar > .toolbar .toolbar-item > button:hover {
                transform: translateY(-1px);
                box-shadow: 0 10px 28px rgba(20, 32, 70, 0.08);
                background: linear-gradient(180deg, #e8fff6, #c8f1e1);
            }
        </style>
    </head>
    <body
        class="min-h-screen p-8 sm:p-6 font-[Inter] text-slate-800 leading-relaxed bg-[linear-gradient(135deg,#f0fdf4_0%,#dbeafe_100%)]"
    >
        <div class="max-w-7xl mx-auto">
            <header
                id="header"
                class="mb-8 rounded-2xl p-8 shadow-[0_10px_30px_rgba(16,185,129,0.10)] bg-[linear-gradient(135deg,#d1fae5,#bfdbfe)]"
            >
                <h1 class="text-[2.5rem] font-bold text-teal-800 mb-2">Reverse Integer</h1>
                <p class="text-xl text-cyan-700 font-semibold mt-2">文字列反転法による O(d) 実装</p>
                <nav class="flex flex-wrap gap-4 mt-6">
                    <a
                        href="#overview"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >概要</a
                    >
                    <a
                        href="#steps"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >ステップ解説</a
                    >
                    <a
                        href="#code"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >コード</a
                    >
                    <a
                        href="#diagram"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >フローチャート</a
                    >
                    <a
                        href="#complexity"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                        >計算量</a
                    >
                </nav>
            </header>

            <section id="overview" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    アルゴリズム概要
                </h2>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">問題</h3>
                <p class="mb-4">
                    32bit符号付き整数
                    <code class="bg-slate-100 px-2 py-1 rounded">x</code> の桁を反転し、結果が
                    <code class="bg-slate-100 px-2 py-1 rounded">[-2³¹, 2³¹-1]</code>
                    の範囲外になる場合は
                    <code class="bg-slate-100 px-2 py-1 rounded">0</code>
                    を返します。64bit整数の使用は禁止されています。
                </p>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">入出力例</h3>
                <div class="bg-slate-50 p-4 rounded-lg mb-4">
                    <pre class="text-sm"><code>Input: x = 123
Output: 321

Input: x = -123
Output: -321

Input: x = 120
Output: 21

Input: x = 2147483647
Output: 0 (範囲外)</code></pre>
                </div>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">制約</h3>
                <ul class="list-disc list-inside space-y-2 text-slate-700">
                    <li><code class="bg-slate-100 px-2 py-1 rounded">-2³¹ ≤ x ≤ 2³¹-1</code></li>
                    <li>64bit整数は使用不可</li>
                </ul>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">戦略</h3>
                <ul class="list-disc list-inside space-y-2 text-slate-700">
                    <li><strong>文字列反転法</strong>: Pythonの高速な組み込み文字列処理を活用</li>
                    <li><strong>符号分離</strong>: 絶対値を反転後に符号を掛け戻し</li>
                    <li><strong>範囲チェック</strong>: 最後に32bit境界と比較</li>
                    <li><strong>早期リターン</strong>: 1桁の場合は処理不要</li>
                </ul>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">主要ポイント</h3>
                <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 mt-4">
                    <p class="font-semibold text-emerald-900">
                        ✓ 時間計算量: O(d) — d は桁数（最大10）
                    </p>
                    <p class="font-semibold text-emerald-900">
                        ✓ 空間計算量: O(d) — 文字列スライスで一時領域
                    </p>
                    <p class="text-emerald-800 mt-2">
                        CPythonの <code class="bg-white px-2 py-1 rounded">str()</code>, スライス
                        <code class="bg-white px-2 py-1 rounded">[::-1]</code>,
                        <code class="bg-white px-2 py-1 rounded">int()</code>
                        はC実装で最適化されており、数値逐次処理より高速です。
                    </p>
                </div>
            </section>

            <section id="steps" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    ステップバイステップ解説
                </h2>
                <div id="step-visualization-root"></div>
            </section>

            <section id="code" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    Python実装
                </h2>
                <pre
                    class="line-numbers"
                ><code class="language-python">from __future__ import annotations

class Solution:
    """
    Reverse Integer (LeetCode #7)
    32-bit 符号付き整数 x の数字を反転。範囲外は 0 を返す。
    """

    # 32bit境界定数（クラス定数として明示）
    INT_MAX: int = 2_147_483_647   #  2^31 - 1
    INT_MIN: int = -2_147_483_648  # -2^31

    def reverse(self, x: int) -> int:
        """
        文字列反転法による最速実装

        Args:
            x: 32-bit signed integer

        Returns:
            反転後の整数（範囲外は 0）

        Time: O(d), Space: O(d) — d は桁数（最大10）
        """
        # 基底条件: 1桁はそのまま返す（早期リターン）
        if -9 <= x <= 9:
            return x

        # 符号を分離して絶対値の文字列を反転
        sign: int = -1 if x < 0 else 1
        abs_x: int = -x if x < 0 else x

        # C実装の高速な文字列処理を活用
        # [::-1] スライスで反転、int() で整数化（先頭ゼロは自動削除）
        rev_abs: int = int(str(abs_x)[::-1])

        # 符号を適用
        result: int = rev_abs * sign

        # 32bit範囲チェック（Pythonの任意精度intを手動で拘束）
        if result < self.INT_MIN or result > self.INT_MAX:
            return 0

        return result</code></pre>
            </section>

            <section id="diagram" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    フローチャート
                </h2>
                <div class="mt-[20px] overflow-x-auto">
                    <svg
                        viewBox="0 0 840 900"
                        style="max-width: 100%; height: auto; color: #333"
                        role="img"
                        aria-label="Reverse Integer flowchart"
                    >
                        <defs>
                            <marker
                                id="arrow"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                            </marker>
                            <marker
                                id="arrowGreen"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                            </marker>
                            <marker
                                id="arrowRed"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#dc2626" />
                            </marker>
                        </defs>

                        <!-- 開始 -->
                        <ellipse
                            cx="420"
                            cy="60"
                            rx="100"
                            ry="35"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="60"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="18"
                            font-weight="600"
                        >
                            開始
                        </text>

                        <!-- 1桁チェック -->
                        <path
                            d="M 420 95 L 420 150"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <path
                            d="M 420 150 L 520 200 L 420 250 L 320 200 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="192"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">-9 &lt;= x &lt;= 9</tspan>
                            <tspan x="420" dy="18">1桁判定</tspan>
                        </text>

                        <!-- はい → そのまま返す -->
                        <path
                            d="M 520 200 L 640 200 L 640 270"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="580"
                            y="185"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#059669"
                        >
                            はい
                        </text>
                        <rect
                            x="540"
                            y="270"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="640"
                            y="300"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="640" dy="-8">x をそのまま返す</tspan>
                            <tspan x="640" dy="18">早期リターン</tspan>
                        </text>

                        <!-- いいえ → 符号分離 -->
                        <path
                            d="M 420 250 L 420 310"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="450"
                            y="280"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#dc2626"
                        >
                            いいえ
                        </text>
                        <rect
                            x="320"
                            y="310"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="340"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">符号を分離</tspan>
                            <tspan x="420" dy="18">sign, abs_x</tspan>
                        </text>

                        <!-- 文字列反転 -->
                        <path
                            d="M 420 370 L 420 420"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <rect
                            x="320"
                            y="420"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="450"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">str(abs_x)[::-1]</tspan>
                            <tspan x="420" dy="18">文字列反転</tspan>
                        </text>

                        <!-- 整数化 -->
                        <path
                            d="M 420 480 L 420 530"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <rect
                            x="320"
                            y="530"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="560"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">int() で整数化</tspan>
                            <tspan x="420" dy="18">先頭ゼロ自動削除</tspan>
                        </text>

                        <!-- 符号適用 -->
                        <path
                            d="M 420 590 L 420 640"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <rect
                            x="320"
                            y="640"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="670"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="420" dy="-8">result = rev * sign</tspan>
                            <tspan x="420" dy="18">符号適用</tspan>
                        </text>

                        <!-- 範囲チェック -->
                        <path
                            d="M 420 700 L 420 760"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <path
                            d="M 420 760 L 520 810 L 420 860 L 320 810 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="802"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                        >
                            <tspan x="420" dy="0">INT_MIN &lt;= result</tspan>
                            <tspan x="420" dy="22">&lt;= INT_MAX</tspan>
                        </text>

                        <!-- いいえ → 0を返す -->
                        <path
                            d="M 320 810 L 160 810 L 160 750"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text
                            x="240"
                            y="795"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#dc2626"
                        >
                            いいえ
                        </text>
                        <rect
                            x="60"
                            y="690"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#fee2e2"
                            stroke="#dc2626"
                            stroke-width="2"
                        />
                        <text
                            x="160"
                            y="720"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="160" dy="-8">0 を返す</tspan>
                            <tspan x="160" dy="18">オーバーフロー</tspan>
                        </text>

                        <!-- はい → resultを返す -->
                        <path
                            d="M 520 810 L 640 810 L 640 750"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text
                            x="580"
                            y="795"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="600"
                            fill="#059669"
                        >
                            はい
                        </text>
                        <rect
                            x="540"
                            y="690"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="640"
                            y="720"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="600"
                        >
                            <tspan x="640" dy="-8">result を返す</tspan>
                            <tspan x="640" dy="18">成功</tspan>
                        </text>
                    </svg>
                </div>

                <p class="mt-8 font-[Source_Code_Pro] text-[20px] font-semibold">
                    <strong class="text-2xl">フローの説明：</strong><br />
                    1. <span class="text-emerald-700">1桁判定</span>で早期リターン（-9 ≤ x ≤ 9）<br />
                    2. <span class="text-cyan-700">符号を分離</span>し、絶対値を文字列に変換<br />
                    3. <span class="text-cyan-700">[::-1] で反転</span>し、int() で整数化<br />
                    4. <span class="text-cyan-700">符号を適用</span>して元の符号を復元<br />
                    5. <span class="text-amber-700">32bit範囲チェック</span>で範囲外なら 0 を返す<br />
                    6. <span class="text-emerald-700">範囲内なら result を返す</span>
                </p>
            </section>

            <section id="complexity" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    計算量分析
                </h2>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">時間計算量: O(d)</h3>
                <ul class="list-disc list-inside space-y-2 text-slate-700 mb-6">
                    <li>d は入力整数の桁数（最大10）</li>
                    <li>
                        <code class="bg-slate-100 px-2 py-1 rounded">str()</code>, スライス
                        <code class="bg-slate-100 px-2 py-1 rounded">[::-1]</code>,
                        <code class="bg-slate-100 px-2 py-1 rounded">int()</code> はすべて O(d)
                    </li>
                    <li>CPythonのC実装により、ループより高速</li>
                </ul>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">空間計算量: O(d)</h3>
                <ul class="list-disc list-inside space-y-2 text-slate-700 mb-6">
                    <li>文字列スライスで一時的に O(d) のメモリを使用</li>
                    <li>最終結果は整数1つ</li>
                </ul>

                <h3 class="text-xl font-semibold text-teal-800 mt-6 mb-3">手法比較</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-slate-100">
                                <th class="border border-slate-300 px-4 py-2 text-left">手法</th>
                                <th class="border border-slate-300 px-4 py-2 text-left">時間</th>
                                <th class="border border-slate-300 px-4 py-2 text-left">空間</th>
                                <th class="border border-slate-300 px-4 py-2 text-left">
                                    Python実装
                                </th>
                                <th class="border border-slate-300 px-4 py-2 text-left">備考</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td
                                    class="border border-slate-300 px-4 py-2 font-semibold text-emerald-700"
                                >
                                    文字列反転法
                                </td>
                                <td class="border border-slate-300 px-4 py-2">O(d)</td>
                                <td class="border border-slate-300 px-4 py-2">O(d)</td>
                                <td class="border border-slate-300 px-4 py-2">最速</td>
                                <td class="border border-slate-300 px-4 py-2">C実装の恩恵で高速</td>
                            </tr>
                            <tr>
                                <td class="border border-slate-300 px-4 py-2">
                                    数値のみ（divmod）
                                </td>
                                <td class="border border-slate-300 px-4 py-2">O(d)</td>
                                <td class="border border-slate-300 px-4 py-2">O(1)</td>
                                <td class="border border-slate-300 px-4 py-2">中速</td>
                                <td class="border border-slate-300 px-4 py-2">ループで逐次処理</td>
                            </tr>
                            <tr>
                                <td class="border border-slate-300 px-4 py-2">負数のまま処理</td>
                                <td class="border border-slate-300 px-4 py-2">O(d)</td>
                                <td class="border border-slate-300 px-4 py-2">O(1)</td>
                                <td class="border border-slate-300 px-4 py-2">中速</td>
                                <td class="border border-slate-300 px-4 py-2">分岐が増えがち</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            function StepVisualization() {
                const [activeStep, setActiveStep] = useState(1);
                const [isPlaying, setIsPlaying] = useState(false);
                const timerRef = useRef(null);

                const stepsData = [
                    {
                        step: 1,
                        title: '入力と早期判定',
                        desc: 'x = 123 の場合を例とします。まず -9 ≤ x ≤ 9 かチェックします（1桁判定）。この例では該当しないので次へ。',
                        visual: { type: 'input', x: 123, isOneDigit: false },
                    },
                    {
                        step: 2,
                        title: '符号分離',
                        desc: 'x が負数かどうかで符号 sign を決定します。123 は正数なので sign = 1。絶対値 abs_x = 123 を取得します。',
                        visual: { type: 'signSplit', x: 123, sign: 1, absX: 123 },
                    },
                    {
                        step: 3,
                        title: '文字列変換と反転',
                        desc: "abs_x を文字列に変換: str(123) = '123'。スライス [::-1] で反転: '321'。これがPythonの高速な組み込み処理です。",
                        visual: { type: 'strReverse', original: '123', reversed: '321' },
                    },
                    {
                        step: 4,
                        title: '整数化',
                        desc: "反転した文字列 '321' を int() で整数に戻します: 321。先頭ゼロは自動的に削除されます（例: '021' → 21）。",
                        visual: { type: 'toInt', str: '321', num: 321 },
                    },
                    {
                        step: 5,
                        title: '符号適用',
                        desc: '整数化した値に元の符号を掛けます: result = 321 * 1 = 321。負数の場合は -1 を掛けて負の値に戻します。',
                        visual: { type: 'applySign', revAbs: 321, sign: 1, result: 321 },
                    },
                    {
                        step: 6,
                        title: '範囲チェック',
                        desc: 'result が 32bit 範囲内かチェック: -2147483648 ≤ 321 ≤ 2147483647。範囲内なので result を返します。',
                        visual: { type: 'rangeCheck', result: 321, inRange: true },
                    },
                    {
                        step: 7,
                        title: '範囲外の例',
                        desc: 'x = 2147483647 の場合、反転すると 7463847412 となり上限を超えます。このような場合は 0 を返します。',
                        visual: {
                            type: 'overflow',
                            x: 2147483647,
                            reversed: '7463847412',
                            result: 0,
                        },
                    },
                ];

                useEffect(() => {
                    if (isPlaying) {
                        if (activeStep >= stepsData.length) {
                            setIsPlaying(false);
                            setActiveStep(1);
                            return;
                        }
                        timerRef.current = setTimeout(() => {
                            setActiveStep((prev) => prev + 1);
                        }, 2000);
                    }
                    return () => {
                        if (timerRef.current) clearTimeout(timerRef.current);
                    };
                }, [isPlaying, activeStep]);

                const handlePlay = () => {
                    if (isPlaying) return;
                    setActiveStep(1);
                    setIsPlaying(true);
                };

                const handlePrev = () => {
                    if (activeStep > 1) {
                        setActiveStep((prev) => prev - 1);
                        setIsPlaying(false);
                    }
                };

                const handleNext = () => {
                    if (activeStep < stepsData.length) {
                        setActiveStep((prev) => prev + 1);
                        setIsPlaying(false);
                    }
                };

                const handleReset = () => {
                    setActiveStep(1);
                    setIsPlaying(false);
                };

                const handleStepClick = (step) => {
                    setActiveStep(step);
                    setIsPlaying(false);
                };

                const currentStepData = stepsData[activeStep - 1];

                return (
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8 mt-2">
                        <div>
                            <h3 className="mt-0 mb-4 text-teal-800 text-xl font-semibold">
                                ステップ一覧
                            </h3>
                            <div className="space-y-2">
                                {stepsData.map((step) => {
                                    const isActive = activeStep === step.step;
                                    return (
                                        <button
                                            key={step.step}
                                            type="button"
                                            className={[
                                                'w-full text-left text-[0.95rem] rounded-xl border-2 transition cursor-pointer px-4 py-4',
                                                'bg-white border-slate-200 hover:border-emerald-500 hover:translate-x-1',
                                                isActive
                                                    ? 'bg-[linear-gradient(135deg,#d1fae5,#a7f3d0)] border-emerald-500 shadow-[0_4px_12px_rgba(16,185,129,0.20)]'
                                                    : '',
                                            ].join(' ')}
                                            onClick={() => handleStepClick(step.step)}
                                            aria-label={`ステップ${step.step}: ${step.title}`}
                                            aria-current={isActive ? 'step' : undefined}
                                        >
                                            <div
                                                className={[
                                                    'font-bold mb-1',
                                                    isActive ? 'text-emerald-900' : 'text-teal-800',
                                                ].join(' ')}
                                            >
                                                Step {step.step}: {step.title}
                                            </div>
                                            <div className="text-slate-500 text-sm mt-1">
                                                {step.desc.substring(0, 50)}
                                                {step.desc.length > 50 ? '...' : ''}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="my-auto">
                            <div className="rounded-2xl p-8 mt-10 border-2 border-emerald-200 bg-[linear-gradient(135deg,#ecfdf5,#f0f9ff)]">
                                <h3 className="mt-0 text-teal-800 text-xl font-semibold">
                                    Step {currentStepData.step}: {currentStepData.title}
                                </h3>
                                <p className="text-slate-600 leading-7">{currentStepData.desc}</p>
                            </div>

                            <StepVisualizationSVG visual={currentStepData.visual} />

                            <div className="flex flex-wrap justify-center gap-2 mt-1">
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#10b981,#059669)]"
                                    onClick={handlePlay}
                                    disabled={isPlaying}
                                    aria-label="自動再生"
                                >
                                    ▶ Play
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#0ea5e9,#0284c7)]"
                                    onClick={handlePrev}
                                    disabled={activeStep === 1}
                                    aria-label="前のステップ"
                                >
                                    ◀ Prev
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#0ea5e9,#0284c7)]"
                                    onClick={handleNext}
                                    disabled={activeStep === stepsData.length}
                                    aria-label="次のステップ"
                                >
                                    Next ▶
                                </button>
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#64748b,#475569)]"
                                    onClick={handleReset}
                                    aria-label="リセット"
                                >
                                    ↺ Reset
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            function StepVisualizationSVG({ visual }) {
                const renderVisualization = () => {
                    switch (visual.type) {
                        case 'input':
                            return (
                                <svg
                                    viewBox="0 0 600 280"
                                    style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                                >
                                    <defs>
                                        <marker
                                            id="arrowPurple"
                                            markerWidth="10"
                                            markerHeight="10"
                                            refX="9"
                                            refY="3"
                                            orient="auto"
                                            markerUnits="strokeWidth"
                                        >
                                            <path d="M0,0 L0,6 L9,3 z" fill="#a855f7" />
                                        </marker>
                                    </defs>

                                    <text
                                        x="300"
                                        y="40"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="600"
                                        fill="#0f766e"
                                    >
                                        入力: x = {visual.x}
                                    </text>

                                    <rect
                                        x="200"
                                        y="80"
                                        width="200"
                                        height="80"
                                        rx="12"
                                        fill="#e0f2fe"
                                        stroke="#0284c7"
                                        strokeWidth="3"
                                    />
                                    <text
                                        x="300"
                                        y="110"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="600"
                                    >
                                        {visual.x}
                                    </text>
                                    <text
                                        x="300"
                                        y="140"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fill="#64748b"
                                    >
                                        入力整数
                                    </text>

                                    <text
                                        x="400"
                                        y="200"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="18"
                                        fill="#64748b"
                                    >
                                        {visual.isOneDigit
                                            ? '1桁 → そのまま返す'
                                            : '複数桁 → 処理を続行'}
                                    </text>

                                    <path
                                        d="M 300 160 L 300 240"
                                        stroke="#a855f7"
                                        strokeWidth="2"
                                        fill="none"
                                        markerEnd="url(#arrowPurple)"
                                    />
                                    <text
                                        x="300"
                                        y="255"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#a855f7"
                                    >
                                        次のステップへ
                                    </text>
                                </svg>
                            );

                        case 'signSplit':
                            return (
                                <svg
                                    viewBox="0 0 600 320"
                                    style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                                >
                                    <defs>
                                        <marker
                                            id="arrow"
                                            markerWidth="10"
                                            markerHeight="10"
                                            refX="9"
                                            refY="3"
                                            orient="auto"
                                            markerUnits="strokeWidth"
                                        >
                                            <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                                        </marker>
                                    </defs>

                                    <text
                                        x="300"
                                        y="30"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="600"
                                        fill="#0f766e"
                                    >
                                        符号分離
                                    </text>

                                    <rect
                                        x="200"
                                        y="60"
                                        width="200"
                                        height="60"
                                        rx="8"
                                        fill="#e0f2fe"
                                        stroke="#0284c7"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="300"
                                        y="90"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="18"
                                        fontWeight="600"
                                    >
                                        x = {visual.x}
                                    </text>

                                    <path
                                        d="M 300 120 L 150 180"
                                        stroke="#64748b"
                                        strokeWidth="2"
                                        fill="none"
                                        markerEnd="url(#arrow)"
                                    />
                                    <path
                                        d="M 300 120 L 450 180"
                                        stroke="#64748b"
                                        strokeWidth="2"
                                        fill="none"
                                        markerEnd="url(#arrow)"
                                    />

                                    <rect
                                        x="50"
                                        y="180"
                                        width="200"
                                        height="80"
                                        rx="8"
                                        fill="#fef3c7"
                                        stroke="#f59e0b"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="150"
                                        y="210"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                    >
                                        sign = {visual.sign}
                                    </text>
                                    <text
                                        x="150"
                                        y="240"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="14"
                                        fill="#64748b"
                                    >
                                        {visual.sign === 1 ? '正の符号' : '負の符号'}
                                    </text>

                                    <rect
                                        x="350"
                                        y="180"
                                        width="200"
                                        height="80"
                                        rx="8"
                                        fill="#dbeafe"
                                        stroke="#0284c7"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="450"
                                        y="210"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                    >
                                        abs_x = {visual.absX}
                                    </text>
                                    <text
                                        x="450"
                                        y="240"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="14"
                                        fill="#64748b"
                                    >
                                        絶対値
                                    </text>
                                </svg>
                            );

                        case 'strReverse':
                            return (
                                <svg
                                    viewBox="0 0 600 280"
                                    style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                                >
                                    <defs>
                                        <marker
                                            id="arrowGreen"
                                            markerWidth="10"
                                            markerHeight="10"
                                            refX="9"
                                            refY="3"
                                            orient="auto"
                                            markerUnits="strokeWidth"
                                        >
                                            <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                                        </marker>
                                    </defs>

                                    <text
                                        x="300"
                                        y="30"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="600"
                                        fill="#0f766e"
                                    >
                                        文字列反転: [::-1]
                                    </text>

                                    <rect
                                        x="80"
                                        y="70"
                                        width="180"
                                        height="70"
                                        rx="8"
                                        fill="#e0f2fe"
                                        stroke="#0284c7"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="170"
                                        y="95"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        str({visual.original})
                                    </text>
                                    <text
                                        x="170"
                                        y="120"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="700"
                                    >
                                        "{visual.original}"
                                    </text>

                                    <path
                                        d="M 260 105 L 340 105"
                                        stroke="#059669"
                                        strokeWidth="3"
                                        fill="none"
                                        markerEnd="url(#arrowGreen)"
                                    />
                                    <text
                                        x="300"
                                        y="90"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#059669"
                                    >
                                        [::-1]
                                    </text>

                                    <rect
                                        x="340"
                                        y="70"
                                        width="180"
                                        height="70"
                                        rx="8"
                                        fill="#d1fae5"
                                        stroke="#10b981"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="430"
                                        y="95"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        反転後
                                    </text>
                                    <text
                                        x="430"
                                        y="120"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="700"
                                        fill="#059669"
                                    >
                                        "{visual.reversed}"
                                    </text>

                                    <text
                                        x="300"
                                        y="180"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fill="#64748b"
                                    >
                                        Pythonの高速な組み込み処理（C実装）
                                    </text>
                                    <text
                                        x="300"
                                        y="210"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fill="#64748b"
                                    >
                                        数値ループより高速に動作
                                    </text>
                                </svg>
                            );

                        case 'toInt':
                            return (
                                <svg
                                    viewBox="0 0 600 280"
                                    style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                                >
                                    <defs>
                                        <marker
                                            id="arrowCyan"
                                            markerWidth="10"
                                            markerHeight="10"
                                            refX="9"
                                            refY="3"
                                            orient="auto"
                                            markerUnits="strokeWidth"
                                        >
                                            <path d="M0,0 L0,6 L9,3 z" fill="#0284c7" />
                                        </marker>
                                    </defs>

                                    <text
                                        x="300"
                                        y="30"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="600"
                                        fill="#0f766e"
                                    >
                                        整数化: int()
                                    </text>

                                    <rect
                                        x="80"
                                        y="70"
                                        width="180"
                                        height="70"
                                        rx="8"
                                        fill="#fef3c7"
                                        stroke="#f59e0b"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="170"
                                        y="95"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        文字列
                                    </text>
                                    <text
                                        x="170"
                                        y="120"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="700"
                                    >
                                        "{visual.str}"
                                    </text>

                                    <path
                                        d="M 260 105 L 340 105"
                                        stroke="#0284c7"
                                        strokeWidth="3"
                                        fill="none"
                                        markerEnd="url(#arrowCyan)"
                                    />
                                    <text
                                        x="300"
                                        y="90"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#0284c7"
                                    >
                                        int()
                                    </text>

                                    <rect
                                        x="340"
                                        y="70"
                                        width="180"
                                        height="70"
                                        rx="8"
                                        fill="#dbeafe"
                                        stroke="#0284c7"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="430"
                                        y="95"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        整数
                                    </text>
                                    <text
                                        x="430"
                                        y="120"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="700"
                                        fill="#0284c7"
                                    >
                                        {visual.num}
                                    </text>

                                    <text
                                        x="300"
                                        y="180"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fill="#64748b"
                                    >
                                        先頭ゼロは自動削除
                                    </text>
                                    <text
                                        x="300"
                                        y="210"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fill="#64748b"
                                    >
                                        例: "021" → 21, "00123" → 123
                                    </text>
                                </svg>
                            );

                        case 'applySign':
                            return (
                                <svg
                                    viewBox="0 0 600 300"
                                    style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                                >
                                    <defs>
                                        <marker
                                            id="arrowGreen"
                                            markerWidth="10"
                                            markerHeight="10"
                                            refX="9"
                                            refY="3"
                                            orient="auto"
                                            markerUnits="strokeWidth"
                                        >
                                            <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                                        </marker>
                                    </defs>

                                    <text
                                        x="300"
                                        y="30"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="600"
                                        fill="#0f766e"
                                    >
                                        符号適用
                                    </text>

                                    <rect
                                        x="80"
                                        y="70"
                                        width="140"
                                        height="70"
                                        rx="8"
                                        fill="#dbeafe"
                                        stroke="#0284c7"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="150"
                                        y="95"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        rev_abs
                                    </text>
                                    <text
                                        x="150"
                                        y="120"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="700"
                                    >
                                        {visual.revAbs}
                                    </text>

                                    <text
                                        x="280"
                                        y="105"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="28"
                                        fontWeight="700"
                                        fill="#64748b"
                                    >
                                        ×
                                    </text>

                                    <rect
                                        x="320"
                                        y="70"
                                        width="100"
                                        height="70"
                                        rx="8"
                                        fill="#fef3c7"
                                        stroke="#f59e0b"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="370"
                                        y="95"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        sign
                                    </text>
                                    <text
                                        x="370"
                                        y="120"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="700"
                                    >
                                        {visual.sign}
                                    </text>

                                    <path
                                        d="M 300 140 L 300 190"
                                        stroke="#059669"
                                        strokeWidth="3"
                                        fill="none"
                                        markerEnd="url(#arrowGreen)"
                                    />
                                    <text
                                        x="160"
                                        y="235"
                                        textAnchor="start"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="600"
                                        fill="#059669"
                                    >
                                        =
                                    </text>

                                    <rect
                                        x="200"
                                        y="190"
                                        width="200"
                                        height="80"
                                        rx="8"
                                        fill="#d1fae5"
                                        stroke="#10b981"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="300"
                                        y="220"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        result
                                    </text>
                                    <text
                                        x="300"
                                        y="250"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="28"
                                        fontWeight="700"
                                        fill="#059669"
                                    >
                                        {visual.result}
                                    </text>
                                </svg>
                            );

                        case 'rangeCheck':
                            return (
                                <svg
                                    viewBox="0 0 600 350"
                                    style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                                >
                                    <defs>
                                        <marker
                                            id="arrowGreen"
                                            markerWidth="10"
                                            markerHeight="10"
                                            refX="9"
                                            refY="3"
                                            orient="auto"
                                            markerUnits="strokeWidth"
                                        >
                                            <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                                        </marker>
                                    </defs>

                                    <text
                                        x="300"
                                        y="30"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="600"
                                        fill="#0f766e"
                                    >
                                        32bit 範囲チェック
                                    </text>

                                    <rect
                                        x="200"
                                        y="60"
                                        width="200"
                                        height="70"
                                        rx="8"
                                        fill={visual.inRange ? '#d1fae5' : '#fee2e2'}
                                        stroke={visual.inRange ? '#10b981' : '#dc2626'}
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="300"
                                        y="85"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        result
                                    </text>
                                    <text
                                        x="300"
                                        y="110"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="24"
                                        fontWeight="700"
                                    >
                                        {visual.result}
                                    </text>

                                    <rect
                                        x="100"
                                        y="160"
                                        width="400"
                                        height="60"
                                        rx="8"
                                        fill="#f1f5f9"
                                        stroke="#64748b"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="300"
                                        y="180"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="14"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        INT_MIN ≤ result ≤ INT_MAX
                                    </text>
                                    <text
                                        x="300"
                                        y="205"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="14"
                                        fill="#64748b"
                                    >
                                        -2147483648 ≤ {visual.result} ≤ 2147483647
                                    </text>

                                    {visual.inRange ? (
                                        <>
                                            <path
                                                d="M 300 220 L 300 260"
                                                stroke="#059669"
                                                strokeWidth="3"
                                                fill="none"
                                                markerEnd="url(#arrowGreen)"
                                            />
                                            <rect
                                                x="200"
                                                y="260"
                                                width="200"
                                                height="70"
                                                rx="8"
                                                fill="#d1fae5"
                                                stroke="#10b981"
                                                strokeWidth="2"
                                            />
                                            <text
                                                x="300"
                                                y="285"
                                                textAnchor="middle"
                                                dominantBaseline="middle"
                                                fontSize="18"
                                                fontWeight="600"
                                                fill="#059669"
                                            >
                                                ✓ 範囲内
                                            </text>
                                            <text
                                                x="300"
                                                y="310"
                                                textAnchor="middle"
                                                dominantBaseline="middle"
                                                fontSize="16"
                                                fill="#064e3b"
                                            >
                                                result を返す
                                            </text>
                                        </>
                                    ) : (
                                        <>
                                            <path
                                                d="M 300 220 L 300 260"
                                                stroke="#dc2626"
                                                strokeWidth="3"
                                                fill="none"
                                            />
                                            <rect
                                                x="200"
                                                y="260"
                                                width="200"
                                                height="70"
                                                rx="8"
                                                fill="#fee2e2"
                                                stroke="#dc2626"
                                                strokeWidth="2"
                                            />
                                            <text
                                                x="300"
                                                y="285"
                                                textAnchor="middle"
                                                dominantBaseline="middle"
                                                fontSize="18"
                                                fontWeight="600"
                                                fill="#dc2626"
                                            >
                                                ✗ 範囲外
                                            </text>
                                            <text
                                                x="300"
                                                y="310"
                                                textAnchor="middle"
                                                dominantBaseline="middle"
                                                fontSize="16"
                                                fill="#7f1d1d"
                                            >
                                                0 を返す
                                            </text>
                                        </>
                                    )}
                                </svg>
                            );

                        case 'overflow':
                            return (
                                <svg
                                    viewBox="0 0 600 380"
                                    style={{ marginTop: '20px', maxWidth: '100%', height: 'auto' }}
                                >
                                    <text
                                        x="300"
                                        y="30"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="600"
                                        fill="#dc2626"
                                    >
                                        オーバーフローの例
                                    </text>

                                    <rect
                                        x="150"
                                        y="60"
                                        width="300"
                                        height="70"
                                        rx="8"
                                        fill="#e0f2fe"
                                        stroke="#0284c7"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="300"
                                        y="85"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        x = INT_MAX
                                    </text>
                                    <text
                                        x="300"
                                        y="110"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="700"
                                    >
                                        {visual.x}
                                    </text>

                                    <path
                                        d="M 300 130 L 300 170"
                                        stroke="#64748b"
                                        strokeWidth="2"
                                        fill="none"
                                    />
                                    <text
                                        x="320"
                                        y="150"
                                        textAnchor="start"
                                        dominantBaseline="middle"
                                        fontSize="14"
                                        fill="#64748b"
                                    >
                                        反転
                                    </text>

                                    <rect
                                        x="150"
                                        y="170"
                                        width="300"
                                        height="70"
                                        rx="8"
                                        fill="#fee2e2"
                                        stroke="#dc2626"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="300"
                                        y="195"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#64748b"
                                    >
                                        反転後の値
                                    </text>
                                    <text
                                        x="300"
                                        y="220"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="20"
                                        fontWeight="700"
                                        fill="#dc2626"
                                    >
                                        {visual.reversed}
                                    </text>

                                    <rect
                                        x="100"
                                        y="270"
                                        width="400"
                                        height="60"
                                        rx="8"
                                        fill="#fef3c7"
                                        stroke="#f59e0b"
                                        strokeWidth="2"
                                    />
                                    <text
                                        x="300"
                                        y="290"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="600"
                                        fill="#92400e"
                                    >
                                        7463847412 &gt; 2147483647
                                    </text>
                                    <text
                                        x="300"
                                        y="310"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="14"
                                        fill="#92400e"
                                    >
                                        INT_MAX を超えているため範囲外
                                    </text>

                                    <rect
                                        x="200"
                                        y="350"
                                        width="200"
                                        height="20"
                                        rx="4"
                                        fill="#dc2626"
                                    />
                                    <text
                                        x="300"
                                        y="360"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontSize="16"
                                        fontWeight="700"
                                        fill="white"
                                    >
                                        返り値: {visual.result}
                                    </text>
                                </svg>
                            );

                        default:
                            return null;
                    }
                };

                return <div>{renderVisualization()}</div>;
            }

            const root = ReactDOM.createRoot(document.getElementById('step-visualization-root'));
            root.render(<StepVisualization />);
        </script>
    </body>
</html>
