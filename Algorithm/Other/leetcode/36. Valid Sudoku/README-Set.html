<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>æ•°ç‹¬æ¤œè¨¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 30px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            h2 {
                color: #34495e;
                border-left: 5px solid #3498db;
                padding-left: 15px;
                margin-top: 30px;
                font-size: 1.5em;
            }

            .sudoku-board {
                display: grid;
                grid-template-columns: repeat(9, 40px);
                grid-template-rows: repeat(9, 40px);
                gap: 2px;
                margin: 20px auto;
                width: fit-content;
                background: #2c3e50;
                padding: 10px;
                border-radius: 10px;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            }

            .cell {
                background: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 16px;
                border-radius: 3px;
                transition: all 0.3s ease;
            }

            .cell.empty {
                background: #ecf0f1;
                color: #bdc3c7;
            }

            .cell.highlight-row {
                background: #e74c3c;
                color: white;
                transform: scale(1.1);
            }

            .cell.highlight-col {
                background: #f39c12;
                color: white;
                transform: scale(1.1);
            }

            .cell.highlight-box {
                background: #27ae60;
                color: white;
                transform: scale(1.1);
            }

            .cell.current {
                background: #9b59b6;
                color: white;
                transform: scale(1.2);
                z-index: 10;
                box-shadow: 0 5px 15px rgba(155, 89, 182, 0.5);
            }

            .analysis-section {
                background: #f8f9fa;
                padding: 20px;
                margin: 20px 0;
                border-radius: 10px;
                border: 1px solid #e9ecef;
            }

            .step-container {
                display: flex;
                align-items: center;
                margin: 15px 0;
                padding: 15px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .step-number {
                background: #3498db;
                color: white;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 15px;
                flex-shrink: 0;
            }

            .controls {
                text-align: center;
                margin: 20px 0;
            }

            button {
                background: linear-gradient(45deg, #3498db, #2980b9);
                color: white;
                border: none;
                padding: 12px 24px;
                margin: 0 10px;
                border-radius: 25px;
                cursor: pointer;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            }

            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            }

            button:disabled {
                background: #bdc3c7;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            .legend {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin: 20px 0;
                flex-wrap: wrap;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 15px;
                background: white;
                border-radius: 20px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .legend-color {
                width: 20px;
                height: 20px;
                border-radius: 3px;
            }

            .status {
                text-align: center;
                padding: 15px;
                margin: 20px 0;
                border-radius: 10px;
                font-weight: bold;
                font-size: 1.1em;
            }

            .status.valid {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .status.invalid {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

            .code-section {
                background: #2d3748;
                color: #e2e8f0;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                overflow-x: auto;
            }

            .code-section pre {
                margin: 0;
                font-family: 'Courier New', monospace;
                line-height: 1.4;
            }

            .highlight-line {
                background: rgba(56, 178, 172, 0.2);
                padding: 2px 0;
                margin: 0 -20px;
                padding-left: 20px;
                padding-right: 20px;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>ğŸ§© æ•°ç‹¬æ¤œè¨¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</h1>

            <h2>ğŸ“‹ ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¦‚è¦</h2>
            <div class="analysis-section">
                <p><strong>ç›®çš„:</strong> 9Ã—9ã®æ•°ç‹¬ãƒœãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹</p>
                <p><strong>åˆ¶ç´„:</strong></p>
                <ul>
                    <li>å„è¡Œã«1-9ã®æ•°å­—ãŒé‡è¤‡ãªãå«ã¾ã‚Œã‚‹</li>
                    <li>å„åˆ—ã«1-9ã®æ•°å­—ãŒé‡è¤‡ãªãå«ã¾ã‚Œã‚‹</li>
                    <li>å„3Ã—3ãƒœãƒƒã‚¯ã‚¹ã«1-9ã®æ•°å­—ãŒé‡è¤‡ãªãå«ã¾ã‚Œã‚‹</li>
                </ul>
                <p><strong>æ™‚é–“è¨ˆç®—é‡:</strong> O(1) - å›ºå®šã‚µã‚¤ã‚ºï¼ˆ9Ã—9ï¼‰ã®ãŸã‚å®šæ•°æ™‚é–“</p>
                <p><strong>ç©ºé–“è¨ˆç®—é‡:</strong> O(1) - æœ€å¤§81å€‹ã®è¦ç´ ã‚’æ ¼ç´ã™ã‚‹å®šæ•°ç©ºé–“</p>
            </div>

            <h2>ğŸ¯ è¦–è¦šçš„ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <div class="controls">
                <button onclick="startDemo()">ãƒ‡ãƒ¢é–‹å§‹</button>
                <button onclick="resetDemo()">ãƒªã‚»ãƒƒãƒˆ</button>
                <button onclick="toggleSpeed()">é€Ÿåº¦: <span id="speed-text">æ™®é€š</span></button>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #9b59b6"></div>
                    <span>ç¾åœ¨ã®ã‚»ãƒ«</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c"></div>
                    <span>åŒã˜è¡Œ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12"></div>
                    <span>åŒã˜åˆ—</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #27ae60"></div>
                    <span>åŒã˜3Ã—3ãƒœãƒƒã‚¯ã‚¹</span>
                </div>
            </div>

            <div class="sudoku-board" id="sudoku-board"></div>

            <div class="status" id="status" style="display: none"></div>

            <h2>ğŸ” ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—è§£æ</h2>
            <div id="step-analysis" class="analysis-section">
                <div class="step-container">
                    <div class="step-number">1</div>
                    <div>
                        <strong>åˆæœŸåŒ–:</strong> å„è¡Œã€åˆ—ã€3Ã—3ãƒœãƒƒã‚¯ã‚¹ç”¨ã®Setã‚’ä½œæˆ<br />
                        <small>rows[9], cols[9], boxes[9] - å„Setã§é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’åŠ¹ç‡åŒ–</small>
                    </div>
                </div>
                <div class="step-container">
                    <div class="step-number">2</div>
                    <div>
                        <strong>ãƒœãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³:</strong> å·¦ä¸Šã‹ã‚‰å³ä¸‹ã¸é †æ¬¡å‡¦ç†<br />
                        <small>äºŒé‡ãƒ«ãƒ¼ãƒ—ã§å…¨81ã‚»ãƒ«ã‚’ä¸€åº¦ã ã‘è¨ªå•</small>
                    </div>
                </div>
                <div class="step-container">
                    <div class="step-number">3</div>
                    <div>
                        <strong>ç©ºã‚»ãƒ«ã‚¹ã‚­ãƒƒãƒ—:</strong> '.'ã®å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—<br />
                        <small>è¨ˆç®—é‡ã‚’å‰Šæ¸›ã—ã€åŠ¹ç‡æ€§ã‚’å‘ä¸Š</small>
                    </div>
                </div>
                <div class="step-container">
                    <div class="step-number">4</div>
                    <div>
                        <strong>ãƒœãƒƒã‚¯ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨ˆç®—:</strong> (i // 3) * 3 + (j // 3)<br />
                        <small>å„ã‚»ãƒ«ãŒã©ã®3Ã—3ãƒœãƒƒã‚¯ã‚¹ã«å±ã™ã‚‹ã‹ã‚’æ•°å­¦çš„ã«è¨ˆç®—</small>
                    </div>
                </div>
                <div class="step-container">
                    <div class="step-number">5</div>
                    <div>
                        <strong>é‡è¤‡ãƒã‚§ãƒƒã‚¯:</strong> åŒã˜æ•°å­—ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯<br />
                        <small>Set.has()ã§O(1)æ™‚é–“ã§ã®é«˜é€Ÿæ¤œç´¢</small>
                    </div>
                </div>
                <div class="step-container">
                    <div class="step-number">6</div>
                    <div>
                        <strong>æ—©æœŸçµ‚äº† or ç¶™ç¶š:</strong>
                        é‡è¤‡ãŒã‚ã‚Œã°falseã€ãªã‘ã‚Œã°Setã«è¿½åŠ <br />
                        <small>ç„¡åŠ¹ãªå ´åˆã¯å³åº§ã«å‡¦ç†ã‚’çµ‚äº†ã—ã¦åŠ¹ç‡åŒ–</small>
                    </div>
                </div>
            </div>

            <h2>ğŸ’» ã‚³ãƒ¼ãƒ‰è§£æ</h2>
            <div class="code-section">
                <pre><code>def isValidSudoku(self, board: List[List[str]]) -> bool:
    # <span class="highlight-line">SetåˆæœŸåŒ– - O(1)ç©ºé–“ã€å„Setã¯æœ€å¤§9è¦ç´ </span>
    rows: List[set[str]] = [set() for _ in range(9)]
    cols: List[set[str]] = [set() for _ in range(9)]
    boxes: List[set[str]] = [set() for _ in range(9)]
    
    # <span class="highlight-line">äºŒé‡ãƒ«ãƒ¼ãƒ— - å›ºå®š81å›ã®åå¾©</span>
    for i in range(9):
        for j in range(9):
            cell: str = board[i][j]
            
            # <span class="highlight-line">ç©ºã‚»ãƒ«ã‚¹ã‚­ãƒƒãƒ— - è¨ˆç®—é‡å‰Šæ¸›</span>
            if cell == '.':
                continue
            
            # <span class="highlight-line">3Ã—3ãƒœãƒƒã‚¯ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ - O(1)è¨ˆç®—</span>
            box_index: int = (i // 3) * 3 + (j // 3)
            
            # <span class="highlight-line">é‡è¤‡ãƒã‚§ãƒƒã‚¯ - å„Set.has()ã¯O(1)</span>
            if cell in rows[i] or cell in cols[j] or cell in boxes[box_index]:
                return False  # <span class="highlight-line">æ—©æœŸçµ‚äº†</span>
            
            # <span class="highlight-line">Setè¿½åŠ  - å„Set.add()ã¯O(1)</span>
            rows[i].add(cell)
            cols[j].add(cell)
            boxes[box_index].add(cell)
    
    return True</code></pre>
            </div>

            <h2>âš¡ æ€§èƒ½åˆ†æ</h2>
            <div class="analysis-section">
                <h3>æ™‚é–“è¨ˆç®—é‡: O(1)</h3>
                <ul>
                    <li><strong>å›ºå®šåå¾©:</strong> 9Ã—9 = 81å›ã®å›ºå®šãƒ«ãƒ¼ãƒ—</li>
                    <li><strong>Setæ“ä½œ:</strong> has()ã¨add()ã¯å¹³å‡O(1)</li>
                    <li><strong>æ•°å­¦è¨ˆç®—:</strong> ãƒœãƒƒã‚¯ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨ˆç®—ã¯O(1)</li>
                    <li><strong>æ—©æœŸçµ‚äº†:</strong> æœ€æ‚ªã§ã‚‚81å›ã§çµ‚äº†</li>
                </ul>

                <h3>ç©ºé–“è¨ˆç®—é‡: O(1)</h3>
                <ul>
                    <li><strong>å›ºå®šã‚µã‚¤ã‚º:</strong> 27å€‹ã®Setï¼ˆå„æœ€å¤§9è¦ç´ ï¼‰</li>
                    <li><strong>æœ€å¤§è¦ç´ æ•°:</strong> 9Ã—9 = 81å€‹ã®æ•°å­—</li>
                    <li><strong>è¿½åŠ å¤‰æ•°:</strong> ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”¨ã®å®šæ•°å€‹ã®å¤‰æ•°</li>
                </ul>

                <h3>æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul>
                    <li><strong>ä¸€å›ã‚¹ã‚­ãƒ£ãƒ³:</strong> 3ã¤ã®åˆ¶ç´„ã‚’åŒæ™‚ã«ãƒã‚§ãƒƒã‚¯</li>
                    <li><strong>Setä½¿ç”¨:</strong> O(1)ã§ã®é‡è¤‡æ¤œå‡º</li>
                    <li><strong>æ—©æœŸçµ‚äº†:</strong> ç„¡åŠ¹ãŒåˆ¤æ˜ã—ãŸæ™‚ç‚¹ã§å³åº§ã«çµ‚äº†</li>
                    <li><strong>åŠ¹ç‡çš„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:</strong> æ•°å­¦çš„è¨ˆç®—ã§ãƒœãƒƒã‚¯ã‚¹ç‰¹å®š</li>
                </ul>
            </div>
        </div>

        <script>
            // ã‚µãƒ³ãƒ—ãƒ«ãƒœãƒ¼ãƒ‰ï¼ˆExample 1ã‹ã‚‰ï¼‰
            const sampleBoard = [
                ['5', '3', '.', '.', '7', '.', '.', '.', '.'],
                ['6', '.', '.', '1', '9', '5', '.', '.', '.'],
                ['.', '9', '8', '.', '.', '.', '.', '6', '.'],
                ['8', '.', '.', '.', '6', '.', '.', '.', '3'],
                ['4', '.', '.', '8', '.', '3', '.', '.', '1'],
                ['7', '.', '.', '.', '2', '.', '.', '.', '6'],
                ['.', '6', '.', '.', '.', '.', '2', '8', '.'],
                ['.', '.', '.', '4', '1', '9', '.', '.', '5'],
                ['.', '.', '.', '.', '8', '.', '.', '7', '9'],
            ];

            let currentStep = -1;
            let demoRunning = false;
            let demoSpeed = 1000; // ãƒŸãƒªç§’
            let speedLevel = 1; // 1: é…ã„, 2: æ™®é€š, 3: é€Ÿã„

            // ãƒœãƒ¼ãƒ‰ã‚’æç”»
            function renderBoard() {
                const board = document.getElementById('sudoku-board');
                board.innerHTML = '';

                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.id = `cell-${i}-${j}`;

                        if (sampleBoard[i][j] === '.') {
                            cell.className += ' empty';
                            cell.textContent = '';
                        } else {
                            cell.textContent = sampleBoard[i][j];
                        }

                        board.appendChild(cell);
                    }
                }
            }

            // ã‚»ãƒ«ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            function highlightCell(i, j, type) {
                const cell = document.getElementById(`cell-${i}-${j}`);
                if (cell) {
                    cell.className = cell.className.replace(/highlight-\w+|current/g, '').trim();
                    cell.className += ` ${type}`;
                }
            }

            // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ã‚¯ãƒªã‚¢
            function clearHighlights() {
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        const cell = document.getElementById(`cell-${i}-${j}`);
                        if (cell) {
                            cell.className = cell.className
                                .replace(/highlight-\w+|current/g, '')
                                .trim();
                            if (sampleBoard[i][j] === '.') {
                                cell.className += ' empty';
                            }
                        }
                    }
                }
            }

            // ãƒ‡ãƒ¢ã‚’é–‹å§‹
            async function startDemo() {
                if (demoRunning) return;

                demoRunning = true;
                document.querySelector('button').disabled = true;
                clearHighlights();

                const status = document.getElementById('status');
                status.style.display = 'block';
                status.className = 'status';
                status.textContent = 'ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­...';

                // æ•°ç‹¬æ¤œè¨¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const rows = Array.from({ length: 9 }, () => new Set());
                const cols = Array.from({ length: 9 }, () => new Set());
                const boxes = Array.from({ length: 9 }, () => new Set());

                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        const cell = sampleBoard[i][j];

                        // ç¾åœ¨ã®ã‚»ãƒ«ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                        highlightCell(i, j, 'current');

                        if (cell !== '.') {
                            // åŒã˜è¡Œã€åˆ—ã€ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                            for (let k = 0; k < 9; k++) {
                                if (k !== j) highlightCell(i, k, 'highlight-row');
                                if (k !== i) highlightCell(k, j, 'highlight-col');
                            }

                            // 3Ã—3ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                            const boxStartRow = Math.floor(i / 3) * 3;
                            const boxStartCol = Math.floor(j / 3) * 3;
                            const boxIndex = Math.floor(i / 3) * 3 + Math.floor(j / 3);

                            for (let r = boxStartRow; r < boxStartRow + 3; r++) {
                                for (let c = boxStartCol; c < boxStartCol + 3; c++) {
                                    if (r !== i || c !== j) {
                                        highlightCell(r, c, 'highlight-box');
                                    }
                                }
                            }

                            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
                            if (
                                rows[i].has(cell) ||
                                cols[j].has(cell) ||
                                boxes[boxIndex].has(cell)
                            ) {
                                status.className = 'status invalid';
                                status.textContent = `ç„¡åŠ¹: ã‚»ãƒ«(${i + 1}, ${j + 1})ã§æ•°å­—"${cell}"ãŒé‡è¤‡ã—ã¦ã„ã¾ã™`;
                                demoRunning = false;
                                document.querySelector('button').disabled = false;
                                return;
                            }

                            // Setã«è¿½åŠ 
                            rows[i].add(cell);
                            cols[j].add(cell);
                            boxes[boxIndex].add(cell);

                            status.textContent = `ãƒã‚§ãƒƒã‚¯ä¸­: ã‚»ãƒ«(${i + 1}, ${j + 1}) = "${cell}" - OK`;
                        } else {
                            status.textContent = `ã‚¹ã‚­ãƒƒãƒ—: ã‚»ãƒ«(${i + 1}, ${j + 1}) ã¯ç©ºã‚»ãƒ«`;
                        }

                        await new Promise((resolve) => setTimeout(resolve, demoSpeed));
                        clearHighlights();
                    }
                }

                // æ¤œè¨¼å®Œäº†
                status.className = 'status valid';
                status.textContent = 'âœ… æ•°ç‹¬ãƒœãƒ¼ãƒ‰ã¯æœ‰åŠ¹ã§ã™ï¼ã™ã¹ã¦ã®åˆ¶ç´„ãŒæº€ãŸã•ã‚Œã¦ã„ã¾ã™ã€‚';

                demoRunning = false;
                document.querySelector('button').disabled = false;
            }

            // ãƒªã‚»ãƒƒãƒˆ
            function resetDemo() {
                demoRunning = false;
                clearHighlights();
                document.getElementById('status').style.display = 'none';
                document.querySelector('button').disabled = false;
            }

            // é€Ÿåº¦åˆ‡ã‚Šæ›¿ãˆ
            function toggleSpeed() {
                speedLevel = (speedLevel % 3) + 1;
                const speedText = document.getElementById('speed-text');

                switch (speedLevel) {
                    case 1:
                        demoSpeed = 1500;
                        speedText.textContent = 'é…ã„';
                        break;
                    case 2:
                        demoSpeed = 1000;
                        speedText.textContent = 'æ™®é€š';
                        break;
                    case 3:
                        demoSpeed = 500;
                        speedText.textContent = 'é€Ÿã„';
                        break;
                }
            }

            // åˆæœŸåŒ–
            document.addEventListener('DOMContentLoaded', function () {
                renderBoard();
            });
        </script>
    </body>
</html>
