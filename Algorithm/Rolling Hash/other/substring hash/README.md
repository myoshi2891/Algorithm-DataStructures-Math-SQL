æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã§ã¯ã€**Pythonã«ã‚ˆã‚‹éƒ¨åˆ†æ–‡å­—åˆ—ãƒãƒƒã‚·ãƒ¥è¨ˆç®—**ã«ã¤ã„ã¦ã€**å„å‡¦ç†ã‚’å›³è§£ã§ä¸å¯§ã«è§£æãƒ»èª¬æ˜**ã—ã¦ã„ãã¾ã™ã€‚

---

## ğŸ§© å•é¡Œã®æœ¬è³ª

ä¸ãˆã‚‰ã‚ŒãŸè‹±å¤§æ–‡å­—åˆ— `S` ã«å¯¾ã—ã€è¤‡æ•°ã®éƒ¨åˆ†åˆ— `S[L..R]` ã«é–¢ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãª **æ•°å€¤ãƒãƒƒã‚·ãƒ¥** ã‚’è¨ˆç®—ã™ã‚‹ï¼š

$$
H(S[L..R]) = T_L \cdot X^{R-L} + T_{L+1} \cdot X^{R-L-1} + \dots + T_R \cdot X^0 \mod P
$$

* `T_i` ã¯ `S[i]` ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼ˆA=1, B=2, ..., Z=26ï¼‰
* `X` ã¯åŸºæ•°ï¼ˆä¾‹ãˆã° 77777ï¼‰
* `P` ã¯ç´ æ•°ãƒ¢ã‚¸ãƒ¥ãƒ­

---

## ğŸ“Œ å‡¦ç†ã®æµã‚Œï¼ˆå›³ä»˜ãï¼‰

### ğŸ”¹ Step 1: å…¥åŠ›ã®å—ã‘å–ã‚Šã¨å¤‰æ›

```python
P, X, N, Q = map(int, data[0].split())
S = data[1]
```

#### ä¾‹ï¼š

```
S = "HELLOWORLD"
```

| ä½ç½®   | 1 | 2 | 3  | 4  | 5  | 6  | 7  | 8  | 9  | 10 |
| ---- | - | - | -- | -- | -- | -- | -- | -- | -- | -- |
| æ–‡å­—   | H | E | L  | L  | O  | W  | O  | R  | L  | D  |
| T\_i | 8 | 5 | 12 | 12 | 15 | 23 | 15 | 18 | 12 | 4  |

---

### ğŸ”¹ Step 2: ç´¯ç©ã¹ãä¹—é…åˆ— powX\[i] ã®æ§‹ç¯‰

```python
powX[i] = (powX[i-1] * X) % P
```

* ç›®çš„ï¼š $X^i \mod P$ ã‚’ã™ã°ã‚„ãå‚ç…§å¯èƒ½ã«ã™ã‚‹ãŸã‚

#### ä¾‹ï¼ˆX=10, P=1000000007ï¼‰ï¼š

| i    | 0 | 1  | 2   | 3    |
| ---- | - | -- | --- | ---- |
| powX | 1 | 10 | 100 | 1000 |

â†’ ã‚¯ã‚¨ãƒªã®é•·ã• `(R - L + 1)` ã®æŒ‡æ•°å‚ç…§ã«ä½¿ç”¨

---

### ğŸ”¹ Step 3: ãƒãƒƒã‚·ãƒ¥é…åˆ— h\[i] ã®æ§‹ç¯‰ï¼ˆãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒãƒƒã‚·ãƒ¥ï¼‰

```python
h[i] = (h[i - 1] * X + T[i - 1]) % P
```

ã“ã“ã§ã¯ã€**å…ˆé ­ã‹ã‚‰iæ–‡å­—ã¾ã§ã®ãƒãƒƒã‚·ãƒ¥å€¤**ã‚’æ±‚ã‚ã¾ã™ã€‚

#### è¨ˆç®—ä¾‹ï¼ˆX=10, S="HEL"ï¼‰

```
T = [8, 5, 12]   # "HEL"
h[0] = 0
h[1] = 0 * 10 + 8 = 8
h[2] = 8 * 10 + 5 = 85
h[3] = 85 * 10 + 12 = 862 â†’ ãƒãƒƒã‚·ãƒ¥("HEL")
```

#### å›³ï¼šhã®æ§‹ç¯‰

```
S = H  E  L  L  O ...
T = 8  5 12 12 15 ...
h[1] =    8
h[2] =    8*X + 5
h[3] = (8*X + 5)*X + 12
```

---

### ğŸ”¹ Step 4: ã‚¯ã‚¨ãƒªå‡¦ç†ï¼ˆãƒãƒƒã‚·ãƒ¥æŠ½å‡ºï¼‰

#### ã‚¯ã‚¨ãƒª `(L=2, R=4)` â†’ `S[2..4] = "ELL"`

* `h[R] = h[4] = ãƒãƒƒã‚·ãƒ¥("HELL")`
* `h[L-1] = h[1] = ãƒãƒƒã‚·ãƒ¥("H")`
* `powX[R - L + 1] = powX[3] = XÂ³`

$$
H(V) = (h[R] - h[L-1] \cdot X^{R-L+1}) \mod P
$$

#### å›³ï¼šéƒ¨åˆ†ãƒãƒƒã‚·ãƒ¥æŠ½å‡º

```
å®Œå…¨ãƒãƒƒã‚·ãƒ¥ï¼ˆh[4]ï¼‰:       ãƒãƒƒã‚·ãƒ¥("HELL")
ä¸è¦ãªå…ˆé ­ãƒãƒƒã‚·ãƒ¥(h[1]):   ãƒãƒƒã‚·ãƒ¥("H")
                   å‰Šé™¤æŒ‡æ•°: X^3
        â†“
éƒ¨åˆ†åˆ—ãƒãƒƒã‚·ãƒ¥(V):           ãƒãƒƒã‚·ãƒ¥("ELL")
```

#### ãªãœæ©Ÿèƒ½ã™ã‚‹ã‹ï¼Ÿ

`h[i]` ã¯æ¬¡ã®å½¢å¼ï¼š

$$
h[i] = T_1 \cdot X^{i-1} + T_2 \cdot X^{i-2} + \dots + T_i \cdot X^0
$$

ã¤ã¾ã‚Šã€

$$
h[R] = h[L-1] \cdot X^{R-L+1} + ãƒãƒƒã‚·ãƒ¥(S[L..R])
$$

é€†ã«ã™ã‚Œã°ï¼š

$$
H(S[L..R]) = h[R] - h[L-1] \cdot X^{R-L+1}
$$

---

### ğŸ”¹ Step 5: å‡ºåŠ›

```python
for res in results:
    print(res)
```

â†’ å„ã‚¯ã‚¨ãƒªã«å¯¾ã—ã¦è¨ˆç®—ã—ãŸãƒãƒƒã‚·ãƒ¥ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

---

## ğŸ§  è£œè¶³ï¼šé€†å…ƒã‚’ä½¿ã‚ãªã„ç†ç”±

ä¸€èˆ¬çš„ãª Rolling Hash ã§ã¯ `X^(N - R)` ã§å‰²ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€

ã“ã®å®Ÿè£…ã§ã¯ã€Œ**æŒ‡æ•°æ–¹å‘ã‚’å›ºå®šï¼ˆå·¦ã‹ã‚‰å³ï¼‰**ã€ã«ã—ã¦ã„ã‚‹ãŸã‚ã€**å¼•ãç®—ã¨æ›ã‘ç®—**ã ã‘ã§ç›®çš„ã®éƒ¨åˆ†åˆ—ãƒãƒƒã‚·ãƒ¥ãŒå¾—ã‚‰ã‚Œã€**é€†å…ƒè¨ˆç®—ã¯ä¸è¦**ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ“Š æ™‚é–“ãƒ»ç©ºé–“ã®è¦³ç‚¹

| é …ç›®     | åˆ†æ                        |
| ------ | ------------------------- |
| å‰å‡¦ç†    | O(N)ï¼ˆpowX, ãƒãƒƒã‚·ãƒ¥ã®æ§‹ç¯‰ï¼‰       |
| ã‚¯ã‚¨ãƒªå‡¦ç†  | O(1) Ã— Qï¼ˆå®šæ•°æ™‚é–“ã§æŠ½å‡ºï¼‰         |
| ç©ºé–“ä½¿ç”¨é‡  | O(N)ï¼ˆpowX\[], h\[]ï¼‰ ç´„ 2MB |
| ãƒãƒƒã‚·ãƒ¥è¡çª | Xã¨Pã®é¸æŠã«ã‚ˆã‚Šè¡çªã¯å®Ÿç”¨ä¸Šç„¡è¦–å¯        |

---

## âœ… ã¾ã¨ã‚å›³ï¼ˆå…¨ä½“ã®æµã‚Œï¼‰

```text
[S] --> [æ–‡å­— â†’ æ•°å€¤å¤‰æ›: T[]]
     --> [ã¹ãä¹—é…åˆ— powX[]: O(N)]
     --> [ç´¯ç©ãƒãƒƒã‚·ãƒ¥é…åˆ— h[]: O(N)]

queries: [(L1,R1), (L2,R2), ...]
        â†“
  å„ã‚¯ã‚¨ãƒª:
    H(V) = (h[R] - h[L-1]*X^{R-L+1}) % P

     â†“

  [çµæœå‡ºåŠ›]
```
