<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>2D累積和による長方形領域和計算</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                padding: 20px;
                min-height: 100vh;
                margin: 0;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }
            h1 {
                text-align: center;
                color: #4a5568;
                margin-bottom: 30px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }
            .grid-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 40px;
                margin-bottom: 30px;
            }
            .matrix {
                display: inline-grid;
                gap: 2px;
                background: #e2e8f0;
                padding: 10px;
                border-radius: 12px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            .cell {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                border-radius: 6px;
                transition: all 0.3s ease;
                font-size: 14px;
            }
            .original {
                background: #bee3f8;
            }
            .prefix {
                background: #d6f5d6;
            }
            .target {
                background: #fed7d7;
            }
            .subtract {
                background: #fbb6ce;
            }
            .add-back {
                background: #c6f6d5;
            }
            .result {
                background: #ffd700;
                font-weight: bold;
            }

            .formula {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 20px;
                border-radius: 12px;
                font-family: 'Monaco', 'Consolas', monospace;
                text-align: center;
                font-size: 18px;
                font-weight: bold;
                margin: 20px 0;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            }

            .section {
                margin: 30px 0;
                padding: 20px;
                background: #f7fafc;
                border-radius: 12px;
                border-left: 5px solid #4299e1;
            }

            .legend {
                display: flex;
                flex-wrap: wrap;
                gap: 15px;
                justify-content: center;
                margin: 20px 0;
            }
            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
                background: white;
                padding: 8px 16px;
                border-radius: 20px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .legend-color {
                width: 20px;
                height: 20px;
                border-radius: 4px;
            }

            .step-explanation {
                background: #edf2f7;
                padding: 15px;
                border-radius: 8px;
                margin: 10px 0;
                border-left: 4px solid #4299e1;
            }

            @keyframes highlight {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                    box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
                }
            }

            .highlight {
                animation: highlight 2s ease-in-out infinite;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>2D累積和による長方形領域和計算</h1>

            <div class="section">
                <h3>元の行列（4×4）</h3>
                <div
                    class="matrix"
                    id="originalMatrix"
                    style="grid-template-columns: repeat(4, 1fr)"
                >
                    <!-- 動的に生成 -->
                </div>
            </div>

            <div class="section">
                <h3>累積和配列（5×5）</h3>
                <div class="matrix" id="prefixMatrix" style="grid-template-columns: repeat(5, 1fr)">
                    <!-- 動的に生成 -->
                </div>
            </div>

            <div class="formula">長方形領域和 = S(c+1,d+1) - S(a,d+1) - S(c+1,b) + S(a,b)</div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color target"></div>
                    <span>目標領域 (a,b) to (c,d)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color subtract"></div>
                    <span>減算する領域</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color add-back"></div>
                    <span>重複分を加算</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color result"></div>
                    <span>計算結果</span>
                </div>
            </div>

            <div class="section">
                <h3>計算例: 領域 (1,1) から (2,3) の和</h3>
                <div class="step-explanation">
                    <strong>ステップ1:</strong> S(3,4) = 78 （右下の大きな長方形）
                </div>
                <div class="step-explanation">
                    <strong>ステップ2:</strong> S(1,4) = 10 を減算 （上の不要領域）
                </div>
                <div class="step-explanation">
                    <strong>ステップ3:</strong> S(3,1) = 15 を減算 （左の不要領域）
                </div>
                <div class="step-explanation">
                    <strong>ステップ4:</strong> S(1,1) = 1 を加算 （重複分を戻す）
                </div>
                <div class="step-explanation">
                    <strong>結果:</strong> 78 - 10 - 15 + 1 =
                    <span class="highlight" style="color: #d69e2e; font-weight: bold">54</span>
                </div>
            </div>

            <div class="section">
                <h3>時間計算量</h3>
                <ul>
                    <li><strong>累積和構築:</strong> O(N × M)</li>
                    <li><strong>各クエリ処理:</strong> O(1)</li>
                    <li><strong>全体:</strong> O(N × M + Q) （Qはクエリ数）</li>
                </ul>
            </div>
        </div>

        <script>
            // 元の行列データ
            const originalData = [
                [1, 2, 3, 4],
                [5, 6, 7, 8],
                [9, 10, 11, 12],
                [13, 14, 15, 16],
            ];

            // 正しい累積和配列を定義
            const prefixSum = [
                [0, 0, 0, 0, 0],
                [0, 1, 3, 6, 10],
                [0, 6, 14, 24, 36],
                [0, 15, 33, 54, 78],
                [0, 28, 60, 96, 136],
            ];

            // 元の行列を表示
            const originalMatrix = document.getElementById('originalMatrix');
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell original';

                    // 目標領域 (1,1) to (2,3) をハイライト
                    if (i >= 1 && i <= 2 && j >= 1 && j <= 3) {
                        cell.classList.add('target');
                    }

                    cell.textContent = originalData[i][j];
                    originalMatrix.appendChild(cell);
                }
            }

            // 累積和配列を表示
            const prefixMatrix = document.getElementById('prefixMatrix');
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 5; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell prefix';

                    // 計算に使用するセルをハイライト
                    if (
                        (i === 3 && j === 4) ||
                        (i === 1 && j === 4) ||
                        (i === 3 && j === 1) ||
                        (i === 1 && j === 1)
                    ) {
                        if (i === 3 && j === 4) cell.classList.add('result');
                        else if ((i === 1 && j === 4) || (i === 3 && j === 1))
                            cell.classList.add('subtract');
                        else cell.classList.add('add-back');
                    }

                    cell.textContent = prefixSum[i][j];
                    prefixMatrix.appendChild(cell);
                }
            }
        </script>
    </body>
</html>
