<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cyclic Sort - ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                line-height: 1.6;
            }

            .container {
                background: rgba(255, 255, 255, 0.95);
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                backdrop-filter: blur(10px);
            }

            h1 {
                text-align: center;
                color: #4a5568;
                margin-bottom: 30px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            h2 {
                color: #2d3748;
                border-bottom: 3px solid #667eea;
                padding-bottom: 10px;
                margin-top: 40px;
                font-size: 1.8em;
            }

            .step {
                margin: 30px 0;
                padding: 25px;
                background: linear-gradient(135deg, #f7fafc, #edf2f7);
                border-radius: 12px;
                border-left: 6px solid #667eea;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
                transition: transform 0.3s ease;
            }

            .step:hover {
                transform: translateY(-5px);
            }

            .array-container {
                display: flex;
                align-items: center;
                margin: 15px 0;
                flex-wrap: wrap;
                gap: 10px;
            }

            .array-label {
                font-weight: bold;
                color: #4a5568;
                min-width: 150px;
                font-size: 1.1em;
            }

            .array-box {
                width: 60px;
                height: 60px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1.2em;
                border-radius: 10px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                position: relative;
            }

            .original {
                background: linear-gradient(135deg, #4299e1, #2b77cb);
                color: white;
            }

            .correct {
                background: linear-gradient(135deg, #48bb78, #38a169);
                color: white;
            }

            .swapping {
                background: linear-gradient(135deg, #ed8936, #dd6b20);
                color: white;
                animation: pulse 0.8s infinite;
            }

            .misplaced {
                background: linear-gradient(135deg, #e53e3e, #c53030);
                color: white;
            }

            .current {
                background: linear-gradient(135deg, #9f7aea, #805ad5);
                color: white;
                border: 3px solid #ffd700;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.1);
                }
            }

            .index {
                font-size: 0.8em;
                color: #666;
                margin-top: 2px;
            }

            .value {
                font-size: 1.2em;
                font-weight: bold;
            }

            .explanation {
                background: #f0fff4;
                border: 2px solid #68d391;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                font-size: 1.05em;
            }

            .code-block {
                background: #2d3748;
                color: #e2e8f0;
                padding: 20px;
                border-radius: 10px;
                font-family: 'Courier New', monospace;
                overflow-x: auto;
                margin: 15px 0;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            }

            .highlight {
                background: rgba(255, 235, 59, 0.3);
                padding: 2px 4px;
                border-radius: 4px;
                font-weight: bold;
            }

            .complexity {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 20px;
                border-radius: 12px;
                margin: 25px 0;
                text-align: center;
                font-size: 1.1em;
                font-weight: bold;
            }

            .arrow {
                font-size: 2em;
                color: #667eea;
                text-align: center;
                margin: 15px 0;
            }

            button {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 1em;
                font-weight: bold;
                transition: all 0.3s ease;
                margin: 10px 5px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            }

            .demo-controls {
                text-align: center;
                margin: 30px 0;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
            }

            .step-counter {
                background: #667eea;
                color: white;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 15px;
                font-size: 1.2em;
            }

            .swap-animation {
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 20px 0;
                gap: 20px;
            }

            .swap-arrow {
                font-size: 2em;
                color: #e53e3e;
                animation: bounce 1s infinite;
            }

            @keyframes bounce {
                0%,
                100% {
                    transform: translateY(0);
                }

                50% {
                    transform: translateY(-10px);
                }
            }

            .comparison-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                background: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            }

            .comparison-table th {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 15px;
                text-align: center;
                font-weight: bold;
            }

            .comparison-table td {
                padding: 12px;
                text-align: center;
                border-bottom: 1px solid #e2e8f0;
            }

            .comparison-table tr:nth-child(even) {
                background: #f8f9fa;
            }

            .ideal-position {
                background: #e6fffa;
                border: 2px dashed #38b2ac;
                border-radius: 8px;
                padding: 5px;
                margin: 5px 0;
                font-size: 0.9em;
                text-align: center;
            }

            .phase-indicator {
                background: linear-gradient(135deg, #ffd89b, #19547b);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-weight: bold;
                display: inline-block;
                margin: 10px 0;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>ğŸ”„ Cyclic Sort ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</h1>

            <div class="explanation">
                <strong>Cyclic Sortï¼ˆé…ç½®ã‚¹ãƒ¯ãƒƒãƒ—æ³•ï¼‰ã¨ã¯ï¼š</strong><br />
                å„è¦ç´ ã‚’ã€Œç†æƒ³çš„ãªä½ç½®ã€ã«é…ç½®ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€‚å€¤xã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(x-1)ã®ä½ç½®ã«é…ç½®ã—ã€
                é…ç½®å¾Œã«æ­£ã—ããªã„ä½ç½®ã®æœ€åˆã®è¦ç´ ã‹ã‚‰ç­”ãˆã‚’å°å‡ºã—ã¾ã™ã€‚
            </div>

            <div class="demo-controls">
                <h3>ğŸ“Š ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢</h3>
                <button onclick="runCyclicSort([3, 4, -1, 1])">ä¾‹1: [3, 4, -1, 1]</button>
                <button onclick="runCyclicSort([1, 2, 0])">ä¾‹2: [1, 2, 0]</button>
                <button onclick="runCyclicSort([7, 8, 9, 11, 12])">ä¾‹3: [7, 8, 9, 11, 12]</button>
                <button onclick="runCyclicSort([2, 3, 4, 1])">ä¾‹4: [2, 3, 4, 1]</button>
                <button onclick="runCyclicSort([1, 3, 6, 4, 1, 2])">ä¾‹5: [1, 3, 6, 4, 1, 2]</button>
            </div>

            <div id="demo-area"></div>

            <h2>ğŸ”§ ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è©³ç´°è§£èª¬</h2>

            <div class="step">
                <div class="step-counter">1</div>
                <h3>Phase 1: Cyclic Placementï¼ˆå¾ªç’°é…ç½®ï¼‰</h3>
                <div class="code-block">
                    for (let i = 0; i < n; i++) { while (nums[i]>= 1 && nums[i] <= n && nums[nums[i]
                    - 1] !==nums[i]) { swap(nums, i, nums[i] - 1); } }
                </div>
                <div class="explanation">
                    <strong>ç›®çš„ï¼š</strong>å„è¦ç´ ã‚’ç†æƒ³çš„ãªä½ç½®ã«é…ç½®<br />
                    <strong>æ¡ä»¶ï¼š</strong>å€¤ãŒç¯„å›²å†…ï¼ˆ1â‰¤å€¤â‰¤nï¼‰ã§ã€ã¾ã æ­£ã—ã„ä½ç½®ã«ãªã„<br />
                    <strong>å‹•ä½œï¼š</strong>å€¤xã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(x-1)ã®ä½ç½®ã«ã‚¹ãƒ¯ãƒƒãƒ—
                </div>
            </div>

            <div class="step">
                <div class="step-counter">2</div>
                <h3>Phase 2: Missing Number Detectionï¼ˆæ¬ ç•ªæ¤œå‡ºï¼‰</h3>
                <div class="code-block">
                    for (let i = 0; i < n; i++) { if (nums[i] !==i + 1) { return i + 1; } } return n
                    + 1;
                </div>
                <div class="explanation">
                    <strong>ç›®çš„ï¼š</strong>æœ€åˆã®ä¸æ­£ãªé…ç½®ã‚’è¦‹ã¤ã‘ã‚‹<br />
                    <strong>è«–ç†ï¼š</strong>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹iã§å€¤ãŒ(i+1)ã§ãªã„ â†’ (i+1)ãŒæ¬ ã‘ã¦ã„ã‚‹<br />
                    <strong>ç‰¹æ®Šã‚±ãƒ¼ã‚¹ï¼š</strong>å…¨ã¦æ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ç­”ãˆã¯(n+1)
                </div>
            </div>

            <h2>ğŸ“ˆ æ™‚é–“è¤‡é›‘åº¦ã®è©³ç´°åˆ†æ</h2>

            <div class="complexity">
                <div>â±ï¸ æ™‚é–“è¤‡é›‘åº¦: <span class="highlight">O(n)</span></div>
                <div style="margin-top: 10px">
                    ğŸ’¾ ç©ºé–“è¤‡é›‘åº¦: <span class="highlight">O(1)</span>
                </div>
            </div>

            <div class="explanation">
                <strong>ãªãœO(n)ãªã®ã‹ï¼Ÿ</strong><br />
                â€¢ å„è¦ç´ ã¯æœ€å¤§1å›ã ã‘æ­£ã—ã„ä½ç½®ã«ç§»å‹•ã•ã‚Œã‚‹<br />
                â€¢ ç·ã‚¹ãƒ¯ãƒƒãƒ—å›æ•°ã¯æœ€å¤§nå›<br />
                â€¢ å¤–å´ã®ãƒ«ãƒ¼ãƒ—: O(n)<br />
                â€¢ å†…å´ã®while: å„Ÿå´O(1)ï¼ˆå„è¦ç´ ã¯æœ€å¤§1å›ç§»å‹•ï¼‰<br />
                â€¢ æ¤œå‡ºãƒ•ã‚§ãƒ¼ã‚º: O(n)<br />
                <strong>åˆè¨ˆ: O(n)</strong>
            </div>

            <h2>âš–ï¸ Cyclic Sort vs ç¬¦å·ãƒãƒ¼ã‚­ãƒ³ã‚°æ³•</h2>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>æ¯”è¼ƒé …ç›®</th>
                        <th>Cyclic Sort</th>
                        <th>ç¬¦å·ãƒãƒ¼ã‚­ãƒ³ã‚°æ³•</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ç›´æ„Ÿçš„ç†è§£</strong></td>
                        <td>â­â­â­ éå¸¸ã«ç›´æ„Ÿçš„</td>
                        <td>â­â­ ã‚„ã‚„è¤‡é›‘</td>
                    </tr>
                    <tr>
                        <td><strong>å®Ÿè£…ã®ç°¡æ½”æ€§</strong></td>
                        <td>â­â­â­ ã‚·ãƒ³ãƒ—ãƒ«</td>
                        <td>â­â­ ä¸­ç¨‹åº¦</td>
                    </tr>
                    <tr>
                        <td><strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</strong></td>
                        <td>â­â­ è‰¯å¥½</td>
                        <td>â­â­â­ å„ªç§€</td>
                    </tr>
                    <tr>
                        <td><strong>ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã•</strong></td>
                        <td>â­â­â­ è¿½è·¡ã—ã‚„ã™ã„</td>
                        <td>â­â­ ä¸­ç¨‹åº¦</td>
                    </tr>
                    <tr>
                        <td><strong>æ•™è‚²çš„ä¾¡å€¤</strong></td>
                        <td>â­â­â­ ç†è§£ã—ã‚„ã™ã„</td>
                        <td>â­â­ ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«</td>
                    </tr>
                </tbody>
            </table>

            <h2>ğŸ¯ æ ¸å¿ƒã‚¢ã‚¤ãƒ‡ã‚¢</h2>

            <div class="step">
                <h3>ğŸ”‘ Key Insight: ç†æƒ³çš„é…ç½®ã®æ¦‚å¿µ</h3>
                <div class="explanation">
                    <strong>åŸºæœ¬åŸç†ï¼š</strong>å€¤xã¯ç†æƒ³çš„ã«ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(x-1)ã«ã‚ã‚‹ã¹ã<br />
                    <strong>é…ç½®æˆ¦ç•¥ï¼š</strong>å„è¦ç´ ã‚’æ­£ã—ã„ä½ç½®ã«ã‚¹ãƒ¯ãƒƒãƒ—ã§ç§»å‹•<br />
                    <strong>æ¤œå‡ºæ–¹æ³•ï¼š</strong>é…ç½®å¾Œã®ä¸æ•´åˆã‹ã‚‰æ¬ ç•ªã‚’ç‰¹å®š<br />
                    <strong>åŠ¹ç‡æ€§ï¼š</strong>å„è¦ç´ ã¯æœ€å¤§1å›ã ã‘ç§»å‹•ã™ã‚‹ãŸã‚å…¨ä½“ã§O(n)
                </div>

                <div class="ideal-position">
                    <strong>ç†æƒ³çš„é…ç½®ã®ä¾‹ï¼š</strong><br />
                    å€¤1 â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹0 | å€¤2 â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1 | å€¤3 â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2 | ...
                </div>
            </div>

            <div class="step">
                <h3>ğŸ’¡ ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç¾ã—ã•</h3>
                <div class="explanation">
                    Cyclic
                    Sortã¯ã€Œæ•´ç†æ•´é “ã€ã®æ¦‚å¿µã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«å¿œç”¨ã—ãŸç¾ã—ã„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚<br />
                    å„è¦ç´ ã‚’ã€Œã‚ã‚‹ã¹ãå ´æ‰€ã€ã«é…ç½®ã™ã‚‹ã“ã¨ã§ã€è‡ªç„¶ã«æ¬ ã‘ã¦ã„ã‚‹è¦ç´ ãŒæµ®ã‹ã³ä¸ŠãŒã‚Šã¾ã™ã€‚<br />
                    ã“ã®ç›´æ„Ÿçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã€è¤‡é›‘ãªå•é¡Œã‚’ elegantly ã«è§£æ±ºã™ã‚‹å…¸å‹ä¾‹ã§ã™ã€‚
                </div>
            </div>
        </div>

        <script>
            function runCyclicSort(inputArray) {
                const demoArea = document.getElementById('demo-area');
                const nums = [...inputArray];
                const n = nums.length;
                let swapSteps = [];

                let html = `
                <div class="step">
                    <h3>ğŸš€ å®Ÿè¡Œä¾‹: [${inputArray.join(', ')}]</h3>
                    <div class="phase-indicator">Phase 1: Cyclic Placementï¼ˆå¾ªç’°é…ç½®ï¼‰</div>
                    <div class="array-container">
                        <div class="array-label">åˆæœŸé…åˆ—:</div>
                        ${nums
                            .map(
                                (num, i) => `
                            <div>
                                <div class="array-box original">
                                    <div class="value">${num}</div>
                                    <div class="index">i=${i}</div>
                                </div>
                                <div class="ideal-position">ç†æƒ³ä½ç½®: ${num >= 1 && num <= n ? num - 1 : 'N/A'}</div>
                            </div>
                        `,
                            )
                            .join('')}
                    </div>
            `;

                // Cyclic Sort ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const workingArray = [...nums];
                let stepCount = 0;

                for (let i = 0; i < n; i++) {
                    let currentI = i;
                    while (
                        workingArray[currentI] >= 1 &&
                        workingArray[currentI] <= n &&
                        workingArray[workingArray[currentI] - 1] !== workingArray[currentI]
                    ) {
                        const targetIndex = workingArray[currentI] - 1;
                        const beforeState = [...workingArray];

                        // ã‚¹ãƒ¯ãƒƒãƒ—å®Ÿè¡Œ
                        const temp = workingArray[currentI];
                        workingArray[currentI] = workingArray[targetIndex];
                        workingArray[targetIndex] = temp;

                        stepCount++;
                        swapSteps.push({
                            step: stepCount,
                            fromIndex: currentI,
                            toIndex: targetIndex,
                            fromValue: beforeState[currentI],
                            toValue: beforeState[targetIndex],
                            before: beforeState,
                            after: [...workingArray],
                            currentPosition: i,
                        });
                    }
                }

                // ã‚¹ãƒ¯ãƒƒãƒ—ã‚¹ãƒ†ãƒƒãƒ—ã®è¡¨ç¤º
                if (swapSteps.length > 0) {
                    html += `<div class="explanation"><strong>ã‚¹ãƒ¯ãƒƒãƒ—ã®è©³ç´°:</strong></div>`;

                    swapSteps.forEach((swap) => {
                        html += `
                        <div class="swap-animation">
                            <div><strong>Step ${swap.step}:</strong></div>
                            <div>å€¤${swap.fromValue}(i=${swap.fromIndex}) â†” å€¤${swap.toValue}(i=${swap.toIndex})</div>
                        </div>
                        <div class="array-container">
                            <div class="array-label">Step ${swap.step}å¾Œ:</div>
                            ${swap.after
                                .map(
                                    (num, i) => `
                                <div>
                                    <div class="array-box ${
                                        i === swap.fromIndex || i === swap.toIndex
                                            ? 'swapping'
                                            : num >= 1 && num <= n && i === num - 1
                                              ? 'correct'
                                              : 'misplaced'
                                    }">
                                        <div class="value">${num}</div>
                                        <div class="index">i=${i}</div>
                                    </div>
                                </div>
                            `,
                                )
                                .join('')}
                        </div>
                    `;
                    });
                } else {
                    html += `<div class="explanation">ã‚¹ãƒ¯ãƒƒãƒ—ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>`;
                }

                // Phase 2: æ¤œå‡ºãƒ•ã‚§ãƒ¼ã‚º
                html += `
                <div class="arrow">â¬‡ï¸</div>
                <div class="phase-indicator">Phase 2: Missing Number Detectionï¼ˆæ¬ ç•ªæ¤œå‡ºï¼‰</div>
                <div class="array-container">
                    <div class="array-label">æœ€çµ‚é…ç½®:</div>
                    ${workingArray
                        .map(
                            (num, i) => `
                        <div>
                            <div class="array-box ${num === i + 1 ? 'correct' : 'misplaced'}">
                                <div class="value">${num}</div>
                                <div class="index">i=${i}</div>
                            </div>
                            <div class="ideal-position">æœŸå¾…å€¤: ${i + 1}</div>
                        </div>
                    `,
                        )
                        .join('')}
                </div>
            `;

                // çµæœã®è¨ˆç®—
                let result = n + 1;
                let resultIndex = -1;
                for (let i = 0; i < n; i++) {
                    if (workingArray[i] !== i + 1) {
                        result = i + 1;
                        resultIndex = i;
                        break;
                    }
                }

                html += `
                <div class="explanation">
                    <strong>ğŸ¯ çµæœ: ${result}</strong><br>
                    ${
                        resultIndex !== -1
                            ? `ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹${resultIndex}ã§æœŸå¾…å€¤${result}ã¨å®Ÿéš›ã®å€¤${workingArray[resultIndex]}ãŒä¸ä¸€è‡´ â†’ ${result}ãŒæ¬ ã‘ã¦ã„ã‚‹`
                            : '1ã‹ã‚‰nã¾ã§å…¨ã¦æ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹ â†’ ç­”ãˆã¯n+1'
                    }
                </div>
                
                <div class="complexity">
                    <div>å®Ÿè¡Œã•ã‚ŒãŸã‚¹ãƒ¯ãƒƒãƒ—å›æ•°: ${swapSteps.length}</div>
                    <div>æ™‚é–“è¤‡é›‘åº¦: O(${n}) - å„è¦ç´ ã¯æœ€å¤§1å›ç§»å‹•</div>
                </div>
                </div>
            `;

                demoArea.innerHTML = html;
            }

            // åˆæœŸè¡¨ç¤º
            runCyclicSort([3, 4, -1, 1]);
        </script>
    </body>
</html>
