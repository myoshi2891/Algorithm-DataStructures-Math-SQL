<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BIT (Binary Indexed Tree) è©³ç´°è§£èª¬</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                min-height: 100vh;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                font-size: 2.5em;
                margin-bottom: 30px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .section {
                margin-bottom: 40px;
                padding: 25px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                border-left: 5px solid #3498db;
            }

            .section h2 {
                color: #2c3e50;
                border-bottom: 3px solid #3498db;
                padding-bottom: 10px;
                font-size: 1.8em;
            }

            .visualization {
                margin: 20px 0;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border: 2px solid #e9ecef;
            }

            .array-display {
                display: flex;
                justify-content: center;
                margin: 20px 0;
                flex-wrap: wrap;
                gap: 5px;
            }

            .array-cell {
                width: 50px;
                height: 50px;
                border: 2px solid #3498db;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 14px;
                border-radius: 8px;
                background: linear-gradient(45deg, #74b9ff, #0984e3);
                color: white;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .array-cell:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            }

            .array-cell.highlight {
                background: linear-gradient(45deg, #ff7675, #d63031);
                animation: pulse 1s infinite;
            }

            @keyframes pulse {

                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.05);
                }
            }

            .index-label {
                font-size: 12px;
                color: #666;
                margin-top: 5px;
            }

            .bit-structure {
                display: flex;
                flex-direction: column;
                align-items: center;
                margin: 30px 0;
            }

            .bit-level {
                display: flex;
                justify-content: center;
                margin: 15px 0;
                gap: 20px;
            }

            .bit-node {
                width: 80px;
                height: 60px;
                border: 3px solid #27ae60;
                border-radius: 12px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background: linear-gradient(45deg, #00b894, #00a085);
                color: white;
                font-weight: bold;
                box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .bit-node:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
            }

            .bit-node .index {
                font-size: 12px;
                opacity: 0.9;
            }

            .bit-node .value {
                font-size: 16px;
                font-weight: bold;
            }

            .connection {
                width: 2px;
                height: 20px;
                background: #95a5a6;
                margin: 0 auto;
            }

            .controls {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin: 25px 0;
                flex-wrap: wrap;
            }

            .control-group {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 15px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                border: 2px solid #e74c3c;
            }

            .control-group label {
                font-weight: bold;
                color: #2c3e50;
                min-width: 60px;
            }

            .control-group input {
                padding: 8px 12px;
                border: 2px solid #bdc3c7;
                border-radius: 6px;
                font-size: 14px;
                width: 80px;
                transition: border-color 0.3s ease;
            }

            .control-group input:focus {
                outline: none;
                border-color: #3498db;
                box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-weight: bold;
                font-size: 14px;
                transition: all 0.3s ease;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .btn-primary {
                background: linear-gradient(45deg, #3498db, #2980b9);
                color: white;
                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            }

            .btn-success {
                background: linear-gradient(45deg, #27ae60, #229954);
                color: white;
                box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            }

            .btn-success:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
            }

            .result {
                margin: 20px 0;
                padding: 15px;
                background: linear-gradient(45deg, #f39c12, #e67e22);
                color: white;
                border-radius: 10px;
                font-weight: bold;
                text-align: center;
                font-size: 18px;
                box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
            }

            .code-block {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 20px;
                border-radius: 10px;
                font-family: 'Courier New', monospace;
                margin: 15px 0;
                overflow-x: auto;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .code-block pre {
                margin: 0;
                white-space: pre-wrap;
            }

            .complexity-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                background: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            .complexity-table th,
            .complexity-table td {
                padding: 15px;
                text-align: left;
                border-bottom: 1px solid #bdc3c7;
            }

            .complexity-table th {
                background: linear-gradient(45deg, #34495e, #2c3e50);
                color: white;
                font-weight: bold;
            }

            .complexity-table tr:hover {
                background: #f8f9fa;
            }

            .binary-display {
                font-family: 'Courier New', monospace;
                background: #34495e;
                color: #ecf0f1;
                padding: 10px;
                border-radius: 6px;
                display: inline-block;
                margin: 5px;
                font-weight: bold;
            }

            .explanation {
                background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                padding: 20px;
                border-radius: 10px;
                margin: 15px 0;
                border-left: 5px solid #e74c3c;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>ğŸŒ³ BIT (Binary Indexed Tree) å®Œå…¨è§£èª¬</h1>

            <div class="section">
                <h2>ğŸ“Š BITã¨ã¯ï¼Ÿ</h2>
                <div class="explanation">
                    <p><strong>Binary Indexed Tree (BIT)</strong>ã¯ã€é…åˆ—ã®åŒºé–“å’Œã‚¯ã‚¨ãƒªã¨è¦ç´ ã®æ›´æ–°ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚</p>
                    <p>é€šå¸¸ã®é…åˆ—ã§ã¯åŒºé–“å’Œã®è¨ˆç®—ã«O(n)æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ãŒã€BITã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§<strong>O(log n)</strong>ã§å®Ÿè¡Œã§ãã¾ã™ã€‚</p>
                </div>

                <table class="complexity-table">
                    <tr>
                        <th>æ“ä½œ</th>
                        <th>é€šå¸¸ã®é…åˆ—</th>
                        <th>BIT</th>
                    </tr>
                    <tr>
                        <td>è¦ç´ ã®æ›´æ–°</td>
                        <td>O(1)</td>
                        <td>O(log n)</td>
                    </tr>
                    <tr>
                        <td>åŒºé–“å’Œã‚¯ã‚¨ãƒª</td>
                        <td>O(n)</td>
                        <td>O(log n)</td>
                    </tr>
                    <tr>
                        <td>ç©ºé–“è¨ˆç®—é‡</td>
                        <td>O(n)</td>
                        <td>O(n)</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>ğŸ¯ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ– ãƒ‡ãƒ¢</h2>
                <div class="visualization">
                    <h3>å…ƒã®é…åˆ—</h3>
                    <div class="array-display" id="originalArray"></div>

                    <h3>BITæ§‹é€ </h3>
                    <div class="array-display" id="bitArray"></div>

                    <div class="controls">
                        <div class="control-group">
                            <label>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:</label>
                            <input type="number" id="updateIndex" min="1" max="8" value="1">
                        </div>
                        <div class="control-group">
                            <label>å€¤:</label>
                            <input type="number" id="updateValue" value="1">
                        </div>
                        <button class="btn btn-primary" onclick="updateBIT()">æ›´æ–°</button>
                    </div>

                    <div class="controls">
                        <div class="control-group">
                            <label>é–‹å§‹:</label>
                            <input type="number" id="queryStart" min="1" max="8" value="1">
                        </div>
                        <div class="control-group">
                            <label>çµ‚äº†:</label>
                            <input type="number" id="queryEnd" min="1" max="8" value="3">
                        </div>
                        <button class="btn btn-success" onclick="queryBIT()">åŒºé–“å’Œã‚¯ã‚¨ãƒª</button>
                    </div>

                    <div class="result" id="result"></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ”¢ BITã®ä»•çµ„ã¿</h2>
                <div class="explanation">
                    <p>BITã®æ ¸å¿ƒã¯<strong>æœ€ä¸‹ä½ãƒ“ãƒƒãƒˆï¼ˆLSBï¼‰</strong>ã®æ¦‚å¿µã§ã™ã€‚å„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒç®¡ç†ã™ã‚‹ç¯„å›²ã¯ã€ãã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®äºŒé€²è¡¨ç¾ã®æœ€ä¸‹ä½ã®1ãƒ“ãƒƒãƒˆã«ã‚ˆã£ã¦æ±ºã¾ã‚Šã¾ã™ã€‚</p>

                    <h3>LSB ã®è¨ˆç®—æ–¹æ³•:</h3>
                    <div class="code-block">
                        <pre>LSB(x) = x & (-x)

ä¾‹ï¼š
6 (110â‚‚) ã® LSB = 110â‚‚ & 010â‚‚ = 010â‚‚ = 2
8 (1000â‚‚) ã® LSB = 1000â‚‚ & 1000â‚‚ = 1000â‚‚ = 8</pre>
                    </div>

                    <h3>å„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒç®¡ç†ã™ã‚‹ç¯„å›²:</h3>
                    <div id="bitRanges"></div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’» å®Ÿè£…ã‚³ãƒ¼ãƒ‰</h2>
                <div class="code-block">
                    <pre>class BIT {
    constructor(n) {
        this.n = n;
        this.tree = new Array(n + 1).fill(0);
    }
    
    // LSBï¼ˆæœ€ä¸‹ä½ãƒ“ãƒƒãƒˆï¼‰ã‚’å–å¾—
    lowbit(x) {
        return x & (-x);
    }
    
    // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ i ã«å€¤ delta ã‚’åŠ ç®—
    update(i, delta) {
        while (i <= this.n) {
            this.tree[i] += delta;
            i += this.lowbit(i);
        }
    }
    
    // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ 1 ã‹ã‚‰ i ã¾ã§ã®ç´¯ç©å’Œã‚’å–å¾—
    query(i) {
        let sum = 0;
        while (i > 0) {
            sum += this.tree[i];
            i -= this.lowbit(i);
        }
        return sum;
    }
    
    // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ l ã‹ã‚‰ r ã¾ã§ã®åŒºé–“å’Œã‚’å–å¾—
    rangeQuery(l, r) {
        return this.query(r) - this.query(l - 1);
    }
}</pre>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ å¿œç”¨ä¾‹</h2>
                <div class="explanation">
                    <h3>BITãŒæ´»ç”¨ã•ã‚Œã‚‹å ´é¢ï¼š</h3>
                    <ul>
                        <li><strong>ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</strong>: åŒºé–“å’Œã‚¯ã‚¨ãƒªãŒé »ç¹ã«ç™ºç”Ÿã™ã‚‹å•é¡Œ</li>
                        <li><strong>çµ±è¨ˆå‡¦ç†</strong>: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®ç´¯ç©çµ±è¨ˆè¨ˆç®—</li>
                        <li><strong>ã‚²ãƒ¼ãƒ é–‹ç™º</strong>: ã‚¹ã‚³ã‚¢ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ </li>
                        <li><strong>ãƒ‡ãƒ¼ã‚¿åˆ†æ</strong>: æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®åŒºé–“é›†è¨ˆ</li>
                    </ul>

                    <h3>é¡ä¼¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã®æ¯”è¼ƒï¼š</h3>
                    <ul>
                        <li><strong>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨</strong>: ã‚ˆã‚Šæ±ç”¨çš„ã ãŒã€å®Ÿè£…ãŒè¤‡é›‘</li>
                        <li><strong>å¹³æ–¹åˆ†å‰²</strong>: å®Ÿè£…ãŒç°¡å˜ã ãŒã€è¨ˆç®—é‡ãŒåŠ£ã‚‹</li>
                        <li><strong>ç´¯ç©å’Œé…åˆ—</strong>: æ›´æ–°ãŒO(n)ã¨éåŠ¹ç‡</li>
                    </ul>
                </div>
            </div>
        </div>

        <script>
            class BIT {
                constructor(n) {
                    this.n = n;
                    this.tree = new Array(n + 1).fill(0);
                    this.original = new Array(n + 1).fill(0);
                }

                lowbit(x) {
                    return x & (-x);
                }

                update(i, delta) {
                    this.original[i] += delta;
                    while (i <= this.n) {
                        this.tree[i] += delta;
                        i += this.lowbit(i);
                    }
                }

                query(i) {
                    let sum = 0;
                    while (i > 0) {
                        sum += this.tree[i];
                        i -= this.lowbit(i);
                    }
                    return sum;
                }

                rangeQuery(l, r) {
                    return this.query(r) - this.query(l - 1);
                }
            }

            // BITã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆæœŸåŒ–
            const bit = new BIT(8);

            // åˆæœŸå€¤ã‚’è¨­å®š
            for (let i = 1; i <= 8; i++) {
                bit.update(i, Math.floor(Math.random() * 10) + 1);
            }

            function updateDisplay() {
                // å…ƒã®é…åˆ—ã®è¡¨ç¤º
                const originalDiv = document.getElementById('originalArray');
                originalDiv.innerHTML = '';
                for (let i = 1; i <= 8; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'array-cell';
                    cell.innerHTML = `<div>${bit.original[i]}</div><div class="index-label">i=${i}</div>`;
                    originalDiv.appendChild(cell);
                }

                // BITé…åˆ—ã®è¡¨ç¤º
                const bitDiv = document.getElementById('bitArray');
                bitDiv.innerHTML = '';
                for (let i = 1; i <= 8; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'array-cell';
                    cell.style.background = 'linear-gradient(45deg, #00b894, #00a085)';
                    cell.innerHTML = `<div>${bit.tree[i]}</div><div class="index-label">BIT[${i}]</div>`;
                    bitDiv.appendChild(cell);
                }

                updateBitRanges();
            }

            function updateBitRanges() {
                const rangesDiv = document.getElementById('bitRanges');
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 20px 0;">';

                for (let i = 1; i <= 8; i++) {
                    const lsb = i & (-i);
                    const start = i - lsb + 1;
                    const binary = i.toString(2).padStart(4, '0');

                    html += `
                    <div style="padding: 15px; background: white; border-radius: 8px; border: 2px solid #3498db; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">
                            ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ${i} <span class="binary-display">${binary}</span>
                        </div>
                        <div style="color: #27ae60; font-weight: bold;">
                            LSB = ${lsb}, ç®¡ç†ç¯„å›²: [${start}, ${i}]
                        </div>
                        <div style="color: #e74c3c; margin-top: 8px;">
                            å€¤: ${bit.tree[i]}
                        </div>
                    </div>
                `;
                }
                html += '</div>';
                rangesDiv.innerHTML = html;
            }

            function updateBIT() {
                const index = parseInt(document.getElementById('updateIndex').value);
                const value = parseInt(document.getElementById('updateValue').value);

                if (index >= 1 && index <= 8) {
                    const oldValue = bit.original[index];
                    const delta = value - oldValue;
                    bit.original[index] = value;

                    // BITæ›´æ–°
                    let i = index;
                    while (i <= 8) {
                        bit.tree[i] += delta;
                        i += bit.lowbit(i);
                    }

                    updateDisplay();
                    document.getElementById('result').innerHTML = `ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ${index} ã‚’ ${value} ã«æ›´æ–°ã—ã¾ã—ãŸ`;

                    // æ›´æ–°ã•ã‚ŒãŸã‚»ãƒ«ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    setTimeout(() => {
                        const cells = document.querySelectorAll('.array-cell');
                        cells[index - 1].classList.add('highlight');
                        setTimeout(() => cells[index - 1].classList.remove('highlight'), 2000);
                    }, 100);
                }
            }

            function queryBIT() {
                const start = parseInt(document.getElementById('queryStart').value);
                const end = parseInt(document.getElementById('queryEnd').value);

                if (start >= 1 && end <= 8 && start <= end) {
                    const result = bit.rangeQuery(start, end);
                    document.getElementById('result').innerHTML =
                        `åŒºé–“ [${start}, ${end}] ã®åˆè¨ˆ: <strong>${result}</strong>`;

                    // ã‚¯ã‚¨ãƒªç¯„å›²ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    const cells = document.querySelectorAll('.array-cell');
                    for (let i = start - 1; i < end; i++) {
                        cells[i].classList.add('highlight');
                    }
                    setTimeout(() => {
                        for (let i = start - 1; i < end; i++) {
                            cells[i].classList.remove('highlight');
                        }
                    }, 3000);
                }
            }

            // åˆæœŸè¡¨ç¤º
            updateDisplay();
            document.getElementById('result').innerHTML = 'BITãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸã€‚æ“ä½œã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼';
        </script>
    </body>

</html>