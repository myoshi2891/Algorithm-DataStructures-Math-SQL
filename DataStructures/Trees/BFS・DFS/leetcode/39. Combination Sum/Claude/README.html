<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Combination Sum Algorithm Analysis</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 40px;
                font-size: 2.5em;
                background: linear-gradient(45deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }

            h2 {
                color: #34495e;
                border-bottom: 3px solid #3498db;
                padding-bottom: 10px;
                margin-top: 40px;
            }

            .algorithm-step {
                background: #f8f9fa;
                border-left: 5px solid #3498db;
                padding: 20px;
                margin: 20px 0;
                border-radius: 0 10px 10px 0;
                position: relative;
            }

            .step-number {
                position: absolute;
                left: -15px;
                top: -10px;
                background: #3498db;
                color: white;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
            }

            .tree-container {
                background: #ffffff;
                border: 2px solid #e9ecef;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                overflow-x: auto;
            }

            .tree-node {
                background: #e3f2fd;
                border: 2px solid #2196f3;
                border-radius: 8px;
                padding: 8px 12px;
                margin: 5px;
                display: inline-block;
                font-weight: bold;
                position: relative;
                min-width: 80px;
                text-align: center;
            }

            .tree-node.valid {
                background: #c8e6c9;
                border-color: #4caf50;
            }

            .tree-node.invalid {
                background: #ffcdd2;
                border-color: #f44336;
            }

            .tree-node.current {
                background: #fff3e0;
                border-color: #ff9800;
                animation: pulse 1.5s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.05);
                }
            }

            .tree-level {
                margin: 20px 0;
                text-align: center;
            }

            .level-label {
                font-weight: bold;
                color: #666;
                margin-bottom: 10px;
            }

            .array-visualization {
                display: flex;
                justify-content: center;
                gap: 5px;
                margin: 20px 0;
            }

            .array-item {
                background: #f0f0f0;
                border: 2px solid #ccc;
                padding: 10px 15px;
                border-radius: 5px;
                font-weight: bold;
                position: relative;
            }

            .array-item.selected {
                background: #4caf50;
                color: white;
                border-color: #388e3c;
            }

            .array-item.considering {
                background: #ff9800;
                color: white;
                border-color: #f57c00;
            }

            .code-block {
                background: #2d3748;
                color: #e2e8f0;
                padding: 20px;
                border-radius: 10px;
                overflow-x: auto;
                font-family: 'Courier New', monospace;
                margin: 20px 0;
                position: relative;
            }

            .code-highlight {
                background: rgba(255, 255, 0, 0.2);
                padding: 2px 4px;
                border-radius: 3px;
            }

            .complexity-box {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
            }

            .example-container {
                border: 2px solid #17a2b8;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                background: #f7fdff;
            }

            .path-trace {
                background: #fff8e1;
                border-left: 4px solid #ffc107;
                padding: 15px;
                margin: 10px 0;
                font-family: monospace;
            }

            .interactive-demo {
                text-align: center;
                margin: 30px 0;
            }

            .demo-button {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 16px;
                margin: 5px;
                transition: transform 0.2s;
            }

            .demo-button:hover {
                transform: translateY(-2px);
            }

            .demo-output {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 20px;
                margin-top: 20px;
                text-align: left;
                font-family: monospace;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>🔍 Combination Sum Algorithm Analysis</h1>

            <h2>📊 アルゴリズム概要</h2>
            <div class="algorithm-step">
                <div class="step-number">1</div>
                <strong>問題設定:</strong> 配列 candidates = [2,3,6,7], target = 7 の場合を例に解析
            </div>

            <h2>🏗️ 初期化フェーズ</h2>
            <div class="example-container">
                <h3>Step 1: 配列のソート</h3>
                <div
                    style="
                        display: flex;
                        justify-content: space-around;
                        align-items: center;
                        margin: 20px 0;
                    "
                >
                    <div>
                        <p><strong>ソート前:</strong></p>
                        <div class="array-visualization">
                            <div class="array-item">2</div>
                            <div class="array-item">3</div>
                            <div class="array-item">6</div>
                            <div class="array-item">7</div>
                        </div>
                    </div>
                    <div style="font-size: 24px">→</div>
                    <div>
                        <p><strong>ソート後:</strong></p>
                        <div class="array-visualization">
                            <div class="array-item selected">2</div>
                            <div class="array-item selected">3</div>
                            <div class="array-item selected">6</div>
                            <div class="array-item selected">7</div>
                        </div>
                    </div>
                </div>
                <p><strong>効果:</strong> 小さい数から試すことで早期終了が可能</p>
            </div>

            <h2>🌳 DFS探索木の可視化</h2>
            <div class="tree-container">
                <div class="tree-level">
                    <div class="level-label">Level 0 (root): target=7, startIndex=0</div>
                    <div class="tree-node current">開始<br />[7]</div>
                </div>

                <div class="tree-level">
                    <div class="level-label">Level 1: 各候補を試行</div>
                    <div class="tree-node">2を選択<br />[5]</div>
                    <div class="tree-node">3を選択<br />[4]</div>
                    <div class="tree-node">6を選択<br />[1]</div>
                    <div class="tree-node valid">7を選択<br />[0] ✓</div>
                </div>

                <div class="tree-level">
                    <div class="level-label">Level 2: 2を選択した場合の展開</div>
                    <div class="tree-node">2,2を選択<br />[3]</div>
                    <div class="tree-node">2,3を選択<br />[2]</div>
                    <div class="tree-node invalid">2,6を選択<br />[-1] ✗</div>
                </div>

                <div class="tree-level">
                    <div class="level-label">Level 3: さらなる展開</div>
                    <div class="tree-node valid">2,2,3を選択<br />[0] ✓</div>
                    <div class="tree-node invalid">2,2,6を選択<br />[-3] ✗</div>
                </div>
            </div>

            <h2>🔄 バックトラッキングの動作</h2>
            <div class="example-container">
                <h3>探索パスの詳細トレース</h3>
                <div class="path-trace">
                    <strong>Path 1:</strong> [] → [2] → [2,2] → [2,2,3] → target達成! →
                    バックトラック
                </div>
                <div class="path-trace">
                    <strong>Path 2:</strong> [] → [2] → [2,2] → [2,2,6] → 無効(sum>target) →
                    バックトラック
                </div>
                <div class="path-trace">
                    <strong>Path 3:</strong> [] → [2] → [2,3] → [2,3,3] → 無効(sum>target) →
                    バックトラック
                </div>
                <div class="path-trace">
                    <strong>Path 4:</strong> [] → [7] → target達成! → 解を記録
                </div>
            </div>

            <h2>⚡ 最適化技法</h2>
            <div class="algorithm-step">
                <div class="step-number">1</div>
                <strong>早期終了 (Pruning):</strong>
                <div class="code-block">
                    <span class="code-highlight"
                        >if (candidate > remainingTarget) { break; // ソート済みなので以降も全て無効
                        }</span
                    >
                </div>
            </div>

            <div class="algorithm-step">
                <div class="step-number">2</div>
                <strong>重複回避:</strong> startIndexにより同じ組み合わせの重複を防止
            </div>

            <div class="algorithm-step">
                <div class="step-number">3</div>
                <strong>メモリ効率:</strong> スプレッド演算子による効率的な配列コピー
            </div>

            <h2>📈 計算量解析</h2>
            <div class="complexity-box">
                <h3>時間計算量: O(N^(T/M))</h3>
                <p>• N: 候補の数 (4)</p>
                <p>• T: target値 (7)</p>
                <p>• M: 最小候補値 (2)</p>
                <p>• 実際の計算: 4^(7/2) ≈ 4^3.5 ≈ 128 (理論上限)</p>

                <h3>空間計算量: O(T/M)</h3>
                <p>• 再帰スタックの最大深度</p>
                <p>• 実際の計算: 7/2 ≈ 4レベル</p>
            </div>

            <h2>🎯 インタラクティブデモ</h2>
            <div class="interactive-demo">
                <div>
                    <label>Candidates: </label>
                    <input
                        type="text"
                        id="candidatesInput"
                        value="2,3,6,7"
                        style="padding: 8px; border-radius: 5px; border: 1px solid #ccc"
                    />
                    <label>Target: </label>
                    <input
                        type="number"
                        id="targetInput"
                        value="7"
                        style="
                            padding: 8px;
                            border-radius: 5px;
                            border: 1px solid #ccc;
                            width: 80px;
                        "
                    />
                    <button class="demo-button" onclick="runDemo()">実行</button>
                    <button class="demo-button" onclick="stepByStep()">ステップ実行</button>
                </div>
                <div class="demo-output" id="demoOutput">結果がここに表示されます...</div>
            </div>

            <h2>🔍 実装のキーポイント</h2>
            <div class="code-block">
                // TypeScript実装の重要部分 function dfs(startIndex: number, remainingTarget:
                number): void { // <span class="code-highlight">ベースケース: 目標達成</span> if
                (remainingTarget === 0) { result.push([...currentCombination]); return; } for (let i
                = startIndex; i < candidates.length; i++) { const candidate=candidates[i]; //
                <span class="code-highlight">早期終了による最適化</span> if (candidate >
                remainingTarget) break; //
                <span class="code-highlight">選択</span> currentCombination.push(candidate); //
                <span class="code-highlight"
                    >再帰 (同じインデックスから開始 = 同じ数字を再利用可能)</span
                >
                dfs(i, remainingTarget - candidate); //
                <span class="code-highlight">バックトラッキング</span>
                currentCombination.pop(); } }
            </div>

            <h2>✅ 実行結果の検証</h2>
            <div class="example-container">
                <h3>Input: candidates = [2,3,6,7], target = 7</h3>
                <h3>Output: [[2,2,3], [7]]</h3>
                <div style="display: flex; justify-content: space-around; margin: 20px 0">
                    <div class="tree-node valid">
                        解1: [2,2,3]<br />
                        2+2+3 = 7 ✓
                    </div>
                    <div class="tree-node valid">
                        解2: [7]<br />
                        7 = 7 ✓
                    </div>
                </div>
            </div>
        </div>

        <script>
            let step = 0;
            let maxSteps = 0;

            function combinationSum(candidates, target) {
                const result = [];
                const currentCombination = [];
                candidates.sort((a, b) => a - b);

                function dfs(startIndex, remainingTarget, path = []) {
                    if (remainingTarget === 0) {
                        result.push([...currentCombination]);
                        return;
                    }

                    if (remainingTarget < 0) return;

                    for (let i = startIndex; i < candidates.length; i++) {
                        const candidate = candidates[i];

                        if (candidate > remainingTarget) break;

                        currentCombination.push(candidate);
                        dfs(i, remainingTarget - candidate, [...path, candidate]);
                        currentCombination.pop();
                    }
                }

                dfs(0, target);
                return result;
            }

            function runDemo() {
                const candidatesStr = document.getElementById('candidatesInput').value;
                const target = parseInt(document.getElementById('targetInput').value);
                const candidates = candidatesStr.split(',').map((x) => parseInt(x.trim()));

                const start = performance.now();
                const result = combinationSum(candidates, target);
                const end = performance.now();

                const output = document.getElementById('demoOutput');
                output.innerHTML = `
                <strong>入力:</strong> candidates = [${candidates.join(', ')}], target = ${target}<br/>
                <strong>結果:</strong> ${JSON.stringify(result)}<br/>
                <strong>組み合わせ数:</strong> ${result.length}<br/>
                <strong>実行時間:</strong> ${(end - start).toFixed(2)} ms<br/>
                <strong>解の詳細:</strong><br/>
                ${result
                    .map(
                        (combo, i) =>
                            `  ${i + 1}. [${combo.join(', ')}] = ${combo.reduce((a, b) => a + b, 0)}`,
                    )
                    .join('<br/>')}
            `;
            }

            function stepByStep() {
                alert(
                    'ステップ実行機能は視覚的なデモンストレーション用です。\n上記の探索木を参照してアルゴリズムの動作を確認してください。',
                );
            }

            // 初期デモを実行
            setTimeout(runDemo, 1000);
        </script>
    </body>
</html>
