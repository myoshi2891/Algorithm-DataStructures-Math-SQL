<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>行列回転: 転置 + 行反転 アルゴリズム解析</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
                line-height: 1.6;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
            }

            .container {
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }

            h1 {
                color: #2c3e50;
                text-align: center;
                border-bottom: 3px solid #3498db;
                padding-bottom: 15px;
                margin-bottom: 30px;
            }

            h2 {
                color: #34495e;
                margin-top: 40px;
                border-left: 5px solid #3498db;
                padding-left: 20px;
                background: #f8f9fa;
                padding: 15px 20px;
                border-radius: 0 10px 10px 0;
            }

            h3 {
                color: #2980b9;
                margin-top: 25px;
            }

            .matrix {
                display: inline-grid;
                gap: 3px;
                margin: 20px;
                border: 3px solid #34495e;
                padding: 15px;
                background: linear-gradient(145deg, #f0f2f5, #e1e8ed);
                border-radius: 12px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            .cell {
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 2px solid #7f8c8d;
                background: white;
                font-weight: bold;
                font-size: 16px;
                border-radius: 8px;
                transition: all 0.4s ease;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }

            .step {
                margin: 30px 0;
                padding: 25px;
                background: linear-gradient(145deg, #ffffff, #f8f9fa);
                border-radius: 12px;
                border: 1px solid #e9ecef;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            }

            .demo-container {
                display: flex;
                flex-wrap: wrap;
                gap: 30px;
                justify-content: center;
                margin: 30px 0;
                align-items: center;
            }

            .arrow {
                font-size: 36px;
                color: #e74c3c;
                margin: 0 20px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .highlight-diagonal {
                background: linear-gradient(135deg, #3498db, #2980b9) !important;
                color: white;
                transform: scale(1.05);
            }

            .highlight-swap {
                background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
                color: white;
                animation: pulse 1s infinite;
            }

            .highlight-reverse {
                background: linear-gradient(135deg, #f39c12, #e67e22) !important;
                color: white;
            }

            .final-result {
                background: linear-gradient(135deg, #2ecc71, #27ae60) !important;
                color: white;
                animation: glow 2s infinite alternate;
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.1);
                }

                100% {
                    transform: scale(1);
                }
            }

            @keyframes glow {
                from {
                    box-shadow: 0 2px 5px rgba(46, 204, 113, 0.3);
                }

                to {
                    box-shadow: 0 4px 20px rgba(46, 204, 113, 0.6);
                }
            }

            .code-section {
                background: linear-gradient(135deg, #2c3e50, #34495e);
                color: #ecf0f1;
                padding: 25px;
                border-radius: 12px;
                margin: 25px 0;
                font-family: 'Fira Code', 'Courier New', monospace;
                overflow-x: auto;
                border-left: 5px solid #3498db;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .code-comment {
                color: #95a5a6;
                font-style: italic;
            }

            .complexity {
                background: linear-gradient(135deg, #27ae60, #2ecc71);
                color: white;
                padding: 20px;
                border-radius: 12px;
                margin: 20px 0;
                box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            }

            .warning {
                background: linear-gradient(135deg, #f39c12, #e67e22);
                color: white;
                padding: 20px;
                border-radius: 12px;
                margin: 20px 0;
                box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
            }

            button {
                background: linear-gradient(135deg, #3498db, #2980b9);
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 8px;
                cursor: pointer;
                margin: 8px;
                font-size: 16px;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            }

            button:hover {
                background: linear-gradient(135deg, #2980b9, #1f4e79);
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            }

            .algorithm-comparison {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin: 20px 0;
            }

            .comparison-card {
                padding: 20px;
                border-radius: 12px;
                border: 2px solid #3498db;
                background: #f8f9fa;
            }

            .pros {
                border-color: #27ae60;
                background: linear-gradient(135deg, #d5f4e6, #a8e6cf);
            }

            .cons {
                border-color: #e74c3c;
                background: linear-gradient(135deg, #fadbd8, #f1948a);
            }

            .iteration-info {
                background: #e8f4f8;
                padding: 15px;
                border-radius: 8px;
                margin: 10px 0;
                border-left: 4px solid #3498db;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>行列90度回転: 転置 + 行反転アルゴリズム解析</h1>

            <h2>1. アルゴリズム概要</h2>
            <p>このアルゴリズムは<strong>2段階のアプローチ</strong>を採用します：</p>
            <div class="step">
                <ol>
                    <li><strong>Step 1</strong>: 行列を転置（対角線に対して反転）</li>
                    <li><strong>Step 2</strong>: 各行を左右反転</li>
                </ol>
                <p>この2つの操作を組み合わせることで、90度時計回りの回転を実現します。</p>
            </div>

            <h2>2. Step 1: 転置（Transpose）の詳細解析</h2>

            <div class="step">
                <h3>転置の概念</h3>
                <p>
                    転置とは、行列の行と列を入れ替える操作です。要素 <code>matrix[i][j]</code> が
                    <code>matrix[j][i]</code> と交換されます。
                </p>

                <div class="code-section">
                    <span class="code-comment">// Step 1: 転置の実装</span>
                    for (let i = 0; i < n; i++) { for (let j=i + 1; j < n; j++) {
                    <span class="code-comment">// ⚠️ j = i + 1 から開始（重要！）</span> const temp:
                    number = matrix[i][j]; matrix[i][j] = matrix[j][i];
                    <span class="code-comment">// (i,j) ← (j,i)</span> matrix[j][i] = temp;
                    <span class="code-comment">// (j,i) ← 元の(i,j)</span>
                    } }
                </div>

                <div class="warning">
                    <h3>⚠️ 重要なポイント: なぜ j = i + 1 から？</h3>
                    <p>
                        <strong>理由</strong>:
                        対角線より上の部分のみを処理することで、各要素ペアを1回だけ交換
                    </p>
                    <p>
                        <strong>もし j = 0 から始めると</strong>:
                        同じ要素ペアを2回交換してしまい、元に戻ってしまう
                    </p>
                    <p><strong>対角線要素</strong>: matrix[i][i] は交換不要（自分自身との交換）</p>
                </div>
            </div>

            <div class="step">
                <h3>3×3行列での転置デモンストレーション</h3>
                <div class="demo-container">
                    <div>
                        <p><strong>初期状態:</strong></p>
                        <div class="matrix" style="grid-template-columns: repeat(3, 1fr)">
                            <div class="cell">1</div>
                            <div class="cell">2</div>
                            <div class="cell">3</div>
                            <div class="cell">4</div>
                            <div class="cell">5</div>
                            <div class="cell">6</div>
                            <div class="cell">7</div>
                            <div class="cell">8</div>
                            <div class="cell">9</div>
                        </div>
                        <div class="iteration-info">
                            <strong>処理対象:</strong> 対角線より上の要素のみ<br />
                            交換ペア: (0,1)↔(1,0), (0,2)↔(2,0), (1,2)↔(2,1)
                        </div>
                    </div>
                    <span class="arrow">→</span>
                    <div>
                        <p><strong>転置後:</strong></p>
                        <div class="matrix" style="grid-template-columns: repeat(3, 1fr)">
                            <div class="cell highlight-diagonal">1</div>
                            <div class="cell highlight-swap">4</div>
                            <div class="cell highlight-swap">7</div>
                            <div class="cell highlight-swap">2</div>
                            <div class="cell highlight-diagonal">5</div>
                            <div class="cell highlight-swap">8</div>
                            <div class="cell highlight-swap">3</div>
                            <div class="cell highlight-swap">6</div>
                            <div class="cell highlight-diagonal">9</div>
                        </div>
                        <div class="iteration-info">
                            <strong>結果:</strong> 行と列が入れ替わった<br />
                            対角線要素（1,5,9）は変化なし
                        </div>
                    </div>
                </div>
            </div>

            <div class="step">
                <h3>転置処理の詳細な反復解析</h3>
                <button onclick="showTransposeSteps()">ステップバイステップで転置を見る</button>
                <div id="transpose-steps"></div>
            </div>

            <h2>3. Step 2: 行反転（Reverse Rows）の詳細解析</h2>

            <div class="step">
                <h3>行反転の実装</h3>
                <div class="code-section">
                    <span class="code-comment">// Step 2: 各行を反転</span>
                    for (let i = 0; i < n; i++) { matrix[i].reverse();
                    <span class="code-comment">// 配列の組み込みメソッドを使用</span>
                    }

                    <span class="code-comment">// reverse()の内部動作（参考）:</span>
                    <span class="code-comment">// [a, b, c] → [c, b, a]</span>
                    <span class="code-comment">// 先頭と末尾から順次交換</span>
                </div>
            </div>

            <div class="step">
                <h3>行反転のデモンストレーション</h3>
                <div class="demo-container">
                    <div>
                        <p><strong>転置後の状態:</strong></p>
                        <div class="matrix" style="grid-template-columns: repeat(3, 1fr)">
                            <div class="cell">1</div>
                            <div class="cell">4</div>
                            <div class="cell">7</div>
                            <div class="cell">2</div>
                            <div class="cell">5</div>
                            <div class="cell">8</div>
                            <div class="cell">3</div>
                            <div class="cell">6</div>
                            <div class="cell">9</div>
                        </div>
                    </div>
                    <span class="arrow">→</span>
                    <div>
                        <p><strong>各行反転後（最終結果）:</strong></p>
                        <div class="matrix" style="grid-template-columns: repeat(3, 1fr)">
                            <div class="cell final-result">7</div>
                            <div class="cell final-result">4</div>
                            <div class="cell final-result">1</div>
                            <div class="cell final-result">8</div>
                            <div class="cell final-result">5</div>
                            <div class="cell final-result">2</div>
                            <div class="cell final-result">9</div>
                            <div class="cell final-result">6</div>
                            <div class="cell final-result">3</div>
                        </div>
                        <div class="iteration-info">
                            <strong>各行の変化:</strong><br />
                            [1,4,7] → [7,4,1]<br />
                            [2,5,8] → [8,5,2]<br />
                            [3,6,9] → [9,6,3]
                        </div>
                    </div>
                </div>
            </div>

            <h2>4. 完全なアルゴリズムデモンストレーション</h2>

            <div class="step">
                <h3>4×4行列での完全な処理過程</h3>
                <button onclick="demonstrateFullRotation()">4×4行列の完全回転を実行</button>
                <div id="full-demo"></div>
            </div>

            <h2>5. なぜこの方法で90度回転になるのか？</h2>

            <div class="step">
                <h3>数学的説明</h3>
                <div class="code-section">
                    <span class="code-comment">// 元の座標 (i, j) の移動を追跡:</span>

                    <span class="code-comment">// Step 1: 転置</span>
                    (i, j) → (j, i)

                    <span class="code-comment">// Step 2: 行反転 (行jの要素を反転)</span>
                    (j, i) → (j, n-1-i)

                    <span class="code-comment">// 結合した結果:</span>
                    (i, j) → (j, n-1-i)

                    <span class="code-comment">// これは90度時計回りの回転公式と一致！</span>
                </div>

                <div class="iteration-info">
                    <p><strong>例</strong>: 4×4行列での座標変換</p>
                    <p>• 元の(0,1) → 転置後(1,0) → 行反転後(1,3) ✓</p>
                    <p>• 元の(2,0) → 転置後(0,2) → 行反転後(0,1) ✓</p>
                    <p>• 元の(3,2) → 転置後(2,3) → 行反転後(2,0) ✓</p>
                </div>
            </div>

            <h2>6. 計算量分析</h2>

            <div class="complexity">
                <h3>時間計算量: O(n²)</h3>
                <p><strong>Step 1 (転置)</strong>: n×n要素の約半分を処理 → O(n²/2) = O(n²)</p>
                <p><strong>Step 2 (行反転)</strong>: n行 × 各行n/2要素 → O(n²/2) = O(n²)</p>
                <p><strong>合計</strong>: O(n²) + O(n²) = O(n²)</p>
            </div>

            <div class="complexity" style="background: linear-gradient(135deg, #e67e22, #f39c12)">
                <h3>空間計算量: O(1)</h3>
                <p><strong>転置</strong>: 一時変数temp のみ使用</p>
                <p><strong>行反転</strong>: Array.reverse() はin-place操作</p>
                <p><strong>総メモリ</strong>: 追加配列不要、定数空間のみ</p>
            </div>

            <h2>7. アルゴリズム比較</h2>

            <div class="algorithm-comparison">
                <div class="comparison-card pros">
                    <h3>転置+行反転の利点</h3>
                    <ul>
                        <li>実装が直感的で理解しやすい</li>
                        <li>2つの単純な操作の組み合わせ</li>
                        <li>デバッグが容易</li>
                        <li>Array.reverse()の最適化を活用</li>
                        <li>コードが短くて読みやすい</li>
                    </ul>
                </div>
                <div class="comparison-card cons">
                    <h3>レイヤー回転との比較</h3>
                    <ul>
                        <li>2回の配列走査が必要</li>
                        <li>キャッシュ効率が若干劣る可能性</li>
                        <li>reverse()の内部実装に依存</li>
                    </ul>
                    <p>
                        <strong>結論</strong>:
                        実用的には性能差は僅少で、コードの可読性が重要な場合は優秀な選択
                    </p>
                </div>
            </div>

            <h2>8. 実装時の注意点</h2>

            <div class="warning">
                <h3>よくある間違いとその対策</h3>
                <ul>
                    <li>
                        <strong>転置で全要素を処理</strong> → 要素が元に戻る（j = i+1 から開始）
                    </li>
                    <li><strong>型エラー</strong> → TypeScriptでは適切な型注釈が必要</li>
                    <li><strong>reverse()の返り値</strong> → 元配列を変更し、その参照を返す</li>
                    <li><strong>境界条件</strong> → n=1の場合も正しく動作することを確認</li>
                </ul>
            </div>
        </div>

        <script>
            function showTransposeSteps() {
                const container = document.getElementById('transpose-steps');
                container.innerHTML = `
                <div style="margin-top: 20px;">
                    <h4>3×3行列の転置: 反復詳細</h4>
                    
                    <div class="iteration-info">
                        <strong>i=0, j=1:</strong> matrix[0][1] ↔ matrix[1][0] (2 ↔ 4)
                    </div>
                    <div class="demo-container">
                        <div class="matrix" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="cell">1</div><div class="cell highlight-swap">2→4</div><div class="cell">3</div>
                            <div class="cell highlight-swap">4→2</div><div class="cell">5</div><div class="cell">6</div>
                            <div class="cell">7</div><div class="cell">8</div><div class="cell">9</div>
                        </div>
                    </div>
                    
                    <div class="iteration-info">
                        <strong>i=0, j=2:</strong> matrix[0][2] ↔ matrix[2][0] (3 ↔ 7)
                    </div>
                    <div class="demo-container">
                        <div class="matrix" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="cell">1</div><div class="cell">4</div><div class="cell highlight-swap">3→7</div>
                            <div class="cell">2</div><div class="cell">5</div><div class="cell">6</div>
                            <div class="cell highlight-swap">7→3</div><div class="cell">8</div><div class="cell">9</div>
                        </div>
                    </div>
                    
                    <div class="iteration-info">
                        <strong>i=1, j=2:</strong> matrix[1][2] ↔ matrix[2][1] (6 ↔ 8)
                    </div>
                    <div class="demo-container">
                        <div class="matrix" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="cell">1</div><div class="cell">4</div><div class="cell">7</div>
                            <div class="cell">2</div><div class="cell">5</div><div class="cell highlight-swap">6→8</div>
                            <div class="cell">3</div><div class="cell highlight-swap">8→6</div><div class="cell">9</div>
                        </div>
                    </div>
                    
                    <div class="complexity" style="margin-top: 20px;">
                        <strong>転置完了!</strong> 処理回数: 3回（n(n-1)/2 = 3×2/2 = 3）
                    </div>
                </div>
            `;
            }

            function demonstrateFullRotation() {
                const container = document.getElementById('full-demo');
                container.innerHTML = `
                <div style="margin-top: 20px;">
                    <h4>4×4行列での完全な回転プロセス</h4>
                    
                    <div class="demo-container">
                        <div>
                            <p><strong>1. 初期状態:</strong></p>
                            <div class="matrix" style="grid-template-columns: repeat(4, 1fr);">
                                <div class="cell">5</div><div class="cell">1</div><div class="cell">9</div><div class="cell">11</div>
                                <div class="cell">2</div><div class="cell">4</div><div class="cell">8</div><div class="cell">10</div>
                                <div class="cell">13</div><div class="cell">3</div><div class="cell">6</div><div class="cell">7</div>
                                <div class="cell">15</div><div class="cell">14</div><div class="cell">12</div><div class="cell">16</div>
                            </div>
                        </div>
                        <span class="arrow">Step1</span>
                        <div>
                            <p><strong>2. 転置後:</strong></p>
                            <div class="matrix" style="grid-template-columns: repeat(4, 1fr);">
                                <div class="cell">5</div><div class="cell highlight-swap">2</div><div class="cell highlight-swap">13</div><div class="cell highlight-swap">15</div>
                                <div class="cell highlight-swap">1</div><div class="cell">4</div><div class="cell highlight-swap">3</div><div class="cell highlight-swap">14</div>
                                <div class="cell highlight-swap">9</div><div class="cell highlight-swap">8</div><div class="cell">6</div><div class="cell highlight-swap">12</div>
                                <div class="cell highlight-swap">11</div><div class="cell highlight-swap">10</div><div class="cell highlight-swap">7</div><div class="cell">16</div>
                            </div>
                        </div>
                        <span class="arrow">Step2</span>
                        <div>
                            <p><strong>3. 各行反転後（完成）:</strong></p>
                            <div class="matrix" style="grid-template-columns: repeat(4, 1fr);">
                                <div class="cell final-result">15</div><div class="cell final-result">13</div><div class="cell final-result">2</div><div class="cell final-result">5</div>
                                <div class="cell final-result">14</div><div class="cell final-result">3</div><div class="cell final-result">4</div><div class="cell final-result">1</div>
                                <div class="cell final-result">12</div><div class="cell final-result">6</div><div class="cell final-result">8</div><div class="cell final-result">9</div>
                                <div class="cell final-result">16</div><div class="cell final-result">7</div><div class="cell final-result">10</div><div class="cell final-result">11</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="iteration-info" style="margin-top: 20px;">
                        <strong>各行の反転詳細:</strong><br>
                        行0: [5,2,13,15] → [15,13,2,5]<br>
                        行1: [1,4,3,14] → [14,3,4,1]<br>
                        行2: [9,8,6,12] → [12,6,8,9]<br>
                        行3: [11,10,7,16] → [16,7,10,11]
                    </div>
                    
                    <div class="complexity" style="margin-top: 20px;">
                        <strong>90度時計回り回転完了!</strong><br>
                        総処理時間: O(n²) | 総メモリ使用量: O(1)
                    </div>
                </div>
            `;
            }
        </script>
    </body>
</html>
