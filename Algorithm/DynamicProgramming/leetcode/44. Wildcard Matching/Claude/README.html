<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ワイルドカードパターンマッチング解析</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }
            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 40px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }
            h2 {
                color: #34495e;
                border-bottom: 3px solid #3498db;
                padding-bottom: 10px;
                margin-top: 40px;
            }
            .example-section {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                border-left: 5px solid #3498db;
            }
            .dp-table {
                border-collapse: collapse;
                margin: 20px auto;
                background: white;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            .dp-table th,
            .dp-table td {
                border: 1px solid #ddd;
                padding: 10px;
                text-align: center;
                font-weight: bold;
                min-width: 40px;
            }
            .dp-table th {
                background: #3498db;
                color: white;
            }
            .dp-table .header-char {
                background: #2ecc71;
                color: white;
            }
            .true-cell {
                background: #2ecc71;
                color: white;
            }
            .false-cell {
                background: #e74c3c;
                color: white;
            }
            .step-animation {
                padding: 15px;
                margin: 10px 0;
                border-radius: 8px;
                background: #ecf0f1;
                border-left: 4px solid #9b59b6;
            }
            .code-block {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 20px;
                border-radius: 8px;
                font-family: 'Courier New', monospace;
                overflow-x: auto;
                margin: 20px 0;
            }
            .highlight {
                background: #f39c12;
                padding: 2px 5px;
                border-radius: 3px;
                color: white;
            }
            .control-panel {
                text-align: center;
                margin: 30px 0;
                padding: 20px;
                background: #34495e;
                border-radius: 10px;
                color: white;
            }
            input[type='text'] {
                padding: 10px;
                margin: 5px;
                border: none;
                border-radius: 5px;
                font-size: 16px;
                width: 200px;
            }
            button {
                background: #3498db;
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                transition: background 0.3s;
            }
            button:hover {
                background: #2980b9;
            }
            .legend {
                display: flex;
                justify-content: center;
                gap: 30px;
                margin: 20px 0;
                flex-wrap: wrap;
            }
            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .legend-box {
                width: 20px;
                height: 20px;
                border-radius: 3px;
            }
            .flow-diagram {
                display: flex;
                justify-content: space-around;
                align-items: center;
                margin: 30px 0;
                flex-wrap: wrap;
            }
            .flow-box {
                background: #3498db;
                color: white;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                min-width: 150px;
                margin: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }
            .arrow {
                font-size: 24px;
                color: #3498db;
                margin: 0 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>🔍 ワイルドカードパターンマッチング解析</h1>

            <div class="control-panel">
                <h3>インタラクティブデモ</h3>
                <div>
                    <label>文字列 (s): </label>
                    <input type="text" id="stringInput" value="adceb" placeholder="例: adceb" />
                </div>
                <div>
                    <label>パターン (p): </label>
                    <input type="text" id="patternInput" value="*a*b*" placeholder="例: *a*b*" />
                </div>
                <button onclick="analyzePattern()">解析実行</button>
            </div>

            <h2>📊 アルゴリズムの流れ</h2>
            <div class="flow-diagram">
                <div class="flow-box">1. DPテーブル初期化</div>
                <div class="arrow">→</div>
                <div class="flow-box">2. ベースケース設定</div>
                <div class="arrow">→</div>
                <div class="flow-box">3. DP計算</div>
                <div class="arrow">→</div>
                <div class="flow-box">4. 結果取得</div>
            </div>

            <h2>🎯 Example 1: s="aa", p="*"</h2>
            <div class="example-section">
                <h3>ステップバイステップ解析</h3>

                <div class="step-animation">
                    <strong>ステップ1: DPテーブル初期化</strong><br />
                    サイズ (3×2) のテーブルを作成し、全てfalseで初期化
                </div>

                <table class="dp-table">
                    <tr>
                        <th></th>
                        <th class="header-char">ε</th>
                        <th class="header-char">*</th>
                    </tr>
                    <tr>
                        <th class="header-char">ε</th>
                        <td class="true-cell">T</td>
                        <td class="true-cell">T</td>
                    </tr>
                    <tr>
                        <th class="header-char">a</th>
                        <td class="false-cell">F</td>
                        <td class="true-cell">T</td>
                    </tr>
                    <tr>
                        <th class="header-char">aa</th>
                        <td class="false-cell">F</td>
                        <td class="true-cell">T</td>
                    </tr>
                </table>

                <div class="step-animation">
                    <strong>処理ロジック:</strong><br />
                    • dp[0][0] = true (空文字列と空パターンはマッチ)<br />
                    • dp[0][1] = true ('*'は空文字列にもマッチ)<br />
                    • dp[1][1] = dp[1][0] || dp[0][1] = false || true = true<br />
                    • dp[2][1] = dp[2][0] || dp[1][1] = false || true = true
                </div>
            </div>

            <h2>🎯 Example 2: s="adceb", p="*a*b*"</h2>
            <div class="example-section">
                <table class="dp-table" id="dynamicTable">
                    <!-- JavaScriptで動的に生成 -->
                </table>
                <div id="analysisResult"></div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-box true-cell"></div>
                    <span>True (マッチ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box false-cell"></div>
                    <span>False (マッチしない)</span>
                </div>
            </div>

            <h2>⚡ 時間・空間計算量解析</h2>
            <div class="example-section">
                <h3>時間計算量: O(m × n)</h3>
                <p>• m = 文字列の長さ, n = パターンの長さ</p>
                <p>• 各セルを一度だけ計算するため線形時間</p>

                <h3>空間計算量: O(m × n)</h3>
                <p>• DPテーブルのサイズに依存</p>
                <p>• 最適化: O(n)に削減可能（前の行のみ保持）</p>
            </div>

            <h2>🔧 核心処理の詳細</h2>
            <div class="code-block">
                if (pChar === '*') { // '*'の2つの解釈: // 1. 空文字列として扱う: dp[i][j-1] // 2.
                1文字以上として扱う: dp[i-1][j] dp[i][j] = dp[i][j - 1] || dp[i - 1][j]; } else if
                (pChar === '?' || pChar === sChar) { // '?'は任意の1文字、または完全一致 dp[i][j] =
                dp[i - 1][j - 1]; }
            </div>

            <div class="example-section">
                <h3>🌟 '*'の処理が重要な理由</h3>
                <p><span class="highlight">dp[i][j-1]</span>: '*'を空文字列として解釈</p>
                <p>
                    <span class="highlight">dp[i-1][j]</span>: '*'を現在の文字を含む文字列として解釈
                </p>
                <p>この2つの論理和により、'*'の柔軟性を完全に表現</p>
            </div>
        </div>

        <script>
            function isMatch(s, p) {
                console.log('isMatch called with:', s, p); // デバッグ用
                const sLen = s.length;
                const pLen = p.length;

                // DPテーブルを正しく初期化
                const dp = [];
                for (let i = 0; i <= sLen; i++) {
                    dp[i] = [];
                    for (let j = 0; j <= pLen; j++) {
                        dp[i][j] = false;
                    }
                }

                // ベースケース
                dp[0][0] = true;

                // パターンの先頭の*を処理
                for (let j = 1; j <= pLen; j++) {
                    if (p[j - 1] === '*') {
                        dp[0][j] = dp[0][j - 1];
                    }
                }

                // DPテーブルを埋める
                for (let i = 1; i <= sLen; i++) {
                    for (let j = 1; j <= pLen; j++) {
                        const sChar = s[i - 1];
                        const pChar = p[j - 1];

                        if (pChar === '*') {
                            dp[i][j] = dp[i][j - 1] || dp[i - 1][j];
                        } else if (pChar === '?' || pChar === sChar) {
                            dp[i][j] = dp[i - 1][j - 1];
                        }
                    }
                }

                return { result: dp[sLen][pLen], dpTable: dp };
            }

            function createDPTable(s, p, dpTable) {
                let html = '<tr><th></th><th class="header-char">ε</th>';

                // パターンのヘッダー
                for (let i = 0; i < p.length; i++) {
                    const char = p[i] === '*' ? '★' : p[i] === '?' ? '？' : p[i];
                    html += `<th class="header-char">${char}</th>`;
                }
                html += '</tr>';

                // 各行を作成
                for (let i = 0; i <= s.length; i++) {
                    html += '<tr>';

                    // 行のヘッダー
                    if (i === 0) {
                        html += '<th class="header-char">ε</th>';
                    } else {
                        html += `<th class="header-char">${s[i - 1]}</th>`;
                    }

                    // 各セル
                    for (let j = 0; j <= p.length; j++) {
                        const cellClass = dpTable[i][j] ? 'true-cell' : 'false-cell';
                        const cellValue = dpTable[i][j] ? 'T' : 'F';
                        html += `<td class="${cellClass}">${cellValue}</td>`;
                    }
                    html += '</tr>';
                }

                return html;
            }

            function analyzePattern() {
                try {
                    const s = document.getElementById('stringInput').value.trim();
                    const p = document.getElementById('patternInput').value.trim();

                    console.log('Analyzing:', s, p); // デバッグ用

                    if (!s && !p) {
                        document.getElementById('analysisResult').innerHTML =
                            '<div style="color: #f39c12;">⚠️ 文字列またはパターンを入力してください</div>';
                        return;
                    }

                    const { result, dpTable } = isMatch(s, p);

                    console.log('Result:', result, dpTable); // デバッグ用

                    const tableElement = document.getElementById('dynamicTable');
                    if (tableElement) {
                        tableElement.innerHTML = createDPTable(s, p, dpTable);
                    }

                    const resultText = result
                        ? `<div style="color: #2ecc71; font-size: 20px; font-weight: bold; margin: 15px 0;">✅ マッチしました!</div>`
                        : `<div style="color: #e74c3c; font-size: 20px; font-weight: bold; margin: 15px 0;">❌ マッチしませんでした</div>`;

                    const resultElement = document.getElementById('analysisResult');
                    if (resultElement) {
                        resultElement.innerHTML = `
                        ${resultText}
                        <div style="background: #ecf0f1; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p><strong>入力:</strong></p>
                            <p>• 文字列 (s): "${s}" (長さ: ${s.length})</p>
                            <p>• パターン (p): "${p}" (長さ: ${p.length})</p>
                            <p><strong>最終結果:</strong> dp[${s.length}][${p.length}] = ${result}</p>
                        </div>
                    `;
                    }
                } catch (error) {
                    console.error('Error in analyzePattern:', error);
                    document.getElementById('analysisResult').innerHTML =
                        `<div style="color: #e74c3c;">エラーが発生しました: ${error.message}</div>`;
                }
            }

            // ページ読み込み完了後に初期表示
            document.addEventListener('DOMContentLoaded', function () {
                console.log('DOM loaded, initializing...');
                analyzePattern();
            });

            // 入力フィールドでEnterキーを押した時も実行
            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('stringInput').addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') analyzePattern();
                });
                document.getElementById('patternInput').addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') analyzePattern();
                });
            });
        </script>
    </body>
</html>
