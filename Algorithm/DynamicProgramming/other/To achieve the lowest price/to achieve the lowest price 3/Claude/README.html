<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>りんご購入アルゴリズム詳細解析</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                padding: 40px;
                backdrop-filter: blur(10px);
            }

            h1 {
                color: #2c3e50;
                text-align: center;
                font-size: 2.5em;
                margin-bottom: 30px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            h2 {
                color: #34495e;
                border-left: 5px solid #3498db;
                padding-left: 15px;
                margin-top: 40px;
                font-size: 1.8em;
            }

            h3 {
                color: #27ae60;
                margin-top: 30px;
                font-size: 1.4em;
            }

            .code-block {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 20px;
                border-radius: 10px;
                font-family: 'Courier New', monospace;
                margin: 15px 0;
                overflow-x: auto;
                box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
                position: relative;
            }

            .code-block::before {
                content: 'JavaScript';
                position: absolute;
                top: -10px;
                right: 10px;
                background: #e74c3c;
                color: white;
                padding: 2px 8px;
                border-radius: 5px;
                font-size: 0.8em;
            }

            .highlight {
                background: #f39c12;
                color: #2c3e50;
                padding: 2px 5px;
                border-radius: 3px;
                font-weight: bold;
            }

            .algorithm-box {
                background: linear-gradient(135deg, #74b9ff, #0984e3);
                color: white;
                padding: 25px;
                border-radius: 15px;
                margin: 20px 0;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            }

            .step-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                margin: 20px 0;
            }

            .step {
                flex: 1;
                min-width: 300px;
                background: #ecf0f1;
                border-radius: 10px;
                padding: 20px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease;
            }

            .step:hover {
                transform: translateY(-5px);
            }

            .step-number {
                background: #e74c3c;
                color: white;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-bottom: 10px;
            }

            .dp-table {
                background: white;
                border-radius: 10px;
                overflow: hidden;
                margin: 20px 0;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            }

            .dp-table table {
                width: 100%;
                border-collapse: collapse;
            }

            .dp-table th,
            .dp-table td {
                padding: 12px;
                text-align: center;
                border: 1px solid #ddd;
            }

            .dp-table th {
                background: #3498db;
                color: white;
                font-weight: bold;
            }

            .dp-table .updated {
                background: #2ecc71;
                color: white;
                font-weight: bold;
                animation: highlight 1s ease-in-out;
            }

            @keyframes highlight {
                0% {
                    background: #f39c12;
                }

                100% {
                    background: #2ecc71;
                }
            }

            .complexity-box {
                background: linear-gradient(135deg, #a29bfe, #6c5ce7);
                color: white;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
            }

            .memory-diagram {
                background: #f8f9fa;
                border: 2px solid #dee2e6;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                position: relative;
            }

            .array-visualization {
                display: flex;
                gap: 5px;
                margin: 15px 0;
                flex-wrap: wrap;
            }

            .array-cell {
                width: 60px;
                height: 40px;
                border: 2px solid #3498db;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #ecf0f1;
                border-radius: 5px;
                font-weight: bold;
                transition: all 0.3s ease;
            }

            .array-cell.infinity {
                background: #e74c3c;
                color: white;
            }

            .array-cell.updated {
                background: #2ecc71;
                color: white;
            }

            .flow-diagram {
                background: #f8f9fa;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                text-align: center;
            }

            .flow-step {
                display: inline-block;
                background: #3498db;
                color: white;
                padding: 10px 20px;
                border-radius: 25px;
                margin: 5px;
                position: relative;
            }

            .flow-step::after {
                content: '→';
                position: absolute;
                right: -15px;
                top: 50%;
                transform: translateY(-50%);
                color: #3498db;
                font-weight: bold;
            }

            .flow-step:last-child::after {
                display: none;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>🍎 りんご購入アルゴリズム詳細解析</h1>

            <h2>📋 問題の概要</h2>
            <div class="algorithm-box">
                <p><strong>目標：</strong> n個以上のりんごを最小コストで購入する</p>
                <p><strong>制約条件：</strong></p>
                <ul>
                    <li>パック1: x個のりんごがa円</li>
                    <li>パック2: y個のりんごがb円</li>
                    <li>x < y, a < b（より大きいパックは必ずしも効率的ではない）</li>
                    <li>n+1個以上買ってもよい（余分に買うことで安くなる可能性）</li>
                </ul>
            </div>

            <h2>🔍 アルゴリズムの全体フロー</h2>
            <div class="flow-diagram">
                <div class="flow-step">入力読み取り</div>
                <div class="flow-step">DP配列初期化</div>
                <div class="flow-step">状態遷移計算</div>
                <div class="flow-step">最小値探索</div>
                <div class="flow-step">結果出力</div>
            </div>

            <h2>💻 コード詳細解析</h2>

            <h3>1. 入力処理とメモリ効率</h3>
            <div class="code-block">
                const input = fs.readFileSync('/dev/stdin', 'utf8').trim(); const [n, x, a, y, b] =
                input.split(' ').map(Number);
            </div>
            <p>
                <span class="highlight">同期読み取り</span
                >を使用することで、大きなファイルでもメモリ使用量を最小限に抑制。非同期処理のオーバーヘッドも回避。
            </p>

            <h3>2. DP配列のサイズ最適化</h3>
            <div class="code-block">
                const maxApples = n + Math.max(x, y) - 1; const dp = new Array(maxApples +
                1).fill(Infinity);
            </div>
            <div class="memory-diagram">
                <h4>📊 メモリ最適化の理論</h4>
                <p>なぜ <code>n + max(x,y) - 1</code> で十分なのか？</p>
                <ul>
                    <li>n個必要 → n個以上を考慮する必要がある</li>
                    <li>最悪でも max(x,y) - 1 個の無駄が発生</li>
                    <li>それ以上買っても必ず別の組み合わせで安くできる</li>
                </ul>
                <p><strong>例：</strong> n=4, x=2, y=5 の場合</p>
                <p>maxApples = 4 + 5 - 1 = 8 → インデックス0〜8の9要素</p>
            </div>

            <h3>3. 動的計画法の状態遷移</h3>
            <div class="code-block">
                for (let i = 0; i <= maxApples; i++) { if (dp[i]===Infinity) continue; //
                x個パック購入 const nextX=Math.min(i + x, maxApples); dp[nextX]=Math.min(dp[nextX],
                dp[i] + a); // y個パック購入 const nextY=Math.min(i + y, maxApples);
                dp[nextY]=Math.min(dp[nextY], dp[i] + b); }
            </div>

            <h2>🔢 具体例での動作追跡 (n=4, x=2, a=110, y=5, b=200)</h2>

            <div class="step-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <h4>初期化</h4>
                    <p>maxApples = 4 + 5 - 1 = 8</p>
                    <p>dp = [0, ∞, ∞, ∞, ∞, ∞, ∞, ∞, ∞]</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h4>i=0での遷移</h4>
                    <p>2個パック: dp[2] = min(∞, 0+110) = 110</p>
                    <p>5個パック: dp[5] = min(∞, 0+200) = 200</p>
                </div>
            </div>

            <div class="dp-table">
                <h4>📈 DP配列の状態変化</h4>
                <table>
                    <tr>
                        <th>りんご個数</th>
                        <th>0</th>
                        <th>1</th>
                        <th>2</th>
                        <th>3</th>
                        <th>4</th>
                        <th>5</th>
                        <th>6</th>
                        <th>7</th>
                        <th>8</th>
                    </tr>
                    <tr>
                        <td><strong>初期状態</strong></td>
                        <td>0</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td>∞</td>
                    </tr>
                    <tr>
                        <td><strong>i=0処理後</strong></td>
                        <td>0</td>
                        <td>∞</td>
                        <td class="updated">110</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td class="updated">200</td>
                        <td>∞</td>
                        <td>∞</td>
                        <td>∞</td>
                    </tr>
                    <tr>
                        <td><strong>i=2処理後</strong></td>
                        <td>0</td>
                        <td>∞</td>
                        <td>110</td>
                        <td>∞</td>
                        <td class="updated">220</td>
                        <td>200</td>
                        <td>∞</td>
                        <td class="updated">310</td>
                        <td>∞</td>
                    </tr>
                    <tr>
                        <td><strong>i=5処理後</strong></td>
                        <td>0</td>
                        <td>∞</td>
                        <td>110</td>
                        <td>∞</td>
                        <td>220</td>
                        <td>200</td>
                        <td>∞</td>
                        <td class="updated">310</td>
                        <td class="updated">400</td>
                    </tr>
                    <tr>
                        <td><strong>最終状態</strong></td>
                        <td>0</td>
                        <td>∞</td>
                        <td>110</td>
                        <td>∞</td>
                        <td>220</td>
                        <td>200</td>
                        <td>310</td>
                        <td>310</td>
                        <td>400</td>
                    </tr>
                </table>
            </div>

            <h3>🎯 状態遷移の詳細</h3>
            <div class="step-container">
                <div class="step">
                    <div class="step-number">i=0</div>
                    <h4>0個の状態から</h4>
                    <p>
                        <strong>2個パック購入:</strong><br />
                        dp[0+2] = dp[2] = min(∞, 0+110) = 110
                    </p>
                    <p>
                        <strong>5個パック購入:</strong><br />
                        dp[0+5] = dp[5] = min(∞, 0+200) = 200
                    </p>
                </div>
                <div class="step">
                    <div class="step-number">i=2</div>
                    <h4>2個の状態から</h4>
                    <p>
                        <strong>2個パック追加購入:</strong><br />
                        dp[2+2] = dp[4] = min(∞, 110+110) = 220
                    </p>
                    <p>
                        <strong>5個パック追加購入:</strong><br />
                        dp[2+5] = dp[7] = min(∞, 110+200) = 310
                    </p>
                </div>
                <div class="step">
                    <div class="step-number">i=5</div>
                    <h4>5個の状態から</h4>
                    <p>
                        <strong>2個パック追加購入:</strong><br />
                        dp[5+2] = dp[7] = min(310, 200+110) = 310
                    </p>
                    <p>
                        <strong>5個パック追加購入:</strong><br />
                        dp[5+5] = dp[8] = min(∞, 200+200) = 400
                    </p>
                </div>
            </div>

            <h3>🔍 最小値探索</h3>
            <div class="code-block">
                let minCost = Infinity; for (let i = n; i <= maxApples; i++) {
                minCost=Math.min(minCost, dp[i]); }
            </div>
            <div class="algorithm-box">
                <p><strong>n=4の場合の候補:</strong></p>
                <ul>
                    <li>dp[4] = 220 (2個パック × 2)</li>
                    <li>dp[5] = 200 (5個パック × 1) ← <span class="highlight">最小値</span></li>
                    <li>dp[6] = 310 (2個パック + 5個パック)</li>
                    <li>dp[7] = 310 (2個パック + 5個パック)</li>
                    <li>dp[8] = 400 (5個パック × 2)</li>
                </ul>
                <p><strong>答え: 200円</strong></p>
            </div>

            <h2>⚡ 計算量とメモリ効率の分析</h2>

            <div class="complexity-box">
                <h3>🕐 時間計算量</h3>
                <p><strong>O(n × max(x, y))</strong></p>
                <ul>
                    <li>外側ループ: maxApples + 1 = n + max(x,y) 回</li>
                    <li>内側処理: 定数時間 O(1)</li>
                    <li>最大でも O(n + max(x,y)) ≈ O(n) (制約下では)</li>
                </ul>

                <h3>💾 空間計算量</h3>
                <p><strong>O(n + max(x, y))</strong></p>
                <ul>
                    <li>DP配列: n + max(x,y) 要素</li>
                    <li>その他: 定数空間</li>
                    <li>制約 n≤1000, x,y≤1000 下では最大2000要素</li>
                </ul>
            </div>

            <h2>🚀 最適化ポイント</h2>

            <div class="step-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <h4>配列サイズ最適化</h4>
                    <p>理論的最小サイズでメモリ使用量を削減</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h4>早期スキップ</h4>
                    <p>dp[i] === Infinity の状態をスキップして無駄な計算を回避</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h4>境界チェック</h4>
                    <p>Math.min()で配列範囲外アクセスを防止</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h4>同期I/O</h4>
                    <p>大きな入力でもメモリ効率的な読み取り</p>
                </div>
            </div>

            <div class="algorithm-box">
                <h3>🎯 アルゴリズムの特徴</h3>
                <p>
                    この動的計画法の解法は、<strong>貪欲法では解けない</strong>問題を効率的に解決します。
                </p>
                <p>
                    <strong>理由:</strong>
                    大きなパックを買うことで小さなパックを複数買うより安くなる場合があり、局所最適解では全体最適解にならないため。
                </p>
            </div>
        </div>
    </body>
</html>
