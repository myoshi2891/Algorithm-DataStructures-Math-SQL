<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Binary Search Algorithm Analysis</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }

            h1,
            h2 {
                color: #2c3e50;
                text-align: center;
            }

            h1 {
                border-bottom: 3px solid #3498db;
                padding-bottom: 10px;
                margin-bottom: 30px;
            }

            .example-section {
                margin: 30px 0;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border-left: 5px solid #3498db;
            }

            .array-container {
                display: flex;
                justify-content: center;
                margin: 20px 0;
                flex-wrap: wrap;
            }

            .array-cell {
                width: 60px;
                height: 60px;
                border: 2px solid #34495e;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 2px;
                font-weight: bold;
                font-size: 16px;
                border-radius: 8px;
                position: relative;
            }

            .array-cell.target {
                background: #e74c3c;
                color: white;
                animation: pulse 1s infinite;
            }

            .array-cell.found {
                background: #27ae60;
                color: white;
            }

            .array-cell.left {
                background: #3498db;
                color: white;
            }

            .array-cell.right {
                background: #9b59b6;
                color: white;
            }

            .array-cell.mid {
                background: #f39c12;
                color: white;
                animation: highlight 0.8s ease-in-out;
            }

            .array-cell.eliminated {
                background: #bdc3c7;
                color: #7f8c8d;
                opacity: 0.5;
            }

            .index-label {
                position: absolute;
                bottom: -25px;
                font-size: 12px;
                color: #7f8c8d;
            }

            .pointer-label {
                position: absolute;
                top: -30px;
                font-size: 12px;
                font-weight: bold;
            }

            .left-pointer {
                color: #3498db;
            }

            .right-pointer {
                color: #9b59b6;
            }

            .mid-pointer {
                color: #f39c12;
            }

            .step-info {
                background: #ecf0f1;
                padding: 15px;
                border-radius: 8px;
                margin: 15px 0;
                border-left: 4px solid #2ecc71;
            }

            .complexity-box {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                text-align: center;
            }

            .algorithm-flow {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin: 20px 0;
            }

            .flow-step {
                background: #fff;
                border: 2px solid #3498db;
                border-radius: 10px;
                padding: 15px;
                text-align: center;
                position: relative;
            }

            .flow-step::after {
                content: '↓';
                position: absolute;
                bottom: -30px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 20px;
                color: #3498db;
            }

            .flow-step:last-child::after {
                display: none;
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.05);
                }

                100% {
                    transform: scale(1);
                }
            }

            @keyframes highlight {
                0% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.1);
                }

                100% {
                    transform: scale(1);
                }
            }

            .controls {
                text-align: center;
                margin: 20px 0;
            }

            button {
                background: #3498db;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                margin: 0 5px;
                font-size: 14px;
                transition: background 0.3s;
            }

            button:hover {
                background: #2980b9;
            }

            button:disabled {
                background: #bdc3c7;
                cursor: not-allowed;
            }

            .visualization-area {
                min-height: 200px;
                margin: 20px 0;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>🔍 Binary Search Algorithm - 詳細解析</h1>

            <div class="complexity-box">
                <h3>計算量分析</h3>
                <p><strong>時間計算量:</strong> O(log n) - 各ステップで検索範囲を半分に削減</p>
                <p><strong>空間計算量:</strong> O(1) - 定数の追加メモリのみ使用</p>
            </div>

            <div class="algorithm-flow">
                <div class="flow-step">
                    <h4>1. 初期化</h4>
                    <p>left = 0<br />right = n-1</p>
                </div>
                <div class="flow-step">
                    <h4>2. 中点計算</h4>
                    <p>mid = left + ⌊(right-left)/2⌋</p>
                </div>
                <div class="flow-step">
                    <h4>3. 比較</h4>
                    <p>nums[mid] と target を比較</p>
                </div>
                <div class="flow-step">
                    <h4>4. 範囲更新</h4>
                    <p>条件に応じて left または right を更新</p>
                </div>
            </div>

            <h2>📊 実例による段階的解析</h2>

            <div class="controls">
                <label for="example-select">例を選択: </label>
                <select id="example-select">
                    <option value="example1">例1: [1,3,5,6], target=5 (存在する場合)</option>
                    <option value="example2">例2: [1,3,5,6], target=2 (挿入位置)</option>
                    <option value="example3">例3: [1,3,5,6], target=7 (末尾挿入)</option>
                </select>
                <button onclick="startVisualization()">可視化開始</button>
                <button onclick="nextStep()" id="next-btn" disabled>次のステップ</button>
                <button onclick="reset()">リセット</button>
            </div>

            <div class="visualization-area" id="visualization">
                <!-- 動的に生成される可視化コンテンツ -->
            </div>

            <div class="example-section">
                <h3>🎯 アルゴリズムの核心理解</h3>
                <div class="step-info">
                    <strong>なぜ O(log n) なのか？</strong><br />
                    各ステップで検索範囲を半分に削減するため、最大でも log₂(n)
                    回の比較で完了します。 例: n=1000の場合、最大10回の比較で結果が得られます。
                </div>
                <div class="step-info">
                    <strong>挿入位置の判定</strong><br />
                    ターゲットが見つからない場合、leftポインターが自然に正しい挿入位置を指します。
                    これは、leftが常に「ターゲット以上の最小要素の位置」を維持するためです。
                </div>
            </div>
        </div>

        <script>
            const examples = {
                example1: {
                    nums: [1, 3, 5, 6],
                    target: 5,
                    title: '例1: ターゲットが存在する場合 (target=5)',
                },
                example2: {
                    nums: [1, 3, 5, 6],
                    target: 2,
                    title: '例2: ターゲットが存在しない場合 (target=2)',
                },
                example3: {
                    nums: [1, 3, 5, 6],
                    target: 7,
                    title: '例3: 末尾への挿入 (target=7)',
                },
            };

            let currentExample = null;
            let currentStep = 0;
            let steps = [];

            function generateSteps(nums, target) {
                const steps = [];
                let left = 0;
                let right = nums.length - 1;

                steps.push({
                    left: left,
                    right: right,
                    mid: null,
                    description: `初期状態: left=${left}, right=${right}`,
                    action: 'init',
                });

                while (left <= right) {
                    const mid = left + Math.floor((right - left) / 2);

                    steps.push({
                        left: left,
                        right: right,
                        mid: mid,
                        description: `中点計算: mid=${mid}, nums[${mid}]=${nums[mid]}`,
                        action: 'calculate_mid',
                    });

                    if (nums[mid] === target) {
                        steps.push({
                            left: left,
                            right: right,
                            mid: mid,
                            description: `発見！ nums[${mid}] = ${target}`,
                            action: 'found',
                            result: mid,
                        });
                        break;
                    } else if (nums[mid] < target) {
                        steps.push({
                            left: left,
                            right: right,
                            mid: mid,
                            description: `nums[${mid}] < ${target} なので右半分を検索`,
                            action: 'go_right',
                        });
                        left = mid + 1;
                    } else {
                        steps.push({
                            left: left,
                            right: right,
                            mid: mid,
                            description: `nums[${mid}] > ${target} なので左半分を検索`,
                            action: 'go_left',
                        });
                        right = mid - 1;
                    }
                }

                if (steps[steps.length - 1].action !== 'found') {
                    steps.push({
                        left: left,
                        right: right,
                        mid: null,
                        description: `挿入位置: ${left}`,
                        action: 'insert',
                        result: left,
                    });
                }

                return steps;
            }

            function renderStep(nums, target, step) {
                const container = document.getElementById('visualization');

                let html = `
                <div class="example-section">
                    <h3>${currentExample.title}</h3>
                    <div class="step-info">
                        <strong>ステップ ${currentStep + 1}:</strong> ${step.description}
                    </div>
                    <div class="array-container">
            `;

                nums.forEach((num, index) => {
                    let classes = ['array-cell'];
                    let pointerLabel = '';

                    if (step.left === index) {
                        classes.push('left');
                        pointerLabel += '<span class="pointer-label left-pointer">L</span>';
                    }
                    if (step.right === index) {
                        classes.push('right');
                        pointerLabel += '<span class="pointer-label right-pointer">R</span>';
                    }
                    if (step.mid === index) {
                        classes.push('mid');
                        pointerLabel += '<span class="pointer-label mid-pointer">M</span>';
                    }

                    if (step.action === 'found' && step.mid === index) {
                        classes.push('found');
                    }

                    if (
                        (step.action === 'go_right' && index <= step.mid) ||
                        (step.action === 'go_left' && index >= step.mid)
                    ) {
                        if (step.mid !== index) {
                            classes.push('eliminated');
                        }
                    }

                    html += `
                    <div class="${classes.join(' ')}">
                        ${pointerLabel}
                        ${num}
                        <span class="index-label">${index}</span>
                    </div>
                `;
                });

                html += `
                    </div>
                    <div class="step-info">
                        <strong>現在の状態:</strong><br>
                        Left = ${step.left}, Right = ${step.right}${step.mid !== null ? `, Mid = ${step.mid}` : ''}<br>
                        Target = ${target}
                    </div>
            `;

                if (step.result !== undefined) {
                    html += `
                    <div class="step-info" style="border-left-color: #27ae60;">
                        <strong>結果:</strong> ${step.action === 'found' ? 'インデックス' : '挿入位置'} = ${step.result}
                    </div>
                `;
                }

                html += `</div>`;
                container.innerHTML = html;
            }

            function startVisualization() {
                const selectedExample = document.getElementById('example-select').value;
                currentExample = examples[selectedExample];
                steps = generateSteps(currentExample.nums, currentExample.target);
                currentStep = 0;

                renderStep(currentExample.nums, currentExample.target, steps[currentStep]);

                document.getElementById('next-btn').disabled = false;
            }

            function nextStep() {
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    renderStep(currentExample.nums, currentExample.target, steps[currentStep]);
                }

                if (currentStep >= steps.length - 1) {
                    document.getElementById('next-btn').disabled = true;
                }
            }

            function reset() {
                currentStep = 0;
                document.getElementById('visualization').innerHTML =
                    '<p style="text-align: center; color: #7f8c8d;">例を選択して「可視化開始」ボタンをクリックしてください</p>';
                document.getElementById('next-btn').disabled = true;
            }

            // 初期化
            reset();
        </script>
    </body>
</html>
