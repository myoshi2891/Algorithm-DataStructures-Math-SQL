<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>LeetCode: 89 Gray Code（Bit formula i XOR i&gt;&gt;1）— 単一HTML解説</title>
        <meta
            name="description"
            content="LeetCode 89 Gray Code を Python で解説。公式ビット式 G(i)=i XOR (i&gt;&gt;1) による O(2^n) 生成。ステップ可視化、静的SVG図、Prismによるコード表示つきの単一HTML。"
        />
        <meta property="og:title" content="LeetCode: 89 Gray Code — 単一HTML解説" />
        <meta
            property="og:description"
            content="公式ビット式による最速実装、可視化、計算量、Pythonコード（LeetCode形式）。"
        />
        <meta property="og:type" content="article" />
        <meta name="color-scheme" content="light" />

        <!-- Tailwind CSS -->
        <script src="/vendor/tailwindcss/script.js"></script>
        <script>
            // Tailwind theme tweak: Emerald / Sky / Slate
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            brand: {
                                primary: '#10b981', // emerald-500
                                primaryLight: '#a7f3d0', // emerald-200
                                sky: '#38bdf8', // sky-400
                                slate: '#334155', // slate-700
                                border: '#e6e8ef',
                            },
                        },
                    },
                },
            };
        </script>
        <!-- Prism CSS（テーマ） -->
        <link
            rel="stylesheet"
            href="/vendor/prismjs/themes/prism.css"
        />

        <!-- Prism CSS（プラグイン：line-numbers / toolbar）※ copy-to-clipboard に CSS は不要 -->
        <link
            rel="stylesheet"
            href="/vendor/prismjs/plugins/line-numbers/prism-line-numbers.css"
        />
        <link
            rel="stylesheet"
            href="/vendor/prismjs/plugins/toolbar/prism-toolbar.css"
        />

        <!-- Prism JS（コア） -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>

        <!-- 言語（Python） -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

        <!-- プラグインの読み込み順に注意：toolbar → copy-to-clipboard → line-numbers -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

        <!-- Page CSS tweaks -->
        <style>
            html {
                scroll-behavior: smooth;
            }
            :root {
                --code-lh: 1.6;
            }
            pre[class*='language-'],
            pre[class*='language-'] > code {
                line-height: var(--code-lh) !important;
                white-space: pre !important;
                word-break: normal !important;
                overflow-wrap: normal !important;
                font-family:
                    'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                    'Liberation Mono', 'Courier New', monospace;
            }
            pre.line-numbers {
                padding-left: 3.2em !important;
            }
            .line-numbers .line-numbers-rows {
                width: 3.2em;
            }
            .line-numbers .line-numbers-rows > span {
                height: calc(var(--code-lh) * 1em);
            }
            /* Prism toolbar cosmetic */
            div.code-toolbar > .toolbar .toolbar-item > button,
            div.code-toolbar > .toolbar .toolbar-item > a {
                background: #fff;
                border: 1px solid #e6e8ef;
                border-radius: 0.5rem;
                padding: 0.8rem 1.2rem;
                margin: 1rem 1rem 0 0;
                font:
                    600 13px/1.2 Inter,
                    system-ui,
                    -apple-system,
                    'Segoe UI',
                    'Helvetica Neue',
                    Arial,
                    sans-serif;
                color: #334155;
                box-shadow: 0 2px 6px rgba(20, 32, 70, 0.06);
                transition:
                    transform 0.15s,
                    box-shadow 0.15s,
                    background 0.15s;
            }
            div.code-toolbar > .toolbar .toolbar-item > button:hover {
                transform: translateY(-1px);
                box-shadow: 0 10px 28px rgba(20, 32, 70, 0.08);
                background: linear-gradient(180deg, #e8fff6, #c8f1e1);
            }
            /* Stage transitions */
            .stage {
                transition:
                    opacity 0.25s ease,
                    transform 0.25s ease;
                opacity: 0;
                transform: translateY(4px);
            }
            .stage.active {
                opacity: 1;
                transform: translateY(0);
            }
            @media (prefers-reduced-motion: reduce) {
                .stage {
                    transition: none;
                }
                div.code-toolbar > .toolbar .toolbar-item > button:hover {
                    transform: none;
                    box-shadow: none;
                }
            }
        </style>
    </head>

    <body class="bg-white text-slate-800 antialiased">
        <!-- Header / Hero -->
        <header class="border-b border-[color:var(--border,#e6e8ef)]">
            <div class="max-w-6xl mx-auto px-4 py-10">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-900">
                    LeetCode: 89 Gray Code — Bit formula i XOR i&gt;&gt;1
                </h1>
                <p class="mt-2 text-slate-600">
                    公式ビット式
                    <code class="px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700"
                        >G(i) = i XOR (i&gt;&gt;1)</code
                    >
                    により、隣接が1ビット差の巡回列を O(2^n) で生成します。
                </p>

                <!-- Nav -->
                <nav class="mt-6 flex flex-wrap gap-2" aria-label="Section navigation">
                    <a
                        href="#overview"
                        class="px-3 py-2 rounded-xl border hover:shadow-sm transition text-slate-700 hover:text-slate-900"
                        aria-label="概要へ移動"
                        >概要</a
                    >
                    <a
                        href="#steps"
                        class="px-3 py-2 rounded-xl border hover:shadow-sm transition text-slate-700 hover:text-slate-900"
                        aria-label="ステップへ移動"
                        >ステップ</a
                    >
                    <a
                        href="#code"
                        class="px-3 py-2 rounded-xl border hover:shadow-sm transition text-slate-700 hover:text-slate-900"
                        aria-label="コードへ移動"
                        >コード</a
                    >
                    <a
                        href="#diagram"
                        class="px-3 py-2 rounded-xl border hover:shadow-sm transition text-slate-700 hover:text-slate-900"
                        aria-label="図解へ移動"
                        >図解</a
                    >
                    <a
                        href="#complexity"
                        class="px-3 py-2 rounded-xl border hover:shadow-sm transition text-slate-700 hover:text-slate-900"
                        aria-label="計算量へ移動"
                        >計算量</a
                    >
                </nav>
            </div>
        </header>

        <main class="max-w-6xl mx-auto px-4 py-10 space-y-12">
            <!-- Overview -->
            <section id="overview" class="scroll-mt-24">
                <div class="bg-white border rounded-2xl p-6 shadow-sm">
                    <h2 class="text-2xl font-bold text-slate-900">アルゴリズム概要</h2>
                    <p class="mt-3 text-slate-700">
                        入力 <b>n</b> に対し長さ <b>2^n</b> の Gray Code
                        を生成します。隣接要素（末尾と先頭を含む）が常に1ビットだけ異なる巡回列です。<br />
                        最短かつ実装容易な方法は、整数 <code>i</code> に対し
                        <code>G(i) = i XOR (i&gt;&gt;1)</code> を適用し、<code>i=0..2^n-1</code>
                        を一括生成する手法です。
                    </p>
                </div>
            </section>

            <!-- Steps + Visualization -->
            <section id="steps" class="scroll-mt-24">
                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Steps list -->
                    <div class="bg-white border rounded-2xl p-6 shadow-sm">
                        <h2 class="text-2xl font-bold text-slate-900 mb-4">
                            ステップバイステップ解説
                        </h2>
                        <ol class="space-y-2">
                            <!-- role=button for A11y -->
                            <li
                                role="button"
                                tabindex="0"
                                data-step-target="1"
                                aria-pressed="true"
                                class="group flex items-start gap-3 p-3 rounded-xl border cursor-pointer hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                title="Step 1: サイズ m を計算"
                            >
                                <span
                                    class="mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full bg-emerald-500 text-white text-sm font-semibold select-none"
                                    >1</span
                                >
                                <div>
                                    <div class="font-semibold text-slate-900">サイズ m を計算</div>
                                    <p class="text-slate-600 text-sm">
                                        m = 1 &lt;&lt; n を計算し、結果リストの長さを決めます。
                                    </p>
                                </div>
                            </li>

                            <li
                                role="button"
                                tabindex="0"
                                data-step-target="2"
                                aria-pressed="false"
                                class="group flex items-start gap-3 p-3 rounded-xl border cursor-pointer hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                title="Step 2: i を 0 から m-1 まで反復"
                            >
                                <span
                                    class="mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full bg-emerald-500 text-white text-sm font-semibold select-none"
                                    >2</span
                                >
                                <div>
                                    <div class="font-semibold text-slate-900">
                                        i を 0 から m-1 まで反復
                                    </div>
                                    <p class="text-slate-600 text-sm">
                                        range を用いて i を順に処理します。
                                    </p>
                                </div>
                            </li>

                            <li
                                role="button"
                                tabindex="0"
                                data-step-target="3"
                                aria-pressed="false"
                                class="group flex items-start gap-3 p-3 rounded-xl border cursor-pointer hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                title="Step 3: Gray 値を計算"
                            >
                                <span
                                    class="mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full bg-emerald-500 text-white text-sm font-semibold select-none"
                                    >3</span
                                >
                                <div>
                                    <div class="font-semibold text-slate-900">Gray 値を計算</div>
                                    <p class="text-slate-600 text-sm">
                                        code = i XOR（i を 1 ビット右シフト）を計算します。
                                    </p>
                                </div>
                            </li>

                            <li
                                role="button"
                                tabindex="0"
                                data-step-target="4"
                                aria-pressed="false"
                                class="group flex items-start gap-3 p-3 rounded-xl border cursor-pointer hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                title="Step 4: 結果に追加し完了"
                            >
                                <span
                                    class="mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full bg-emerald-500 text-white text-sm font-semibold select-none"
                                    >4</span
                                >
                                <div>
                                    <div class="font-semibold text-slate-900">結果に追加し完了</div>
                                    <p class="text-slate-600 text-sm">
                                        code を結果リストに追加し、全 i が終われば完成です。
                                    </p>
                                </div>
                            </li>
                        </ol>

                        <!-- Controls -->
                        <div class="mt-6 flex flex-wrap gap-2">
                            <button
                                type="button"
                                data-action="play"
                                class="px-4 py-2 rounded-xl border text-slate-800 hover:shadow-sm transition focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                aria-label="Play steps"
                            >
                                Play
                            </button>
                            <button
                                type="button"
                                data-action="prev"
                                class="px-4 py-2 rounded-xl border text-slate-800 hover:shadow-sm transition focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                aria-label="Previous step"
                            >
                                Prev
                            </button>
                            <button
                                type="button"
                                data-action="next"
                                class="px-4 py-2 rounded-xl border text-slate-800 hover:shadow-sm transition focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                aria-label="Next step"
                            >
                                Next
                            </button>
                            <button
                                type="button"
                                data-action="reset"
                                class="px-4 py-2 rounded-xl border text-slate-800 hover:shadow-sm transition focus:outline-none focus:ring-2 focus:ring-emerald-400"
                                aria-label="Reset to step 1"
                            >
                                Reset
                            </button>
                        </div>
                        <p class="mt-2 text-xs text-slate-500">
                            Play は 1 回のみ再生。最後に自動的に Step 1 に戻ります。
                        </p>
                    </div>

                    <!-- SVG visualization -->
                    <div class="bg-white border rounded-2xl p-6 shadow-sm">
                        <h2 class="text-2xl font-bold text-slate-900 mb-4">可視化（SVG）</h2>

                        <!-- Stage 1 -->
                        <svg
                            class="stage active w-full h-64"
                            viewBox="0 0 900 300"
                            data-step="1"
                            aria-hidden="false"
                            role="img"
                        >
                            <rect
                                x="40"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#ecfeff"
                                stroke="#38bdf8"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="220"
                                y="90"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                m = 1 &lt;&lt; n を計算
                            </text>

                            <rect
                                x="460"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#ecfdf5"
                                stroke="#10b981"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="640"
                                y="90"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                結果リストを用意
                            </text>

                            <line
                                x1="400"
                                y1="85"
                                x2="460"
                                y2="85"
                                stroke="#334155"
                                stroke-width="2"
                                marker-end="url(#arrow1)"
                            ></line>
                            <defs>
                                <marker
                                    id="arrow1"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="6"
                                    refY="3"
                                    orient="auto"
                                >
                                    <path d="M0,0 L0,6 L9,3 z" fill="#334155"></path>
                                </marker>
                            </defs>
                        </svg>

                        <!-- Stage 2 -->
                        <svg
                            class="stage w-full h-64 hidden"
                            viewBox="0 0 900 300"
                            data-step="2"
                            aria-hidden="true"
                            role="img"
                        >
                            <rect
                                x="40"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#f0f9ff"
                                stroke="#38bdf8"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="220"
                                y="90"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                i を 0 から m-1 まで反復
                            </text>

                            <rect
                                x="460"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#f0fdf4"
                                stroke="#10b981"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="640"
                                y="90"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                各 i について Gray 値を計算
                            </text>

                            <line
                                x1="400"
                                y1="85"
                                x2="460"
                                y2="85"
                                stroke="#334155"
                                stroke-width="2"
                                marker-end="url(#arrow2)"
                            ></line>
                            <defs>
                                <marker
                                    id="arrow2"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="6"
                                    refY="3"
                                    orient="auto"
                                >
                                    <path d="M0,0 L0,6 L9,3 z" fill="#334155"></path>
                                </marker>
                            </defs>
                        </svg>

                        <!-- Stage 3 -->
                        <svg
                            class="stage w-full h-64 hidden"
                            viewBox="0 0 900 300"
                            data-step="3"
                            aria-hidden="true"
                            role="img"
                        >
                            <rect
                                x="40"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#f0f9ff"
                                stroke="#38bdf8"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="250"
                                y="72"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                <tspan x="230" dy="0">code = i XOR</tspan>
                                <tspan x="230" dy="35">（i を 1 ビット右シフト）</tspan>
                            </text>

                            <rect
                                x="500"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#fefce8"
                                stroke="#f59e0b"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="680"
                                y="90"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                隣接要素は 1 ビットだけ異なる
                            </text>

                            <line
                                x1="400"
                                y1="85"
                                x2="500"
                                y2="85"
                                stroke="#334155"
                                stroke-width="2"
                                marker-end="url(#arrow3)"
                            ></line>
                            <defs>
                                <marker
                                    id="arrow3"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="6"
                                    refY="3"
                                    orient="auto"
                                >
                                    <path d="M0,0 L0,6 L9,3 z" fill="#334155"></path>
                                </marker>
                            </defs>
                        </svg>

                        <!-- Stage 4 -->
                        <svg
                            class="stage w-full h-64 hidden"
                            viewBox="0 0 900 300"
                            data-step="4"
                            aria-hidden="true"
                            role="img"
                        >
                            <rect
                                x="40"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#ecfdf5"
                                stroke="#10b981"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="220"
                                y="90"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                code を結果に追加
                            </text>

                            <rect
                                x="460"
                                y="40"
                                width="360"
                                height="90"
                                rx="14"
                                fill="#eef2ff"
                                stroke="#6366f1"
                                stroke-width="2"
                            ></rect>
                            <text
                                x="640"
                                y="90"
                                text-anchor="middle"
                                font-family="Inter, Arial"
                                font-size="24"
                                font-weight="bold"
                                fill="#0f172a"
                            >
                                i が m に達したら完了
                            </text>

                            <line
                                x1="400"
                                y1="85"
                                x2="460"
                                y2="85"
                                stroke="#334155"
                                stroke-width="2"
                                marker-end="url(#arrow4)"
                            ></line>
                            <defs>
                                <marker
                                    id="arrow4"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="6"
                                    refY="3"
                                    orient="auto"
                                >
                                    <path d="M0,0 L0,6 L9,3 z" fill="#334155"></path>
                                </marker>
                            </defs>
                        </svg>

                        <p class="mt-3 text-sm text-slate-600">
                            各ステップの処理内容を日本語で表示しています。長い文は改行し、矩形サイズと
                            viewBox を拡大してはみ出しを防止しています。
                        </p>
                    </div>
                </div>
            </section>

            <!-- Code -->
            <section id="code" class="scroll-mt-24">
                <div class="bg-white border rounded-2xl p-6 shadow-sm">
                    <h2 class="text-2xl font-bold text-slate-900">
                        コード例（Python / LeetCode形式）
                    </h2>
                    <p class="mt-2 text-slate-700">
                        クラス形式・pylance適合の型注釈付き。行番号とコピーに対応しています。
                    </p>
                    <pre
                        class="language-python line-numbers whitespace-pre leading-[1.6] overflow-x-auto mt-4"
                    ><code class="language-python">from __future__ import annotations
from typing import List

class Solution:
    &quot;&quot;&quot;
    Gray Code generator
    LeetCode提出想定 (Python 3.11+, pylance対応)
    &quot;&quot;&quot;

    def grayCode(self, n: int) -> List[int]:
        &quot;&quot;&quot;
        Args:
            n (int): bit length (1 &lt;= n &lt;= 16)

        Returns:
            List[int]: Gray code sequence starting from 0

        Complexity:
            Time: O(2^n)
            Space: O(2^n)
        &quot;&quot;&quot;
        m: int = 1 &lt;&lt; n
        # 内包表記で高速構築。各 i に対し i ^ (i &gt;&gt; 1) を計算。
        result: List[int] = [(i ^ (i &gt;&gt; 1)) for i in range(m)]
        return result
</code></pre>
                </div>
            </section>

            <!-- Static SVG Diagram (not Mermaid) -->
            <section id="diagram" class="scroll-mt-24">
                <div class="bg-white border rounded-2xl p-6 shadow-sm">
                    <h2 class="text-2xl font-bold text-slate-900">
                        視覚的図解・フローチャート（SVG）
                    </h2>
                    <svg
                        class="w-full h-[380px] mt-4"
                        viewBox="0 0 1100 380"
                        role="img"
                        aria-label="Gray code flow JP"
                    >
                        <!-- Nodes -->
                        <rect
                            x="40"
                            y="40"
                            width="220"
                            height="70"
                            rx="12"
                            fill="#ecfeff"
                            stroke="#38bdf8"
                            stroke-width="2"
                        ></rect>
                        <text
                            x="150"
                            y="82"
                            text-anchor="middle"
                            font-family="Inter, Arial"
                            font-size="24"
                            font-weight="bold"
                            fill="#0f172a"
                        >
                            開始
                        </text>

                        <rect
                            x="300"
                            y="40"
                            width="360"
                            height="90"
                            rx="12"
                            fill="#ecfdf5"
                            stroke="#10b981"
                            stroke-width="2"
                        ></rect>
                        <text
                            x="480"
                            y="70"
                            text-anchor="middle"
                            font-family="Inter, Arial"
                            font-size="24"
                            font-weight="bold"
                            fill="#0f172a"
                        >
                            <tspan x="480" dy="20">m = 1 &lt;&lt; n を計算</tspan>
                        </text>

                        <rect
                            x="700"
                            y="40"
                            width="360"
                            height="90"
                            rx="12"
                            fill="#eef2ff"
                            stroke="#6366f1"
                            stroke-width="2"
                        ></rect>
                        <text
                            x="880"
                            y="70"
                            text-anchor="middle"
                            font-family="Inter, Arial"
                            font-size="24"
                            font-weight="bold"
                            fill="#0f172a"
                        >
                            <tspan x="880" dy="20">i を 0 から m-1 までループ</tspan>
                        </text>

                        <rect
                            x="160"
                            y="200"
                            width="420"
                            height="90"
                            rx="12"
                            fill="#f0f9ff"
                            stroke="#38bdf8"
                            stroke-width="2"
                        ></rect>
                        <text
                            x="370"
                            y="230"
                            text-anchor="middle"
                            font-family="Inter, Arial"
                            font-size="24"
                            font-weight="bold"
                            fill="#0f172a"
                        >
                            <tspan x="370" dy="8">code = i XOR</tspan>
                            <tspan x="370" dy="32">（i を 1 ビット右シフト）</tspan>
                        </text>

                        <rect
                            x="620"
                            y="200"
                            width="300"
                            height="90"
                            rx="12"
                            fill="#fefce8"
                            stroke="#f59e0b"
                            stroke-width="2"
                        ></rect>
                        <text
                            x="770"
                            y="250"
                            text-anchor="middle"
                            font-family="Inter, Arial"
                            font-size="24"
                            font-weight="bold"
                            fill="#0f172a"
                        >
                            結果に追加
                        </text>

                        <rect
                            x="960"
                            y="200"
                            width="120"
                            height="90"
                            rx="12"
                            fill="#ecfdf5"
                            stroke="#10b981"
                            stroke-width="2"
                        ></rect>
                        <text
                            x="1020"
                            y="250"
                            text-anchor="middle"
                            font-family="Inter, Arial"
                            font-size="24"
                            font-weight="bold"
                            fill="#0f172a"
                        >
                            完了
                        </text>

                        <!-- Arrows -->
                        <defs>
                            <marker
                                id="arrJP"
                                markerWidth="10"
                                markerHeight="10"
                                refX="6"
                                refY="3"
                                orient="auto"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#334155"></path>
                            </marker>
                        </defs>

                        <line
                            x1="260"
                            y1="75"
                            x2="300"
                            y2="75"
                            stroke="#334155"
                            stroke-width="2"
                            marker-end="url(#arrJP)"
                        ></line>
                        <line
                            x1="660"
                            y1="75"
                            x2="700"
                            y2="75"
                            stroke="#334155"
                            stroke-width="2"
                            marker-end="url(#arrJP)"
                        ></line>
                        <line
                            x1="880"
                            y1="130"
                            x2="370"
                            y2="200"
                            stroke="#334155"
                            stroke-width="2"
                            marker-end="url(#arrJP)"
                        ></line>
                        <line
                            x1="580"
                            y1="245"
                            x2="620"
                            y2="245"
                            stroke="#334155"
                            stroke-width="2"
                            marker-end="url(#arrJP)"
                        ></line>
                        <line
                            x1="920"
                            y1="245"
                            x2="960"
                            y2="245"
                            stroke="#334155"
                            stroke-width="2"
                            marker-end="url(#arrJP)"
                        ></line>
                    </svg>
                    <p class="mt-3 text-sm text-slate-600">
                        開始 → サイズ計算 → ループ → Gray 値計算 → 追加 →
                        完了の流れを日本語で示しています。長い文は改行し、矩形と viewBox
                        を拡大してはみ出しを防止しています。
                    </p>

                    <p class="mt-3 text-sm text-slate-600">
                        Start → size 計算 → ループ → Gray 値計算 → 追加 → 完了の流れを示します。
                    </p>
                </div>
            </section>

            <!-- Complexity -->
            <section id="complexity" class="scroll-mt-24">
                <div class="bg-white border rounded-2xl p-6 shadow-sm">
                    <h2 class="text-2xl font-bold text-slate-900">計算量</h2>
                    <ul class="mt-2 list-disc list-inside text-slate-700">
                        <li><b>Time</b>: O(2^n)</li>
                        <li><b>Space</b>: O(2^n)（出力リスト）。追加領域は O(1)。</li>
                    </ul>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="mt-12 py-8 text-center text-slate-500">
            <p>© Gray Code walkthrough — Tailwind + Prism 単一HTML</p>
        </footer>

        <!-- Prism JS（コア） -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>

        <!-- 言語（Python） -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

        <!-- プラグインの読み込み順に注意：toolbar → copy-to-clipboard → line-numbers -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

        <!-- Interaction JS -->
        <script>
            (function () {
                const N = 4;
                let currentStep = 1;
                let isPlaying = false;
                let playTimer = null;

                const q = (sel, root = document) => root.querySelector(sel);
                const qa = (sel, root = document) => Array.from(root.querySelectorAll(sel));

                const stages = qa('.stage');
                const stepItems = qa('[data-step-target]');
                const btnPlay = q('[data-action="play"]');
                const btnPrev = q('[data-action="prev"]');
                const btnNext = q('[data-action="next"]');
                const btnReset = q('[data-action="reset"]');

                function setStep(step) {
                    const s = Math.min(Math.max(1, step), N);
                    currentStep = s;

                    // Update stages
                    stages.forEach((svg) => {
                        const isActive = Number(svg.getAttribute('data-step')) === s;
                        svg.classList.toggle('active', isActive);
                        svg.classList.toggle('hidden', !isActive);
                        svg.setAttribute('aria-hidden', String(!isActive));
                    });

                    // Update step items
                    stepItems.forEach((el) => {
                        const target = Number(el.getAttribute('data-step-target'));
                        const pressed = target === s;
                        el.setAttribute('aria-pressed', String(pressed));
                        el.classList.toggle('ring-2', pressed);
                        el.classList.toggle('ring-emerald-400', pressed);
                        el.classList.toggle('bg-emerald-50', pressed);
                    });
                }

                function reset() {
                    stopPlay();
                    setStep(1);
                }

                function stopPlay() {
                    if (playTimer) {
                        clearTimeout(playTimer);
                        playTimer = null;
                    }
                    isPlaying = false;
                    btnPlay.removeAttribute('disabled');
                    btnPlay.classList.remove('opacity-50', 'cursor-not-allowed');
                }

                function playOnce() {
                    if (isPlaying) return; // guard multi-start
                    isPlaying = true;
                    btnPlay.setAttribute('disabled', 'true');
                    btnPlay.classList.add('opacity-50', 'cursor-not-allowed');

                    let s = 1;
                    setStep(s);

                    const tick = () => {
                        if (s >= N) {
                            // Auto reset after short delay
                            playTimer = setTimeout(() => {
                                reset();
                            }, 700);
                            return;
                        }
                        s += 1;
                        setStep(s);
                        playTimer = setTimeout(tick, 700);
                    };
                    playTimer = setTimeout(tick, 700);
                }

                // Event bindings
                stepItems.forEach((el) => {
                    const to = Number(el.getAttribute('data-step-target'));
                    const activate = () => {
                        stopPlay();
                        setStep(to);
                    };
                    el.addEventListener('click', activate);
                    el.addEventListener('keydown', (ev) => {
                        if (ev.key === 'Enter' || ev.key === ' ') {
                            ev.preventDefault();
                            activate();
                        }
                    });
                });

                btnPrev.addEventListener('click', () => {
                    stopPlay();
                    setStep(currentStep - 1);
                });
                btnNext.addEventListener('click', () => {
                    stopPlay();
                    setStep(currentStep + 1);
                });
                btnReset.addEventListener('click', () => {
                    reset();
                });
                btnPlay.addEventListener('click', () => {
                    playOnce();
                });

                // Init
                setStep(1);
            })();
        </script>
    </body>
</html>
