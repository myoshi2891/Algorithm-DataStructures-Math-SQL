<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Maximal Rectangle（Python実装）| Row-wise Histogram + Monotonic Stack</title>

        <!-- Tailwind CSS (CDN) -->
        <script src="/vendor/tailwindcss/script.js"></script>

        <!-- Prism.js (CDN) -->
        <link
            href="/vendor/prismjs/themes/prism.css"
            rel="stylesheet"
        />
        <link
            href="/vendor/prismjs/plugins/line-numbers/prism-line-numbers.css"
            rel="stylesheet"
        />
        <link
            href="/vendor/prismjs/plugins/toolbar/prism-toolbar.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-highlight/prism-line-highlight.min.css"
            rel="stylesheet"
        />

        <!-- Font Awesome (icons) -->
        <link
            href="/vendor/fontawesome/css/all.min.css"
            rel="stylesheet"
        />

        <style>
            :root {
                --ink: #0f172a; /* slate-900 */
                --muted: #f1f5f9; /* slate-100 */
                --surface: #ffffff; /* white */
                --card: #ffffff;
                --acc: #2563eb; /* blue-600 */
                --acc2: #06b6d4; /* cyan-500 */
                --ring: rgba(37, 99, 235, 0.25);
                --code-lh: 1.6; /* ← pre.leading-[1.6] と揃える */
            }
            html,
            body {
                color: var(--ink);
                background: linear-gradient(180deg, #f8fafc 0%, #ffffff 60%);
            }

            .card {
                background: linear-gradient(
                    180deg,
                    rgba(255, 255, 255, 0.96),
                    rgba(255, 255, 255, 0.92)
                );
                border: 1px solid rgba(2, 6, 23, 0.06);
                box-shadow:
                    0 10px 24px rgba(2, 6, 23, 0.05),
                    0 4px 10px rgba(2, 6, 23, 0.06);
                backdrop-filter: blur(6px);
            }
            .section-title {
                position: relative;
                display: inline-block;
            }
            .section-title::after {
                content: '';
                position: absolute;
                left: 0;
                bottom: -6px;
                height: 3px;
                width: 100%;
                background: linear-gradient(90deg, var(--acc), var(--acc2));
                border-radius: 9999px;
                opacity: 0.85;
            }
            .glow:hover {
                box-shadow: 0 14px 36px var(--ring);
                transform: translateY(-1px);
            }

            /* Prism: 行高 / wrap / 行番号同期 / 余白とツールバー最適化 */
            pre[class*='language-'],
            pre[class*='language-'] > code {
                line-height: var(--code-lh) !important;
                white-space: pre !important;
                word-break: normal !important;
                overflow-wrap: normal !important;
                tab-size: 2 !important;
                font-variant-ligatures: none;
            }
            .line-numbers .line-numbers-rows > span {
                height: calc(var(--code-lh) * 1em);
            }
            pre.line-numbers {
                padding-left: 3.2em !important;
                padding-top: 2.8rem !important; /* 上下の余白を広めに */
                padding-bottom: 0 !important;
                margin-bottom: 0 !important; /* 下余白 */
                border-radius: 0.75rem;
                background: #fff;
            }
            .line-numbers .line-numbers-rows {
                width: 3.2em;
            }
            .line-highlight {
                background: linear-gradient(
                    90deg,
                    rgba(37, 99, 235, 0.08),
                    rgba(6, 182, 212, 0.08)
                ) !important;
                box-shadow: inset 3px 0 0 var(--acc);
            }
            .code-toolbar > .toolbar {
                opacity: 1 !important;
                right: 0.75rem !important;
                top: 0.75rem !important;
            }
            .code-toolbar > .toolbar .toolbar-item > button {
                background: linear-gradient(180deg, var(--acc), #1d4ed8);
                color: #fff;
                border-radius: 0.6rem;
                padding: 0.45rem 0.75rem;
                font-weight: 700;
                box-shadow: 0 8px 20px var(--ring);
            }
            .code-toolbar > .toolbar .toolbar-item > button:hover {
                background: linear-gradient(180deg, #1e40af, #1d4ed8);
            }

            pre[data-line] .line-highlight {
                overflow: hidden;
                padding: 0;
                height: 0 !important;
                padding-bottom: 0 !important;
            }
            .prism-toolbar {
                position: absolute;
                right: 0.5rem;
                top: 0.5rem;
                display: flex;
                gap: 0.5rem;
            }

            /* 既定ボタンの装飾（色・角丸・影・ホバー） */
            div.code-toolbar > .toolbar .toolbar-item > button,
            div.code-toolbar > .toolbar .toolbar-item > a {
                background: #fff;
                border: 1px solid #e6e8ef;
                border-radius: 10px;
                padding: 6px 10px;
                font:
                    600 13px/1.2 Inter,
                    system-ui,
                    -apple-system,
                    'Segoe UI',
                    'Helvetica Neue',
                    Arial,
                    sans-serif;
                color: #334155;
                box-shadow: 0 2px 6px rgba(20, 32, 70, 0.06);
                transition:
                    transform 0.15s ease,
                    box-shadow 0.15s ease,
                    background 0.15s ease;
            }
            div.code-toolbar > .toolbar .toolbar-item > button:hover {
                transform: translateY(-1px);
                box-shadow: 0 10px 28px rgba(20, 32, 70, 0.08);
                background: linear-gradient(180deg, #e8fff6, #c8f1e1);
            }

            /* 押下フィードバック（Copied! に切り替わる瞬間の色） */
            div.code-toolbar > .toolbar .toolbar-item > button:active {
                background: #e8fff6;
                border-color: #c8f1e1;
                color: #0b7f5b;
            }

            /* Step chips */
            .step {
                transition: all 0.25s ease;
                border: 1px solid transparent;
            }
            .step:hover {
                transform: translateY(-2px);
                border-color: rgba(2, 6, 23, 0.08);
                box-shadow: 0 10px 20px rgba(2, 6, 23, 0.06);
            }
            .step.active {
                border-color: var(--acc);
                box-shadow: 0 14px 30px var(--ring);
            }

            /* SVG styling */
            svg {
                width: 100%;
                height: auto;
            }
            .node {
                fill: #ffffff;
                stroke: #0f172a;
                stroke-opacity: 0.15;
                stroke-width: 1.5;
            }
            .node.label {
                font:
                    600 12px/1.2 ui-sans-serif,
                    system-ui,
                    -apple-system;
                fill: #0f172a;
            }
            .edge {
                stroke: #94a3b8;
                stroke-width: 1.5;
            }
            .arrow {
                fill: #94a3b8;
            }
            .hl-node {
                fill: #dbeafe;
                stroke: #2563eb;
            }
            .hl-edge {
                stroke: #2563eb;
            }
            .decision {
                fill: #ffffff;
                stroke: #0f172a;
                stroke-opacity: 0.15;
            }
            .bar {
                fill: #e2e8f0;
            }
            .bar.hl {
                fill: #93c5fd;
            }
            .stack-rect {
                fill: #e2e8f0;
            }
            .stack-rect.hl {
                fill: #67e8f9;
            }
            .legend {
                font:
                    500 12px/1.2 ui-sans-serif,
                    system-ui;
                fill: #475569;
            }
            .diagram-card {
                background: var(--card);
                border: 1px solid rgba(2, 6, 23, 0.06);
            }

            html {
                scroll-behavior: smooth;
            }
        </style>
    </head>
    <body id="top">
        <!-- Header -->
        <header class="max-w-6xl mx-auto px-4 sm:px-6 pt-10 pb-6">
            <div
                class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6"
            >
                <div>
                    <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">
                        Maximal Rectangle（Python 実装・技術解説）
                    </h1>
                    <p class="mt-2 text-slate-600">
                        対象アルゴリズム：<span class="font-semibold text-slate-900"
                            >Row-wise Histogram + Monotonic Increasing Stack</span
                        >
                    </p>
                </div>
                <a
                    href="#code"
                    class="glow inline-flex items-center gap-2 rounded-xl bg-blue-600 text-white px-5 py-3 font-semibold shadow hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition"
                >
                    <i class="fa-solid fa-code"></i> Jump to Code
                </a>
            </div>
        </header>

        <!-- Overview + Main Flow -->
        <section class="max-w-6xl mx-auto px-4 sm:px-6 pb-10">
            <div class="card rounded-2xl p-6 md:p-8">
                <div class="flex flex-col lg:flex-row items-start gap-8">
                    <div class="flex-1">
                        <h2 class="section-title text-2xl font-bold">アルゴリズム概要</h2>
                        <p class="mt-4 leading-relaxed text-slate-700">
                            各行を「底」として連続1の本数からなる
                            <strong>高さ配列（ヒストグラム）</strong> を更新し、行ごとに
                            <span class="font-semibold">Largest Rectangle in Histogram</span
                            >（単調増加スタック）を適用して最大長方形面積を求めます。 計算量は
                            <span class="font-mono">O(R·C)</span>、追加メモリは
                            <span class="font-mono">O(C)</span> です。
                        </p>
                        <ul class="mt-4 space-y-2 text-slate-700">
                            <li class="flex items-start gap-3">
                                <i class="fa-solid fa-circle-check text-blue-600 mt-1"></i>
                                行の走査で高さ配列を1パス更新
                            </li>
                            <li class="flex items-start gap-3">
                                <i class="fa-solid fa-circle-check text-blue-600 mt-1"></i>
                                スタックはインデックスのみ（push/pop）で単純高速
                            </li>
                            <li class="flex items-start gap-3">
                                <i class="fa-solid fa-circle-check text-blue-600 mt-1"></i>
                                末尾は高さ0のセンチネルで確定処理を一括化
                            </li>
                        </ul>
                    </div>

                    <!-- SVG: Main Flow -->
                    <div class="flex-1 diagram-card rounded-2xl p-4">
                        <div class="text-sm text-slate-500 mb-2">Flow (SVG, English labels)</div>
                        <svg viewBox="0 0 640 260" role="img" aria-label="Main flow">
                            <defs>
                                <marker
                                    id="arrow"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="8"
                                    refY="3"
                                    orient="auto"
                                    markerUnits="userSpaceOnUse"
                                >
                                    <path d="M0,0 L10,3 L0,6 z" class="arrow" />
                                </marker>
                            </defs>
                            <!-- Nodes -->
                            <rect
                                id="A"
                                class="node"
                                x="20"
                                y="20"
                                width="140"
                                height="36"
                                rx="10"
                            />
                            <text x="90" y="42" text-anchor="middle" class="node label">
                                Start row loop
                            </text>

                            <rect
                                id="B"
                                class="node"
                                x="220"
                                y="20"
                                width="200"
                                height="36"
                                rx="10"
                            />
                            <text x="320" y="42" text-anchor="middle" class="node label">
                                Update heights by row
                            </text>

                            <rect
                                id="C"
                                class="node"
                                x="460"
                                y="20"
                                width="160"
                                height="36"
                                rx="10"
                            />
                            <text x="540" y="42" text-anchor="middle" class="node label">
                                Run LRiH
                            </text>

                            <polygon
                                id="D"
                                class="decision"
                                points="320,110 360,140 320,170 280,140"
                            />
                            <text x="320" y="144" text-anchor="middle" class="node label">
                                Update max?
                            </text>

                            <rect
                                id="E"
                                class="node"
                                x="460"
                                y="120"
                                width="150"
                                height="36"
                                rx="10"
                            />
                            <text x="535" y="142" text-anchor="middle" class="node label">
                                Store new max
                            </text>

                            <rect
                                id="F"
                                class="node"
                                x="120"
                                y="120"
                                width="120"
                                height="36"
                                rx="10"
                            />
                            <text x="180" y="142" text-anchor="middle" class="node label">
                                Continue
                            </text>

                            <polygon
                                id="G"
                                class="decision"
                                points="120,200 160,230 120,260 80,230"
                            />
                            <text x="120" y="234" text-anchor="middle" class="node label">
                                More rows?
                            </text>

                            <rect
                                id="H"
                                class="node"
                                x="220"
                                y="220"
                                width="160"
                                height="36"
                                rx="10"
                            />
                            <text x="300" y="242" text-anchor="middle" class="node label">
                                Return max area
                            </text>

                            <!-- Edges -->
                            <line
                                id="eAB"
                                class="edge"
                                x1="160"
                                y1="38"
                                x2="220"
                                y2="38"
                                marker-end="url(#arrow)"
                            />
                            <line
                                id="eBC"
                                class="edge"
                                x1="420"
                                y1="38"
                                x2="460"
                                y2="38"
                                marker-end="url(#arrow)"
                            />
                            <line
                                id="eCD"
                                class="edge"
                                x1="540"
                                y1="56"
                                x2="320"
                                y2="110"
                                marker-end="url(#arrow)"
                            />
                            <line
                                id="eDY"
                                class="edge"
                                x1="360"
                                y1="140"
                                x2="460"
                                y2="138"
                                marker-end="url(#arrow)"
                            />
                            <!-- Yes -->
                            <line
                                id="eDN"
                                class="edge"
                                x1="280"
                                y1="140"
                                x2="240"
                                y2="138"
                                marker-end="url(#arrow)"
                            />
                            <!-- No -->
                            <line
                                id="eEF"
                                class="edge"
                                x1="535"
                                y1="156"
                                x2="240"
                                y2="156"
                                marker-end="url(#arrow)"
                            />
                            <line
                                id="eFG"
                                class="edge"
                                x1="180"
                                y1="156"
                                x2="120"
                                y2="200"
                                marker-end="url(#arrow)"
                            />
                            <line id="eGY" class="edge" x1="80" y1="230" x2="60" y2="230" />
                            <line
                                id="eYA"
                                class="edge"
                                x1="60"
                                y1="230"
                                x2="60"
                                y2="38"
                                marker-end="url(#arrow)"
                            />
                            <line
                                id="eGN"
                                class="edge"
                                x1="160"
                                y1="230"
                                x2="220"
                                y2="238"
                                marker-end="url(#arrow)"
                            />
                        </svg>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step-by-Step with SVG Diagrams -->
        <section class="max-w-6xl mx-auto px-4 sm:px-6 pb-12">
            <div class="card rounded-2xl p-6 md:p-8">
                <h2 class="section-title text-2xl font-bold">
                    ステップバイステップ解説（視覚化付き）
                </h2>

                <div class="mt-6 grid lg:grid-cols-12 gap-6">
                    <!-- Steps -->
                    <div class="lg:col-span-5 space-y-4">
                        <button
                            data-lines="38-48"
                            data-step="1"
                            class="step w-full text-left rounded-xl bg-white p-4 hover:bg-slate-50 transition"
                        >
                            <div class="flex items-center gap-3">
                                <span
                                    class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-600 text-white font-bold"
                                    >1</span
                                >
                                <span class="font-semibold">高さ配列を更新（行を底にする）</span>
                            </div>
                            <p class="mt-2 text-slate-700">
                                各列で '1' なら高さ+1、'0' なら 0
                                にリセットしてヒストグラムを作ります。
                            </p>
                        </button>

                        <button
                            data-lines="23-37,50-73"
                            data-step="2"
                            class="step w-full text-left rounded-xl bg-white p-4 hover:bg-slate-50 transition"
                        >
                            <div class="flex items-center gap-3">
                                <span
                                    class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-600 text-white font-bold"
                                    >2</span
                                >
                                <span class="font-semibold">単調増加スタックで最大長方形</span>
                            </div>
                            <p class="mt-2 text-slate-700">
                                現在高さが小さくなる地点で面積確定。<em
                                    >width = rightIndex - leftLessIndex - 1</em
                                >。
                            </p>
                        </button>

                        <button
                            data-lines="74-82"
                            data-step="3"
                            class="step w-full text-left rounded-xl bg-white p-4 hover:bg-slate-50 transition"
                        >
                            <div class="flex items-center gap-3">
                                <span
                                    class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-600 text-white font-bold"
                                    >3</span
                                >
                                <span class="font-semibold">最大面積を更新</span>
                            </div>
                            <p class="mt-2 text-slate-700">
                                各行の結果とグローバル最大値を比較し、必要に応じて更新します。
                            </p>
                        </button>

                        <div class="flex items-center gap-3 pt-2">
                            <button
                                id="play-steps"
                                class="glow inline-flex items-center gap-2 rounded-lg bg-cyan-500 text-white px-4 py-2 font-semibold hover:bg-cyan-600 focus:outline-none focus:ring-4 focus:ring-cyan-300 transition"
                            >
                                <i class="fa-solid fa-forward"></i> Play Steps
                            </button>
                            <button
                                id="reset-steps"
                                class="inline-flex items-center gap-2 rounded-lg bg-slate-200 text-slate-800 px-4 py-2 font-semibold hover:bg-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-300 transition"
                            >
                                <i class="fa-solid fa-rotate-left"></i> Reset
                            </button>
                        </div>

                        <!-- Complexity -->
                        <div class="mt-6 rounded-xl bg-white p-5 border border-slate-100">
                            <h3 class="text-lg font-bold">時間計算量</h3>
                            <p class="mt-2 text-slate-700">
                                各行で <span class="font-mono">O(C)</span>、全体で
                                <span class="font-mono">O(R·C)</span>。追加メモリは
                                <span class="font-mono">O(C)</span>。
                            </p>
                            <ul class="mt-3 space-y-2 text-slate-700">
                                <li class="flex items-start gap-2">
                                    <i class="fa-regular fa-circle-check text-blue-600 mt-1"></i>
                                    push/pop だけの単純なスタック操作
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fa-regular fa-circle-check text-blue-600 mt-1"></i>
                                    センチネル（j==cols）で終端処理を簡潔に
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fa-regular fa-circle-check text-blue-600 mt-1"></i>
                                    配列再利用で GC 負荷を抑制
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Diagrams -->
                    <div class="lg:col-span-7 space-y-6">
                        <!-- Diagram 1: Heights update -->
                        <div class="diagram-card rounded-2xl p-4">
                            <div class="text-sm text-slate-500 mb-2">
                                Step 1 — Heights update (SVG)
                            </div>
                            <svg
                                id="diag1"
                                viewBox="0 0 640 160"
                                role="img"
                                aria-label="Heights update"
                            >
                                <defs>
                                    <marker
                                        id="arrow1"
                                        markerWidth="10"
                                        markerHeight="10"
                                        refX="8"
                                        refY="3"
                                        orient="auto"
                                    >
                                        <path d="M0,0 L10,3 L0,6 z" class="arrow" />
                                    </marker>
                                </defs>
                                <!-- nodes -->
                                <rect
                                    x="20"
                                    y="20"
                                    width="160"
                                    height="36"
                                    rx="8"
                                    class="node"
                                    id="d1a"
                                />
                                <text x="100" y="42" text-anchor="middle" class="node label">
                                    row[j] == '1'
                                </text>

                                <rect
                                    x="220"
                                    y="20"
                                    width="200"
                                    height="36"
                                    rx="8"
                                    class="node"
                                    id="d1b"
                                />
                                <text x="320" y="42" text-anchor="middle" class="node label">
                                    heights[j] = heights[j] + 1
                                </text>

                                <rect
                                    x="20"
                                    y="90"
                                    width="160"
                                    height="36"
                                    rx="8"
                                    class="node"
                                    id="d1c"
                                />
                                <text x="100" y="112" text-anchor="middle" class="node label">
                                    row[j] == '0'
                                </text>

                                <rect
                                    x="220"
                                    y="90"
                                    width="200"
                                    height="36"
                                    rx="8"
                                    class="node"
                                    id="d1d"
                                />
                                <text x="320" y="112" text-anchor="middle" class="node label">
                                    heights[j] = 0
                                </text>

                                <line
                                    x1="180"
                                    y1="38"
                                    x2="220"
                                    y2="38"
                                    class="edge"
                                    marker-end="url(#arrow1)"
                                    id="d1e1"
                                />
                                <line
                                    x1="180"
                                    y1="108"
                                    x2="220"
                                    y2="108"
                                    class="edge"
                                    marker-end="url(#arrow1)"
                                    id="d1e2"
                                />
                            </svg>
                        </div>

                        <!-- Diagram 2: Monotonic stack -->
                        <div class="diagram-card rounded-2xl p-4">
                            <div class="text-sm text-slate-500 mb-2">
                                Step 2 — Monotonic stack (SVG)
                            </div>
                            <svg
                                id="diag2"
                                viewBox="0 0 640 220"
                                role="img"
                                aria-label="Monotonic stack"
                            >
                                <defs>
                                    <marker
                                        id="arrow2"
                                        markerWidth="10"
                                        markerHeight="10"
                                        refX="8"
                                        refY="3"
                                        orient="auto"
                                    >
                                        <path d="M0,0 L10,3 L0,6 z" class="arrow" />
                                    </marker>
                                </defs>
                                <!-- histogram bars -->
                                <g id="bars">
                                    <rect x="40" y="120" width="30" height="80" class="bar" />
                                    <rect
                                        x="80"
                                        y="80"
                                        width="30"
                                        height="120"
                                        class="bar hl"
                                        id="bar-pop"
                                    />
                                    <rect x="120" y="60" width="30" height="140" class="bar" />
                                    <rect x="160" y="100" width="30" height="100" class="bar" />
                                    <rect x="200" y="100" width="30" height="100" class="bar" />
                                    <rect x="240" y="140" width="30" height="60" class="bar" />
                                </g>

                                <!-- stack (indices) -->
                                <g id="stack">
                                    <rect
                                        x="340"
                                        y="140"
                                        width="40"
                                        height="40"
                                        class="stack-rect"
                                    />
                                    <rect
                                        x="340"
                                        y="100"
                                        width="40"
                                        height="40"
                                        class="stack-rect hl"
                                        id="stk-top"
                                    />
                                    <rect
                                        x="340"
                                        y="60"
                                        width="40"
                                        height="40"
                                        class="stack-rect"
                                    />
                                    <text x="360" y="195" text-anchor="middle" class="legend">
                                        stack (top ↑)
                                    </text>
                                </g>

                                <!-- arrows / notes -->
                                <line
                                    x1="135"
                                    y1="60"
                                    x2="360"
                                    y2="100"
                                    class="edge"
                                    marker-end="url(#arrow2)"
                                    id="edge-pop"
                                />
                                <text x="220" y="50" class="legend">pop until monotonic</text>

                                <rect
                                    x="440"
                                    y="40"
                                    width="160"
                                    height="60"
                                    rx="8"
                                    class="node"
                                    id="note-area"
                                />
                                <text x="520" y="65" text-anchor="middle" class="node label">
                                    area = height × width
                                </text>
                                <text x="520" y="83" text-anchor="middle" class="legend">
                                    width = right - leftLess - 1
                                </text>
                            </svg>
                        </div>

                        <!-- Diagram 3: Max area update -->
                        <div class="diagram-card rounded-2xl p-4">
                            <div class="text-sm text-slate-500 mb-2">
                                Step 3 — Update global maximum (SVG)
                            </div>
                            <svg
                                id="diag3"
                                viewBox="0 0 640 160"
                                role="img"
                                aria-label="Update max"
                            >
                                <defs>
                                    <marker
                                        id="arrow3"
                                        markerWidth="10"
                                        markerHeight="10"
                                        refX="8"
                                        refY="3"
                                        orient="auto"
                                    >
                                        <path d="M0,0 L10,3 L0,6 z" class="arrow" />
                                    </marker>
                                </defs>
                                <rect
                                    x="20"
                                    y="20"
                                    width="200"
                                    height="36"
                                    rx="8"
                                    class="node"
                                    id="d3a"
                                />
                                <text x="120" y="42" text-anchor="middle" class="node label">
                                    area from histogram
                                </text>

                                <polygon
                                    id="d3b"
                                    class="decision"
                                    points="300,20 340,38 300,56 260,38"
                                />
                                <text x="300" y="42" text-anchor="middle" class="node label">
                                    area > max?
                                </text>

                                <rect
                                    x="420"
                                    y="10"
                                    width="160"
                                    height="36"
                                    rx="8"
                                    class="node"
                                    id="d3c"
                                />
                                <text x="500" y="32" text-anchor="middle" class="node label">
                                    set max = area
                                </text>

                                <rect
                                    x="420"
                                    y="90"
                                    width="160"
                                    height="36"
                                    rx="8"
                                    class="node"
                                    id="d3d"
                                />
                                <text x="500" y="112" text-anchor="middle" class="node label">
                                    keep max
                                </text>

                                <line
                                    x1="220"
                                    y1="38"
                                    x2="260"
                                    y2="38"
                                    class="edge"
                                    marker-end="url(#arrow3)"
                                />
                                <line
                                    x1="340"
                                    y1="38"
                                    x2="420"
                                    y2="28"
                                    class="edge"
                                    marker-end="url(#arrow3)"
                                />
                                <line
                                    x1="300"
                                    y1="56"
                                    x2="420"
                                    y2="108"
                                    class="edge"
                                    marker-end="url(#arrow3)"
                                />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Code -->
        <section id="code" class="max-w-6xl mx-auto px-4 sm:px-6 pb-24">
            <div class="card rounded-2xl p-6 md:p-8">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <h2 class="section-title text-2xl font-bold">
                        コード例（Python / LeetCode Class形式）
                    </h2>
                    <div class="flex items-center gap-2">
                        <span class="text-slate-500 text-sm">行番号・行ハイライト・コピー対応</span>
                        <i class="fa-regular fa-clipboard text-slate-400"></i>
                    </div>
                </div>

                <div class="mt-6 rounded-xl border border-slate-200 overflow-hidden">
                    <pre
                        id="code-block"
                        class="line-numbers whitespace-pre leading-[1.6] overflow-x-auto"
                        data-prismjs-copy="Copy"
                        data-prismjs-copy-success="Copied!"
                        data-prismjs-copy-error="Press Ctrl+C to copy"
                        data-line=""
                    >
<code class="language-python">from typing import List


class Solution:
    """
    LeetCode 85. Maximal Rectangle

    Competitive version:
    - Assumes matrix is a well-formed 2D list of '0'/'1' strings.
    - Time: O(R*C), Space: O(C)
    """

    def maximalRectangle(self, matrix: List[List[str]]) -> int:
        if not matrix:
            return 0
        rows: int = len(matrix)
        cols: int = len(matrix[0])
        if cols == 0:
            return 0

        # heights[j]: consecutive '1' height using current row as the base
        heights: List[int] = [0] * cols
        # stack will store indices; manual top pointer for perf
        stack: List[int] = [0] * (cols + 1)
        max_area: int = 0

        def largest_rectangle_in_histogram(h: List[int]) -> int:
            best: int = 0
            top: int = -1  # -1 means empty
            # sentinel: treat j==cols as height 0 to flush the stack
            for j in range(cols + 1):
                cur: int = 0 if j == cols else h[j]
                while top >= 0 and cur < h[stack[top]]:
                    height: int = h[stack[top]]
                    top -= 1
                    left_less: int = stack[top] if top >= 0 else -1
                    width: int = j - left_less - 1
                    area: int = height * width
                    if area > best:
                        best = area
                top += 1
                stack[top] = j
            return best

        for i in range(rows):
            row = matrix[i]
            # update heights
            for j in range(cols):
                heights[j] = heights[j] + 1 if row[j] == '1' else 0
            # compute area for this histogram
            area = largest_rectangle_in_histogram(heights)
            if area > max_area:
                max_area = area

        return max_area

    # Production-grade version with validations (optional)
    def maximalRectangle_production(self, matrix: List[List[str]]) -> int:
        if not isinstance(matrix, list):
            raise TypeError("matrix must be a list of lists")
        if not matrix:
            return 0
        cols: int = len(matrix[0])
        if cols == 0:
            return 0
        rows: int = len(matrix)
        if not (1 <= rows <= 200):
            raise ValueError("rows must be within [1, 200]")
        if not (1 <= cols <= 200):
            raise ValueError("cols must be within [1, 200]")
        for r, row in enumerate(matrix):
            if not isinstance(row, list) or len(row) != cols:
                raise ValueError("All rows must have identical length")
            for c, v in enumerate(row):
                if not isinstance(v, str) or (v != '0' and v != '1'):
                    raise TypeError("matrix[i][j] must be '0' or '1'")
        return self.maximalRectangle(matrix)
</code>
        </pre>
                </div>

                <div class="mt-4 flex items-center justify-between flex-wrap gap-3 text-sm">
                    <div class="text-slate-500">
                        <i class="fa-solid fa-circle-info mr-1"></i>
                        行番号・ハイライトは行高と同期済み。コピーは右上ボタン or 下のボタンから。
                    </div>
                    <div class="flex items-center gap-2">
                        <button
                            id="copy-btn"
                            class="glow inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-3 py-2 font-semibold hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition"
                        >
                            <i class="fa-regular fa-clipboard"></i> Copy Code
                        </button>
                        <a
                            href="#top"
                            class="inline-flex items-center gap-2 rounded-lg bg-slate-200 text-slate-800 px-3 py-2 font-semibold hover:bg-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-300 transition"
                        >
                            <i class="fa-solid fa-arrow-up"></i> Page Top
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="border-t border-slate-200">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 text-sm text-slate-500">
                &copy; 2025 Maximal Rectangle Demo. Designed &amp; Engineered with care.
            </div>
        </footer>

        <!-- Prism.js scripts (after content) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

        <!-- Interaction (steps ↔ code ↔ SVG highlight) -->
        <script>
            (function () {
                const codePre = document.getElementById('code-block');
                const stepButtons = Array.from(document.querySelectorAll('.step'));
                const playBtn = document.getElementById('play-steps');
                const resetBtn = document.getElementById('reset-steps');
                const copyBtn = document.getElementById('copy-btn');

                // helper: set code highlight lines
                function setLines(linesStr) {
                    codePre.setAttribute('data-line', linesStr || '');
                    Prism.highlightAllUnder(codePre.parentElement);
                    if (linesStr) {
                        const first = linesStr.split(',')[0];
                        const start = parseInt(first.split('-')[0], 10);
                        const rowHeightEm =
                            parseFloat(
                                getComputedStyle(document.documentElement).getPropertyValue(
                                    '--code-lh',
                                ),
                            ) || 1.6;
                        const approxPx = (start - 1) * (rowHeightEm * 16);
                        codePre.scrollTo({
                            left: 0,
                            top: Math.max(approxPx - 80, 0),
                            behavior: 'smooth',
                        });
                    }
                }

                // helper: clear svg highlights
                function clearSvgHighlights() {
                    // diagram 1
                    ['d1a', 'd1b', 'd1c', 'd1d', 'd1e1', 'd1e2'].forEach((id) => {
                        const el = document.getElementById(id);
                        if (!el) return;
                        el.classList.remove('hl-node', 'hl-edge');
                        if (el.tagName === 'LINE') el.classList.remove('hl-edge');
                    });
                    // diagram 2
                    const barPop = document.getElementById('bar-pop');
                    const stkTop = document.getElementById('stk-top');
                    const edgePop = document.getElementById('edge-pop');
                    if (barPop) barPop.classList.remove('hl');
                    if (stkTop) stkTop.classList.remove('hl');
                    if (edgePop) edgePop.classList.remove('hl-edge');
                    // diagram 3
                    ['d3a', 'd3b', 'd3c', 'd3d'].forEach((id) => {
                        const el = document.getElementById(id);
                        if (!el) return;
                        el.classList.remove('hl-node');
                    });
                }

                // apply highlight per step
                function applyStep(step) {
                    clearSvgHighlights();
                    if (step === 1) {
                        ['d1a', 'd1b', 'd1c', 'd1d'].forEach((id) =>
                            document.getElementById(id)?.classList.add('hl-node'),
                        );
                        ['d1e1', 'd1e2'].forEach((id) =>
                            document.getElementById(id)?.classList.add('hl-edge'),
                        );
                    } else if (step === 2) {
                        document.getElementById('bar-pop')?.classList.add('hl');
                        document.getElementById('stk-top')?.classList.add('hl');
                        document.getElementById('edge-pop')?.classList.add('hl-edge');
                    } else if (step === 3) {
                        ['d3a', 'd3b', 'd3c'].forEach((id) =>
                            document.getElementById(id)?.classList.add('hl-node'),
                        );
                    }
                }

                // bind step buttons
                stepButtons.forEach((btn) => {
                    btn.addEventListener('click', () => {
                        stepButtons.forEach((b) => b.classList.remove('active'));
                        btn.classList.add('active');
                        setLines(btn.dataset.lines || '');
                        const s = parseInt(btn.dataset.step || '0', 10);
                        applyStep(s);
                    });
                });

                // play / reset
                let current = -1;
                playBtn?.addEventListener('click', () => {
                    current = (current + 1) % stepButtons.length;
                    stepButtons[current].click();
                });
                resetBtn?.addEventListener('click', () => {
                    current = -1;
                    stepButtons.forEach((b) => b.classList.remove('active'));
                    setLines('');
                    clearSvgHighlights();
                });

                // extra copy button
                copyBtn?.addEventListener('click', async () => {
                    const text = codePre.textContent || '';
                    try {
                        await navigator.clipboard.writeText(text);
                        copyBtn.innerHTML = '<i class="fa-solid fa-check"></i> Copied';
                        copyBtn.classList.replace('bg-blue-600', 'bg-emerald-600');
                        setTimeout(() => {
                            copyBtn.innerHTML = '<i class="fa-regular fa-clipboard"></i> Copy Code';
                            copyBtn.classList.replace('bg-emerald-600', 'bg-blue-600');
                        }, 1500);
                    } catch (e) {
                        console.error(e);
                    }
                });

                // default state
                if (stepButtons[0]) stepButtons[0].click();
            })();
        </script>
    </body>
</html>
