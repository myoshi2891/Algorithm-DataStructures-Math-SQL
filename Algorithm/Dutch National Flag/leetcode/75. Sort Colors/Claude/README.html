<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Sort Colors Algorithm - Interactive Technical Guide</title>

        <!-- CDN Dependencies -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
            rel="stylesheet"
        />

        <style>
            :root {
                --bg-primary: #0a0a0f;
                --bg-secondary: #1a1a2e;
                --bg-tertiary: #16213e;
                --accent-primary: #64ffda;
                --accent-secondary: #bb86fc;
                --text-primary: #ffffff;
                --text-secondary: #a0a0a0;
                --text-muted: #666;
                --border: #333;
                --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Inter', sans-serif;
                background: var(--bg-primary);
                color: var(--text-primary);
                line-height: 1.6;
                overflow-x: hidden;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 2rem;
            }

            /* Header */
            header {
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                padding: 4rem 0;
                text-align: center;
                position: relative;
                overflow: hidden;
            }

            header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="rgba(255,255,255,0.05)"><polygon points="0,100 1000,0 1000,100"/></svg>');
            }

            .header-content {
                position: relative;
                z-index: 1;
            }

            h1 {
                font-size: clamp(2.5rem, 5vw, 4rem);
                font-weight: 700;
                margin-bottom: 1rem;
                background: linear-gradient(45deg, #64ffda, #bb86fc);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                animation: fadeInUp 0.8s ease-out;
            }

            .subtitle {
                font-size: 1.2rem;
                color: rgba(255, 255, 255, 0.8);
                margin-bottom: 2rem;
                animation: fadeInUp 0.8s ease-out 0.2s both;
            }

            .algorithm-badge {
                display: inline-block;
                padding: 0.5rem 1.5rem;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50px;
                backdrop-filter: blur(10px);
                font-weight: 500;
                animation: fadeInUp 0.8s ease-out 0.4s both;
            }

            /* Navigation */
            .nav-tabs {
                background: var(--bg-secondary);
                padding: 0;
                margin: 2rem 0;
                border-radius: 12px;
                box-shadow: var(--shadow);
                overflow: hidden;
            }

            .nav-tabs ul {
                list-style: none;
                display: flex;
                flex-wrap: wrap;
            }

            .nav-tabs li {
                flex: 1;
            }

            .nav-tab {
                display: block;
                padding: 1rem 1.5rem;
                color: var(--text-secondary);
                text-decoration: none;
                text-align: center;
                transition: all 0.3s ease;
                border-bottom: 3px solid transparent;
                font-weight: 500;
            }

            .nav-tab:hover,
            .nav-tab.active {
                color: var(--accent-primary);
                background: rgba(100, 255, 218, 0.1);
                border-bottom-color: var(--accent-primary);
            }

            /* Content Sections */
            .section {
                display: none;
                background: var(--bg-secondary);
                border-radius: 12px;
                padding: 2rem;
                margin: 2rem 0;
                box-shadow: var(--shadow);
                animation: fadeIn 0.5s ease-out;
            }

            .section.active {
                display: block;
            }

            .section h2 {
                font-size: 2rem;
                margin-bottom: 1.5rem;
                color: var(--accent-primary);
                border-bottom: 2px solid var(--border);
                padding-bottom: 0.5rem;
            }

            .section h3 {
                font-size: 1.5rem;
                margin: 2rem 0 1rem 0;
                color: var(--accent-secondary);
            }

            /* Code Blocks */
            .code-container {
                position: relative;
                margin: 1.5rem 0;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: var(--shadow);
            }

            .code-header {
                background: var(--bg-tertiary);
                padding: 0.75rem 1rem;
                display: flex;
                justify-content: between;
                align-items: center;
                border-bottom: 1px solid var(--border);
            }

            .code-title {
                font-family: 'JetBrains Mono', monospace;
                font-size: 0.9rem;
                color: var(--text-secondary);
            }

            .copy-btn {
                background: var(--accent-primary);
                color: var(--bg-primary);
                border: none;
                padding: 0.3rem 0.8rem;
                border-radius: 4px;
                cursor: pointer;
                font-size: 0.8rem;
                font-weight: 500;
                transition: all 0.2s ease;
            }

            .copy-btn:hover {
                background: #4fd3b3;
                transform: translateY(-1px);
            }

            pre[class*='language-'] {
                margin: 0 !important;
                border-radius: 0 0 8px 8px !important;
                font-family: 'JetBrains Mono', monospace !important;
            }

            /* Visual Algorithm Display */
            .algorithm-display {
                background: var(--bg-tertiary);
                border-radius: 12px;
                padding: 2rem;
                margin: 2rem 0;
                text-align: center;
            }

            .array-container {
                display: flex;
                justify-content: center;
                gap: 0.5rem;
                margin: 2rem 0;
                flex-wrap: wrap;
            }

            .array-element {
                width: 60px;
                height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 8px;
                font-weight: bold;
                font-size: 1.2rem;
                transition: all 0.3s ease;
                position: relative;
                cursor: pointer;
            }

            .array-element.red {
                background: #ff6b6b;
            }
            .array-element.white {
                background: #ffffff;
                color: #333;
            }
            .array-element.blue {
                background: #4ecdc4;
            }

            .array-element:hover {
                transform: scale(1.1);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }

            .pointer {
                position: absolute;
                bottom: -35px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--accent-primary);
            }

            /* Controls */
            .controls {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin: 2rem 0;
                flex-wrap: wrap;
            }

            .btn {
                padding: 0.75rem 1.5rem;
                background: var(--gradient);
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            }

            .btn:disabled {
                background: var(--text-muted);
                cursor: not-allowed;
                transform: none;
            }

            /* Stats */
            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin: 2rem 0;
            }

            .stat-card {
                background: var(--bg-tertiary);
                padding: 1.5rem;
                border-radius: 8px;
                text-align: center;
                border: 1px solid var(--border);
            }

            .stat-value {
                font-size: 2rem;
                font-weight: bold;
                color: var(--accent-primary);
                margin-bottom: 0.5rem;
            }

            .stat-label {
                color: var(--text-secondary);
                font-size: 0.9rem;
            }

            /* Step Display */
            .step-display {
                background: var(--bg-tertiary);
                padding: 1.5rem;
                border-radius: 8px;
                margin: 1rem 0;
                border-left: 4px solid var(--accent-primary);
            }

            .step-number {
                background: var(--accent-primary);
                color: var(--bg-primary);
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                margin-right: 1rem;
                font-weight: bold;
            }

            /* Complexity Analysis */
            .complexity-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 2rem;
                margin: 2rem 0;
            }

            .complexity-card {
                background: var(--bg-tertiary);
                padding: 2rem;
                border-radius: 12px;
                border: 1px solid var(--border);
                transition: all 0.3s ease;
            }

            .complexity-card:hover {
                transform: translateY(-5px);
                border-color: var(--accent-primary);
            }

            .complexity-title {
                color: var(--accent-secondary);
                font-size: 1.2rem;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .complexity-value {
                font-size: 2rem;
                font-weight: bold;
                color: var(--accent-primary);
                margin: 1rem 0;
            }

            /* Animations */
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            .animate-pulse {
                animation: pulse 1s infinite;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .container {
                    padding: 0 1rem;
                }
                .nav-tabs ul {
                    flex-direction: column;
                }
                .nav-tab {
                    text-align: left;
                }
                .array-element {
                    width: 45px;
                    height: 45px;
                    font-size: 1rem;
                }
                .controls {
                    flex-direction: column;
                    align-items: center;
                }
                .section {
                    padding: 1.5rem;
                }
                h1 {
                    font-size: 2.5rem;
                }
            }

            /* Tooltip */
            .tooltip {
                position: relative;
                display: inline-block;
            }

            .tooltip .tooltiptext {
                visibility: hidden;
                width: 200px;
                background-color: var(--bg-tertiary);
                color: var(--text-primary);
                text-align: center;
                border-radius: 6px;
                padding: 5px 10px;
                position: absolute;
                z-index: 1;
                bottom: 125%;
                left: 50%;
                margin-left: -100px;
                opacity: 0;
                transition: opacity 0.3s;
                font-size: 0.8rem;
                border: 1px solid var(--border);
            }

            .tooltip:hover .tooltiptext {
                visibility: visible;
                opacity: 1;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="container">
                <div class="header-content">
                    <h1>Sort Colors Algorithm</h1>
                    <p class="subtitle">
                        Dutch National Flag Problem - Interactive Technical Guide
                    </p>
                    <span class="algorithm-badge">
                        <i class="fas fa-flag"></i> 3-Way Partitioning
                    </span>
                </div>
            </div>
        </header>

        <div class="container">
            <nav class="nav-tabs">
                <ul>
                    <li><a href="#overview" class="nav-tab active">概要</a></li>
                    <li><a href="#algorithm" class="nav-tab">アルゴリズム</a></li>
                    <li><a href="#visualization" class="nav-tab">ビジュアル</a></li>
                    <li><a href="#implementation" class="nav-tab">実装</a></li>
                    <li><a href="#complexity" class="nav-tab">計算量</a></li>
                </ul>
            </nav>

            <!-- Overview Section -->
            <section id="overview" class="section active">
                <h2><i class="fas fa-info-circle"></i> アルゴリズム概要</h2>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">O(n)</div>
                        <div class="stat-label">時間計算量</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">O(1)</div>
                        <div class="stat-label">空間計算量</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">1-Pass</div>
                        <div class="stat-label">アルゴリズム</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">In-Place</div>
                        <div class="stat-label">ソート方式</div>
                    </div>
                </div>

                <p>
                    <strong>Sort Colors</strong
                    >は、配列内の0、1、2（赤、白、青）を表す要素を効率的にソートする問題です。
                    これは<strong>オランダ国旗問題（Dutch National Flag Problem）</strong
                    >として知られており、 3-way partitioningの典型的な応用例です。
                </p>

                <h3><i class="fas fa-target"></i> 問題設定</h3>
                <ul>
                    <li>配列内の要素は0, 1, 2のいずれか</li>
                    <li>In-placeでソートする必要がある</li>
                    <li>ライブラリのソート関数は使用禁止</li>
                    <li>1回のパスで完了させる</li>
                </ul>

                <h3><i class="fas fa-lightbulb"></i> 基本アイデア</h3>
                <p>3つのポインタ（low, mid, high）を使用して配列を以下の領域に分割します：</p>
                <div class="code-container">
                    <div class="code-header">
                        <span class="code-title">配列の領域分割</span>
                    </div>
                    <pre><code class="language-text">[0...low-1] [low...mid-1] [mid...high] [high+1...n-1]
     0s         1s          unknown      2s</code></pre>
                </div>
            </section>

            <!-- Algorithm Section -->
            <section id="algorithm" class="section">
                <h2><i class="fas fa-code"></i> アルゴリズム詳細</h2>

                <h3>3つのポインタの役割</h3>
                <div class="complexity-grid">
                    <div class="complexity-card">
                        <div class="complexity-title">
                            <i class="fas fa-arrow-right" style="color: #ff6b6b"></i>
                            low ポインタ
                        </div>
                        <p>次に0を配置する位置を指す。0の領域の右端+1。</p>
                    </div>
                    <div class="complexity-card">
                        <div class="complexity-title">
                            <i class="fas fa-search" style="color: #4ecdc4"></i>
                            mid ポインタ
                        </div>
                        <p>現在処理中の要素の位置。未処理領域の左端。</p>
                    </div>
                    <div class="complexity-card">
                        <div class="complexity-title">
                            <i class="fas fa-arrow-left" style="color: #bb86fc"></i>
                            high ポインタ
                        </div>
                        <p>次に2を配置する位置を指す。2の領域の左端-1。</p>
                    </div>
                </div>

                <h3>処理パターン</h3>

                <div class="step-display">
                    <span class="step-number">1</span>
                    <strong>nums[mid] == 0 の場合：</strong>
                    <br />nums[low]とnums[mid]を交換し、lowとmidを両方インクリメント
                </div>

                <div class="step-display">
                    <span class="step-number">2</span>
                    <strong>nums[mid] == 1 の場合：</strong>
                    <br />既に正しい位置にあるため、midのみインクリメント
                </div>

                <div class="step-display">
                    <span class="step-number">3</span>
                    <strong>nums[mid] == 2 の場合：</strong>
                    <br />nums[mid]とnums[high]を交換し、highをデクリメント（midは変更しない）
                </div>

                <div class="algorithm-display">
                    <h4>フローチャート</h4>
                    <div style="text-align: left; max-width: 600px; margin: 0 auto">
                        <div
                            style="
                                background: var(--bg-secondary);
                                padding: 1rem;
                                border-radius: 8px;
                                margin: 0.5rem 0;
                            "
                        >
                            <strong>開始:</strong> low = 0, mid = 0, high = n-1
                        </div>
                        <div style="text-align: center; margin: 0.5rem 0">↓</div>
                        <div
                            style="
                                background: var(--bg-secondary);
                                padding: 1rem;
                                border-radius: 8px;
                                margin: 0.5rem 0;
                            "
                        >
                            <strong>while mid ≤ high:</strong>
                            <div style="margin-left: 1rem">
                                <div>• nums[mid] == 0 → swap(low, mid), low++, mid++</div>
                                <div>• nums[mid] == 1 → mid++</div>
                                <div>• nums[mid] == 2 → swap(mid, high), high--</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin: 0.5rem 0">↓</div>
                        <div
                            style="
                                background: var(--bg-secondary);
                                padding: 1rem;
                                border-radius: 8px;
                                margin: 0.5rem 0;
                            "
                        >
                            <strong>終了:</strong> ソート完了
                        </div>
                    </div>
                </div>
            </section>

            <!-- Visualization Section -->
            <section id="visualization" class="section">
                <h2><i class="fas fa-eye"></i> ビジュアル実行</h2>

                <div class="algorithm-display">
                    <h3>インタラクティブデモ</h3>
                    <div class="array-container" id="arrayContainer">
                        <!-- Array elements will be dynamically generated -->
                    </div>

                    <div class="controls">
                        <button class="btn" id="resetBtn">
                            <i class="fas fa-undo"></i> リセット
                        </button>
                        <button class="btn" id="stepBtn">
                            <i class="fas fa-step-forward"></i> 次のステップ
                        </button>
                        <button class="btn" id="autoBtn">
                            <i class="fas fa-play"></i> 自動実行
                        </button>
                    </div>

                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value" id="stepCount">0</div>
                            <div class="stat-label">実行ステップ数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="swapCount">0</div>
                            <div class="stat-label">交換回数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="comparisonCount">0</div>
                            <div class="stat-label">比較回数</div>
                        </div>
                    </div>

                    <div id="stepDescription" class="step-display" style="display: none">
                        <span class="step-number" id="currentStepNum">1</span>
                        <span id="stepText">初期状態</span>
                    </div>
                </div>
            </section>

            <!-- Implementation Section -->
            <section id="implementation" class="section">
                <h2><i class="fas fa-code"></i> 実装コード</h2>

                <h3>業務開発向け堅牢版</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span class="code-title">sortColors_robust.py</span>
                        <button class="copy-btn" onclick="copyCode('code1')">
                            <i class="fas fa-copy"></i> コピー
                        </button>
                    </div>
                    <pre><code id="code1" class="language-python">from typing import List

class Solution:
    def sortColors(self, nums: List[int]) -> None:
        """
        オランダ国旗問題の解法 (業務開発向け堅牢版)
        Args:
            nums (List[int]): 色を表す配列 (0=赤, 1=白, 2=青)
        Returns:
            None: 配列を in-place でソート
        Raises:
            ValueError: 入力が空、または 0/1/2 以外を含む場合
        """
        # 入力検証
        if not nums:
            raise ValueError("Input must not be empty")
        if any(num not in (0, 1, 2) for num in nums):
            raise ValueError("Input must contain only 0, 1, or 2")

        # 3-way partitioning
        low, mid, high = 0, 0, len(nums) - 1

        while mid <= high:
            if nums[mid] == 0:
                # 0を左側に移動
                nums[low], nums[mid] = nums[mid], nums[low]
                low += 1
                mid += 1
            elif nums[mid] == 1:
                # 1は既に正しい位置
                mid += 1
            else:  # nums[mid] == 2
                # 2を右側に移動
                nums[mid], nums[high] = nums[high], nums[mid]
                high -= 1
                # midは進めない（交換された値を再評価）</code></pre>
                </div>

                <h3>競技プログラミング向け最適化版</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span class="code-title">sortColors_optimized.py</span>
                        <button class="copy-btn" onclick="copyCode('code2')">
                            <i class="fas fa-copy"></i> コピー
                        </button>
                    </div>
                    <pre><code id="code2" class="language-python">class Solution:
    def sortColors(self, nums: List[int]) -> None:
        """競技プログラミング向け最適化版"""
        low = mid = 0
        high = len(nums) - 1

        while mid <= high:
            if nums[mid] == 0:
                nums[low], nums[mid] = nums[mid], nums[low]
                low += 1
                mid += 1
            elif nums[mid] == 1:
                mid += 1
            else:
                nums[mid], nums[high] = nums[high], nums[mid]
                high -= 1</code></pre>
                </div>

                <h3>使用例</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span class="code-title">example_usage.py</span>
                        <button class="copy-btn" onclick="copyCode('code3')">
                            <i class="fas fa-copy"></i> コピー
                        </button>
                    </div>
                    <pre><code id="code3" class="language-python"># テストケース
def test_sort_colors():
    solution = Solution()

    # Example 1
    nums1 = [2, 0, 2, 1, 1, 0]
    solution.sortColors(nums1)
    print(f"Result 1: {nums1}")  # [0, 0, 1, 1, 2, 2]

    # Example 2
    nums2 = [2, 0, 1]
    solution.sortColors(nums2)
    print(f"Result 2: {nums2}")  # [0, 1, 2]

    # Edge cases
    nums3 = [0]
    solution.sortColors(nums3)
    print(f"Single element: {nums3}")  # [0]

    nums4 = [1, 1, 1]
    solution.sortColors(nums4)
    print(f"All same: {nums4}")  # [1, 1, 1]

if __name__ == "__main__":
    test_sort_colors()</code></pre>
                </div>
            </section>

            <!-- Complexity Section -->
            <section id="complexity" class="section">
                <h2><i class="fas fa-chart-line"></i> 計算量解析</h2>

                <div class="complexity-grid">
                    <div class="complexity-card">
                        <div class="complexity-title">
                            <i class="fas fa-clock"></i>
                            時間計算量
                        </div>
                        <div class="complexity-value">O(n)</div>
                        <p>
                            各要素は最大1回しか処理されない。midが右に進むか、highが左に進むかのいずれかで、最悪でもn回の操作で完了。
                        </p>
                    </div>

                    <div class="complexity-card">
                        <div class="complexity-title">
                            <i class="fas fa-memory"></i>
                            空間計算量
                        </div>
                        <div class="complexity-value">O(1)</div>
                        <p>
                            3つのポインタ変数のみを使用。追加の配列やデータ構造は不要でin-place操作を実現。
                        </p>
                    </div>
                </div>

                <h3>詳細分析</h3>

                <div class="step-display">
                    <span class="step-number">1</span>
                    <strong>最良ケース:</strong> 既にソートされている場合 → O(n)時間、n回の比較
                </div>

                <div class="step-display">
                    <span class="step-number">2</span>
                    <strong>平均ケース:</strong> ランダムな配列 → O(n)時間、約n/2回の交換
                </div>

                <div class="step-display">
                    <span class="step-number">3</span>
                    <strong>最悪ケース:</strong> 逆順にソート → O(n)時間、最大n回の交換
                </div>

                <h3>他のソート手法との比較</h3>
                <div style="overflow-x: auto">
                    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0">
                        <thead>
                            <tr style="background: var(--bg-tertiary)">
                                <th
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: left;
                                    "
                                >
                                    手法
                                </th>
                                <th
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    時間計算量
                                </th>
                                <th
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    空間計算量
                                </th>
                                <th
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    パス数
                                </th>
                                <th
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: left;
                                    "
                                >
                                    特徴
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        font-weight: bold;
                                        color: var(--accent-primary);
                                    "
                                >
                                    Dutch Flag
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(n)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(1)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    1
                                </td>
                                <td style="padding: 1rem; border: 1px solid var(--border)">
                                    最適解、in-place
                                </td>
                            </tr>
                            <tr style="background: rgba(255, 255, 255, 0.05)">
                                <td style="padding: 1rem; border: 1px solid var(--border)">
                                    Counting Sort
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(n)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(k)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    2
                                </td>
                                <td style="padding: 1rem; border: 1px solid var(--border)">
                                    追加配列が必要
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 1rem; border: 1px solid var(--border)">
                                    Quick Sort
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(n log n)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(log n)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    log n
                                </td>
                                <td style="padding: 1rem; border: 1px solid var(--border)">
                                    汎用的だが非効率
                                </td>
                            </tr>
                            <tr style="background: rgba(255, 255, 255, 0.05)">
                                <td style="padding: 1rem; border: 1px solid var(--border)">
                                    Merge Sort
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(n log n)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    O(n)
                                </td>
                                <td
                                    style="
                                        padding: 1rem;
                                        border: 1px solid var(--border);
                                        text-align: center;
                                    "
                                >
                                    log n
                                </td>
                                <td style="padding: 1rem; border: 1px solid var(--border)">
                                    安定だが空間を消費
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>実用性の評価</h3>
                <div class="complexity-grid" style="grid-template-columns: 1fr 1fr">
                    <div class="complexity-card" style="border-color: #4caf50">
                        <div class="complexity-title" style="color: #4caf50">
                            <i class="fas fa-thumbs-up"></i>
                            メリット
                        </div>
                        <ul style="text-align: left; margin-top: 1rem">
                            <li>最適な時間計算量 O(n)</li>
                            <li>定数の空間計算量 O(1)</li>
                            <li>In-place操作</li>
                            <li>1回のパスで完了</li>
                            <li>実装が比較的簡単</li>
                        </ul>
                    </div>
                    <div class="complexity-card" style="border-color: #ff9800">
                        <div class="complexity-title" style="color: #ff9800">
                            <i class="fas fa-exclamation-triangle"></i>
                            制限事項
                        </div>
                        <ul style="text-align: left; margin-top: 1rem">
                            <li>3つの値のみに特化</li>
                            <li>安定ソートではない</li>
                            <li>汎用性に欠ける</li>
                            <li>ポインタの管理が重要</li>
                            <li>デバッグが若干困難</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>

        <!-- Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

        <script>
            // Global variables for visualization
            let currentArray = [2, 0, 2, 1, 1, 0];
            let originalArray = [...currentArray];
            let low = 0,
                mid = 0,
                high = 5;
            let stepCount = 0;
            let swapCount = 0;
            let comparisonCount = 0;
            let isRunning = false;
            let autoInterval;

            // Navigation functionality
            document.addEventListener('DOMContentLoaded', function () {
                const navTabs = document.querySelectorAll('.nav-tab');
                const sections = document.querySelectorAll('.section');

                navTabs.forEach((tab) => {
                    tab.addEventListener('click', function (e) {
                        e.preventDefault();

                        // Remove active class from all tabs and sections
                        navTabs.forEach((t) => t.classList.remove('active'));
                        sections.forEach((s) => s.classList.remove('active'));

                        // Add active class to clicked tab
                        this.classList.add('active');

                        // Show corresponding section
                        const targetId = this.getAttribute('href').substring(1);
                        document.getElementById(targetId).classList.add('active');
                    });
                });

                // Initialize visualization
                initializeVisualization();
                updateDisplay();
            });

            // Visualization functions
            function initializeVisualization() {
                currentArray = [...originalArray];
                low = 0;
                mid = 0;
                high = currentArray.length - 1;
                stepCount = 0;
                swapCount = 0;
                comparisonCount = 0;
                isRunning = false;

                if (autoInterval) {
                    clearInterval(autoInterval);
                    autoInterval = null;
                }

                updateDisplay();
                updateDescription('初期状態: low=0, mid=0, high=' + high);
            }

            function updateDisplay() {
                const container = document.getElementById('arrayContainer');
                container.innerHTML = '';

                currentArray.forEach((value, index) => {
                    const element = document.createElement('div');
                    element.className = 'array-element';
                    element.textContent = value;

                    // Color coding
                    if (value === 0) element.classList.add('red');
                    else if (value === 1) element.classList.add('white');
                    else element.classList.add('blue');

                    // Add pointers
                    if (index === low && index === mid) {
                        element.innerHTML += '<div class="pointer">low,mid</div>';
                    } else if (index === low) {
                        element.innerHTML += '<div class="pointer">low</div>';
                    } else if (index === mid) {
                        element.innerHTML += '<div class="pointer">mid</div>';
                    } else if (index === high) {
                        element.innerHTML += '<div class="pointer">high</div>';
                    }

                    // Highlight current processing element
                    if (index === mid && mid <= high) {
                        element.classList.add('animate-pulse');
                    }

                    container.appendChild(element);
                });

                // Update stats
                document.getElementById('stepCount').textContent = stepCount;
                document.getElementById('swapCount').textContent = swapCount;
                document.getElementById('comparisonCount').textContent = comparisonCount;

                // Update buttons
                const stepBtn = document.getElementById('stepBtn');
                const autoBtn = document.getElementById('autoBtn');

                if (mid > high) {
                    stepBtn.disabled = true;
                    autoBtn.disabled = true;
                    autoBtn.innerHTML = '<i class="fas fa-check"></i> 完了';
                    updateDescription('ソート完了！');
                } else {
                    stepBtn.disabled = false;
                    autoBtn.disabled = false;
                    if (!isRunning) {
                        autoBtn.innerHTML = '<i class="fas fa-play"></i> 自動実行';
                    }
                }
            }

            function updateDescription(text) {
                const descElement = document.getElementById('stepDescription');
                const stepNum = document.getElementById('currentStepNum');
                const stepText = document.getElementById('stepText');

                stepNum.textContent = stepCount;
                stepText.textContent = text;
                descElement.style.display = 'block';
            }

            function executeStep() {
                if (mid > high) return false;

                comparisonCount++;
                stepCount++;

                if (currentArray[mid] === 0) {
                    // Swap with low position
                    [currentArray[low], currentArray[mid]] = [currentArray[mid], currentArray[low]];
                    swapCount++;
                    updateDescription(
                        `Step ${stepCount}: nums[${mid}] = 0 → swap(${low}, ${mid}), low++, mid++`,
                    );
                    low++;
                    mid++;
                } else if (currentArray[mid] === 1) {
                    // Just move mid
                    updateDescription(`Step ${stepCount}: nums[${mid}] = 1 → mid++`);
                    mid++;
                } else {
                    // currentArray[mid] === 2
                    // Swap with high position
                    [currentArray[mid], currentArray[high]] = [
                        currentArray[high],
                        currentArray[mid],
                    ];
                    swapCount++;
                    updateDescription(
                        `Step ${stepCount}: nums[${mid}] = 2 → swap(${mid}, ${high}), high--`,
                    );
                    high--;
                    // Note: mid is not incremented
                }

                updateDisplay();
                return mid <= high;
            }

            function startAutoExecution() {
                if (isRunning) {
                    // Stop auto execution
                    clearInterval(autoInterval);
                    isRunning = false;
                    document.getElementById('autoBtn').innerHTML =
                        '<i class="fas fa-play"></i> 自動実行';
                    return;
                }

                isRunning = true;
                document.getElementById('autoBtn').innerHTML = '<i class="fas fa-pause"></i> 停止';

                autoInterval = setInterval(() => {
                    if (!executeStep()) {
                        clearInterval(autoInterval);
                        isRunning = false;
                        document.getElementById('autoBtn').innerHTML =
                            '<i class="fas fa-check"></i> 完了';
                        document.getElementById('autoBtn').disabled = true;
                    }
                }, 1500);
            }

            // Event listeners
            document.getElementById('resetBtn').addEventListener('click', initializeVisualization);
            document.getElementById('stepBtn').addEventListener('click', executeStep);
            document.getElementById('autoBtn').addEventListener('click', startAutoExecution);

            // Copy code functionality
            function copyCode(elementId) {
                const codeElement = document.getElementById(elementId);
                const text = codeElement.textContent;

                navigator.clipboard
                    .writeText(text)
                    .then(function () {
                        // Show feedback
                        const btn = event.target.closest('.copy-btn');
                        const originalText = btn.innerHTML;
                        btn.innerHTML = '<i class="fas fa-check"></i> コピー済み';
                        btn.style.background = '#4CAF50';

                        setTimeout(() => {
                            btn.innerHTML = originalText;
                            btn.style.background = '';
                        }, 2000);
                    })
                    .catch(function () {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                    });
            }

            // Smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start',
                        });
                    }
                });
            });

            // Add some interactive hover effects
            document.addEventListener('mouseover', function (e) {
                if (e.target.classList.contains('array-element')) {
                    e.target.style.transform = 'scale(1.1) translateY(-5px)';
                    e.target.style.zIndex = '10';
                }
            });

            document.addEventListener('mouseout', function (e) {
                if (e.target.classList.contains('array-element')) {
                    e.target.style.transform = '';
                    e.target.style.zIndex = '';
                }
            });

            // Add keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                if (document.getElementById('visualization').classList.contains('active')) {
                    switch (e.key) {
                        case ' ': // Space for step
                            e.preventDefault();
                            if (!document.getElementById('stepBtn').disabled) {
                                executeStep();
                            }
                            break;
                        case 'Enter': // Enter for auto
                            e.preventDefault();
                            if (!document.getElementById('autoBtn').disabled) {
                                startAutoExecution();
                            }
                            break;
                        case 'r': // R for reset
                        case 'R':
                            e.preventDefault();
                            initializeVisualization();
                            break;
                    }
                }
            });

            // Add resize handler for responsive behavior
            window.addEventListener('resize', function () {
                // Ensure visualization remains centered and readable
                updateDisplay();
            });
        </script>
    </body>
</html>
