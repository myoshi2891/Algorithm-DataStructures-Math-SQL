<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>BIT (Binary Indexed Tree) Ë©≥Á¥∞Ëß£Ë™¨</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                min-height: 100vh;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                font-size: 2.5em;
                margin-bottom: 30px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .section {
                margin-bottom: 40px;
                padding: 25px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                border-left: 5px solid #3498db;
            }

            .section h2 {
                color: #2c3e50;
                border-bottom: 3px solid #3498db;
                padding-bottom: 10px;
                font-size: 1.8em;
            }

            .visualization {
                margin: 20px 0;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border: 2px solid #e9ecef;
            }

            .array-display {
                display: flex;
                justify-content: center;
                margin: 20px 0;
                flex-wrap: wrap;
                gap: 5px;
            }

            .array-cell {
                width: 50px;
                height: 50px;
                border: 2px solid #3498db;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 14px;
                border-radius: 8px;
                background: linear-gradient(45deg, #74b9ff, #0984e3);
                color: white;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .array-cell:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            }

            .array-cell.highlight {
                background: linear-gradient(45deg, #ff7675, #d63031);
                animation: pulse 1s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.05);
                }
            }

            .index-label {
                font-size: 12px;
                color: #666;
                margin-top: 5px;
            }

            .bit-structure {
                display: flex;
                flex-direction: column;
                align-items: center;
                margin: 30px 0;
            }

            .bit-level {
                display: flex;
                justify-content: center;
                margin: 15px 0;
                gap: 20px;
            }

            .bit-node {
                width: 80px;
                height: 60px;
                border: 3px solid #27ae60;
                border-radius: 12px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background: linear-gradient(45deg, #00b894, #00a085);
                color: white;
                font-weight: bold;
                box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .bit-node:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
            }

            .bit-node .index {
                font-size: 12px;
                opacity: 0.9;
            }

            .bit-node .value {
                font-size: 16px;
                font-weight: bold;
            }

            .connection {
                width: 2px;
                height: 20px;
                background: #95a5a6;
                margin: 0 auto;
            }

            .controls {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin: 25px 0;
                flex-wrap: wrap;
            }

            .control-group {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 15px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                border: 2px solid #e74c3c;
            }

            .control-group label {
                font-weight: bold;
                color: #2c3e50;
                min-width: 60px;
            }

            .control-group input {
                padding: 8px 12px;
                border: 2px solid #bdc3c7;
                border-radius: 6px;
                font-size: 14px;
                width: 80px;
                transition: border-color 0.3s ease;
            }

            .control-group input:focus {
                outline: none;
                border-color: #3498db;
                box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-weight: bold;
                font-size: 14px;
                transition: all 0.3s ease;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .btn-primary {
                background: linear-gradient(45deg, #3498db, #2980b9);
                color: white;
                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            }

            .btn-success {
                background: linear-gradient(45deg, #27ae60, #229954);
                color: white;
                box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            }

            .btn-success:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
            }

            .result {
                margin: 20px 0;
                padding: 15px;
                background: linear-gradient(45deg, #f39c12, #e67e22);
                color: white;
                border-radius: 10px;
                font-weight: bold;
                text-align: center;
                font-size: 18px;
                box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
            }

            .code-block {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 20px;
                border-radius: 10px;
                font-family: 'Courier New', monospace;
                margin: 15px 0;
                overflow-x: auto;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .code-block pre {
                margin: 0;
                white-space: pre-wrap;
            }

            .complexity-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                background: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            .complexity-table th,
            .complexity-table td {
                padding: 15px;
                text-align: left;
                border-bottom: 1px solid #bdc3c7;
            }

            .complexity-table th {
                background: linear-gradient(45deg, #34495e, #2c3e50);
                color: white;
                font-weight: bold;
            }

            .complexity-table tr:hover {
                background: #f8f9fa;
            }

            .binary-display {
                font-family: 'Courier New', monospace;
                background: #34495e;
                color: #ecf0f1;
                padding: 10px;
                border-radius: 6px;
                display: inline-block;
                margin: 5px;
                font-weight: bold;
            }

            .explanation {
                background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                padding: 20px;
                border-radius: 10px;
                margin: 15px 0;
                border-left: 5px solid #e74c3c;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>üå≥ BIT (Binary Indexed Tree) ÂÆåÂÖ®Ëß£Ë™¨</h1>

            <div class="section">
                <h2>üìä BIT„Å®„ÅØÔºü</h2>
                <div class="explanation">
                    <p>
                        <strong>Binary Indexed Tree (BIT)</strong
                        >„ÅØ„ÄÅÈÖçÂàó„ÅÆÂå∫ÈñìÂíå„ÇØ„Ç®„É™„Å®Ë¶ÅÁ¥†„ÅÆÊõ¥Êñ∞„ÇíÂäπÁéáÁöÑ„Å´Âá¶ÁêÜ„Åô„Çã„Éá„Éº„ÇøÊßãÈÄ†„Åß„Åô„ÄÇ
                    </p>
                    <p>
                        ÈÄöÂ∏∏„ÅÆÈÖçÂàó„Åß„ÅØÂå∫ÈñìÂíå„ÅÆË®àÁÆó„Å´O(n)ÊôÇÈñì„Åå„Åã„Åã„Çä„Åæ„Åô„Åå„ÄÅBIT„Çí‰ΩøÁî®„Åô„Çã„Åì„Å®„Åß<strong
                            >O(log n)</strong
                        >„ÅßÂÆüË°å„Åß„Åç„Åæ„Åô„ÄÇ
                    </p>
                </div>

                <table class="complexity-table">
                    <tr>
                        <th>Êìç‰Ωú</th>
                        <th>ÈÄöÂ∏∏„ÅÆÈÖçÂàó</th>
                        <th>BIT</th>
                    </tr>
                    <tr>
                        <td>Ë¶ÅÁ¥†„ÅÆÊõ¥Êñ∞</td>
                        <td>O(1)</td>
                        <td>O(log n)</td>
                    </tr>
                    <tr>
                        <td>Âå∫ÈñìÂíå„ÇØ„Ç®„É™</td>
                        <td>O(n)</td>
                        <td>O(log n)</td>
                    </tr>
                    <tr>
                        <td>Á©∫ÈñìË®àÁÆóÈáè</td>
                        <td>O(n)</td>
                        <td>O(n)</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>üéØ „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ „Éá„É¢</h2>
                <div class="visualization">
                    <h3>ÂÖÉ„ÅÆÈÖçÂàó</h3>
                    <div class="array-display" id="originalArray"></div>

                    <h3>BITÊßãÈÄ†</h3>
                    <div class="array-display" id="bitArray"></div>

                    <div class="controls">
                        <div class="control-group">
                            <label>„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ:</label>
                            <input type="number" id="updateIndex" min="1" max="8" value="1" />
                        </div>
                        <div class="control-group">
                            <label>ÂÄ§:</label>
                            <input type="number" id="updateValue" value="1" />
                        </div>
                        <button class="btn btn-primary" onclick="updateBIT()">Êõ¥Êñ∞</button>
                    </div>

                    <div class="controls">
                        <div class="control-group">
                            <label>ÈñãÂßã:</label>
                            <input type="number" id="queryStart" min="1" max="8" value="1" />
                        </div>
                        <div class="control-group">
                            <label>ÁµÇ‰∫Ü:</label>
                            <input type="number" id="queryEnd" min="1" max="8" value="3" />
                        </div>
                        <button class="btn btn-success" onclick="queryBIT()">Âå∫ÈñìÂíå„ÇØ„Ç®„É™</button>
                    </div>

                    <div class="result" id="result"></div>
                </div>
            </div>

            <div class="section">
                <h2>üî¢ BIT„ÅÆ‰ªïÁµÑ„Åø</h2>
                <div class="explanation">
                    <p>
                        BIT„ÅÆÊ†∏ÂøÉ„ÅØ<strong>ÊúÄ‰∏ã‰Ωç„Éì„ÉÉ„ÉàÔºàLSBÔºâ</strong>„ÅÆÊ¶ÇÂøµ„Åß„Åô„ÄÇÂêÑ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅåÁÆ°ÁêÜ„Åô„ÇãÁØÑÂõ≤„ÅØ„ÄÅ„Åù„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅÆ‰∫åÈÄ≤Ë°®Áèæ„ÅÆÊúÄ‰∏ã‰Ωç„ÅÆ1„Éì„ÉÉ„Éà„Å´„Çà„Å£„Å¶Ê±∫„Åæ„Çä„Åæ„Åô„ÄÇ
                    </p>

                    <h3>LSB „ÅÆË®àÁÆóÊñπÊ≥ï:</h3>
                    <div class="code-block">
                        <pre>
LSB(x) = x & (-x)

‰æãÔºö
6 (110‚ÇÇ) „ÅÆ LSB = 110‚ÇÇ & 010‚ÇÇ = 010‚ÇÇ = 2
8 (1000‚ÇÇ) „ÅÆ LSB = 1000‚ÇÇ & 1000‚ÇÇ = 1000‚ÇÇ = 8</pre
                        >
                    </div>

                    <h3>ÂêÑ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅåÁÆ°ÁêÜ„Åô„ÇãÁØÑÂõ≤:</h3>
                    <div id="bitRanges"></div>
                </div>
            </div>

            <div class="section">
                <h2>üíª ÂÆüË£Ö„Ç≥„Éº„Éâ</h2>
                <div class="code-block">
                    <pre>
class BIT {
    constructor(n) {
        this.n = n;
        this.tree = new Array(n + 1).fill(0);
    }
    
    // LSBÔºàÊúÄ‰∏ã‰Ωç„Éì„ÉÉ„ÉàÔºâ„ÇíÂèñÂæó
    lowbit(x) {
        return x & (-x);
    }
    
    // „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ i „Å´ÂÄ§ delta „ÇíÂä†ÁÆó
    update(i, delta) {
        while (i <= this.n) {
            this.tree[i] += delta;
            i += this.lowbit(i);
        }
    }
    
    // „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ 1 „Åã„Çâ i „Åæ„Åß„ÅÆÁ¥ØÁ©çÂíå„ÇíÂèñÂæó
    query(i) {
        let sum = 0;
        while (i > 0) {
            sum += this.tree[i];
            i -= this.lowbit(i);
        }
        return sum;
    }
    
    // „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ l „Åã„Çâ r „Åæ„Åß„ÅÆÂå∫ÈñìÂíå„ÇíÂèñÂæó
    rangeQuery(l, r) {
        return this.query(r) - this.query(l - 1);
    }
}</pre
                    >
                </div>
            </div>

            <div class="section">
                <h2>üéì ÂøúÁî®‰æã</h2>
                <div class="explanation">
                    <h3>BIT„ÅåÊ¥ªÁî®„Åï„Çå„ÇãÂ†¥Èù¢Ôºö</h3>
                    <ul>
                        <li>
                            <strong>Á´∂ÊäÄ„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞</strong>: Âå∫ÈñìÂíå„ÇØ„Ç®„É™„ÅåÈ†ªÁπÅ„Å´Áô∫Áîü„Åô„ÇãÂïèÈ°å
                        </li>
                        <li><strong>Áµ±Ë®àÂá¶ÁêÜ</strong>: „É™„Ç¢„É´„Çø„Ç§„É†„Åß„ÅÆÁ¥ØÁ©çÁµ±Ë®àË®àÁÆó</li>
                        <li><strong>„Ç≤„Éº„É†ÈñãÁô∫</strong>: „Çπ„Ç≥„Ç¢„É©„É≥„Ç≠„É≥„Ç∞„Ç∑„Çπ„ÉÜ„É†</li>
                        <li><strong>„Éá„Éº„ÇøÂàÜÊûê</strong>: ÊôÇÁ≥ªÂàó„Éá„Éº„Çø„ÅÆÂå∫ÈñìÈõÜË®à</li>
                    </ul>

                    <h3>È°û‰ºº„Éá„Éº„ÇøÊßãÈÄ†„Å®„ÅÆÊØîËºÉÔºö</h3>
                    <ul>
                        <li><strong>„Çª„Ç∞„É°„É≥„ÉàÊú®</strong>: „Çà„ÇäÊ±éÁî®ÁöÑ„Å†„Åå„ÄÅÂÆüË£Ö„ÅåË§áÈõë</li>
                        <li><strong>Âπ≥ÊñπÂàÜÂâ≤</strong>: ÂÆüË£Ö„ÅåÁ∞°Âçò„Å†„Åå„ÄÅË®àÁÆóÈáè„ÅåÂä£„Çã</li>
                        <li><strong>Á¥ØÁ©çÂíåÈÖçÂàó</strong>: Êõ¥Êñ∞„ÅåO(n)„Å®ÈùûÂäπÁéá</li>
                    </ul>
                </div>
            </div>
        </div>

        <script>
            class BIT {
                constructor(n) {
                    this.n = n;
                    this.tree = new Array(n + 1).fill(0);
                    this.original = new Array(n + 1).fill(0);
                }

                lowbit(x) {
                    return x & -x;
                }

                update(i, delta) {
                    this.original[i] += delta;
                    while (i <= this.n) {
                        this.tree[i] += delta;
                        i += this.lowbit(i);
                    }
                }

                query(i) {
                    let sum = 0;
                    while (i > 0) {
                        sum += this.tree[i];
                        i -= this.lowbit(i);
                    }
                    return sum;
                }

                rangeQuery(l, r) {
                    return this.query(r) - this.query(l - 1);
                }
            }

            // BIT„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÇíÂàùÊúüÂåñ
            const bit = new BIT(8);

            // ÂàùÊúüÂÄ§„ÇíË®≠ÂÆö
            for (let i = 1; i <= 8; i++) {
                bit.update(i, Math.floor(Math.random() * 10) + 1);
            }

            function updateDisplay() {
                // ÂÖÉ„ÅÆÈÖçÂàó„ÅÆË°®Á§∫
                const originalDiv = document.getElementById('originalArray');
                originalDiv.innerHTML = '';
                for (let i = 1; i <= 8; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'array-cell';
                    cell.innerHTML = `<div>${bit.original[i]}</div><div class="index-label">i=${i}</div>`;
                    originalDiv.appendChild(cell);
                }

                // BITÈÖçÂàó„ÅÆË°®Á§∫
                const bitDiv = document.getElementById('bitArray');
                bitDiv.innerHTML = '';
                for (let i = 1; i <= 8; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'array-cell';
                    cell.style.background = 'linear-gradient(45deg, #00b894, #00a085)';
                    cell.innerHTML = `<div>${bit.tree[i]}</div><div class="index-label">BIT[${i}]</div>`;
                    bitDiv.appendChild(cell);
                }

                updateBitRanges();
            }

            function updateBitRanges() {
                const rangesDiv = document.getElementById('bitRanges');
                let html =
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 20px 0;">';

                for (let i = 1; i <= 8; i++) {
                    const lsb = i & -i;
                    const start = i - lsb + 1;
                    const binary = i.toString(2).padStart(4, '0');

                    html += `
                    <div style="padding: 15px; background: white; border-radius: 8px; border: 2px solid #3498db; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">
                            „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ ${i} <span class="binary-display">${binary}</span>
                        </div>
                        <div style="color: #27ae60; font-weight: bold;">
                            LSB = ${lsb}, ÁÆ°ÁêÜÁØÑÂõ≤: [${start}, ${i}]
                        </div>
                        <div style="color: #e74c3c; margin-top: 8px;">
                            ÂÄ§: ${bit.tree[i]}
                        </div>
                    </div>
                `;
                }
                html += '</div>';
                rangesDiv.innerHTML = html;
            }

            function updateBIT() {
                const index = parseInt(document.getElementById('updateIndex').value);
                const value = parseInt(document.getElementById('updateValue').value);

                if (index >= 1 && index <= 8) {
                    const oldValue = bit.original[index];
                    const delta = value - oldValue;
                    bit.original[index] = value;

                    // BITÊõ¥Êñ∞
                    let i = index;
                    while (i <= 8) {
                        bit.tree[i] += delta;
                        i += bit.lowbit(i);
                    }

                    updateDisplay();
                    document.getElementById('result').innerHTML =
                        `„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ ${index} „Çí ${value} „Å´Êõ¥Êñ∞„Åó„Åæ„Åó„Åü`;

                    // Êõ¥Êñ∞„Åï„Çå„Åü„Çª„É´„Çí„Éè„Ç§„É©„Ç§„Éà
                    setTimeout(() => {
                        const cells = document.querySelectorAll('.array-cell');
                        cells[index - 1].classList.add('highlight');
                        setTimeout(() => cells[index - 1].classList.remove('highlight'), 2000);
                    }, 100);
                }
            }

            function queryBIT() {
                const start = parseInt(document.getElementById('queryStart').value);
                const end = parseInt(document.getElementById('queryEnd').value);

                if (start >= 1 && end <= 8 && start <= end) {
                    const result = bit.rangeQuery(start, end);
                    document.getElementById('result').innerHTML =
                        `Âå∫Èñì [${start}, ${end}] „ÅÆÂêàË®à: <strong>${result}</strong>`;

                    // „ÇØ„Ç®„É™ÁØÑÂõ≤„Çí„Éè„Ç§„É©„Ç§„Éà
                    const cells = document.querySelectorAll('.array-cell');
                    for (let i = start - 1; i < end; i++) {
                        cells[i].classList.add('highlight');
                    }
                    setTimeout(() => {
                        for (let i = start - 1; i < end; i++) {
                            cells[i].classList.remove('highlight');
                        }
                    }, 3000);
                }
            }

            // ÂàùÊúüË°®Á§∫
            updateDisplay();
            document.getElementById('result').innerHTML =
                'BIT„ÅåÂàùÊúüÂåñ„Åï„Çå„Åæ„Åó„Åü„ÄÇÊìç‰Ωú„ÇíË©¶„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑÔºÅ';
        </script>
    </body>
</html>
