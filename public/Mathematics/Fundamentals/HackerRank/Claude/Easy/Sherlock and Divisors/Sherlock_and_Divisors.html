<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>HackerRank: Divisors Divisible by 2</title>
        <script src="/vendor/react/react.development.js"></script>
        <script src="/vendor/react-dom/react-dom.development.js"></script>
        <script src="/vendor/babel/babel.min.js"></script>
        <script src="/vendor/tailwindcss/script.js"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Mono:wght@400;500&family=Noto+Sans+JP:wght@400;500;700&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            rel="stylesheet"
        />
        <link
            href="/vendor/prismjs/plugins/line-numbers/prism-line-numbers.css"
            rel="stylesheet"
        />
        <style>
            html {
                scroll-behavior: smooth;
            }
            body {
                font-family: 'Noto Sans JP', sans-serif;
                background: #f0fdf4;
                background-image:
                    radial-gradient(circle at 20% 20%, rgba(16, 185, 129, 0.08) 0, transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(14, 165, 233, 0.08) 0, transparent 50%);
                min-height: 100vh;
            }
            h1,
            h2,
            h3 {
                font-family: 'Syne', 'Noto Sans JP', sans-serif;
            }
            .dm {
                font-family: 'DM Mono', monospace;
            }
            /* ── Copy button: top-right ── */
            .code-wrapper {
                position: relative;
            }
            .code-wrapper pre {
                margin: 0;
            }
            .code-toolbar > .toolbar {
                display: none !important;
            }
            .copy-btn {
                position: absolute;
                top: 12px;
                right: 12px;
                z-index: 10;
                background: #334155;
                color: #e2e8f0;
                border-radius: 8px;
                padding: 5px 14px;
                font-size: 12px;
                font-family: 'DM Mono', monospace;
                border: none;
                cursor: pointer;
                transition:
                    background 0.2s,
                    transform 0.15s;
            }
            .copy-btn:hover {
                background: #10b981;
                transform: translateY(-1px);
            }
            .copy-btn.copied {
                background: #059669;
            }
            @keyframes fu {
                from {
                    opacity: 0;
                    transform: translateY(16px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .fu {
                animation: fu 0.5s ease both;
            }
            @keyframes bp {
                0%,
                100% {
                    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
                }
                50% {
                    box-shadow: 0 0 0 6px rgba(16, 185, 129, 0);
                }
            }
            .bp {
                animation: bp 2.2s infinite;
            }
            .sb {
                transition:
                    transform 0.15s,
                    box-shadow 0.15s;
            }
            ::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            ::-webkit-scrollbar-track {
                background: #e2e8f0;
                border-radius: 3px;
            }
            ::-webkit-scrollbar-thumb {
                background: #10b981;
                border-radius: 3px;
            }
        </style>
    </head>
    <body class="p-4 md:p-8 max-w-6xl mx-auto">
        <header
            id="header"
            class="mb-8 rounded-3xl p-8 shadow-[0_10px_40px_rgba(16,185,129,.15)] bg-[linear-gradient(135deg,#d1fae5,#bfdbfe)] fu"
        >
            <div class="flex flex-wrap gap-3 mb-2">
                <span
                    class="bp inline-block px-3 py-1 rounded-full bg-emerald-600 text-white text-xs font-bold dm"
                    >HackerRank</span
                >
                <span class="px-3 py-1 rounded-full bg-sky-600/20 text-sky-800 text-xs font-bold dm"
                    >Number Theory</span
                >
                <span
                    class="px-3 py-1 rounded-full bg-amber-400/30 text-amber-800 text-xs font-bold dm"
                    >O(√n)</span
                >
            </div>
            <h1 class="text-3xl md:text-5xl font-black text-teal-900 mb-2 leading-tight">
                Divisors Divisible by 2
            </h1>
            <p class="text-lg text-cyan-700 font-semibold">
                全単射で #divisors(n/2) に帰着する偶数約数カウント
            </p>
            <nav id="main-nav" class="flex flex-wrap gap-3 mt-6"></nav>
        </header>

        <div id="root"></div>

        <section
            id="code"
            class="bg-white rounded-2xl p-8 mb-8 shadow-[0_4px_20px_rgba(0,0,0,.07)] fu"
        >
            <h2 class="text-3xl font-black text-cyan-700 mb-4 pb-3 border-b-4 border-emerald-200">
                Python 実装
            </h2>
            <div class="code-wrapper">
                <button class="copy-btn" id="copyBtn" onclick="copyCode()">Copy</button>
                <pre
                    class="line-numbers rounded-xl overflow-x-auto"
                ><code class="language-python" id="codeBlock">from __future__ import annotations
import os


def divisors(n: int) -> int:
    """
    n の約数のうち 2 で割り切れるものの個数を返す。

    【全単射による帰着】
        A = { d : d|n, 2|d }  ←→  B = { k : k | (n//2) }
        写像 φ: d → d/2  は A→B の全単射。
        よって |A| = |B| = #divisors(n // 2)

    Time Complexity:  O(√n)
    Space Complexity: O(1)
    """
    if n % 2 != 0:          # ① 奇数なら偶数約数はゼロ
        return 0

    m: int = n // 2         # ② 全単射により n//2 の約数カウントに帰着
    count: int = 0

    i: int = 1
    while i * i <= m:       # ③ i=1 から √m まで走査
        if m % i == 0:
            count += 1 if i * i == m else 2  # 完全平方→+1, それ以外→+2
        i += 1

    return count


if __name__ == "__main__":
    fptr = open(os.environ["OUTPUT_PATH"], "w")
    t: int = int(input().strip())
    for _ in range(t):
        fptr.write(str(divisors(int(input().strip()))) + "\n")
    fptr.close()</code></pre>
            </div>
        </section>

        <section
            id="complexity"
            class="bg-white rounded-2xl p-8 mb-8 shadow-[0_4px_20px_rgba(0,0,0,.07)] fu"
        >
            <h2 class="text-3xl font-black text-cyan-700 mb-4 pb-3 border-b-4 border-emerald-200">
                計算量分析
            </h2>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-emerald-50">
                            <th
                                class="border border-emerald-200 px-4 py-3 text-left font-bold text-teal-800"
                            >
                                アプローチ
                            </th>
                            <th
                                class="border border-emerald-200 px-4 py-3 text-center font-bold text-teal-800"
                            >
                                時間
                            </th>
                            <th
                                class="border border-emerald-200 px-4 py-3 text-center font-bold text-teal-800"
                            >
                                空間
                            </th>
                            <th
                                class="border border-emerald-200 px-4 py-3 text-left font-bold text-teal-800"
                            >
                                備考
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-emerald-50/50">
                            <td
                                class="border border-emerald-200 px-4 py-3 font-semibold text-emerald-800"
                            >
                                ✅ 全単射 + √走査
                            </td>
                            <td
                                class="border border-emerald-200 px-4 py-3 text-center dm text-emerald-700"
                            >
                                O(√n)
                            </td>
                            <td
                                class="border border-emerald-200 px-4 py-3 text-center dm text-emerald-700"
                            >
                                O(1)
                            </td>
                            <td class="border border-emerald-200 px-4 py-3 text-slate-600">
                                本実装。数学的に最適。
                            </td>
                        </tr>
                        <tr>
                            <td class="border border-slate-200 px-4 py-3 text-slate-700">
                                全約数列挙 + フィルタ
                            </td>
                            <td class="border border-slate-200 px-4 py-3 text-center dm">O(√n)</td>
                            <td class="border border-slate-200 px-4 py-3 text-center dm">O(1)</td>
                            <td class="border border-slate-200 px-4 py-3 text-slate-600">
                                同等だが定数倍わずかに大
                            </td>
                        </tr>
                        <tr class="bg-red-50/30">
                            <td class="border border-slate-200 px-4 py-3">線形スキャン</td>
                            <td
                                class="border border-slate-200 px-4 py-3 text-center dm text-red-500"
                            >
                                O(n)
                            </td>
                            <td class="border border-slate-200 px-4 py-3 text-center dm">O(1)</td>
                            <td class="border border-slate-200 px-4 py-3 text-red-600">
                                大 n では TLE リスク
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section
            id="edgecases"
            class="bg-white rounded-2xl p-8 mb-8 shadow-[0_4px_20px_rgba(0,0,0,.07)] fu"
        >
            <h2 class="text-3xl font-black text-cyan-700 mb-4 pb-3 border-b-4 border-emerald-200">
                エッジケースと検証
            </h2>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-sky-50">
                            <th
                                class="border border-sky-200 px-4 py-3 text-center dm font-bold text-sky-800"
                            >
                                n
                            </th>
                            <th class="border border-sky-200 px-4 py-3 font-bold text-sky-800">
                                偶数約数
                            </th>
                            <th class="border border-sky-200 px-4 py-3 font-bold text-sky-800">
                                m=n/2 の約数
                            </th>
                            <th
                                class="border border-sky-200 px-4 py-3 text-center font-bold text-sky-800"
                            >
                                期待値
                            </th>
                            <th class="border border-sky-200 px-4 py-3 font-bold text-sky-800">
                                ポイント
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="border border-slate-200 px-4 py-2 text-center dm font-bold">
                                1
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-400">—</td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-400">—</td>
                            <td
                                class="border border-slate-200 px-4 py-2 text-center dm font-bold text-emerald-700"
                            >
                                0 ✅
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                奇数の基底ケース
                            </td>
                        </tr>
                        <tr class="bg-slate-50">
                            <td class="border border-slate-200 px-4 py-2 text-center dm font-bold">
                                2
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">2</td>
                            <td class="border border-slate-200 px-4 py-2 dm text-slate-600">1</td>
                            <td
                                class="border border-slate-200 px-4 py-2 text-center dm font-bold text-emerald-700"
                            >
                                1 ✅
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                最小偶数
                            </td>
                        </tr>
                        <tr>
                            <td class="border border-slate-200 px-4 py-2 text-center dm font-bold">
                                9
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-400">—</td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-400">—</td>
                            <td
                                class="border border-slate-200 px-4 py-2 text-center dm font-bold text-emerald-700"
                            >
                                0 ✅
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                奇数（サンプル）
                            </td>
                        </tr>
                        <tr class="bg-slate-50">
                            <td class="border border-slate-200 px-4 py-2 text-center dm font-bold">
                                8
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                2, 4, 8
                            </td>
                            <td class="border border-slate-200 px-4 py-2 dm text-slate-600">
                                1, 2, 4
                            </td>
                            <td
                                class="border border-slate-200 px-4 py-2 text-center dm font-bold text-emerald-700"
                            >
                                3 ✅
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                サンプル入力
                            </td>
                        </tr>
                        <tr>
                            <td class="border border-slate-200 px-4 py-2 text-center dm font-bold">
                                16
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                2,4,8,16
                            </td>
                            <td class="border border-slate-200 px-4 py-2 dm text-slate-600">
                                1,2,4,8
                            </td>
                            <td
                                class="border border-slate-200 px-4 py-2 text-center dm font-bold text-emerald-700"
                            >
                                4 ✅
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">2 の冪</td>
                        </tr>
                        <tr class="bg-slate-50">
                            <td class="border border-slate-200 px-4 py-2 text-center dm font-bold">
                                36
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                2,4,6,12,18,36
                            </td>
                            <td class="border border-slate-200 px-4 py-2 dm text-slate-600">
                                1,2,3,6,9,18
                            </td>
                            <td
                                class="border border-slate-200 px-4 py-2 text-center dm font-bold text-emerald-700"
                            >
                                6 ✅
                            </td>
                            <td class="border border-slate-200 px-4 py-2 text-slate-600">
                                完全平方 m=18
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section
            id="faq"
            class="bg-white rounded-2xl p-8 mb-8 shadow-[0_4px_20px_rgba(0,0,0,.07)] fu"
        >
            <h2 class="text-3xl font-black text-cyan-700 mb-6 pb-3 border-b-4 border-emerald-200">
                FAQ
            </h2>
            <div class="space-y-4">
                <div class="p-5 rounded-xl bg-emerald-50 border-l-4 border-emerald-500">
                    <p class="font-bold text-teal-800 mb-1">
                        Q1. なぜ偶数約数の個数 = n/2 の約数の個数？
                    </p>
                    <p class="text-slate-600 text-sm">
                        写像 φ: d→d/2 が全単射になるためです。d|n かつ 2|d ⟺ d/2|n/2 が成立します。
                    </p>
                </div>
                <div class="p-5 rounded-xl bg-sky-50 border-l-4 border-sky-500">
                    <p class="font-bold text-sky-800 mb-1">
                        Q2. 完全平方のとき count+=1 とする理由は？
                    </p>
                    <p class="text-slate-600 text-sm">
                        i²=m のとき i=m/i なので同一の約数を 2 回数えてしまいます。加算を 1
                        に留めることで重複を防ぎます。
                    </p>
                </div>
                <div class="p-5 rounded-xl bg-amber-50 border-l-4 border-amber-400">
                    <p class="font-bold text-amber-800 mb-1">
                        Q3. n が奇数のとき偶数約数がゼロになるのはなぜ？
                    </p>
                    <p class="text-slate-600 text-sm">
                        d|n かつ 2|d と仮定すると 2|n が言えます。これは n
                        が奇数という仮定に矛盾します。
                    </p>
                </div>
                <div class="p-5 rounded-xl bg-purple-50 border-l-4 border-purple-400">
                    <p class="font-bold text-purple-800 mb-1">
                        Q4. 非常に大きな n でも動作するか？
                    </p>
                    <p class="text-slate-600 text-sm">
                        Python の int は任意精度整数なので桁あふれはありません。n=10¹² でも
                        √(n/2)≈7×10⁵ ステップ程度です。
                    </p>
                </div>
            </div>
        </section>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

        <script>
            function copyCode() {
                var c = document.getElementById('codeBlock').textContent;
                navigator.clipboard.writeText(c).then(function () {
                    var b = document.getElementById('copyBtn');
                    b.textContent = 'Copied!';
                    b.classList.add('copied');
                    setTimeout(function () {
                        b.textContent = 'Copy';
                        b.classList.remove('copied');
                    }, 2000);
                });
            }
        </script>

        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            function computeDivisors(n) {
                if (n <= 0) return [];
                const d = [];
                for (let i = 1; i * i <= n; i++)
                    if (n % i === 0) {
                        d.push(i);
                        if (i !== n / i) d.push(n / i);
                    }
                return d.sort((a, b) => a - b);
            }

            /* ── Shared SVG helpers ── */
            const AD = () => (
                <defs>
                    <marker
                        id="ag"
                        markerWidth="8"
                        markerHeight="6"
                        refX="7"
                        refY="3"
                        orient="auto"
                    >
                        <path d="M0,0 L0,6 L8,3z" fill="#64748b" />
                    </marker>
                    <marker
                        id="agr"
                        markerWidth="8"
                        markerHeight="6"
                        refX="7"
                        refY="3"
                        orient="auto"
                    >
                        <path d="M0,0 L0,6 L8,3z" fill="#059669" />
                    </marker>
                    <marker
                        id="ar"
                        markerWidth="8"
                        markerHeight="6"
                        refX="7"
                        refY="3"
                        orient="auto"
                    >
                        <path d="M0,0 L0,6 L8,3z" fill="#dc2626" />
                    </marker>
                    <marker
                        id="ap"
                        markerWidth="8"
                        markerHeight="6"
                        refX="7"
                        refY="3"
                        orient="auto"
                    >
                        <path d="M0,0 L0,6 L8,3z" fill="#a855f7" />
                    </marker>
                    <marker
                        id="ab"
                        markerWidth="8"
                        markerHeight="6"
                        refX="7"
                        refY="3"
                        orient="auto"
                    >
                        <path d="M0,0 L0,6 L8,3z" fill="#0284c7" />
                    </marker>
                </defs>
            );

            const R = ({ x, y, w, h, fill, stroke, sw = 2, r = 10 }) => (
                <rect
                    x={x}
                    y={y}
                    width={w}
                    height={h}
                    rx={r}
                    fill={fill}
                    stroke={stroke}
                    strokeWidth={sw}
                />
            );
            const D = ({ cx, cy, hw, hh, fill, stroke, sw = 2 }) => (
                <polygon
                    points={`${cx},${cy - hh} ${cx + hw},${cy} ${cx},${cy + hh} ${cx - hw},${cy}`}
                    fill={fill}
                    stroke={stroke}
                    strokeWidth={sw}
                />
            );

            function TL({
                x,
                y,
                lines,
                fill = '#1e293b',
                fs = 13,
                ff = 'Noto Sans JP',
                fw = 'normal',
                anchor = 'middle',
            }) {
                const lh = fs * 1.55;
                const top = y - ((lines.length - 1) * lh) / 2;
                return (
                    <>
                        {lines.map((t, i) => (
                            <text
                                key={i}
                                x={x}
                                y={top + i * lh}
                                textAnchor={anchor}
                                dominantBaseline="middle"
                                fontFamily={ff}
                                fontSize={fs}
                                fontWeight={fw}
                                fill={fill}
                            >
                                {t}
                            </text>
                        ))}
                    </>
                );
            }

            /* ══════════════════════════════════════════════
   VisInput — Step1 (FIXED: wider viewBox, clear arrows)
   ══════════════════════════════════════════════ */
            function VisInput({ n, isOdd }) {
                const W = 660,
                    H = 280;
                // Input box
                const iCX = 120,
                    iY = 40,
                    iW = 160,
                    iH = 60;
                // Diamond
                const dCX = 120,
                    dCY = 170,
                    dHW = 110,
                    dHH = 52;
                // Right: return 0
                const rCX = 460,
                    rY = 144,
                    rW = 160,
                    rH = 52;
                // Down: next step box
                const nCX = 120,
                    nY = 248,
                    nW = 180,
                    nH = 28;
                return (
                    <svg viewBox={`0 0 ${W} ${H}`} style={{ maxWidth: '100%', height: 'auto' }}>
                        <AD />
                        {/* Input box */}
                        <R x={iCX - iW / 2} y={iY} w={iW} h={iH} fill="#e0f2fe" stroke="#0284c7" />
                        <TL x={iCX} y={iY + 18} lines={['入力']} fill="#0c4a6e" fs={12} />
                        <TL
                            x={iCX}
                            y={iY + 43}
                            lines={[`n = ${n}`]}
                            fill="#0284c7"
                            fs={17}
                            ff="DM Mono"
                            fw="bold"
                        />

                        {/* Input → Diamond (down) */}
                        <line
                            x1={iCX}
                            y1={iY + iH}
                            x2={iCX}
                            y2={dCY - dHH - 4}
                            stroke="#64748b"
                            strokeWidth={2}
                            markerEnd="url(#ag)"
                        />

                        {/* Diamond */}
                        <D
                            cx={dCX}
                            cy={dCY}
                            hw={dHW}
                            hh={dHH}
                            fill={isOdd ? '#fee2e2' : '#fef3c7'}
                            stroke={isOdd ? '#dc2626' : '#f59e0b'}
                        />
                        <TL x={dCX} y={dCY - 10} lines={['n が奇数?']} fill="#78350f" fs={13} />
                        <TL
                            x={dCX}
                            y={dCY + 13}
                            lines={['n % 2 != 0']}
                            fill="#92400e"
                            fs={12}
                            ff="DM Mono"
                        />

                        {/* Right branch: はい → return 0 */}
                        <line
                            x1={dCX + dHW + 4}
                            y1={dCY}
                            x2={rCX - rW / 2 - 4}
                            y2={dCY}
                            stroke="#dc2626"
                            strokeWidth={2}
                            markerEnd="url(#ar)"
                        />
                        {/* Label above the arrow */}
                        <text
                            x={(dCX + dHW + rCX - rW / 2) / 2}
                            y={dCY - 12}
                            textAnchor="middle"
                            fontFamily="Noto Sans JP"
                            fontSize={12}
                            fontWeight="bold"
                            fill="#dc2626"
                        >
                            はい
                        </text>

                        {/* return 0 box */}
                        <R
                            x={rCX - rW / 2}
                            y={rY}
                            w={rW}
                            h={rH}
                            fill={isOdd ? '#fee2e2' : '#f1f5f9'}
                            stroke={isOdd ? '#dc2626' : '#94a3b8'}
                        />
                        <TL
                            x={rCX}
                            y={rY + rH / 2}
                            lines={['return 0']}
                            fill={isOdd ? '#dc2626' : '#94a3b8'}
                            fs={15}
                            ff="DM Mono"
                            fw="bold"
                        />

                        {/* Down branch: いいえ → next step box */}
                        <line
                            x1={dCX}
                            y1={dCY + dHH + 4}
                            x2={dCX}
                            y2={nY - 4}
                            stroke="#059669"
                            strokeWidth={2}
                            markerEnd="url(#agr)"
                        />
                        {/* Label to the right of the down arrow */}
                        <text
                            x={dCX + 16}
                            y={dCY + dHH + 20}
                            textAnchor="start"
                            fontFamily="Noto Sans JP"
                            fontSize={12}
                            fontWeight="bold"
                            fill="#059669"
                        >
                            いいえ
                        </text>

                        {/* Next step indicator box */}
                        <R
                            x={nCX - nW / 2}
                            y={nY}
                            w={nW}
                            h={nH}
                            fill="#d1fae5"
                            stroke="#10b981"
                            r={14}
                        />
                        <TL
                            x={nCX}
                            y={nY + nH / 2}
                            lines={['次のステップへ ▼']}
                            fill="#065f46"
                            fs={12}
                            fw="bold"
                        />
                    </svg>
                );
            }

            function VisOddReturn({ n }) {
                return (
                    <svg viewBox="0 0 460 130" style={{ maxWidth: '100%', height: 'auto' }}>
                        <R
                            x={80}
                            y={18}
                            w={300}
                            h={90}
                            fill="#fee2e2"
                            stroke="#dc2626"
                            sw={3}
                            r={16}
                        />
                        <TL x={230} y={52} lines={[`n = ${n} は奇数`]} fill="#7f1d1d" fs={14} />
                        <TL
                            x={230}
                            y={86}
                            lines={['return 0']}
                            fill="#dc2626"
                            fs={20}
                            ff="DM Mono"
                            fw="bold"
                        />
                    </svg>
                );
            }

            function VisBijection({ n, m }) {
                const lX = 10,
                    lY = 48,
                    lW = 190,
                    lH = 80;
                const rX = 358,
                    rY = 48,
                    rW = 200,
                    rH = 80;
                const aY = lY + lH / 2;
                return (
                    <svg viewBox="0 0 570 170" style={{ maxWidth: '100%', height: 'auto' }}>
                        <AD />
                        <R x={lX} y={lY} w={lW} h={lH} fill="#e0f2fe" stroke="#0284c7" />
                        <TL
                            x={lX + lW / 2}
                            y={lY + 22}
                            lines={['n の偶数約数集合']}
                            fill="#0c4a6e"
                            fs={12}
                        />
                        <TL
                            x={lX + lW / 2}
                            y={lY + 54}
                            lines={[`n = ${n}`]}
                            fill="#0284c7"
                            fs={20}
                            ff="DM Mono"
                            fw="bold"
                        />
                        <line
                            x1={lX + lW + 4}
                            y1={aY}
                            x2={rX - 4}
                            y2={aY}
                            stroke="#059669"
                            strokeWidth={2.5}
                            markerEnd="url(#agr)"
                        />
                        <text
                            x={(lX + lW + rX) / 2}
                            y={aY - 14}
                            textAnchor="middle"
                            fontFamily="DM Mono"
                            fontSize={12}
                            fill="#059669"
                        >
                            φ: d → d/2
                        </text>
                        <text
                            x={(lX + lW + rX) / 2}
                            y={aY + 16}
                            textAnchor="middle"
                            fontFamily="Noto Sans JP"
                            fontSize={11}
                            fill="#059669"
                        >
                            全単射
                        </text>
                        <R x={rX} y={rY} w={rW} h={rH} fill="#d1fae5" stroke="#10b981" sw={2.5} />
                        <TL
                            x={rX + rW / 2}
                            y={rY + 22}
                            lines={['m = n/2 の約数集合']}
                            fill="#065f46"
                            fs={12}
                        />
                        <TL
                            x={rX + rW / 2}
                            y={rY + 54}
                            lines={[`m = ${m}`]}
                            fill="#059669"
                            fs={20}
                            ff="DM Mono"
                            fw="bold"
                        />
                        <text
                            x={285}
                            y={148}
                            textAnchor="middle"
                            fontFamily="Noto Sans JP"
                            fontSize={12}
                            fill="#475569"
                        >
                            |偶数約数| = |divisors({m})| ← 帰着先
                        </text>
                    </svg>
                );
            }

            function VisScan({ m, divs }) {
                const sq = Math.floor(Math.sqrt(m));
                const pairs = [];
                for (let i = 1; i * i <= m; i++)
                    if (m % i === 0) pairs.push({ a: i, b: m / i, sq: i * i === m });
                const ms = 5,
                    show = pairs.slice(0, ms);
                const W = 560,
                    bW = Math.min(86, Math.floor((W - 40) / (show.length || 1)) - 8),
                    bH = 64,
                    gap = 8;
                const tw = show.length * (bW + gap) - gap,
                    sx = (W - tw) / 2;
                return (
                    <svg viewBox={`0 0 ${W} 205`} style={{ maxWidth: '100%', height: 'auto' }}>
                        <text
                            x={W / 2}
                            y={17}
                            textAnchor="middle"
                            fontFamily="Noto Sans JP"
                            fontSize={13}
                            fill="#334155"
                        >
                            m = {m}（√m ≈ {sq} まで走査）
                        </text>
                        {show.map((p, i) => {
                            const bx = sx + i * (bW + gap),
                                by = 28;
                            return (
                                <g key={i}>
                                    <R
                                        x={bx}
                                        y={by}
                                        w={bW}
                                        h={bH}
                                        fill={p.sq ? '#fef3c7' : '#d1fae5'}
                                        stroke={p.sq ? '#f59e0b' : '#10b981'}
                                    />
                                    <text
                                        x={bx + bW / 2}
                                        y={by + 19}
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontFamily="DM Mono"
                                        fontSize={13}
                                        fontWeight="bold"
                                        fill={p.sq ? '#92400e' : '#065f46'}
                                    >
                                        i={p.a}
                                    </text>
                                    <text
                                        x={bx + bW / 2}
                                        y={by + 39}
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontFamily="DM Mono"
                                        fontSize={12}
                                        fill={p.sq ? '#92400e' : '#065f46'}
                                    >
                                        {p.sq ? '+1' : '+2'}
                                    </text>
                                    <text
                                        x={bx + bW / 2}
                                        y={by + 57}
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontFamily="DM Mono"
                                        fontSize={10}
                                        fill={p.sq ? '#a16207' : '#047857'}
                                    >
                                        {p.sq ? `(${p.a}²=m)` : `${p.a},${p.b}`}
                                    </text>
                                </g>
                            );
                        })}
                        {pairs.length > ms && (
                            <text
                                x={W / 2}
                                y={106}
                                textAnchor="middle"
                                fontFamily="Noto Sans JP"
                                fontSize={12}
                                fill="#94a3b8"
                            >
                                ... 他 {pairs.length - ms} ペア
                            </text>
                        )}
                        <text
                            x={W / 2}
                            y={124}
                            textAnchor="middle"
                            fontFamily="Noto Sans JP"
                            fontSize={12}
                            fill="#475569"
                        >
                            divisors({m}) = [ {divs.join(', ')} ]
                        </text>
                        <R
                            x={(W - 200) / 2}
                            y={138}
                            w={200}
                            h={52}
                            fill="#d1fae5"
                            stroke="#10b981"
                        />
                        <TL x={W / 2} y={156} lines={['約数の個数']} fill="#065f46" fs={12} />
                        <TL
                            x={W / 2}
                            y={177}
                            lines={[`count = ${divs.length}`]}
                            fill="#059669"
                            fs={18}
                            ff="DM Mono"
                            fw="bold"
                        />
                    </svg>
                );
            }

            function VisMapping({ n, m, mDivs, evenDivs }) {
                const ms = 6,
                    show = mDivs.slice(0, ms),
                    showE = evenDivs.slice(0, ms);
                const rH = 30,
                    sY = 44,
                    W = 500,
                    H = sY + show.length * rH + 50;
                return (
                    <svg viewBox={`0 0 ${W} ${H}`} style={{ maxWidth: '100%', height: 'auto' }}>
                        <AD />
                        <text
                            x={110}
                            y={18}
                            textAnchor="middle"
                            fontFamily="DM Mono"
                            fontSize={13}
                            fontWeight="bold"
                            fill="#0284c7"
                        >
                            divisors({m})
                        </text>
                        <text
                            x={390}
                            y={18}
                            textAnchor="middle"
                            fontFamily="Noto Sans JP"
                            fontSize={13}
                            fontWeight="bold"
                            fill="#059669"
                        >
                            {n} の偶数約数
                        </text>
                        <line x1={20} y1={28} x2={480} y2={28} stroke="#e2e8f0" strokeWidth={1} />
                        {show.map((d, i) => {
                            const y = sY + i * rH;
                            return (
                                <g key={i}>
                                    <R
                                        x={20}
                                        y={y}
                                        w={160}
                                        h={24}
                                        fill="#e0f2fe"
                                        stroke="#0ea5e9"
                                        sw={1.5}
                                    />
                                    <text
                                        x={100}
                                        y={y + 12}
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontFamily="DM Mono"
                                        fontSize={14}
                                        fill="#0c4a6e"
                                    >
                                        {d}
                                    </text>
                                    <line
                                        x1={184}
                                        y1={y + 12}
                                        x2={308}
                                        y2={y + 12}
                                        stroke="#10b981"
                                        strokeWidth={1.8}
                                        markerEnd="url(#agr)"
                                    />
                                    <text
                                        x={246}
                                        y={y + 4}
                                        textAnchor="middle"
                                        fontFamily="DM Mono"
                                        fontSize={10}
                                        fill="#059669"
                                    >
                                        ×2
                                    </text>
                                    <R
                                        x={312}
                                        y={y}
                                        w={160}
                                        h={24}
                                        fill="#d1fae5"
                                        stroke="#10b981"
                                        sw={1.5}
                                    />
                                    <text
                                        x={392}
                                        y={y + 12}
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontFamily="DM Mono"
                                        fontSize={14}
                                        fill="#065f46"
                                    >
                                        {showE[i]}
                                    </text>
                                </g>
                            );
                        })}
                        {mDivs.length > ms && (
                            <text
                                x={W / 2}
                                y={sY + show.length * rH + 18}
                                textAnchor="middle"
                                fontFamily="Noto Sans JP"
                                fontSize={12}
                                fill="#94a3b8"
                            >
                                ... 他 {mDivs.length - ms} 件
                            </text>
                        )}
                    </svg>
                );
            }

            function VisResult({ n, count, evenDivs }) {
                return (
                    <svg viewBox="0 0 460 152" style={{ maxWidth: '100%', height: 'auto' }}>
                        <R
                            x={50}
                            y={10}
                            w={360}
                            h={130}
                            fill="#d1fae5"
                            stroke="#10b981"
                            sw={3}
                            r={18}
                        />
                        <TL
                            x={230}
                            y={40}
                            lines={[`n = ${n} の偶数約数の個数`]}
                            fill="#065f46"
                            fs={14}
                        />
                        <TL
                            x={230}
                            y={88}
                            lines={[String(count)]}
                            fill="#059669"
                            fs={46}
                            ff="DM Mono"
                            fw="bold"
                        />
                        {evenDivs.length > 0 ? (
                            <TL
                                x={230}
                                y={128}
                                lines={[`[ ${evenDivs.join(', ')} ]`]}
                                fill="#047857"
                                fs={12}
                                ff="DM Mono"
                            />
                        ) : (
                            <TL
                                x={230}
                                y={128}
                                lines={['奇数のため偶数約数なし']}
                                fill="#dc2626"
                                fs={12}
                            />
                        )}
                    </svg>
                );
            }

            function StepViz({ visual }) {
                if (!visual) return null;
                return (
                    <div style={{ marginTop: '14px' }}>
                        {visual.type === 'input' && <VisInput {...visual} />}
                        {visual.type === 'odd_return' && <VisOddReturn {...visual} />}
                        {visual.type === 'bijection' && <VisBijection {...visual} />}
                        {visual.type === 'scan' && <VisScan {...visual} />}
                        {visual.type === 'mapping' && <VisMapping {...visual} />}
                        {visual.type === 'result' && <VisResult {...visual} />}
                    </div>
                );
            }

            function makeSteps(n) {
                const isOdd = n % 2 !== 0,
                    m = Math.floor(n / 2);
                const mD = computeDivisors(m),
                    nD = computeDivisors(n),
                    eD = nD.filter((d) => d % 2 === 0);
                const raw = [
                    {
                        title: '入力 n の確認',
                        desc: `n=${n} を受け取る。奇数判定 (n%2!=0) を行う。奇数なら即座に 0 を返し、偶数なら次へ進む。`,
                        visual: { type: 'input', n, isOdd },
                    },
                    ...(isOdd
                        ? [
                              {
                                  title: '奇数 → 0 を返す',
                                  desc: `n=${n} は奇数。偶数約数は存在しないため 0 を返して終了。`,
                                  visual: { type: 'odd_return', n },
                              },
                          ]
                        : [
                              {
                                  title: `m = n/2 = ${m} に帰着`,
                                  desc: `全単射 φ: d→d/2 により、n の偶数約数の個数 = m=${m} の約数の個数。問題を置き換える。`,
                                  visual: { type: 'bijection', n, m },
                              },
                              {
                                  title: `√m ≈ ${Math.floor(Math.sqrt(m))} まで走査`,
                                  desc: `i=1 から √m まで m%i==0 を確認。約数ペア (i,m/i) を計上。完全平方なら +1、それ以外は +2。`,
                                  visual: { type: 'scan', m, divs: mD },
                              },
                              {
                                  title: '全単射の対応を確認',
                                  desc: `m=${m} の約数 [${mD.join(', ')}] が n=${n} の偶数約数 [${eD.join(', ')}] に一対一対応する。`,
                                  visual: { type: 'mapping', n, m, mDivs: mD, evenDivs: eD },
                              },
                          ]),
                    {
                        title: `結果: ${isOdd ? 0 : mD.length}`,
                        desc: `n=${n} の偶数約数は ${isOdd ? 0 : mD.length} 個。${isOdd ? '（奇数のためゼロ）' : `偶数約数: [${eD.join(', ')}]`}`,
                        visual: {
                            type: 'result',
                            n,
                            count: isOdd ? 0 : mD.length,
                            evenDivs: isOdd ? [] : eD,
                        },
                    },
                ];
                return raw.map((s, i) => ({ ...s, step: i + 1 }));
            }

            function StepsSection() {
                const [N, setN] = useState(8);
                const [edit, setEdit] = useState('8');
                const [steps, setSteps] = useState(() => makeSteps(8));
                const [cur, setCur] = useState(1);
                const [play, setPlay] = useState(false);
                const tr = useRef(null);
                const apply = () => {
                    const v = parseInt(edit, 10);
                    if (!isNaN(v) && v >= 1) {
                        setN(v);
                        setSteps(makeSteps(v));
                        setCur(1);
                        setPlay(false);
                    }
                };
                useEffect(() => {
                    if (!play) return;
                    if (cur > steps.length) {
                        setPlay(false);
                        setCur(1);
                        return;
                    }
                    tr.current = setTimeout(() => {
                        if (cur === steps.length) {
                            setCur(1);
                            setPlay(false);
                        } else setCur((p) => p + 1);
                    }, 1800);
                    return () => clearTimeout(tr.current);
                }, [play, cur, steps.length]);
                const cs = steps.find((s) => s.step === cur) || steps[0];
                const presets = [1, 2, 8, 9, 12, 36, 100];
                return (
                    <section
                        id="steps"
                        className="bg-white rounded-2xl p-8 mb-8 shadow-[0_4px_20px_rgba(0,0,0,.07)]"
                    >
                        <h2 className="text-3xl font-black text-cyan-700 mb-2 pb-3 border-b-4 border-emerald-200">
                            ステップバイステップ解説
                        </h2>
                        <div className="flex flex-wrap items-center gap-3 my-5 p-4 rounded-xl bg-slate-50 border border-slate-200">
                            <span className="text-slate-600 font-semibold text-sm">n を入力：</span>
                            <input
                                type="number"
                                min="1"
                                value={edit}
                                onChange={(e) => setEdit(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && apply()}
                                className="w-24 px-3 py-2 rounded-lg border-2 border-emerald-200 focus:border-emerald-500 outline-none text-center dm font-bold text-lg text-emerald-800 bg-white"
                            />
                            <button
                                type="button"
                                onClick={apply}
                                className="px-5 py-2 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-500 to-teal-600 hover:-translate-y-0.5 transition text-sm"
                            >
                                適用
                            </button>
                            <div className="flex gap-2 flex-wrap">
                                {presets.map((v) => (
                                    <button
                                        key={v}
                                        type="button"
                                        onClick={() => {
                                            setEdit(String(v));
                                            setSteps(makeSteps(v));
                                            setN(v);
                                            setCur(1);
                                            setPlay(false);
                                        }}
                                        className={[
                                            'px-3 py-1 rounded-lg text-sm dm font-bold transition border-2',
                                            N === v
                                                ? 'bg-emerald-100 border-emerald-500 text-emerald-800'
                                                : 'bg-white border-slate-200 text-slate-600 hover:border-emerald-400',
                                        ].join(' ')}
                                    >
                                        {v}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8">
                            <div>
                                <h3 className="mt-0 mb-4 text-teal-800 text-lg font-bold">
                                    ステップ一覧
                                </h3>
                                <div className="space-y-2">
                                    {steps.map((s) => {
                                        const a = cur === s.step;
                                        return (
                                            <button
                                                key={s.step}
                                                type="button"
                                                className={[
                                                    'sb w-full text-left text-sm rounded-xl border-2 px-4 py-3',
                                                    a
                                                        ? 'bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-500 shadow-[0_4px_12px_rgba(16,185,129,.18)] translate-x-1'
                                                        : 'bg-white border-slate-200 hover:border-emerald-400 hover:translate-x-1',
                                                ].join(' ')}
                                                onClick={() => {
                                                    setCur(s.step);
                                                    setPlay(false);
                                                }}
                                            >
                                                <div
                                                    className={[
                                                        'font-bold mb-0.5',
                                                        a ? 'text-emerald-800' : 'text-teal-700',
                                                    ].join(' ')}
                                                >
                                                    Step {s.step}: {s.title}
                                                </div>
                                                <div className="text-slate-400 text-xs mt-0.5">
                                                    {s.desc.length > 60
                                                        ? s.desc.slice(0, 60) + '…'
                                                        : s.desc}
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                            <div className="my-auto">
                                <div className="rounded-2xl p-5 border-2 border-emerald-200 bg-gradient-to-br from-emerald-50 to-sky-50">
                                    <h3 className="mt-0 text-teal-800 font-bold text-base mb-1">
                                        Step {cs.step}: {cs.title}
                                    </h3>
                                    <p className="text-slate-600 leading-7 text-sm">{cs.desc}</p>
                                </div>
                                <StepViz visual={cs.visual} />
                                <div className="flex flex-wrap justify-center gap-2 mt-4">
                                    {[
                                        [
                                            '▶ Play',
                                            () => {
                                                if (!play) {
                                                    setCur(1);
                                                    setPlay(true);
                                                }
                                            },
                                            play,
                                            true,
                                        ],
                                        [
                                            '← Prev',
                                            () => {
                                                setCur((p) => Math.max(1, p - 1));
                                                setPlay(false);
                                            },
                                            cur <= 1 || play,
                                            false,
                                        ],
                                        [
                                            'Next →',
                                            () => {
                                                setCur((p) => Math.min(steps.length, p + 1));
                                                setPlay(false);
                                            },
                                            cur >= steps.length || play,
                                            false,
                                        ],
                                        [
                                            '↺ Reset',
                                            () => {
                                                setCur(1);
                                                setPlay(false);
                                            },
                                            false,
                                            false,
                                        ],
                                    ].map(([l, fn, dis, pri], i) => (
                                        <button
                                            key={i}
                                            type="button"
                                            onClick={fn}
                                            disabled={dis}
                                            className={[
                                                'px-5 py-2.5 rounded-xl font-semibold text-sm transition disabled:opacity-40',
                                                pri
                                                    ? 'text-white bg-gradient-to-r from-emerald-500 to-teal-600 shadow hover:-translate-y-0.5'
                                                    : 'text-teal-700 border-2 border-teal-200 bg-white hover:border-teal-500 hover:-translate-y-0.5',
                                            ].join(' ')}
                                        >
                                            {l}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </section>
                );
            }

            function OverviewSection() {
                return (
                    <section
                        id="overview"
                        className="bg-white rounded-2xl p-8 mb-8 shadow-[0_4px_20px_rgba(0,0,0,.07)]"
                    >
                        <h2 className="text-3xl font-black text-cyan-700 mb-4 pb-3 border-b-4 border-emerald-200">
                            アルゴリズム概要
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div className="p-5 rounded-xl bg-sky-50 border border-sky-200">
                                <h3 className="font-bold text-sky-800 mb-2 text-base">
                                    問題の要件
                                </h3>
                                <p className="text-slate-600 text-sm leading-relaxed">
                                    整数 <code className="dm text-sky-700">n</code> を受け取り、
                                    <strong>n の正の約数のうち 2 で割り切れるもの</strong>
                                    の個数を返す。
                                </p>
                                <div className="mt-3 p-3 rounded-lg bg-white border border-sky-100 dm text-sm text-slate-600 space-y-1">
                                    <div>入力: 9 → 出力: 0 （約数1,3,9はすべて奇数）</div>
                                    <div>入力: 8 → 出力: 3 （偶数約数 2,4,8）</div>
                                </div>
                            </div>
                            <div className="p-5 rounded-xl bg-emerald-50 border border-emerald-200">
                                <h3 className="font-bold text-emerald-800 mb-2 text-base">
                                    コア洞察
                                </h3>
                                <p className="text-slate-600 text-sm leading-relaxed">
                                    写像 <code className="dm">φ: d → d/2</code> は{' '}
                                    <code className="dm text-xs">
                                        {'{d|n,2|d}'} → {'{k|k|(n/2)}'}
                                    </code>{' '}
                                    の<strong>全単射</strong>。問題を{' '}
                                    <code className="dm">m=n/2</code> の約数カウントに帰着できる。
                                </p>
                            </div>
                        </div>
                        <div className="p-5 rounded-xl bg-gradient-to-r from-emerald-50 to-teal-50 border-2 border-emerald-200">
                            <h3 className="font-bold text-teal-800 mb-3 text-base">
                                全単射の証明スケッチ
                            </h3>
                            <div className="space-y-1.5 text-sm text-slate-600 leading-relaxed dm">
                                <p>
                                    <strong className="text-teal-700">命題</strong>: A=
                                    {'{d>0:d|n,2|d}'} と B={'{k>0:k|(n/2)}'} の間に全単射が存在する
                                </p>
                                <p>
                                    <strong className="text-teal-700">写像</strong>: φ(d) = d/2
                                </p>
                                <p>
                                    <strong className="text-teal-700">単射性</strong>: φ(d₁)=φ(d₂) ⟹
                                    d₁=d₂ ✓
                                </p>
                                <p>
                                    <strong className="text-teal-700">全射性</strong>: 任意の k∈B
                                    に対し d=2k とおけば d∈A ✓
                                </p>
                                <p>
                                    <strong className="text-teal-700">結論</strong>: |A| = |B| =
                                    #divisors(n/2)
                                </p>
                            </div>
                        </div>
                    </section>
                );
            }

            /* ══════════════════════════════════════════════════════════
   DiagramSection — v5: "return count" 左配置版

   列レイアウト (x座標):
     LX    =  20  左バイパス縦線 (div/sq スキップ)
     LCX   = 120  "return count" ボックス中心 (左ブランチ)
     CX    = 390  主フロー
     RCX   = 635  "return 0" ボックス中心 (右ブランチ)
     RRGHT = 755  ループバック右縦線

   交差チェック (全クリア ✓):
     ループ◇左端 CX-DHW=280 → return count 右端 LCX+BWL/2=200 → 矢印長68px ✓
     ループ◇右端 CX+DHW=500 → return 0 左端 RCX-BWR/2=547 → 矢印長47px ✓
     RRGHT=755 > return 0 右端=722 → 33px 余裕 ✓
     左バイパス LX=20, Y.div(800)〜Y.inc(1130) ← return count は Y.loop(625) で被らない ✓
══════════════════════════════════════════════════════════ */
            function DiagramSection() {
                const CX = 390;
                const RCX = 635;
                const LCX = 120;
                const LX = 20;
                const RRGHT = 755;
                const BW = 200;
                const BWR = 175;
                const BWL = 160;
                const BH = 52;
                const DHW = 110;
                const DHH = 52;
                const Y = {
                    start: 55,
                    odd: 205,
                    m: 365,
                    init: 475,
                    loop: 625,
                    div: 800,
                    sq: 975,
                    inc: 1130,
                };
                const SVG_W = 820,
                    SVG_H = 1310;

                const vL = (x, y1, y2, c, m2 = null) => (
                    <line
                        x1={x}
                        y1={y1}
                        x2={x}
                        y2={y2}
                        stroke={c}
                        strokeWidth={2}
                        {...(m2 ? { markerEnd: m2 } : {})}
                    />
                );
                const hL = (x1, y, x2, c, m2 = null) => (
                    <line
                        x1={x1}
                        y1={y}
                        x2={x2}
                        y2={y}
                        stroke={c}
                        strokeWidth={2}
                        {...(m2 ? { markerEnd: m2 } : {})}
                    />
                );

                return (
                    <section
                        id="diagram"
                        className="bg-white rounded-2xl p-8 mb-8 shadow-[0_4px_20px_rgba(0,0,0,.07)]"
                    >
                        <h2 className="text-3xl font-black text-cyan-700 mb-4 pb-3 border-b-4 border-emerald-200">
                            フローチャート
                        </h2>
                        <div className="overflow-x-auto mt-4">
                            <svg
                                viewBox={`0 0 ${SVG_W} ${SVG_H}`}
                                style={{ maxWidth: '100%', height: 'auto' }}
                                role="img"
                                aria-label="アルゴリズム フローチャート"
                            >
                                <AD />

                                {/* ══ 開始 ══ */}
                                <ellipse
                                    cx={CX}
                                    cy={Y.start}
                                    rx={108}
                                    ry={30}
                                    fill="#d1fae5"
                                    stroke="#10b981"
                                    strokeWidth={2.5}
                                />
                                <TL
                                    x={CX}
                                    y={Y.start}
                                    lines={['開始: 入力 n']}
                                    fill="#065f46"
                                    fs={14}
                                    fw="bold"
                                />

                                {/* 開始 ↓ 奇数判定 */}
                                {vL(CX, Y.start + 30, Y.odd - DHH - 6, '#64748b', 'url(#ag)')}

                                {/* ══ 奇数判定 ◇ ══ */}
                                <D
                                    cx={CX}
                                    cy={Y.odd}
                                    hw={DHW}
                                    hh={DHH}
                                    fill="#fef3c7"
                                    stroke="#f59e0b"
                                />
                                <TL
                                    x={CX}
                                    y={Y.odd - 10}
                                    lines={['n が奇数?']}
                                    fill="#78350f"
                                    fs={14}
                                />
                                <TL
                                    x={CX}
                                    y={Y.odd + 14}
                                    lines={['n % 2 != 0']}
                                    fill="#92400e"
                                    fs={12}
                                    ff="DM Mono"
                                />

                                {/* はい → return 0 (右)  ラベルはボックス上端の上 */}
                                {hL(CX + DHW + 6, Y.odd, RCX - BWR / 2 - 6, '#dc2626', 'url(#ar)')}
                                <text
                                    x={(CX + DHW + 6 + RCX - BWR / 2 - 6) / 2}
                                    y={Y.odd - BH / 2 - 16}
                                    textAnchor="middle"
                                    fontFamily="Noto Sans JP"
                                    fontSize={13}
                                    fontWeight="bold"
                                    fill="#dc2626"
                                >
                                    はい
                                </text>
                                <R
                                    x={RCX - BWR / 2}
                                    y={Y.odd - BH / 2}
                                    w={BWR}
                                    h={BH}
                                    fill="#fee2e2"
                                    stroke="#dc2626"
                                />
                                <TL
                                    x={RCX}
                                    y={Y.odd - 10}
                                    lines={['即座に']}
                                    fill="#7f1d1d"
                                    fs={12}
                                />
                                <TL
                                    x={RCX}
                                    y={Y.odd + 12}
                                    lines={['return 0']}
                                    fill="#dc2626"
                                    fs={15}
                                    ff="DM Mono"
                                    fw="bold"
                                />

                                {/* いいえ ↓ m=n//2 */}
                                {vL(CX, Y.odd + DHH + 6, Y.m - BH / 2 - 6, '#059669', 'url(#agr)')}
                                <text
                                    x={CX + 14}
                                    y={Y.odd + DHH + 24}
                                    textAnchor="start"
                                    fontFamily="Noto Sans JP"
                                    fontSize={13}
                                    fontWeight="bold"
                                    fill="#059669"
                                >
                                    いいえ
                                </text>

                                {/* ══ m = n // 2 ══ */}
                                <R
                                    x={CX - BW / 2}
                                    y={Y.m - BH / 2}
                                    w={BW}
                                    h={BH}
                                    fill="#e0f2fe"
                                    stroke="#0284c7"
                                />
                                <TL
                                    x={CX}
                                    y={Y.m - 10}
                                    lines={['m = n // 2']}
                                    fill="#0c4a6e"
                                    fs={14}
                                    ff="DM Mono"
                                />
                                <TL
                                    x={CX}
                                    y={Y.m + 12}
                                    lines={['全単射により帰着']}
                                    fill="#0369a1"
                                    fs={11}
                                />

                                {/* ↓ i=1,count=0 */}
                                {vL(CX, Y.m + BH / 2, Y.init - BH / 2 - 6, '#64748b', 'url(#ag)')}

                                {/* ══ i=1, count=0 ══ */}
                                <R
                                    x={CX - BW / 2}
                                    y={Y.init - BH / 2}
                                    w={BW}
                                    h={BH}
                                    fill="#f1f5f9"
                                    stroke="#64748b"
                                />
                                <TL
                                    x={CX}
                                    y={Y.init}
                                    lines={['i = 1,  count = 0']}
                                    fill="#334155"
                                    fs={14}
                                    ff="DM Mono"
                                />

                                {/* ↓ ループ◇ */}
                                {vL(CX, Y.init + BH / 2, Y.loop - DHH - 6, '#64748b', 'url(#ag)')}

                                {/* ══ ループ◇: i*i<=m? ══ */}
                                <D
                                    cx={CX}
                                    cy={Y.loop}
                                    hw={DHW}
                                    hh={DHH}
                                    fill="#fef3c7"
                                    stroke="#f59e0b"
                                />
                                <TL
                                    x={CX}
                                    y={Y.loop - 10}
                                    lines={['i * i <= m ?']}
                                    fill="#78350f"
                                    fs={14}
                                    ff="DM Mono"
                                />
                                <TL
                                    x={CX}
                                    y={Y.loop + 14}
                                    lines={['ループ継続?']}
                                    fill="#92400e"
                                    fs={12}
                                />

                                {/* ★ いいえ → return count (左配置) ★
                                    ラベルはボックス上端の上  */}
                                {hL(CX - DHW - 6, Y.loop, LCX + BWL / 2 + 6, '#dc2626', 'url(#ar)')}
                                <text
                                    x={(CX - DHW - 6 + LCX + BWL / 2 + 6) / 2}
                                    y={Y.loop - BH / 2 - 16}
                                    textAnchor="middle"
                                    fontFamily="Noto Sans JP"
                                    fontSize={13}
                                    fontWeight="bold"
                                    fill="#dc2626"
                                >
                                    いいえ
                                </text>
                                <R
                                    x={LCX - BWL / 2}
                                    y={Y.loop - BH / 2}
                                    w={BWL}
                                    h={BH}
                                    fill="#d1fae5"
                                    stroke="#10b981"
                                />
                                <TL
                                    x={LCX}
                                    y={Y.loop - 10}
                                    lines={['結果を返す']}
                                    fill="#065f46"
                                    fs={12}
                                />
                                <TL
                                    x={LCX}
                                    y={Y.loop + 12}
                                    lines={['return count']}
                                    fill="#059669"
                                    fs={15}
                                    ff="DM Mono"
                                    fw="bold"
                                />

                                {/* はい ↓ m%i==0? */}
                                {vL(CX, Y.loop + DHH + 6, Y.div - DHH - 6, '#059669', 'url(#agr)')}
                                <text
                                    x={CX + 14}
                                    y={Y.loop + DHH + 24}
                                    textAnchor="start"
                                    fontFamily="Noto Sans JP"
                                    fontSize={13}
                                    fontWeight="bold"
                                    fill="#059669"
                                >
                                    はい
                                </text>

                                {/* ══ m%i==0? ◇ ══ */}
                                <D
                                    cx={CX}
                                    cy={Y.div}
                                    hw={DHW}
                                    hh={DHH}
                                    fill="#fef3c7"
                                    stroke="#f59e0b"
                                />
                                <TL
                                    x={CX}
                                    y={Y.div - 10}
                                    lines={['m % i == 0 ?']}
                                    fill="#78350f"
                                    fs={14}
                                    ff="DM Mono"
                                />
                                <TL
                                    x={CX}
                                    y={Y.div + 14}
                                    lines={['i は m の約数?']}
                                    fill="#92400e"
                                    fs={12}
                                />

                                {/* いいえ → 左バイパス縦線へ  ラベルは矢印上 */}
                                {hL(CX - DHW - 6, Y.div, LX + 6, '#a855f7', 'url(#ap)')}
                                <text
                                    x={(CX - DHW - 6 + LX + 6) / 2}
                                    y={Y.div - 16}
                                    textAnchor="middle"
                                    fontFamily="Noto Sans JP"
                                    fontSize={12}
                                    fontWeight="bold"
                                    fill="#a855f7"
                                >
                                    いいえ (スキップ)
                                </text>

                                {/* はい ↓ i*i==m? */}
                                {vL(CX, Y.div + DHH + 6, Y.sq - DHH - 6, '#059669', 'url(#agr)')}
                                <text
                                    x={CX + 14}
                                    y={Y.div + DHH + 24}
                                    textAnchor="start"
                                    fontFamily="Noto Sans JP"
                                    fontSize={13}
                                    fontWeight="bold"
                                    fill="#059669"
                                >
                                    はい
                                </text>

                                {/* ══ i*i==m? ◇ ══ */}
                                <D
                                    cx={CX}
                                    cy={Y.sq}
                                    hw={DHW}
                                    hh={DHH}
                                    fill="#fef3c7"
                                    stroke="#f59e0b"
                                />
                                <TL
                                    x={CX}
                                    y={Y.sq - 10}
                                    lines={['i * i == m ?']}
                                    fill="#78350f"
                                    fs={14}
                                    ff="DM Mono"
                                />
                                <TL
                                    x={CX}
                                    y={Y.sq + 14}
                                    lines={['完全平方?']}
                                    fill="#92400e"
                                    fs={12}
                                />

                                {/* いいえ(count+=2) → 左バイパス  両ラベルは矢印の上 */}
                                {hL(CX - DHW - 6, Y.sq, LX + 6, '#a855f7', 'url(#ap)')}
                                <text
                                    x={(CX - DHW - 6 + LX + 6) / 2}
                                    y={Y.sq - 32}
                                    textAnchor="middle"
                                    fontFamily="Noto Sans JP"
                                    fontSize={12}
                                    fontWeight="bold"
                                    fill="#a855f7"
                                >
                                    いいえ
                                </text>
                                <text
                                    x={(CX - DHW - 6 + LX + 6) / 2}
                                    y={Y.sq - 16}
                                    textAnchor="middle"
                                    fontFamily="DM Mono"
                                    fontSize={12}
                                    fill="#a855f7"
                                >
                                    count += 2
                                </text>

                                {/* はい(count+=1) ↓ i+=1 */}
                                {vL(CX, Y.sq + DHH + 6, Y.inc - BH / 2 - 6, '#059669', 'url(#agr)')}
                                <text
                                    x={CX + 14}
                                    y={Y.sq + DHH + 20}
                                    textAnchor="start"
                                    fontFamily="Noto Sans JP"
                                    fontSize={13}
                                    fontWeight="bold"
                                    fill="#059669"
                                >
                                    はい
                                </text>
                                <text
                                    x={CX + 14}
                                    y={Y.sq + DHH + 38}
                                    textAnchor="start"
                                    fontFamily="DM Mono"
                                    fontSize={12}
                                    fill="#059669"
                                >
                                    count += 1
                                </text>

                                {/* ══ i += 1 ══ */}
                                <R
                                    x={CX - BW / 2}
                                    y={Y.inc - BH / 2}
                                    w={BW}
                                    h={BH}
                                    fill="#f1f5f9"
                                    stroke="#64748b"
                                />
                                <TL
                                    x={CX}
                                    y={Y.inc}
                                    lines={['i += 1']}
                                    fill="#334155"
                                    fs={14}
                                    ff="DM Mono"
                                />

                                {/* 左バイパス縦線: LX=20, Y.div〜Y.inc
                                    Y.div(800) > Y.loop(625)+BH/2(26)=651 なので return count と被らない ✓ */}
                                {vL(LX, Y.div, Y.inc, '#a855f7')}
                                {hL(LX, Y.inc, CX - BW / 2 - 6, '#a855f7', 'url(#ap)')}
                                <text
                                    x={LX - 18}
                                    y={(Y.div + Y.inc) / 2}
                                    textAnchor="middle"
                                    fontFamily="Noto Sans JP"
                                    fontSize={11}
                                    fill="#a855f7"
                                    transform={`rotate(-90 ${LX - 10} ${(Y.div + Y.inc) / 2})`}
                                >
                                    スキップ / 次の i へ
                                </text>

                                {/* ループバック: i+=1右端 → RRGHT(755) → Y.loop → ループ◇右端
                                    return countは左側なので右列は完全にクリア ✓ */}
                                <path
                                    d={`M ${CX + BW / 2} ${Y.inc} L ${RRGHT} ${Y.inc} L ${RRGHT} ${Y.loop} L ${CX + DHW + 6} ${Y.loop}`}
                                    stroke="#a855f7"
                                    strokeWidth={2}
                                    fill="none"
                                    markerEnd="url(#ap)"
                                />
                                <text
                                    x={RRGHT + 18}
                                    y={(Y.loop + Y.inc) / 2}
                                    textAnchor="middle"
                                    fontFamily="Noto Sans JP"
                                    fontSize={12}
                                    fill="#a855f7"
                                    transform={`rotate(90 ${RRGHT + 18} ${(Y.loop + Y.inc) / 2})`}
                                >
                                    ループ先頭へ戻る
                                </text>

                                {/* 凡例 */}
                                {[
                                    ['#64748b', '通常フロー'],
                                    ['#059669', 'はい / 成功'],
                                    ['#dc2626', 'いいえ / 終了'],
                                    ['#a855f7', 'ループバック / スキップ'],
                                ].map(([c, l], idx) => {
                                    const ly = Y.inc + BH / 2 + 44 + idx * 26;
                                    return (
                                        <g key={idx}>
                                            <line
                                                x1={CX - 20}
                                                y1={ly}
                                                x2={CX + 10}
                                                y2={ly}
                                                stroke={c}
                                                strokeWidth={2.5}
                                            />
                                            <circle cx={CX + 10} cy={ly} r={4} fill={c} />
                                            <text
                                                x={CX + 20}
                                                y={ly}
                                                dominantBaseline="middle"
                                                fontFamily="Noto Sans JP"
                                                fontSize={13}
                                                fill="#475569"
                                            >
                                                {l}
                                            </text>
                                        </g>
                                    );
                                })}
                            </svg>
                        </div>
                        <div className="mt-4 p-4 rounded-xl bg-slate-50 border border-slate-200 text-sm text-slate-600 leading-relaxed">
                            <strong className="text-slate-800">フローの説明：</strong>
                            <br />
                            1. n が奇数 → <strong>即座に 0 を返す</strong>（右の赤ボックス）
                            <br />
                            2. m = n/2 に帰着（全単射による置き換え）
                            <br />
                            3. ループ条件 i*i&gt;m → <strong>count を返す</strong>（左の緑ボックス）
                            <br />
                            4. m%i==0 でなければ左バイパスで i+=1 へスキップ
                            <br />
                            5. i²==m（完全平方）なら +1、そうでなければ +2
                            <br />
                            6. i+=1 後、右側ループバックでループ先頭へ戻る
                        </div>
                    </section>
                );
            }

            function App() {
                return (
                    <>
                        <OverviewSection />
                        <DiagramSection />
                        <StepsSection />
                    </>
                );
            }
            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const labels = [
                    '概要',
                    '図解',
                    'ステップ解説',
                    '実装',
                    '計算量',
                    'エッジケース',
                    'FAQ',
                ];
                const ids = [
                    'overview',
                    'diagram',
                    'steps',
                    'code',
                    'complexity',
                    'edgecases',
                    'faq',
                ];
                const nav = document.getElementById('main-nav');
                if (nav)
                    nav.innerHTML = labels
                        .map(
                            (l, i) =>
                                `<a href="#${ids[i]}" style="font-family:'Noto Sans JP',sans-serif" class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-xl border-2 border-white/60 bg-white/70 text-sm transition hover:shadow-md hover:-translate-y-px hover:bg-white hover:border-teal-500">${l}</a>`,
                        )
                        .join('');
            });
        </script>
    </body>
</html>
