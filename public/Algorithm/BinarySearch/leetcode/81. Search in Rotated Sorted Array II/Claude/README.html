<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Search in Rotated Sorted Array II - Technical Analysis</title>

        <!-- External Dependencies -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            rel="stylesheet"
        />
        <link
            href="/vendor/prismjs/plugins/line-numbers/prism-line-numbers.css"
            rel="stylesheet"
        />
        <link
            href="/vendor/fontawesome/css/all.min.css"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
            rel="stylesheet"
        />

        <style>
            :root {
                --primary-color: #2563eb;
                --secondary-color: #3b82f6;
                --accent-color: #10b981;
                --warning-color: #f59e0b;
                --error-color: #ef4444;
                --success-color: #22c55e;

                --bg-primary: #ffffff;
                --bg-secondary: #f8fafc;
                --bg-tertiary: #e2e8f0;
                --text-primary: #0f172a;
                --text-secondary: #475569;
                --text-muted: #64748b;

                --border-color: #e2e8f0;
                --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
                --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
                --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);

                --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                --font-mono: 'JetBrains Mono', 'Monaco', 'Menlo', monospace;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: var(--font-family);
                line-height: 1.6;
                color: var(--text-primary);
                background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
                min-height: 100vh;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 2rem;
            }

            .hero {
                text-align: center;
                padding: 4rem 0 3rem;
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                color: white;
                border-radius: 1rem;
                margin-bottom: 3rem;
                position: relative;
                overflow: hidden;
            }

            .hero::before {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
                animation: rotate 20s linear infinite;
            }

            @keyframes rotate {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .hero-content {
                position: relative;
                z-index: 1;
            }

            .hero h1 {
                font-size: 3rem;
                font-weight: 700;
                margin-bottom: 1rem;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .hero p {
                font-size: 1.25rem;
                opacity: 0.9;
                max-width: 600px;
                margin: 0 auto;
            }

            .section {
                background: var(--bg-primary);
                border-radius: 1rem;
                padding: 2rem;
                margin-bottom: 2rem;
                box-shadow: var(--shadow-md);
                border: 1px solid var(--border-color);
                transition:
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
            }

            .section:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }

            .section-header {
                display: flex;
                align-items: center;
                margin-bottom: 1.5rem;
            }

            .section-icon {
                font-size: 1.5rem;
                margin-right: 1rem;
                color: var(--primary-color);
            }

            .section-title {
                font-size: 1.75rem;
                font-weight: 600;
                color: var(--text-primary);
            }

            .algorithm-overview {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            }

            .overview-card {
                background: linear-gradient(
                    135deg,
                    var(--bg-secondary) 0%,
                    var(--bg-tertiary) 100%
                );
                padding: 1.5rem;
                border-radius: 0.75rem;
                border-left: 4px solid var(--primary-color);
            }

            .overview-card h3 {
                color: var(--primary-color);
                margin-bottom: 0.5rem;
                display: flex;
                align-items: center;
            }

            .overview-card h3 i {
                margin-right: 0.5rem;
            }

            .step-container {
                margin: 2rem 0;
            }

            .step {
                display: flex;
                margin-bottom: 1.5rem;
                padding: 1rem;
                background: var(--bg-secondary);
                border-radius: 0.75rem;
                border-left: 4px solid var(--accent-color);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .step:hover {
                background: var(--bg-tertiary);
                transform: translateX(5px);
            }

            .step.active {
                background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
                border-left-color: var(--success-color);
            }

            .step-number {
                background: var(--accent-color);
                color: white;
                width: 2rem;
                height: 2rem;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                margin-right: 1rem;
                flex-shrink: 0;
            }

            .step-content h4 {
                color: var(--text-primary);
                margin-bottom: 0.5rem;
            }

            .step-content p {
                color: var(--text-secondary);
            }

            .code-container {
                position: relative;
                margin: 1.5rem 0;
            }

            .code-header {
                background: var(--text-primary);
                color: white;
                padding: 0.75rem 1rem;
                border-radius: 0.5rem 0.5rem 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .code-title {
                font-weight: 500;
                display: flex;
                align-items: center;
            }

            .code-title i {
                margin-right: 0.5rem;
            }

            .copy-btn {
                background: var(--primary-color);
                color: white;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: 0.25rem;
                cursor: pointer;
                font-size: 0.875rem;
                transition: background 0.2s ease;
            }

            .copy-btn:hover {
                background: var(--secondary-color);
            }

            .copy-btn.copied {
                background: var(--success-color);
            }

            pre {
                margin: 0 !important;
                border-radius: 0 0 0.5rem 0.5rem !important;
                font-family: var(--font-mono) !important;
                position: relative;
            }

            /* Prism line numbers styling */
            .line-numbers .line-numbers-rows {
                border-right: 1px solid #565c64;
            }

            .line-numbers-rows > span:before {
                color: #8b949e;
                font-family: var(--font-mono);
                padding: 0.015em 0.5em 0.015em 0 !important;
            }

            .complexity-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
                margin: 1.5rem 0;
            }

            .complexity-card {
                background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
                padding: 1.5rem;
                border-radius: 0.75rem;
                text-align: center;
                border: 1px solid #f59e0b;
            }

            .complexity-card h4 {
                color: var(--warning-color);
                margin-bottom: 0.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .complexity-card h4 i {
                margin-right: 0.5rem;
            }

            .complexity-value {
                font-size: 1.5rem;
                font-weight: 700;
                font-family: var(--font-mono);
                color: var(--text-primary);
            }

            .visualization {
                background: var(--bg-secondary);
                border-radius: 0.75rem;
                padding: 2rem;
                margin: 1.5rem 0;
                text-align: center;
            }

            .array-visual {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.5rem;
                margin: 1rem 0;
            }

            .array-item {
                background: var(--bg-primary);
                border: 2px solid var(--border-color);
                border-radius: 0.5rem;
                padding: 0.75rem;
                min-width: 3rem;
                text-align: center;
                font-family: var(--font-mono);
                font-weight: 600;
                transition: all 0.3s ease;
            }

            .array-item.highlight-target {
                background: var(--success-color);
                color: white;
                border-color: var(--success-color);
                transform: scale(1.1);
            }

            .array-item.highlight-mid {
                background: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
            }

            .array-item.highlight-left {
                background: var(--warning-color);
                color: white;
                border-color: var(--warning-color);
            }

            .array-item.highlight-right {
                background: var(--error-color);
                color: white;
                border-color: var(--error-color);
            }

            .controls {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin: 1rem 0;
            }

            .btn {
                background: var(--primary-color);
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 0.5rem;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
            }

            .btn:hover {
                background: var(--secondary-color);
                transform: translateY(-1px);
            }

            .btn i {
                margin-right: 0.5rem;
            }

            .btn:disabled {
                background: var(--text-muted);
                cursor: not-allowed;
                transform: none;
            }

            .progress-bar {
                background: var(--border-color);
                height: 4px;
                border-radius: 2px;
                overflow: hidden;
                margin: 1rem 0;
            }

            .progress-fill {
                background: linear-gradient(
                    90deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                height: 100%;
                transition: width 0.5s ease;
            }

            .info-badge {
                display: inline-flex;
                align-items: center;
                background: var(--primary-color);
                color: white;
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-size: 0.875rem;
                font-weight: 500;
                margin: 0.25rem;
            }

            .info-badge i {
                margin-right: 0.25rem;
            }

            @media (max-width: 768px) {
                .container {
                    padding: 1rem;
                }

                .hero {
                    padding: 2rem 0;
                }

                .hero h1 {
                    font-size: 2rem;
                }

                .section {
                    padding: 1.5rem;
                }

                .algorithm-overview {
                    grid-template-columns: 1fr;
                }

                .complexity-grid {
                    grid-template-columns: 1fr;
                }

                .controls {
                    flex-direction: column;
                    align-items: center;
                }

                .array-visual {
                    justify-content: flex-start;
                }
            }

            .fade-in {
                opacity: 0;
                transform: translateY(20px);
                animation: fadeIn 0.6s ease forwards;
            }

            @keyframes fadeIn {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .pulse {
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Hero Section -->
            <div class="hero fade-in">
                <div class="hero-content">
                    <h1><i class="fas fa-search"></i> Search in Rotated Sorted Array II</h1>
                    <p>重複要素を含む回転ソート配列での効率的な検索アルゴリズム</p>
                </div>
            </div>

            <!-- Algorithm Overview -->
            <div class="section fade-in">
                <div class="section-header">
                    <i class="fas fa-lightbulb section-icon"></i>
                    <h2 class="section-title">アルゴリズム概要</h2>
                </div>

                <div class="algorithm-overview">
                    <div class="overview-card">
                        <h3><i class="fas fa-target"></i>問題</h3>
                        <p>
                            回転されたソート済み配列（重複要素あり）から、指定されたターゲット値を効率的に検索
                        </p>
                    </div>
                    <div class="overview-card">
                        <h3><i class="fas fa-cogs"></i>手法</h3>
                        <p>修正版バイナリサーチ：通常の二分探索を回転配列と重複要素に対応</p>
                    </div>
                    <div class="overview-card">
                        <h3><i class="fas fa-chart-line"></i>効率性</h3>
                        <p>平均：O(log n) / 最悪：O(n) - 重複要素により線形時間の可能性</p>
                    </div>
                </div>
            </div>

            <!-- Step by Step Explanation -->
            <div class="section fade-in">
                <div class="section-header">
                    <i class="fas fa-list-ol section-icon"></i>
                    <h2 class="section-title">ステップバイステップ解説</h2>
                </div>

                <div class="step-container">
                    <div class="step" onclick="highlightStep(0)">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>初期化</h4>
                            <p>left = 0, right = n-1 で検索範囲を設定</p>
                        </div>
                    </div>

                    <div class="step" onclick="highlightStep(1)">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>中央値計算</h4>
                            <p>mid = (left + right) // 2 で中央のインデックスを計算</p>
                        </div>
                    </div>

                    <div class="step" onclick="highlightStep(2)">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>ターゲット確認</h4>
                            <p>nums[mid] == target の場合、True を返す</p>
                        </div>
                    </div>

                    <div class="step" onclick="highlightStep(3)">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>重複処理</h4>
                            <p>nums[left] == nums[mid] == nums[right] の場合、両端を縮める</p>
                        </div>
                    </div>

                    <div class="step" onclick="highlightStep(4)">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>ソート判定</h4>
                            <p>左半分または右半分のどちらがソートされているかを判定</p>
                        </div>
                    </div>

                    <div class="step" onclick="highlightStep(5)">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <h4>範囲更新</h4>
                            <p>ターゲットの位置に応じて検索範囲を更新</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Implementation -->
            <div class="section fade-in">
                <div class="section-header">
                    <i class="fas fa-code section-icon"></i>
                    <h2 class="section-title">Python実装</h2>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <div class="code-title">
                            <i class="fab fa-python"></i>
                            LeetCode Solution
                        </div>
                        <button class="copy-btn" onclick="copyCode('solution-code', this)">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <pre
                        class="line-numbers"
                    ><code id="solution-code" class="language-python">from typing import List

class Solution:
    def search(self, nums: List[int], target: int) -> bool:
        left: int = 0
        right: int = len(nums) - 1

        while left <= right:
            mid: int = (left + right) // 2
            if nums[mid] == target:
                return True

            # Handle duplicates
            while left < mid and nums[left] == nums[mid] and nums[right] == nums[mid]:
                left += 1
                right -= 1

            # Left half is sorted
            if nums[left] <= nums[mid]:
                if nums[left] <= target < nums[mid]:
                    right = mid - 1
                else:
                    left = mid + 1
            else:
                # Right half is sorted
                if nums[mid] < target <= nums[right]:
                    left = mid + 1
                else:
                    right = mid - 1

        return False

# Test Examples
solution = Solution()

# Example 1: [2,5,6,0,0,1,2], target = 0
print(solution.search([2,5,6,0,0,1,2], 0))  # True

# Example 2: [2,5,6,0,0,1,2], target = 3
print(solution.search([2,5,6,0,0,1,2], 3))  # False</code></pre>
                </div>
            </div>

            <!-- Interactive Visualization -->
            <div class="section fade-in">
                <div class="section-header">
                    <i class="fas fa-play-circle section-icon"></i>
                    <h2 class="section-title">インタラクティブ可視化</h2>
                </div>

                <div class="visualization">
                    <h3>配列: [4, 5, 6, 7, 0, 1, 2] - ターゲット: 0</h3>

                    <div class="array-visual" id="arrayVisual">
                        <!-- Array items will be generated by JavaScript -->
                    </div>

                    <div class="controls">
                        <button class="btn" onclick="startAnimation()" id="startBtn">
                            <i class="fas fa-play"></i> Start Animation
                        </button>
                        <button class="btn" onclick="resetAnimation()">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                        <button class="btn" onclick="nextStep()" id="nextBtn" disabled>
                            <i class="fas fa-step-forward"></i> Next Step
                        </button>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>

                    <div id="stepInfo" class="info-badges">
                        <span class="info-badge"> <i class="fas fa-arrow-left"></i> Left: 0 </span>
                        <span class="info-badge"> <i class="fas fa-arrows-alt-h"></i> Mid: 3 </span>
                        <span class="info-badge">
                            <i class="fas fa-arrow-right"></i> Right: 6
                        </span>
                    </div>

                    <div
                        id="stepMessage"
                        style="
                            margin-top: 1rem;
                            padding: 1rem;
                            background: var(--bg-secondary);
                            border-radius: 0.5rem;
                            min-height: 3rem;
                        "
                    >
                        <h4>ステップ 0: 初期化完了</h4>
                        <p>配列の初期状態です。検索を開始してください。</p>
                    </div>
                </div>
            </div>

            <!-- Complexity Analysis -->
            <div class="section fade-in">
                <div class="section-header">
                    <i class="fas fa-chart-bar section-icon"></i>
                    <h2 class="section-title">計算量解析</h2>
                </div>

                <div class="complexity-grid">
                    <div class="complexity-card">
                        <h4><i class="fas fa-clock"></i>時間計算量</h4>
                        <div class="complexity-value">O(log n)</div>
                        <p>平均ケース</p>
                    </div>
                    <div class="complexity-card">
                        <h4><i class="fas fa-exclamation-triangle"></i>最悪ケース</h4>
                        <div class="complexity-value">O(n)</div>
                        <p>全要素が重複</p>
                    </div>
                    <div class="complexity-card">
                        <h4><i class="fas fa-memory"></i>空間計算量</h4>
                        <div class="complexity-value">O(1)</div>
                        <p>定数空間</p>
                    </div>
                </div>

                <div style="margin-top: 2rem">
                    <h4>重複要素による影響</h4>
                    <p>
                        重複要素が多い場合、どちらの半分がソートされているかを判定できないケースが発生します。
                        この場合、両端から重複を除去する必要があり、最悪の場合は線形時間O(n)となります。
                    </p>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

        <script>
            // Animation state
            let animationState = {
                array: [4, 5, 6, 7, 0, 1, 2],
                target: 0,
                left: 0,
                right: 6,
                mid: 0,
                step: 0,
                isAnimating: false,
                currentMessage: '',
                steps: [
                    {
                        left: 0,
                        right: 6,
                        mid: 3,
                        message: '初期状態: left=0, right=6, mid=3',
                        action: 'nums[3] = 7, target = 0. 7 ≠ 0 なので続行',
                        nextLeft: 0,
                        nextRight: 6,
                        nextMid: 3,
                    },
                    {
                        left: 0,
                        right: 6,
                        mid: 3,
                        message: '重複チェック: nums[0]=4, nums[3]=7, nums[6]=2 - 重複なし',
                        action: '左半分の判定: nums[0]=4 ≤ nums[3]=7 → 左半分がソート済み',
                        nextLeft: 0,
                        nextRight: 6,
                        nextMid: 3,
                    },
                    {
                        left: 0,
                        right: 6,
                        mid: 3,
                        message: 'ターゲット範囲チェック: nums[0]=4 ≤ target=0 < nums[3]=7?',
                        action: '4 ≤ 0 は偽 → ターゲットは右半分にある',
                        nextLeft: 4,
                        nextRight: 6,
                        nextMid: 5,
                    },
                    {
                        left: 4,
                        right: 6,
                        mid: 5,
                        message: '新しい範囲: left=4, right=6, mid=5',
                        action: 'nums[5] = 1, target = 0. 1 ≠ 0 なので続行',
                        nextLeft: 4,
                        nextRight: 6,
                        nextMid: 5,
                    },
                    {
                        left: 4,
                        right: 6,
                        mid: 5,
                        message: '重複チェック: nums[4]=0, nums[5]=1, nums[6]=2 - 重複なし',
                        action: '左半分の判定: nums[4]=0 ≤ nums[5]=1 → 左半分がソート済み',
                        nextLeft: 4,
                        nextRight: 6,
                        nextMid: 5,
                    },
                    {
                        left: 4,
                        right: 6,
                        mid: 5,
                        message: 'ターゲット範囲チェック: nums[4]=0 ≤ target=0 < nums[5]=1?',
                        action: '0 ≤ 0 < 1 は真 → ターゲットは左半分にある',
                        nextLeft: 4,
                        nextRight: 4,
                        nextMid: 4,
                    },
                    {
                        left: 4,
                        right: 4,
                        mid: 4,
                        message: '新しい範囲: left=4, right=4, mid=4',
                        action: 'nums[4] = 0, target = 0. 一致！',
                        nextLeft: 4,
                        nextRight: 4,
                        nextMid: 4,
                        found: true,
                    },
                ],
            };

            // Initialize array visualization
            function initArrayVisual() {
                const container = document.getElementById('arrayVisual');
                container.innerHTML = '';

                animationState.array.forEach((value, index) => {
                    const item = document.createElement('div');
                    item.className = 'array-item';
                    item.textContent = value;
                    item.id = `item-${index}`;
                    container.appendChild(item);
                });

                updateStepInfo();
            }

            // Update step information
            function updateStepInfo() {
                const stepInfo = document.getElementById('stepInfo');
                stepInfo.innerHTML = `
                <span class="info-badge">
                    <i class="fas fa-arrow-left"></i> Left: ${animationState.left}
                </span>
                <span class="info-badge">
                    <i class="fas fa-arrows-alt-h"></i> Mid: ${animationState.mid}
                </span>
                <span class="info-badge">
                    <i class="fas fa-arrow-right"></i> Right: ${animationState.right}
                </span>
                <span class="info-badge">
                    <i class="fas fa-bullseye"></i> Target: ${animationState.target}
                </span>
            `;
            }

            // Update step message
            function updateStepMessage() {
                const stepMessage = document.getElementById('stepMessage');
                const currentStep = animationState.steps[animationState.step];

                if (currentStep) {
                    stepMessage.innerHTML = `
                    <h4>ステップ ${animationState.step + 1}: ${currentStep.message}</h4>
                    <p><strong>処理:</strong> ${currentStep.action}</p>
                `;
                }
            }

            // Highlight array items
            function highlightArrayItems() {
                // Clear all highlights
                document.querySelectorAll('.array-item').forEach((item) => {
                    item.className = 'array-item';
                });

                // Add current highlights
                if (animationState.left <= animationState.right) {
                    document
                        .getElementById(`item-${animationState.left}`)
                        .classList.add('highlight-left');
                    document
                        .getElementById(`item-${animationState.mid}`)
                        .classList.add('highlight-mid');
                    document
                        .getElementById(`item-${animationState.right}`)
                        .classList.add('highlight-right');

                    if (animationState.array[animationState.mid] === animationState.target) {
                        document
                            .getElementById(`item-${animationState.mid}`)
                            .classList.remove('highlight-mid');
                        document
                            .getElementById(`item-${animationState.mid}`)
                            .classList.add('highlight-target');
                    }
                }
            }

            // Start animation
            function startAnimation() {
                if (animationState.isAnimating) return;

                animationState.isAnimating = true;
                document.getElementById('startBtn').disabled = true;
                document.getElementById('nextBtn').disabled = false;

                // Start with first step
                nextStep();
            }

            // Reset animation
            function resetAnimation() {
                animationState.left = 0;
                animationState.right = 6;
                animationState.mid = 3;
                animationState.step = 0;
                animationState.isAnimating = false;

                document.getElementById('startBtn').disabled = false;
                document.getElementById('nextBtn').disabled = true;

                document.querySelectorAll('.array-item').forEach((item) => {
                    item.className = 'array-item';
                });

                document.getElementById('progressFill').style.width = '0%';
                updateStepInfo();

                // Reset step message
                const stepMessage = document.getElementById('stepMessage');
                stepMessage.innerHTML = `
                <h4>ステップ 0: 初期化完了</h4>
                <p>配列の初期状態です。検索を開始してください。</p>
            `;
            }

            // Next step
            function nextStep() {
                if (animationState.step >= animationState.steps.length) return;

                const currentStep = animationState.steps[animationState.step];

                // Update animation state
                animationState.left = currentStep.left;
                animationState.right = currentStep.right;
                animationState.mid = currentStep.mid;

                // Update visuals
                highlightArrayItems();
                updateStepInfo();
                updateStepMessage();

                // Update progress
                const progress = ((animationState.step + 1) / animationState.steps.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';

                // Check if found
                if (currentStep.found) {
                    document.getElementById(`item-${animationState.mid}`).classList.add('pulse');
                    document.getElementById('nextBtn').disabled = true;
                    animationState.isAnimating = false;
                }

                // Update step for next iteration
                animationState.step++;

                // Disable next button if no more steps
                if (animationState.step >= animationState.steps.length) {
                    document.getElementById('nextBtn').disabled = true;
                    animationState.isAnimating = false;
                }
            }

            // Highlight step in explanation
            function highlightStep(stepIndex) {
                document.querySelectorAll('.step').forEach((step) => {
                    step.classList.remove('active');
                });

                document.querySelectorAll('.step')[stepIndex].classList.add('active');
            }

            // Copy code functionality
            function copyCode(elementId, btnElement) {
                const code = document.getElementById(elementId).textContent;
                navigator.clipboard.writeText(code).then(() => {
                    const originalContent = btnElement.innerHTML;
                    btnElement.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    btnElement.classList.add('copied');

                    setTimeout(() => {
                        btnElement.innerHTML = originalContent;
                        btnElement.classList.remove('copied');
                    }, 2000);
                });
            }

            // Initialize when page loads
            document.addEventListener('DOMContentLoaded', function () {
                initArrayVisual();

                // Add fade-in animation to sections
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            entry.target.style.animationDelay = '0.1s';
                            entry.target.classList.add('fade-in');
                        }
                    });
                });

                document.querySelectorAll('.section').forEach((section) => {
                    observer.observe(section);
                });
            });
        </script>
    </body>
</html>
