TypeScriptの `fourSum` アルゴリズムを **図解付きで具体的に解析・説明**します。

---

## **全体アルゴリズムの流れ**

1. **ソート**
2. **二重ループ (i, j)**
3. **二重ポインター (left, right)**
4. **重複回避**

---

## **具体例**

### **入力**

```typescript
nums = [1, 0, -1, 0, -2, 2];
target = 0;
```

### **ソート**

```
-2   -1    0    0    1    2
```

---

## **探索の流れ**

### ① 外側ループ (i)

```text
i=0 → nums[0]=-2
```

### ② 内側ループ (j)

```text
j=1 → nums[1]=-1
```

### ③ 二重ポインター (left, right)

| ポインター | 位置 | 値  |
| ---------- | ---- | --- |
| left       | 2    | 0   |
| right      | 5    | 2   |

#### **計算**

```
sum = -2 + (-1) + 0 + 2 = -1
```

##### **target = 0 なので → left++**

| ポインター | 位置 | 値  |
| ---------- | ---- | --- |
| left       | 3    | 0   |
| right      | 5    | 2   |

```
sum = -2 + (-1) + 0 + 2 = -1  → またleft++
```

| ポインター | 位置 | 値  |
| ---------- | ---- | --- |
| left       | 4    | 1   |
| right      | 5    | 2   |

```
sum = -2 + (-1) + 1 + 2 = 0
```

**→ 解発見: \[-2, -1, 1, 2]**

---

## **図解：現在の探索状態**

```
Index:   0   1   2   3   4   5
Value:  -2  -1   0   0   1   2
         ^   ^             ^   ^
         i   j           left right
```

---

## **重複スキップ**

- **leftとright**が次も同じ値なら **スキップ**

この例では `nums[right]=2` ですが、`nums[right-1]=1`なのでスキップ不要。

---

## **続きの探索**

ポインターを移動して、全パターン探索します。

---

## **最終的な出力**

```
[[-2, -1, 1, 2],
 [-2, 0, 0, 2],
 [-1, 0, 0, 1]]
```

---

# **処理全体の図**

```
for i = 0 to n-4
    ↓
    for j = i+1 to n-3
        ↓
        left = j+1
        right = n-1
        while left < right:
            if sum == target:
                add quadruplet to result
                move left and right to skip duplicates
            elif sum < target:
                left++
            else:
                right--
```

---

## **計算量**

| 項目        | 計算量     |
| ----------- | ---------- |
| ソート      | O(n log n) |
| i ループ    | O(n)       |
| j ループ    | O(n)       |
| two-pointer | O(n)       |

### **合計**: O(n³)

---

## **メモリ消費量**

| 項目                   | 内容                           |
| ---------------------- | ------------------------------ |
| ソートのための一時領域 | O(n)                           |
| 出力リスト             | O(k) （kは解の個数、最悪O(n³)) |

---

## **まとめ**

| 特徴     | 内容                                 |
| -------- | ------------------------------------ |
| 利用技法 | ソート + 二重ループ + 二重ポインター |
| 重複回避 | 同じ数値のスキップ                   |
| 効率化   | O(n³)まで減少（全探索ならO(n⁴))      |
| 適用場面 | 4Sum問題、kSum問題の一般化可能       |

---
