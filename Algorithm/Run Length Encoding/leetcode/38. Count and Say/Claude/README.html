<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Count and Say アルゴリズム解析 (TypeScript版)</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                line-height: 1.6;
            }

            .container {
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1,
            h2 {
                color: #2c3e50;
                text-align: center;
                margin-bottom: 30px;
            }

            h1 {
                font-size: 2.5rem;
                margin-bottom: 10px;
                background: linear-gradient(45deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .subtitle {
                text-align: center;
                color: #666;
                font-size: 1.2rem;
                margin-bottom: 40px;
            }

            .demo-section {
                background: #f8f9fa;
                border-radius: 10px;
                padding: 25px;
                margin: 30px 0;
                border-left: 5px solid #667eea;
            }

            .step-visualization {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                gap: 20px;
                margin: 20px 0;
                padding: 20px;
                background: white;
                border-radius: 8px;
                border: 2px dashed #e9ecef;
            }

            .step-box {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                font-weight: bold;
                font-size: 1.2rem;
                text-align: center;
                min-width: 80px;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                transition: transform 0.3s ease;
            }

            .step-box:hover {
                transform: translateY(-5px);
            }

            .arrow {
                font-size: 2rem;
                color: #667eea;
                font-weight: bold;
            }

            .rle-demo {
                background: #fff3cd;
                border: 2px solid #ffeaa7;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
            }

            .character-analysis {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
                margin: 15px 0;
            }

            .char-group {
                background: #74b9ff;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                font-family: monospace;
                font-size: 1.1rem;
                text-align: center;
            }

            .char-group.highlight {
                background: #e17055;
                animation: pulse 1s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.1);
                }
            }

            .code-section {
                background: #2d3748;
                color: #e2e8f0;
                padding: 25px;
                border-radius: 10px;
                margin: 30px 0;
                overflow-x: auto;
            }

            .code-section pre {
                margin: 0;
                font-family: 'Courier New', monospace;
                font-size: 0.9rem;
                line-height: 1.5;
            }

            .complexity-analysis {
                background: linear-gradient(135deg, #a8e6cf, #dcedc1);
                border-radius: 10px;
                padding: 25px;
                margin: 30px 0;
            }

            .complexity-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: white;
                padding: 15px;
                margin: 10px 0;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .interactive-demo {
                background: #e8f4f8;
                border-radius: 10px;
                padding: 25px;
                margin: 30px 0;
                text-align: center;
            }

            .input-group {
                margin: 20px 0;
            }

            input[type='number'] {
                padding: 10px 15px;
                border: 2px solid #667eea;
                border-radius: 5px;
                font-size: 1.1rem;
                width: 100px;
                text-align: center;
            }

            button {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 5px;
                font-size: 1.1rem;
                cursor: pointer;
                margin-left: 10px;
                transition: transform 0.3s ease;
            }

            button:hover {
                transform: translateY(-2px);
            }

            .result-display {
                background: white;
                border: 2px solid #667eea;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
                font-size: 1.2rem;
                font-family: monospace;
            }

            .process-steps {
                background: #f1f3f4;
                border-radius: 8px;
                padding: 15px;
                margin: 15px 0;
                font-family: monospace;
                font-size: 0.9rem;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>Count and Say アルゴリズム解析</h1>
            <div class="subtitle">TypeScript版 - 視覚的解析とデモンストレーション</div>

            <div class="demo-section">
                <h2>🔍 アルゴリズム概要</h2>
                <p>
                    <strong>Count and Say</strong>は、前の数列のRun-Length
                    Encoding（RLE）を行うことで次の数列を生成する反復的なシーケンスです。
                </p>

                <div class="step-visualization">
                    <div class="step-box">n=1<br />"1"</div>
                    <div class="arrow">→</div>
                    <div class="step-box">n=2<br />"11"</div>
                    <div class="arrow">→</div>
                    <div class="step-box">n=3<br />"21"</div>
                    <div class="arrow">→</div>
                    <div class="step-box">n=4<br />"1211"</div>
                </div>
            </div>

            <div class="demo-section">
                <h2>🎯 Run-Length Encoding の詳細解析</h2>

                <div class="rle-demo">
                    <h3>例: "21" → "1211" の変換プロセス</h3>

                    <div class="character-analysis">
                        <div class="char-group highlight">2</div>
                        <div class="char-group highlight">1</div>
                    </div>

                    <p><strong>ステップ1:</strong> 文字 "2" を1回カウント → "12"</p>
                    <p><strong>ステップ2:</strong> 文字 "1" を1回カウント → "11"</p>
                    <p><strong>結果:</strong> "12" + "11" = "1211"</p>
                </div>

                <div class="rle-demo">
                    <h3>より複雑な例: "1112" → "3112" の変換</h3>

                    <div class="character-analysis">
                        <div class="char-group">1</div>
                        <div class="char-group">1</div>
                        <div class="char-group">1</div>
                        <div class="char-group highlight">2</div>
                    </div>

                    <p><strong>ステップ1:</strong> 文字 "1" を3回カウント → "31"</p>
                    <p><strong>ステップ2:</strong> 文字 "2" を1回カウント → "12"</p>
                    <p><strong>結果:</strong> "31" + "12" = "3112"</p>
                </div>
            </div>

            <div class="code-section">
                <h2>💻 TypeScript実装コード</h2>
                <pre><code>/**
 * Count and Say数列のn番目の要素を返す関数
 * @param {number} n - 取得したい数列の位置（1以上30以下）
 * @returns {string} n番目のcount-and-say数列の文字列
 */
function countAndSay(n: number): string {
    let current: string = "1";
    
    if (n === 1) return current;
    
    for (let i: number = 2; i <= n; i++) {
        current = runLengthEncode(current);
    }
    
    return current;
}

/**
 * Run-Length Encoding実装
 * @param {string} str - エンコードする文字列
 * @returns {string} エンコード後の文字列
 */
function runLengthEncode(str: string): string {
    let result: string = "";
    let count: number = 1;
    let currentChar: string = str[0];
    
    for (let i: number = 1; i < str.length; i++) {
        if (str[i] === currentChar) {
            count++;
        } else {
            result += count + currentChar;
            currentChar = str[i];
            count = 1;
        }
    }
    
    result += count + currentChar;
    return result;
}</code></pre>
            </div>

            <div class="complexity-analysis">
                <h2>📊 計算量解析</h2>

                <div class="complexity-item">
                    <strong>時間計算量:</strong>
                    <span>O(m × k) - m: 各ステップの文字列長, k: ステップ数</span>
                </div>

                <div class="complexity-item">
                    <strong>空間計算量:</strong>
                    <span>O(m) - 各ステップで生成される文字列の長さ</span>
                </div>

                <div class="complexity-item">
                    <strong>最適化ポイント:</strong>
                    <span>反復的アプローチ、文字列連結の最適化</span>
                </div>
            </div>

            <div class="interactive-demo">
                <h2>🚀 インタラクティブデモ</h2>
                <p>nの値を入力してcount-and-sayシーケンスを生成してください：</p>

                <div class="input-group">
                    <input type="number" id="nInput" min="1" max="15" value="4" placeholder="n" />
                    <button onclick="demonstrateCountAndSay()">生成実行</button>
                </div>

                <div id="resultDisplay" class="result-display">結果がここに表示されます</div>

                <div id="processSteps" class="process-steps">処理ステップがここに表示されます</div>
            </div>
        </div>

        <script>
            // JavaScript版の実装（HTMLで動作させるため）
            function countAndSay(n) {
                let current = '1';

                if (n === 1) return current;

                for (let i = 2; i <= n; i++) {
                    current = runLengthEncode(current);
                }

                return current;
            }

            function runLengthEncode(str) {
                let result = '';
                let count = 1;
                let currentChar = str[0];

                for (let i = 1; i < str.length; i++) {
                    if (str[i] === currentChar) {
                        count++;
                    } else {
                        result += count + currentChar;
                        currentChar = str[i];
                        count = 1;
                    }
                }

                result += count + currentChar;
                return result;
            }

            function demonstrateCountAndSay() {
                const n = parseInt(document.getElementById('nInput').value);
                const resultDiv = document.getElementById('resultDisplay');
                const stepsDiv = document.getElementById('processSteps');

                if (n < 1 || n > 15) {
                    resultDiv.innerHTML =
                        '<span style="color: red;">nは1から15の間で入力してください</span>';
                    return;
                }

                // 結果の表示
                const result = countAndSay(n);
                resultDiv.innerHTML = `<strong>countAndSay(${n}) = "${result}"</strong>`;

                // プロセスの表示
                let steps = '<strong>処理ステップ:</strong><br>';
                let current = '1';
                steps += `Step 1: countAndSay(1) = "${current}"<br>`;

                for (let i = 2; i <= n; i++) {
                    const previous = current;
                    current = runLengthEncode(current);
                    steps += `Step ${i}: RLE("${previous}") = "${current}"<br>`;

                    // RLEの詳細を追加
                    steps += `  → "${previous}"の解析: `;
                    let analysis = analyzeRLE(previous);
                    steps += analysis + '<br>';
                }

                stepsDiv.innerHTML = steps;
            }

            function analyzeRLE(str) {
                let analysis = '';
                let count = 1;
                let currentChar = str[0];
                let parts = [];

                for (let i = 1; i < str.length; i++) {
                    if (str[i] === currentChar) {
                        count++;
                    } else {
                        parts.push(`"${currentChar}"を${count}回 → "${count}${currentChar}"`);
                        currentChar = str[i];
                        count = 1;
                    }
                }
                parts.push(`"${currentChar}"を${count}回 → "${count}${currentChar}"`);

                return parts.join(', ');
            }

            // 初期デモを実行
            document.addEventListener('DOMContentLoaded', function () {
                demonstrateCountAndSay();
            });
        </script>
    </body>
</html>
