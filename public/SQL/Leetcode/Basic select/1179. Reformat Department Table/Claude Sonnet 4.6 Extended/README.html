<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LeetCode 1179 Â· Reformat Department Table</title>

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap"
            rel="stylesheet"
        />

        <!-- Tailwind -->
        <script src="/vendor/tailwindcss/script.js"></script>

        <!-- React 18 -->
        <script src="/vendor/react/react.development.js"></script>
        <script src="/vendor/react-dom/react-dom.development.js"></script>
        <script src="/vendor/babel/babel.min.js"></script>

        <!-- Prism.js -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
        />
        <link
            rel="stylesheet"
            href="/vendor/prismjs/plugins/line-numbers/prism-line-numbers.css"
        />
        <link
            rel="stylesheet"
            href="/vendor/prismjs/plugins/toolbar/prism-toolbar.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

        <style>
            html {
                scroll-behavior: smooth;
                font-family: 'DM Sans', sans-serif;
            }
            code,
            pre,
            .mono {
                font-family: 'DM Mono', monospace;
            }
            h1,
            h2,
            h3 {
                font-family: 'Space Grotesk', sans-serif;
            }

            /* Prism toolbar */
            .code-toolbar > .toolbar {
                top: 0.6rem;
                right: 0.6rem;
            }
            .code-toolbar > .toolbar button {
                background: #10b981 !important;
                color: white !important;
                border-radius: 6px !important;
                font-size: 12px !important;
                padding: 0.5rem 1rem !important;
                margin-top: 0.5rem !important;
                margin-right: 0.5rem !important;
                box-shadow: none !important;
            }

            /* subtle noise bg */
            .noise-bg {
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
            }

            /* table scroll */
            .tbl-wrap {
                overflow-x: auto;
            }
            table {
                border-collapse: collapse;
                width: 100%;
            }
            th {
                background: #0f172a;
                color: #e2e8f0;
                font-family: 'DM Mono', monospace;
                font-size: 13px;
            }
            td {
                font-family: 'DM Mono', monospace;
                font-size: 13px;
            }
            tr:nth-child(even) td {
                background: #f8fafc;
            }
        </style>
    </head>
    <body class="bg-[#f0fdf6] noise-bg min-h-screen p-4 md:p-8 max-w-[1200px] mx-auto">
        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <header
            id="header"
            class="mb-8 rounded-3xl p-8 md:p-10 shadow-[0_12px_40px_rgba(16,185,129,0.15)] bg-[linear-gradient(135deg,#d1fae5_0%,#bfdbfe_100%)] relative overflow-hidden"
        >
            <div class="absolute inset-0 opacity-10 pointer-events-none">
                <svg width="100%" height="100%">
                    <pattern id="grid" width="32" height="32" patternUnits="userSpaceOnUse">
                        <path
                            d="M 32 0 L 0 0 0 32"
                            fill="none"
                            stroke="#0f172a"
                            stroke-width="0.5"
                        />
                    </pattern>
                    <rect width="100%" height="100%" fill="url(#grid)" />
                </svg>
            </div>
            <div class="relative z-10">
                <div
                    class="inline-block bg-emerald-600 text-white text-xs font-bold tracking-widest px-3 py-1 rounded-full mb-4"
                >
                    LeetCode Â· #1179 Â· Easy
                </div>
                <h1 class="text-3xl md:text-5xl font-bold text-teal-900 mb-2 leading-tight">
                    Reformat Department Table
                </h1>
                <p class="text-lg md:text-xl text-cyan-700 font-semibold mt-2">
                    ç¸¦æŒã¡ â†’ æ¨ªæŒã¡ ãƒ”ãƒœãƒƒãƒˆå¤‰æ›ï½œæ¡ä»¶ä»˜ãé›†è¨ˆ
                    <span class="bg-white/60 rounded px-2 py-0.5 text-sm ml-1">O(N)</span>
                </p>
                <nav class="flex flex-wrap gap-3 mt-6" aria-label="ãƒšãƒ¼ã‚¸å†…ãƒŠãƒ“">
                    <a
                        href="#overview"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-xl border-2 border-slate-200 bg-white/80 text-sm transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-emerald-50 hover:border-emerald-400"
                        >æ¦‚è¦</a
                    >
                    <a
                        href="#steps"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-xl border-2 border-slate-200 bg-white/80 text-sm transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-emerald-50 hover:border-emerald-400"
                        >ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬</a
                    >
                    <a
                        href="#code"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-xl border-2 border-slate-200 bg-white/80 text-sm transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-emerald-50 hover:border-emerald-400"
                        >SQLå®Ÿè£…</a
                    >
                    <a
                        href="#pandas"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-xl border-2 border-slate-200 bg-white/80 text-sm transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-emerald-50 hover:border-emerald-400"
                        >Pandaså®Ÿè£…</a
                    >
                    <a
                        href="#diagram"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-xl border-2 border-slate-200 bg-white/80 text-sm transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-emerald-50 hover:border-emerald-400"
                        >ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</a
                    >
                    <a
                        href="#complexity"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-xl border-2 border-slate-200 bg-white/80 text-sm transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-emerald-50 hover:border-emerald-400"
                        >è¨ˆç®—é‡</a
                    >
                </nav>
            </div>
        </header>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section
            id="overview"
            class="bg-white rounded-3xl p-8 mb-8 shadow-[0_4px_24px_rgba(0,0,0,0.06)]"
        >
            <h2
                class="text-3xl font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
            >
                ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¦‚è¦
            </h2>

            <p class="text-slate-600 leading-7 mb-4">
                ç¸¦æŒã¡ï¼ˆEAVå½¢å¼ï¼‰ã§æ ¼ç´ã•ã‚ŒãŸ <code>Department</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã€<strong
                    >éƒ¨é–€ID Ã— æœˆ ã®2æ¬¡å…ƒãƒ†ãƒ¼ãƒ–ãƒ«</strong
                >ï¼ˆæ¨ªæŒã¡ï¼‰ã«ãƒ”ãƒœãƒƒãƒˆå¤‰æ›ã™ã‚‹å•é¡Œã§ã™ã€‚ SQLã§ã¯ <code>GROUP BY id</code> ã¨
                <strong>æ¡ä»¶ä»˜ãé›†è¨ˆ <code>MAX â€¦ FILTER</code></strong>
                ã‚’çµ„ã¿åˆã‚ã›ã¦12åˆ—ã‚’ä¸€åº¦ã«å±•é–‹ã—ã¾ã™ã€‚
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <h3 class="text-teal-800 font-bold mb-2 text-lg">ğŸ“¥ å…¥åŠ›</h3>
                    <div class="tbl-wrap rounded-xl border border-slate-200 overflow-hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th class="p-3 text-left">id</th>
                                    <th class="p-3 text-left">revenue</th>
                                    <th class="p-3 text-left">month</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-3 border-t border-slate-100">1</td>
                                    <td class="p-3 border-t border-slate-100">8000</td>
                                    <td
                                        class="p-3 border-t border-slate-100 text-emerald-700 font-bold"
                                    >
                                        Jan
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-3 border-t border-slate-100">2</td>
                                    <td class="p-3 border-t border-slate-100">9000</td>
                                    <td
                                        class="p-3 border-t border-slate-100 text-emerald-700 font-bold"
                                    >
                                        Jan
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-3 border-t border-slate-100">3</td>
                                    <td class="p-3 border-t border-slate-100">10000</td>
                                    <td
                                        class="p-3 border-t border-slate-100 text-sky-700 font-bold"
                                    >
                                        Feb
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-3 border-t border-slate-100">1</td>
                                    <td class="p-3 border-t border-slate-100">7000</td>
                                    <td
                                        class="p-3 border-t border-slate-100 text-sky-700 font-bold"
                                    >
                                        Feb
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-3 border-t border-slate-100">1</td>
                                    <td class="p-3 border-t border-slate-100">6000</td>
                                    <td
                                        class="p-3 border-t border-slate-100 text-violet-700 font-bold"
                                    >
                                        Mar
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div>
                    <h3 class="text-teal-800 font-bold mb-2 text-lg">ğŸ“¤ å‡ºåŠ›ï¼ˆ12åˆ—ï¼‰</h3>
                    <div class="tbl-wrap rounded-xl border border-slate-200 overflow-hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th class="p-3 text-left">id</th>
                                    <th class="p-3 text-left">Jan_Revenue</th>
                                    <th class="p-3 text-left">Feb_Revenue</th>
                                    <th class="p-3 text-left">Mar_Revenue</th>
                                    <th class="p-3 text-left">â€¦</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-3 border-t border-slate-100 font-bold">1</td>
                                    <td class="p-3 border-t border-slate-100 text-emerald-700">
                                        8000
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-sky-700">7000</td>
                                    <td class="p-3 border-t border-slate-100 text-violet-700">
                                        6000
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-slate-400">
                                        null
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-3 border-t border-slate-100 font-bold">2</td>
                                    <td class="p-3 border-t border-slate-100 text-emerald-700">
                                        9000
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-slate-400">
                                        null
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-slate-400">
                                        null
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-slate-400">
                                        null
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-3 border-t border-slate-100 font-bold">3</td>
                                    <td class="p-3 border-t border-slate-100 text-slate-400">
                                        null
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-sky-700">
                                        10000
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-slate-400">
                                        null
                                    </td>
                                    <td class="p-3 border-t border-slate-100 text-slate-400">
                                        null
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-emerald-50 border border-emerald-200 rounded-2xl p-5">
                    <div class="text-2xl mb-1">ğŸ”‘</div>
                    <div class="font-bold text-emerald-800 mb-1">ä¸»ã‚­ãƒ¼ä¿è¨¼</div>
                    <div class="text-sm text-slate-600">
                        (id, month) ãŒä¸»ã‚­ãƒ¼ ï¼ å„ã‚°ãƒ«ãƒ¼ãƒ—ã«æœ€å¤§1è¡Œ â†’ <code>MAX</code> /
                        <code>first</code> ã§ç¢ºå®š
                    </div>
                </div>
                <div class="bg-sky-50 border border-sky-200 rounded-2xl p-5">
                    <div class="text-2xl mb-1">ğŸ“</div>
                    <div class="font-bold text-sky-800 mb-1">é™çš„ãƒ”ãƒœãƒƒãƒˆ</div>
                    <div class="text-sm text-slate-600">
                        æœˆã¯å›ºå®š12ç¨®é¡ â†’ å‹•çš„SQLã‚„ <code>crosstab()</code> ä¸è¦ã€<code>FILTER</code>
                        å¥12å€‹ã§å®Œçµ
                    </div>
                </div>
                <div class="bg-violet-50 border border-violet-200 rounded-2xl p-5">
                    <div class="text-2xl mb-1">ğŸš€</div>
                    <div class="font-bold text-violet-800 mb-1">è¨ˆç®—é‡</div>
                    <div class="text-sm text-slate-600">
                        æ™‚é–“ <code>O(N)</code>ãƒ»ç©ºé–“ <code>O(#dept Ã— 12)</code> â€”
                        Nè¡Œã‚’1ãƒ‘ã‚¹é›†è¨ˆã§å®Œäº†
                    </div>
                </div>
            </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ STEPS (React) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section
            id="steps"
            class="bg-white rounded-3xl p-8 mb-8 shadow-[0_4px_24px_rgba(0,0,0,0.06)]"
        >
            <h2
                class="text-3xl font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
            >
                ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬
            </h2>
            <div id="react-steps"></div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SQL CODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section
            id="code"
            class="bg-white rounded-3xl p-8 mb-8 shadow-[0_4px_24px_rgba(0,0,0,0.06)]"
        >
            <h2
                class="text-3xl font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
            >
                SQLå®Ÿè£…ï¼ˆPostgreSQL 16.6+ï¼‰
            </h2>

            <div class="mb-6 bg-slate-50 rounded-2xl p-4 border border-slate-200">
                <div class="flex gap-3 flex-wrap mb-2">
                    <span
                        class="bg-emerald-100 text-emerald-800 text-xs font-bold px-3 py-1 rounded-full"
                        >æœ€é©è§£</span
                    >
                    <span class="text-sm text-slate-500 font-mono"
                        >FILTERå¥ï¼ˆPostgreSQL 9.4+ï¼‰</span
                    >
                </div>
            </div>

            <pre
                class="line-numbers rounded-xl overflow-hidden text-sm"
            ><code class="language-sql">WITH pivoted AS (
  SELECT
    id,
    MAX(revenue) FILTER (WHERE month = 'Jan') AS "Jan_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Feb') AS "Feb_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Mar') AS "Mar_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Apr') AS "Apr_Revenue",
    MAX(revenue) FILTER (WHERE month = 'May') AS "May_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Jun') AS "Jun_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Jul') AS "Jul_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Aug') AS "Aug_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Sep') AS "Sep_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Oct') AS "Oct_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Nov') AS "Nov_Revenue",
    MAX(revenue) FILTER (WHERE month = 'Dec') AS "Dec_Revenue"
  FROM Department
  GROUP BY id
)
SELECT *
FROM pivoted
ORDER BY id;</code></pre>

            <div class="mt-6 bg-amber-50 border border-amber-200 rounded-2xl p-5">
                <h4 class="font-bold text-amber-800 mb-2">ğŸ’¡ ãªãœ <code>MAX</code> ã‚’ä½¿ã†ã®ã‹ï¼Ÿ</h4>
                <p class="text-sm text-slate-600 leading-6">
                    ä¸»ã‚­ãƒ¼åˆ¶ç´„ã«ã‚ˆã‚Šå„ <code>(id, month)</code> ã‚°ãƒ«ãƒ¼ãƒ—ã¯å¿…ãš1è¡Œä»¥ä¸‹ã€‚<code
                        >MAX</code
                    >
                    ã¯å˜ä¸€å€¤ã‚’ãã®ã¾ã¾è¿”ã—ã€è¡ŒãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ <code>NULL</code> ã‚’è¿”ã—ã¾ã™ã€‚
                    <code>SUM</code> ã‚„ <code>MIN</code> ã§ã‚‚åŒçµæœã«ãªã‚Šã¾ã™ãŒã€<strong
                        >ã€Œ1ã¤ã®å€¤ã‚’é¸ã¶ã€ã¨ã„ã†èªç¾©ãŒæœ€ã‚‚æ­£ç¢ºãªã®ã¯ <code>MAX</code></strong
                    >
                    ã§ã™ã€‚
                    <code>FILTER (WHERE ...)</code> ã¯ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ãŒé›†è¨ˆå‰ã«æ¡ä»¶ã‚’é©ç”¨ã§ãã€<code
                        >CASE WHEN</code
                    >
                    ã‚ˆã‚Šé«˜åŠ¹ç‡ã§ã™ã€‚
                </p>
            </div>

            <h3 class="text-xl font-bold text-slate-700 mt-8 mb-4">
                ä»£æ›¿ï¼šCASE WHENï¼ˆäº’æ›æ€§é‡è¦–ï¼‰
            </h3>
            <pre
                class="line-numbers rounded-xl overflow-hidden text-sm"
            ><code class="language-sql">SELECT
  id,
  MAX(CASE WHEN month = 'Jan' THEN revenue END) AS "Jan_Revenue",
  MAX(CASE WHEN month = 'Feb' THEN revenue END) AS "Feb_Revenue",
  MAX(CASE WHEN month = 'Mar' THEN revenue END) AS "Mar_Revenue",
  -- ... æ®‹ã‚Š9ãƒ¶æœˆåˆ†
  MAX(CASE WHEN month = 'Dec' THEN revenue END) AS "Dec_Revenue"
FROM Department
GROUP BY id
ORDER BY id;</code></pre>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PANDAS CODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section
            id="pandas"
            class="bg-white rounded-3xl p-8 mb-8 shadow-[0_4px_24px_rgba(0,0,0,0.06)]"
        >
            <h2
                class="text-3xl font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
            >
                Pandaså®Ÿè£…ï¼ˆPython 3.10 / pandas 2.2.2ï¼‰
            </h2>

            <div class="flex gap-3 flex-wrap mb-4">
                <span class="bg-violet-100 text-violet-800 text-xs font-bold px-3 py-1 rounded-full"
                    >æ”¹å–„ç‰ˆ</span
                >
                <span class="text-sm text-slate-500 font-mono"
                    >set_index + unstackï¼ˆMemoryæœ€é©åŒ–æ¸ˆï¼‰</span
                >
                <span class="bg-sky-100 text-sky-800 text-xs font-bold px-3 py-1 rounded-full"
                    >ä¸­é–“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ: 1å€‹</span
                >
            </div>

            <pre
                class="line-numbers rounded-xl overflow-hidden text-sm"
            ><code class="language-python">import pandas as pd

_MONTHS = ["Jan","Feb","Mar","Apr","May","Jun",
           "Jul","Aug","Sep","Oct","Nov","Dec"]

def reformat_department(department: pd.DataFrame) -> pd.DataFrame:
    """
    ç¸¦æŒã¡ã® Department ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¨ªæŒã¡ã«ãƒ”ãƒœãƒƒãƒˆã™ã‚‹ã€‚

    Args:
        department (pd.DataFrame): columns = [id, revenue, month]

    Returns:
        pd.DataFrame: [id, Jan_Revenue, Feb_Revenue, ..., Dec_Revenue]
                      å£²ä¸Šãªã—æœˆã¯ NaNã€‚
    """
    # â‘  (id, month) ãŒä¸»ã‚­ãƒ¼ â†’ é›†è¨ˆä¸è¦ã€ç›´æ¥ãƒ”ãƒœãƒƒãƒˆè»¸ã‚’æ§‹ç¯‰
    #    unstack ã¯ Cython ãƒ¬ãƒ™ãƒ«ã§å‹•ä½œã— Python é›†è¨ˆå‘¼ã³å‡ºã—ãªã—
    out = (
        department
        .set_index(["id", "month"])["revenue"]   # MultiIndex Series: O(N)
        .unstack("month")                         # Series â†’ 2D DataFrame: O(N)
        .reindex(columns=_MONTHS)                 # æ¬ ææœˆè£œå®Œ + ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é †: O(12)
    )

    # â‘¡ åˆ—åã‚’ä¸€æ‹¬ãƒªãƒãƒ¼ãƒ ï¼ˆãƒªã‚¹ãƒˆä»£å…¥ã¯ã‚³ãƒ”ãƒ¼ãªã—ï¼‰
    out.columns = [f"{m}_Revenue" for m in out.columns]

    # â‘¢ id ã‚’é€šå¸¸åˆ—ã«æˆ»ã™
    out = out.reset_index()
    out.columns.name = None

    return out</code></pre>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <div class="bg-red-50 border border-red-200 rounded-2xl p-4">
                    <div class="font-bold text-red-700 mb-2">
                        âŒ æ—§å®Ÿè£… <code>pivot_table</code>
                    </div>
                    <div class="text-sm text-slate-600">
                        ä¸­é–“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ3ã€œ4å€‹ã€Python ãƒ¬ãƒ™ãƒ«ã®
                        <code>aggfunc</code> å‘¼ã³å‡ºã—ç™ºç”Ÿã€‚Memory Beats <strong>5.66%</strong>
                    </div>
                </div>
                <div class="bg-emerald-50 border border-emerald-200 rounded-2xl p-4">
                    <div class="font-bold text-emerald-700 mb-2">
                        âœ… æ”¹å–„ç‰ˆ <code>set_index + unstack</code>
                    </div>
                    <div class="text-sm text-slate-600">
                        ä¸­é–“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ1å€‹ã€Cythonãƒ¬ãƒ™ãƒ«ç›´æ¥å±•é–‹ã€‚Memory Beats
                        <strong>50ã€œ80% æœŸå¾…</strong>
                    </div>
                </div>
            </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DIAGRAM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section
            id="diagram"
            class="bg-white rounded-3xl p-8 mb-8 shadow-[0_4px_24px_rgba(0,0,0,0.06)]"
        >
            <h2
                class="text-3xl font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
            >
                ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
            </h2>
            <div class="mt-5 overflow-x-auto">
                <svg
                    viewBox="-40 -40 920 1040"
                    style="max-width: 100%; height: auto"
                    role="img"
                    aria-label="Reformat Department Table flowchart"
                >
                    <defs>
                        <marker
                            id="arr"
                            markerWidth="10"
                            markerHeight="10"
                            refX="8"
                            refY="3"
                            orient="auto"
                            markerUnits="strokeWidth"
                        >
                            <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                        </marker>
                        <marker
                            id="arrG"
                            markerWidth="10"
                            markerHeight="10"
                            refX="8"
                            refY="3"
                            orient="auto"
                            markerUnits="strokeWidth"
                        >
                            <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                        </marker>
                        <marker
                            id="arrB"
                            markerWidth="10"
                            markerHeight="10"
                            refX="8"
                            refY="3"
                            orient="auto"
                            markerUnits="strokeWidth"
                        >
                            <path d="M0,0 L0,6 L9,3 z" fill="#0284c7" />
                        </marker>
                        <marker
                            id="arrV"
                            markerWidth="10"
                            markerHeight="10"
                            refX="8"
                            refY="3"
                            orient="auto"
                            markerUnits="strokeWidth"
                        >
                            <path d="M0,0 L0,6 L9,3 z" fill="#7c3aed" />
                        </marker>
                    </defs>

                    <!-- â‘  ã‚¹ã‚¿ãƒ¼ãƒˆ -->
                    <ellipse
                        cx="420"
                        cy="54"
                        rx="160"
                        ry="34"
                        fill="#d1fae5"
                        stroke="#10b981"
                        stroke-width="2.5"
                    />
                    <text
                        x="420"
                        y="54"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="17"
                        font-weight="700"
                        fill="#065f46"
                    >
                        é–‹å§‹
                    </text>

                    <!-- â†“ -->
                    <line
                        x1="420"
                        y1="88"
                        x2="420"
                        y2="118"
                        stroke="#64748b"
                        stroke-width="2"
                        marker-end="url(#arr)"
                    />

                    <!-- â‘¡ å…¥åŠ›ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª -->
                    <rect
                        x="260"
                        y="120"
                        width="320"
                        height="58"
                        rx="10"
                        fill="#e0f2fe"
                        stroke="#0284c7"
                        stroke-width="2"
                    />
                    <text
                        x="420"
                        y="143"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="17"
                        font-weight="700"
                        fill="#0c4a6e"
                    >
                        å…¥åŠ›ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
                    </text>
                    <text
                        x="420"
                        y="163"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        fill="#0369a1"
                    >
                        Department(id, revenue, month)
                    </text>

                    <!-- â†“ -->
                    <line
                        x1="420"
                        y1="178"
                        x2="420"
                        y2="208"
                        stroke="#64748b"
                        stroke-width="2"
                        marker-end="url(#arr)"
                    />

                    <!-- â‘¢ ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰: (id, month) ä¸»ã‚­ãƒ¼ï¼Ÿ -->
                    <polygon
                        points="420,210 560,265 420,320 280,265"
                        fill="#fef3c7"
                        stroke="#f59e0b"
                        stroke-width="2"
                    />
                    <text
                        x="420"
                        y="258"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="15"
                        font-weight="700"
                        fill="#78350f"
                    >
                        (id, month)
                    </text>
                    <text
                        x="420"
                        y="276"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        fill="#92400e"
                    >
                        ä¸»ã‚­ãƒ¼ä¿è¨¼ã‚ã‚Šï¼Ÿ
                    </text>

                    <!-- ã¯ã„ â†’ å³ -->
                    <line
                        x1="560"
                        y1="265"
                        x2="650"
                        y2="265"
                        stroke="#059669"
                        stroke-width="2"
                        marker-end="url(#arrG)"
                    />
                    <text
                        x="600"
                        y="254"
                        text-anchor="middle"
                        font-size="14"
                        font-weight="600"
                        fill="#059669"
                    >
                        ã¯ã„
                    </text>
                    <rect
                        x="652"
                        y="240"
                        width="160"
                        height="50"
                        rx="8"
                        fill="#d1fae5"
                        stroke="#059669"
                        stroke-width="2"
                    />
                    <text
                        x="732"
                        y="262"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        font-weight="600"
                        fill="#065f46"
                    >
                        é›†è¨ˆã¯ MAX
                    </text>
                    <text
                        x="732"
                        y="278"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="13"
                        fill="#047857"
                    >
                        ï¼ˆ1è¡Œç¢ºå®šï¼‰
                    </text>

                    <!-- ã„ã„ãˆ â†’ å·¦ -->
                    <line
                        x1="280"
                        y1="265"
                        x2="190"
                        y2="265"
                        stroke="#dc2626"
                        stroke-width="2"
                        marker-end="url(#arr)"
                    />
                    <text
                        x="232"
                        y="254"
                        text-anchor="middle"
                        font-size="14"
                        font-weight="600"
                        fill="#dc2626"
                    >
                        ã„ã„ãˆ
                    </text>
                    <rect
                        x="28"
                        y="240"
                        width="160"
                        height="50"
                        rx="8"
                        fill="#fee2e2"
                        stroke="#dc2626"
                        stroke-width="2"
                    />
                    <text
                        x="108"
                        y="262"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        font-weight="600"
                        fill="#7f1d1d"
                    >
                        é‡è¤‡ã‚ã‚Š
                    </text>
                    <text
                        x="108"
                        y="278"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="13"
                        fill="#991b1b"
                    >
                        äº‹å‰é›†è¨ˆã‚’æ¤œè¨
                    </text>

                    <!-- â†“ from diamond -->
                    <line
                        x1="420"
                        y1="320"
                        x2="420"
                        y2="360"
                        stroke="#64748b"
                        stroke-width="2"
                        marker-end="url(#arr)"
                    />

                    <!-- â‘£ GROUP BY id -->
                    <rect
                        x="260"
                        y="362"
                        width="320"
                        height="58"
                        rx="10"
                        fill="#e0f2fe"
                        stroke="#0284c7"
                        stroke-width="2"
                    />
                    <text
                        x="420"
                        y="384"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="17"
                        font-weight="700"
                        fill="#0c4a6e"
                    >
                        GROUP BY id
                    </text>
                    <text
                        x="420"
                        y="404"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        fill="#0369a1"
                    >
                        éƒ¨é–€ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
                    </text>

                    <!-- â†“ -->
                    <line
                        x1="420"
                        y1="420"
                        x2="420"
                        y2="450"
                        stroke="#64748b"
                        stroke-width="2"
                        marker-end="url(#arr)"
                    />

                    <!-- â‘¤ æœˆåˆ¥ FILTER é›†è¨ˆ -->
                    <rect
                        x="220"
                        y="452"
                        width="400"
                        height="70"
                        rx="10"
                        fill="#e0f2fe"
                        stroke="#0284c7"
                        stroke-width="2"
                    />
                    <text
                        x="420"
                        y="476"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="16"
                        font-weight="700"
                        fill="#0c4a6e"
                    >
                        æœˆåˆ¥ FILTER é›†è¨ˆï¼ˆ12å›ï¼‰
                    </text>
                    <text
                        x="420"
                        y="496"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="13"
                        fill="#0369a1"
                    >
                        MAX(revenue) FILTER (WHERE month='Jan')
                    </text>
                    <text
                        x="420"
                        y="512"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="13"
                        fill="#0369a1"
                    >
                        â€¦ Ã— 12ãƒ¶æœˆåˆ†
                    </text>

                    <!-- â†“ -->
                    <line
                        x1="420"
                        y1="522"
                        x2="420"
                        y2="552"
                        stroke="#64748b"
                        stroke-width="2"
                        marker-end="url(#arr)"
                    />

                    <!-- â‘¥ ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰: å…¨æœˆå‡¦ç†å®Œäº†ï¼Ÿ -->
                    <polygon
                        points="420,554 560,609 420,664 280,609"
                        fill="#fef3c7"
                        stroke="#f59e0b"
                        stroke-width="2"
                    />
                    <text
                        x="420"
                        y="602"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="15"
                        font-weight="700"
                        fill="#78350f"
                    >
                        å…¨12åˆ—
                    </text>
                    <text
                        x="420"
                        y="620"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        fill="#92400e"
                    >
                        å±•é–‹å®Œäº†ï¼Ÿ
                    </text>

                    <!-- ã„ã„ãˆ â†’ å·¦ãƒ«ãƒ¼ãƒ— -->
                    <path
                        d="M280,609 L160,609 L160,487 L220,487"
                        stroke="#7c3aed"
                        stroke-width="2"
                        fill="none"
                        marker-end="url(#arrV)"
                        stroke-dasharray="6 3"
                    />
                    <text
                        x="130"
                        y="550"
                        text-anchor="middle"
                        font-size="13"
                        font-weight="600"
                        fill="#7c3aed"
                    >
                        æ¬¡ã®æœˆ
                    </text>

                    <!-- ã¯ã„ â†“ -->
                    <line
                        x1="420"
                        y1="664"
                        x2="420"
                        y2="694"
                        stroke="#059669"
                        stroke-width="2"
                        marker-end="url(#arrG)"
                    />
                    <text x="440" y="682" font-size="14" font-weight="600" fill="#059669">
                        ã¯ã„
                    </text>

                    <!-- â‘¦ NULLè£œå®Œ -->
                    <rect
                        x="260"
                        y="696"
                        width="320"
                        height="58"
                        rx="10"
                        fill="#f1f5f9"
                        stroke="#64748b"
                        stroke-width="2"
                    />
                    <text
                        x="420"
                        y="718"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="17"
                        font-weight="700"
                        fill="#334155"
                    >
                        NULLè£œå®Œ
                    </text>
                    <text
                        x="420"
                        y="738"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        fill="#475569"
                    >
                        å£²ä¸Šãªã—æœˆã¯è‡ªå‹•çš„ã« NULL
                    </text>

                    <!-- â†“ -->
                    <line
                        x1="420"
                        y1="754"
                        x2="420"
                        y2="784"
                        stroke="#64748b"
                        stroke-width="2"
                        marker-end="url(#arr)"
                    />

                    <!-- â‘§ å‡ºåŠ› -->
                    <rect
                        x="235"
                        y="786"
                        width="370"
                        height="58"
                        rx="10"
                        fill="#d1fae5"
                        stroke="#059669"
                        stroke-width="2.5"
                    />
                    <text
                        x="420"
                        y="808"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="17"
                        font-weight="700"
                        fill="#065f46"
                    >
                        æ¨ªæŒã¡ãƒ†ãƒ¼ãƒ–ãƒ«å‡ºåŠ›
                    </text>
                    <text
                        x="420"
                        y="828"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="14"
                        fill="#047857"
                    >
                        id + 12åˆ—ï¼ˆJan_Revenue â€¦ Dec_Revenueï¼‰
                    </text>

                    <!-- â†“ -->
                    <line
                        x1="420"
                        y1="844"
                        x2="420"
                        y2="869"
                        stroke="#059669"
                        stroke-width="2"
                        marker-end="url(#arrG)"
                    />

                    <!-- â‘¨ çµ‚äº† -->
                    <ellipse
                        cx="420"
                        cy="900"
                        rx="160"
                        ry="32"
                        fill="#d1fae5"
                        stroke="#10b981"
                        stroke-width="2.5"
                    />
                    <text
                        x="420"
                        y="900"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="17"
                        font-weight="700"
                        fill="#065f46"
                    >
                        çµ‚äº†
                    </text>
                </svg>
            </div>

            <div
                class="mt-6 bg-slate-50 rounded-2xl p-5 border border-slate-200 mono text-sm leading-7"
            >
                <strong class="text-xl not-mono font-bold">ãƒ•ãƒ­ãƒ¼ã®èª¬æ˜ï¼š</strong><br />
                1. å…¥åŠ›ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ§‹é€ ï¼ˆid, revenue, monthï¼‰ã‚’ç¢ºèªã™ã‚‹<br />
                2. <strong>(id, month) ãŒä¸»ã‚­ãƒ¼</strong>ã‹ã©ã†ã‹ã‚’ç¢ºèª â€” ä¸»ã‚­ãƒ¼ä¿è¨¼ãŒã‚ã‚Œã°
                <code>MAX</code> é›†è¨ˆãŒå®‰å…¨<br />
                3. <code>GROUP BY id</code> ã§éƒ¨é–€ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å½¢æˆã™ã‚‹<br />
                4.
                <code>MAX(revenue) FILTER (WHERE month = 'X')</code>
                ã‚’æœˆã”ã¨ã«12å›é©ç”¨ï¼ˆç´«ãƒ«ãƒ¼ãƒ—ï¼‰<br />
                5. å…¨12åˆ—ã®å±•é–‹ãŒå®Œäº†ã—ãŸã‚‰ NULL è£œå®Œãƒ•ã‚§ãƒ¼ã‚ºã¸é€²ã‚€<br />
                6. è¡ŒãŒå­˜åœ¨ã—ãªã„æœˆã«ã¯è‡ªå‹•çš„ã« <code>NULL</code> ãŒæ ¼ç´ã•ã‚Œã‚‹<br />
                7. æœ€çµ‚çš„ãªæ¨ªæŒã¡ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‡ºåŠ›ã—ã¦çµ‚äº†
            </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ COMPLEXITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section
            id="complexity"
            class="bg-white rounded-3xl p-8 mb-8 shadow-[0_4px_24px_rgba(0,0,0,0.06)]"
        >
            <h2
                class="text-3xl font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
            >
                è¨ˆç®—é‡åˆ†æ
            </h2>

            <div class="tbl-wrap rounded-2xl border border-slate-200 overflow-hidden mb-6">
                <table>
                    <thead>
                        <tr>
                            <th class="p-4 text-left">æ‰‹æ³•</th>
                            <th class="p-4 text-left">æ™‚é–“è¨ˆç®—é‡</th>
                            <th class="p-4 text-left">ç©ºé–“è¨ˆç®—é‡</th>
                            <th class="p-4 text-left">ä¸­é–“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</th>
                            <th class="p-4 text-left">å‚™è€ƒ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="p-4 border-t border-slate-100 font-bold text-emerald-700">
                                FILTERå¥ï¼ˆæ¨å¥¨ï¼‰
                            </td>
                            <td class="p-4 border-t border-slate-100">O(N)</td>
                            <td class="p-4 border-t border-slate-100">O(#dept Ã— 12)</td>
                            <td class="p-4 border-t border-slate-100 text-emerald-600">æœ€å°</td>
                            <td class="p-4 border-t border-slate-100">Cythoné›†è¨ˆå‰ãƒ•ã‚£ãƒ«ã‚¿</td>
                        </tr>
                        <tr>
                            <td class="p-4 border-t border-slate-100 font-bold text-sky-700">
                                CASE WHEN
                            </td>
                            <td class="p-4 border-t border-slate-100">O(N)</td>
                            <td class="p-4 border-t border-slate-100">O(#dept Ã— 12)</td>
                            <td class="p-4 border-t border-slate-100 text-sky-600">å°‘</td>
                            <td class="p-4 border-t border-slate-100">è¡Œã”ã¨ã«WHENè©•ä¾¡</td>
                        </tr>
                        <tr>
                            <td class="p-4 border-t border-slate-100 font-bold text-violet-700">
                                unstack (Pandas)
                            </td>
                            <td class="p-4 border-t border-slate-100">O(N)</td>
                            <td class="p-4 border-t border-slate-100">O(#dept Ã— 12)</td>
                            <td class="p-4 border-t border-slate-100 text-violet-600">1å€‹</td>
                            <td class="p-4 border-t border-slate-100">Memoryæœ€å°ã€Beatsâ†‘</td>
                        </tr>
                        <tr>
                            <td class="p-4 border-t border-slate-100 font-bold text-amber-700">
                                pivot_table (Pandas)
                            </td>
                            <td class="p-4 border-t border-slate-100">O(N)</td>
                            <td class="p-4 border-t border-slate-100">O(#dept Ã— 12)</td>
                            <td class="p-4 border-t border-slate-100 text-red-500">3ã€œ4å€‹</td>
                            <td class="p-4 border-t border-slate-100">Python aggfuncå‘¼ã³å‡ºã—</td>
                        </tr>
                        <tr>
                            <td class="p-4 border-t border-slate-100 font-bold text-slate-500">
                                crosstab()
                            </td>
                            <td class="p-4 border-t border-slate-100">O(N log N)</td>
                            <td class="p-4 border-t border-slate-100">O(#dept Ã— 12)</td>
                            <td class="p-4 border-t border-slate-100 text-red-500">å¤š</td>
                            <td class="p-4 border-t border-slate-100">å‹•çš„åˆ—ãŒå¿…è¦ãªå ´åˆã®ã¿</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-emerald-50 border border-emerald-200 rounded-2xl p-5">
                    <h4 class="font-bold text-emerald-800 mb-2">â± æ™‚é–“è¨ˆç®—é‡</h4>
                    <p class="text-sm text-slate-600 leading-6">
                        <code>GROUP BY id</code> ã¯ãƒãƒƒã‚·ãƒ¥é›†è¨ˆã§ <strong>O(N)</strong>ã€‚<br />
                        <code>FILTER</code> æ¡ä»¶è©•ä¾¡ã¯ <code>O(12Ã—N) = O(N)</code>ã€‚<br />
                        ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒã‚ã‚‹å ´åˆã¯ Index Scan â†’ Hash Agg ã§ç·šå½¢è¿‘ä¼¼ã€‚
                    </p>
                </div>
                <div class="bg-sky-50 border border-sky-200 rounded-2xl p-5">
                    <h4 class="font-bold text-sky-800 mb-2">ğŸ’¾ ç©ºé–“è¨ˆç®—é‡</h4>
                    <p class="text-sm text-slate-600 leading-6">
                        å‡ºåŠ›è¡Œåˆ—ã¯ <strong>O(#dept Ã— 12)</strong> ã®å›ºå®šã‚µã‚¤ã‚ºã€‚<br />
                        N ãŒå¤§ãããªã£ã¦ã‚‚å‡ºåŠ›ã‚µã‚¤ã‚ºã¯éƒ¨é–€æ•° Ã—
                        12åˆ—ã«åæŸã™ã‚‹ãŸã‚ã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã¯é«˜ã„ã€‚
                    </p>
                </div>
            </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ REACT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            const MONTHS = [
                'Jan',
                'Feb',
                'Mar',
                'Apr',
                'May',
                'Jun',
                'Jul',
                'Aug',
                'Sep',
                'Oct',
                'Nov',
                'Dec',
            ];

            const stepsData = [
                {
                    step: 1,
                    title: 'å…¥åŠ›ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª',
                    desc: 'ç¸¦æŒã¡ï¼ˆEAVå½¢å¼ï¼‰ã® Department ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèªã—ã¾ã™ã€‚(id, month) ãŒè¤‡åˆä¸»ã‚­ãƒ¼ã¨ãªã£ã¦ãŠã‚Šã€åŒã˜éƒ¨é–€IDã«è¤‡æ•°ã®æœˆãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ã¾ã™ã€‚',
                    visual: { type: 'raw' },
                },
                {
                    step: 2,
                    title: 'GROUP BY id',
                    desc: 'id ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã€éƒ¨é–€å˜ä½ã«é›†ç´„ã—ã¾ã™ã€‚ã“ã®æ™‚ç‚¹ã§ã¯æœˆåˆ¥ã®è¡ŒãŒ1è¡Œã«ã¾ã¨ã¾ã‚Šã€é›†è¨ˆã®æº–å‚™ãŒæ•´ã„ã¾ã™ã€‚',
                    visual: { type: 'group' },
                },
                {
                    step: 3,
                    title: 'Janåˆ—ã‚’æ¡ä»¶é›†è¨ˆ',
                    desc: "MAX(revenue) FILTER (WHERE month = 'Jan') ã§ Jan_Revenue åˆ—ã‚’ç”Ÿæˆã—ã¾ã™ã€‚month = 'Jan' ã®è¡Œã ã‘ã‚’å¯¾è±¡ã« MAX ã‚’é©ç”¨ã—ã€å­˜åœ¨ã—ãªã„éƒ¨é–€ã¯ NULL ã«ãªã‚Šã¾ã™ã€‚",
                    visual: { type: 'filter', targetMonth: 'Jan', monthIdx: 0 },
                },
                {
                    step: 4,
                    title: 'Febãƒ»Maråˆ—ã‚’å±•é–‹',
                    desc: 'åŒæ§˜ã« Feb_Revenue, Mar_Revenue â€¦ ã¨ FILTER å¥ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚å„æœˆã§è©²å½“è¡ŒãŒå­˜åœ¨ã™ã‚Œã° revenue å€¤ã€ãªã‘ã‚Œã° NULL ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚',
                    visual: { type: 'filter', targetMonth: 'Mar', monthIdx: 2 },
                },
                {
                    step: 5,
                    title: 'å…¨12æœˆåˆ—ã‚’å±•é–‹å®Œäº†',
                    desc: '12ãƒ¶æœˆåˆ†ã® FILTER é›†è¨ˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚å£²ä¸ŠãŒãªã„æœˆã¯è‡ªå‹•çš„ã« NULL ã§è£œå®Œã•ã‚Œã¾ã™ã€‚',
                    visual: { type: 'all' },
                },
                {
                    step: 6,
                    title: 'æ¨ªæŒã¡ãƒ†ãƒ¼ãƒ–ãƒ«å®Œæˆ',
                    desc: 'æœ€çµ‚çš„ãªæ¨ªæŒã¡ãƒ”ãƒœãƒƒãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®Œæˆã§ã™ã€‚id åˆ— + 12ãƒ¶æœˆã® Revenue åˆ—ã€åˆè¨ˆ13åˆ—ã®å‡ºåŠ›ã§ã™ã€‚',
                    visual: { type: 'result' },
                },
            ];

            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
            const rawData = [
                { id: 1, revenue: 8000, month: 'Jan' },
                { id: 2, revenue: 9000, month: 'Jan' },
                { id: 3, revenue: 10000, month: 'Feb' },
                { id: 1, revenue: 7000, month: 'Feb' },
                { id: 1, revenue: 6000, month: 'Mar' },
            ];

            const pivotedData = {
                1: { Jan: 8000, Feb: 7000, Mar: 6000 },
                2: { Jan: 9000 },
                3: { Feb: 10000 },
            };

            const COLORS = {
                Jan: '#10b981',
                Feb: '#0ea5e9',
                Mar: '#8b5cf6',
                Apr: '#f59e0b',
                May: '#ec4899',
                Jun: '#14b8a6',
                Jul: '#f97316',
                Aug: '#06b6d4',
                Sep: '#6366f1',
                Oct: '#84cc16',
                Nov: '#ef4444',
                Dec: '#78716c',
            };

            function StepViz({ visual }) {
                if (visual.type === 'raw') {
                    return (
                        <div className="overflow-x-auto mt-5">
                            <table className="w-full text-sm rounded-xl overflow-hidden border border-slate-200">
                                <thead>
                                    <tr>
                                        <th className="bg-slate-800 text-slate-200 px-4 py-2 text-left mono">
                                            id
                                        </th>
                                        <th className="bg-slate-800 text-slate-200 px-4 py-2 text-left mono">
                                            revenue
                                        </th>
                                        <th className="bg-slate-800 text-slate-200 px-4 py-2 text-left mono">
                                            month
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {rawData.map((r, i) => (
                                        <tr
                                            key={i}
                                            className={i % 2 === 0 ? 'bg-white' : 'bg-slate-50'}
                                        >
                                            <td className="px-4 py-2 mono border-t border-slate-100">
                                                {r.id}
                                            </td>
                                            <td className="px-4 py-2 mono border-t border-slate-100">
                                                {r.revenue.toLocaleString()}
                                            </td>
                                            <td
                                                className="px-4 py-2 mono border-t border-slate-100 font-bold"
                                                style={{ color: COLORS[r.month] }}
                                            >
                                                {r.month}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            <div className="mt-3 text-xs text-slate-500 mono text-center">
                                5è¡Œ Â· ç¸¦æŒã¡å½¢å¼
                            </div>
                        </div>
                    );
                }

                if (visual.type === 'group') {
                    return (
                        <div className="mt-5">
                            <div className="text-sm text-slate-500 mono mb-3 text-center">
                                GROUP BY id â†’ 3ã‚°ãƒ«ãƒ¼ãƒ—
                            </div>
                            <div className="flex gap-3 flex-wrap justify-center">
                                {[1, 2, 3].map((id) => {
                                    const rows = rawData.filter((r) => r.id === id);
                                    return (
                                        <div
                                            key={id}
                                            className="rounded-xl border-2 border-emerald-300 bg-emerald-50 p-4 min-w-[140px]"
                                        >
                                            <div className="font-bold text-emerald-800 text-center mb-2 text-sm">
                                                id = {id}
                                            </div>
                                            {rows.map((r, i) => (
                                                <div
                                                    key={i}
                                                    className="text-xs mono bg-white rounded px-2 py-1 mb-1 border border-emerald-100"
                                                >
                                                    <span
                                                        style={{ color: COLORS[r.month] }}
                                                        className="font-bold"
                                                    >
                                                        {r.month}
                                                    </span>
                                                    : {r.revenue.toLocaleString()}
                                                </div>
                                            ))}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    );
                }

                if (visual.type === 'filter') {
                    const { targetMonth, monthIdx } = visual;
                    const filledMonths = MONTHS.slice(0, monthIdx + 1);
                    return (
                        <div className="mt-5">
                            <div className="text-xs mono bg-slate-800 text-emerald-300 rounded-lg px-4 py-2 mb-4">
                                MAX(revenue) FILTER (WHERE month = '
                                <span style={{ color: COLORS[targetMonth] }}>{targetMonth}</span>')
                            </div>
                            <div className="overflow-x-auto">
                                <table className="text-xs rounded-xl overflow-hidden border border-slate-200 w-full">
                                    <thead>
                                        <tr>
                                            <th className="bg-slate-800 text-slate-200 px-3 py-2 text-left mono">
                                                id
                                            </th>
                                            {filledMonths.map((m) => (
                                                <th
                                                    key={m}
                                                    className={[
                                                        'px-3 py-2 text-left mono',
                                                        m === targetMonth
                                                            ? 'text-white'
                                                            : 'bg-slate-800 text-slate-200',
                                                    ].join(' ')}
                                                    style={
                                                        m === targetMonth
                                                            ? { background: COLORS[m] }
                                                            : {}
                                                    }
                                                >
                                                    {m}
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {[1, 2, 3].map((id, ri) => (
                                            <tr
                                                key={id}
                                                className={
                                                    ri % 2 === 0 ? 'bg-white' : 'bg-slate-50'
                                                }
                                            >
                                                <td className="px-3 py-2 mono border-t border-slate-100 font-bold">
                                                    {id}
                                                </td>
                                                {filledMonths.map((m) => {
                                                    const val = pivotedData[id]?.[m];
                                                    return (
                                                        <td
                                                            key={m}
                                                            className={[
                                                                'px-3 py-2 mono border-t border-slate-100',
                                                                m === targetMonth
                                                                    ? 'font-bold'
                                                                    : '',
                                                            ].join(' ')}
                                                            style={
                                                                m === targetMonth
                                                                    ? {
                                                                          color: val
                                                                              ? COLORS[m]
                                                                              : '#94a3b8',
                                                                      }
                                                                    : {}
                                                            }
                                                        >
                                                            {val !== undefined ? (
                                                                val.toLocaleString()
                                                            ) : (
                                                                <span className="text-slate-300">
                                                                    null
                                                                </span>
                                                            )}
                                                        </td>
                                                    );
                                                })}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    );
                }

                if (visual.type === 'all') {
                    const show = ['Jan', 'Feb', 'Mar', 'Apr', 'May'];
                    return (
                        <div className="mt-5">
                            <div className="text-xs text-slate-500 mono mb-2 text-center">
                                12ãƒ¶æœˆåˆ† å±•é–‹å®Œäº†ï¼ˆä¸€éƒ¨è¡¨ç¤ºï¼‰
                            </div>
                            <div className="overflow-x-auto">
                                <table className="text-xs rounded-xl overflow-hidden border border-slate-200">
                                    <thead>
                                        <tr>
                                            <th className="bg-slate-800 text-slate-200 px-3 py-2">
                                                id
                                            </th>
                                            {show.map((m) => (
                                                <th
                                                    key={m}
                                                    className="px-3 py-2 text-white"
                                                    style={{ background: COLORS[m] }}
                                                >
                                                    {m}
                                                </th>
                                            ))}
                                            <th className="bg-slate-600 text-slate-200 px-3 py-2">
                                                â€¦
                                            </th>
                                            <th className="bg-slate-700 text-slate-200 px-3 py-2">
                                                Dec
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {[1, 2, 3].map((id, ri) => (
                                            <tr
                                                key={id}
                                                className={
                                                    ri % 2 === 0 ? 'bg-white' : 'bg-slate-50'
                                                }
                                            >
                                                <td className="px-3 py-2 mono border-t border-slate-100 font-bold">
                                                    {id}
                                                </td>
                                                {show.map((m) => {
                                                    const val = pivotedData[id]?.[m];
                                                    return (
                                                        <td
                                                            key={m}
                                                            className="px-3 py-2 mono border-t border-slate-100"
                                                            style={{
                                                                color: val ? COLORS[m] : '#cbd5e1',
                                                            }}
                                                        >
                                                            {val ?? 'null'}
                                                        </td>
                                                    );
                                                })}
                                                <td className="px-3 py-2 mono border-t border-slate-100 text-slate-400">
                                                    â€¦
                                                </td>
                                                <td className="px-3 py-2 mono border-t border-slate-100 text-slate-300">
                                                    null
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    );
                }

                if (visual.type === 'result') {
                    return (
                        <div className="mt-5">
                            <div className="text-center mb-3">
                                <span className="inline-block bg-emerald-600 text-white text-xs font-bold px-3 py-1 rounded-full">
                                    âœ… å‡ºåŠ›å®Œæˆ Â· 13åˆ—
                                </span>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="text-xs rounded-xl overflow-hidden border-2 border-emerald-300 w-full">
                                    <thead>
                                        <tr>
                                            <th className="bg-emerald-700 text-white px-3 py-2">
                                                id
                                            </th>
                                            {['Jan', 'Feb', 'Mar', 'â€¦', 'Dec'].map((m, i) => (
                                                <th
                                                    key={i}
                                                    className="bg-emerald-600 text-white px-3 py-2 mono"
                                                >
                                                    {m}_Rev
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {[
                                            [1, '8000', '7000', '6000', 'â€¦', 'null'],
                                            [2, '9000', 'null', 'null', 'â€¦', 'null'],
                                            [3, 'null', '10000', 'null', 'â€¦', 'null'],
                                        ].map((row, ri) => (
                                            <tr
                                                key={ri}
                                                className={
                                                    ri % 2 === 0 ? 'bg-white' : 'bg-emerald-50/40'
                                                }
                                            >
                                                <td className="px-3 py-2 mono border-t border-slate-100 font-bold text-emerald-800">
                                                    {row[0]}
                                                </td>
                                                {row.slice(1).map((v, ci) => (
                                                    <td
                                                        key={ci}
                                                        className={[
                                                            'px-3 py-2 mono border-t border-slate-100',
                                                            v === 'null'
                                                                ? 'text-slate-300'
                                                                : 'text-emerald-700 font-bold',
                                                        ].join(' ')}
                                                    >
                                                        {v}
                                                    </td>
                                                ))}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    );
                }

                return null;
            }

            function StepApp() {
                const [activeStep, setActiveStep] = useState(1);
                const [isPlaying, setIsPlaying] = useState(false);
                const timerRef = useRef(null);

                const currentStepData = stepsData[activeStep - 1];

                useEffect(() => {
                    if (isPlaying) {
                        if (activeStep > stepsData.length) {
                            setIsPlaying(false);
                            setActiveStep(1);
                            return;
                        }
                        timerRef.current = setTimeout(() => {
                            if (activeStep === stepsData.length) {
                                setActiveStep(1);
                                setIsPlaying(false);
                            } else {
                                setActiveStep((prev) => prev + 1);
                            }
                        }, 1800);
                    }
                    return () => {
                        if (timerRef.current) clearTimeout(timerRef.current);
                    };
                }, [isPlaying, activeStep]);

                const handlePlay = () => {
                    if (isPlaying) return;
                    setActiveStep(1);
                    setIsPlaying(true);
                };
                const handlePrev = () => {
                    setIsPlaying(false);
                    setActiveStep((s) => Math.max(1, s - 1));
                };
                const handleNext = () => {
                    setIsPlaying(false);
                    setActiveStep((s) => Math.min(stepsData.length, s + 1));
                };
                const handleReset = () => {
                    setIsPlaying(false);
                    setActiveStep(1);
                };

                return (
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8 mt-2">
                        {/* å·¦: ã‚¹ãƒ†ãƒƒãƒ—ãƒªã‚¹ãƒˆ */}
                        <div>
                            <h3 className="mt-0 mb-4 text-teal-800 text-xl font-semibold">
                                ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§
                            </h3>
                            <div className="space-y-2">
                                {stepsData.map((step) => {
                                    const isActive = activeStep === step.step;
                                    return (
                                        <button
                                            key={step.step}
                                            type="button"
                                            className={[
                                                'w-full text-left text-sm rounded-xl border-2 transition cursor-pointer px-4 py-3',
                                                'bg-white border-slate-200 hover:border-emerald-400 hover:translate-x-1',
                                                isActive
                                                    ? 'bg-[linear-gradient(135deg,#d1fae5,#a7f3d0)] border-emerald-500 shadow-[0_4px_12px_rgba(16,185,129,0.20)]'
                                                    : '',
                                            ].join(' ')}
                                            onClick={() => {
                                                setIsPlaying(false);
                                                setActiveStep(step.step);
                                            }}
                                            aria-label={`ã‚¹ãƒ†ãƒƒãƒ—${step.step}: ${step.title}`}
                                            aria-current={isActive ? 'step' : undefined}
                                        >
                                            <div
                                                className={[
                                                    'font-bold mb-1 text-sm',
                                                    isActive ? 'text-emerald-900' : 'text-teal-800',
                                                ].join(' ')}
                                            >
                                                Step {step.step}: {step.title}
                                            </div>
                                            <div className="text-slate-500 text-xs">
                                                {step.desc.substring(0, 60)}
                                                {step.desc.length > 60 ? 'â€¦' : ''}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* å³: å¯è¦–åŒ– */}
                        <div className="my-auto">
                            <div className="rounded-2xl p-6 border-2 border-emerald-200 bg-[linear-gradient(135deg,#ecfdf5,#f0f9ff)]">
                                <h3 className="mt-0 text-teal-800 text-lg font-bold">
                                    Step {currentStepData.step}: {currentStepData.title}
                                </h3>
                                <p className="text-slate-600 leading-7 text-sm">
                                    {currentStepData.desc}
                                </p>
                            </div>

                            <StepViz visual={currentStepData.visual} />

                            {/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */}
                            <div className="flex flex-wrap justify-center gap-2 mt-4">
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 bg-[linear-gradient(135deg,#10b981,#059669)] text-sm"
                                    onClick={handlePlay}
                                    disabled={isPlaying}
                                    aria-label="è‡ªå‹•å†ç”Ÿ"
                                >
                                    â–¶ Play
                                </button>
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-slate-700 transition disabled:opacity-50 border-2 border-slate-200 bg-white hover:border-emerald-400 text-sm"
                                    onClick={handlePrev}
                                    disabled={activeStep === 1}
                                    aria-label="å‰ã®ã‚¹ãƒ†ãƒƒãƒ—"
                                >
                                    â† Prev
                                </button>
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-slate-700 transition disabled:opacity-50 border-2 border-slate-200 bg-white hover:border-emerald-400 text-sm"
                                    onClick={handleNext}
                                    disabled={activeStep === stepsData.length}
                                    aria-label="æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—"
                                >
                                    Next â†’
                                </button>
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-slate-500 transition border-2 border-slate-200 bg-white hover:border-slate-400 text-sm"
                                    onClick={handleReset}
                                    aria-label="ãƒªã‚»ãƒƒãƒˆ"
                                >
                                    â†º Reset
                                </button>
                            </div>

                            {/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ */}
                            <div className="flex gap-1.5 justify-center mt-4">
                                {stepsData.map((s) => (
                                    <button
                                        key={s.step}
                                        type="button"
                                        onClick={() => {
                                            setIsPlaying(false);
                                            setActiveStep(s.step);
                                        }}
                                        className={[
                                            'w-2.5 h-2.5 rounded-full transition',
                                            activeStep === s.step
                                                ? 'bg-emerald-500 scale-125'
                                                : 'bg-slate-300 hover:bg-emerald-300',
                                        ].join(' ')}
                                        aria-label={`Step ${s.step}`}
                                    />
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            const root = ReactDOM.createRoot(document.getElementById('react-steps'));
            root.render(<StepApp />);
        </script>

        <!-- Prism re-highlight after mount -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    if (window.Prism) Prism.highlightAll();
                }, 300);
            });
        </script>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <footer class="text-center text-slate-400 text-sm py-6 mono">
            LeetCode #1179 Â· Reformat Department Table Â· PostgreSQL 16.6+ / pandas 2.2.2
        </footer>
    </body>
</html>
