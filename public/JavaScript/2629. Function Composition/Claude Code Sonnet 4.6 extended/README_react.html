<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LeetCode 2629 - Function Composition</title>
        <script
            src="/vendor/react/react.production.min.js"
            integrity="sha384-DGyLxAyjq0f9SPpVevD6IgztCFlnMF6oW/XQGmfe+IsZ8TqEiDrcHkMLKI6fiB/Z"
            crossorigin="anonymous"
        ></script>
        <script
            src="/vendor/react-dom/react-dom.production.min.js"
            integrity="sha384-gTGxhz21lVGYNMcdJOyq01Edg0jhn/c22nsx0kyqP0TxaV5WVdsSH1fSDUf5YJj1"
            crossorigin="anonymous"
        ></script>
        <script
            src="/vendor/babel/babel.min.js"
            integrity="sha384-Fo0OdKhdnE7y2WmzjOMW4PYjHkkANeu1501pWTqKrzAPeJMFQb4ZTdAA9dtrVUJV"
            crossorigin="anonymous"
        ></script>
        <script src="/vendor/tailwindcss/script.js"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&family=Fraunces:wght@700;900&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            integrity="sha384-wFjoQjtV1y5jVHbt0p35Ui8aV8GVpEZkyF99OXWqP/eNJDU93D3Ugxkoyh6Y2I4A"
            crossorigin="anonymous"
        />
        <link
            rel="stylesheet"
            href="/vendor/prismjs/plugins/line-numbers/prism-line-numbers.css"
            integrity="sha384-nUkTNLI8COlMCRJ0FHIdX76If83145OTCLUx4gQyfnO0gGeO/sD9czGEUBxtkcUv"
            crossorigin="anonymous"
        />
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"
            integrity="sha384-06z5D//U/xpvxZHuUz92xBvq3DqBBFi7Up53HRrbV7Jlv7Yvh/MZ7oenfUe9iCEt"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"
            integrity="sha384-PeOqKNW/piETaCg8rqKFy+Pm6KEk7e36/5YZE5XO/OaFdO+/Aw3O8qZ9qDPKVUgx"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"
            integrity="sha384-6QJu8apxMmB9TiPVWzYKF5pRgKcz7snO0/QU+MrWmgBLECQjoa6erxX2VQ5t41Jd"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"
            integrity="sha384-jC1G68eGEXJpPwMDNqyIUQsQlcUCdCU+a7GGuoV4TUZvM1gLYTMJUDvqBnxtZLWA"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"
            integrity="sha384-ZdEfx8sYX8i4IVXU1tUbqwOp4PBUCCmnpagpiHchnstXkEczkzPfUd9fvBrntM+F"
            crossorigin="anonymous"
        ></script>
        <style>
            html {
                scroll-behavior: smooth;
            }
            body {
                font-family: 'DM Sans', sans-serif;
            }
            h1,
            h2,
            h3 {
                font-family: 'Fraunces', serif;
            }
            code,
            pre,
            .mono {
                font-family: 'DM Mono', monospace;
            }
            .code-toolbar > .toolbar {
                position: absolute;
                top: 0.5rem;
                right: 0.5rem;
                opacity: 0;
                transition: opacity 0.3s ease-in-out;
            }
            .code-toolbar:hover > .toolbar {
                opacity: 1;
            }
            .code-toolbar > .toolbar .toolbar-item button {
                background: #374151;
                color: #e5e7eb;
                border-radius: 6px;
                padding: 4px 10px;
                font-size: 12px;
                border: none;
                cursor: pointer;
            }
            div.code-toolbar {
                position: relative;
            }
        </style>
    </head>
    <body class="bg-[#0f0e17] text-[#fffffe] min-h-screen">
        <div class="max-w-6xl mx-auto px-4 py-10">
            <!-- HEADER -->
            <header
                id="header"
                class="mb-10 rounded-3xl p-10 bg-[linear-gradient(135deg,#1a1a2e,#16213e,#0f3460)] border border-[#e53170]/30 shadow-[0_0_60px_rgba(229,49,112,0.15)]"
            >
                <div class="flex items-start gap-4 flex-wrap">
                    <span
                        class="text-[#e53170] mono text-sm font-semibold bg-[#e53170]/10 px-3 py-1 rounded-full border border-[#e53170]/30"
                        >LeetCode #2629</span
                    >
                    <span class="text-[#a7a9be] mono text-sm bg-white/5 px-3 py-1 rounded-full"
                        >Easy</span
                    >
                </div>
                <h1 class="text-5xl font-black text-[#fffffe] mt-4 mb-2 leading-tight">
                    Function<br /><span class="text-[#e53170]">Composition</span>
                </h1>
                <p class="text-[#a7a9be] text-lg mt-3 max-w-2xl">
                    é–¢æ•°ã®é…åˆ—ã‚’å—ã‘å–ã‚Šã€å³ã‹ã‚‰å·¦ã¸é †ã«é©ç”¨ã™ã‚‹åˆæˆé–¢æ•°ã‚’è¿”ã™ã€‚<br />
                    <span class="text-[#e7c7d4] mono text-sm">reduceRight</span> ã«ã‚ˆã‚‹ O(n)
                    ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè£…ã€‚
                </p>
                <nav class="flex flex-wrap gap-3 mt-8">
                    <a
                        href="#overview"
                        class="px-5 py-2 rounded-xl border border-white/10 text-[#a7a9be] text-sm font-medium hover:bg-white/5 hover:text-[#fffffe] transition-all"
                        >æ¦‚è¦</a
                    >
                    <a
                        href="#steps"
                        class="px-5 py-2 rounded-xl border border-white/10 text-[#a7a9be] text-sm font-medium hover:bg-white/5 hover:text-[#fffffe] transition-all"
                        >ã‚¹ãƒ†ãƒƒãƒ—å¯è¦–åŒ–</a
                    >
                    <a
                        href="#code"
                        class="px-5 py-2 rounded-xl border border-white/10 text-[#a7a9be] text-sm font-medium hover:bg-white/5 hover:text-[#fffffe] transition-all"
                        >å®Ÿè£…</a
                    >
                    <a
                        href="#diagram"
                        class="px-5 py-2 rounded-xl border border-white/10 text-[#a7a9be] text-sm font-medium hover:bg-white/5 hover:text-[#fffffe] transition-all"
                        >ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</a
                    >
                    <a
                        href="#complexity"
                        class="px-5 py-2 rounded-xl border border-white/10 text-[#a7a9be] text-sm font-medium hover:bg-white/5 hover:text-[#fffffe] transition-all"
                        >è¨ˆç®—é‡</a
                    >
                </nav>
            </header>

            <!-- OVERVIEW -->
            <section id="overview" class="bg-[#1a1a2e] rounded-3xl p-8 mb-8 border border-white/5">
                <h2
                    class="text-3xl font-black text-[#fffffe] mb-6 pb-3 border-b border-[#e53170]/20"
                >
                    æ¦‚è¦
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-bold text-[#e53170] mb-3">å•é¡Œã®è¦ä»¶</h3>
                        <p class="text-[#a7a9be] leading-relaxed mb-4">
                            é–¢æ•°ã®é…åˆ—
                            <code class="text-[#e7c7d4] bg-white/5 px-1 rounded"
                                >functions = [f1, f2, ..., fn]</code
                            >
                            ã‚’å—ã‘å–ã‚Šã€
                            <strong class="text-[#fffffe]">å³ã‹ã‚‰å·¦</strong
                            >ã¸é †ã«é©ç”¨ã™ã‚‹åˆæˆé–¢æ•°ã‚’è¿”ã™ã€‚
                        </p>
                        <div
                            class="bg-[#0f0e17] rounded-2xl p-4 mono text-sm border border-white/5"
                        >
                            <div class="text-[#a7a9be] mb-2">// åˆæˆã®å®šç¾©</div>
                            <div class="text-[#e7c7d4]">compose([f, g, h])(x)</div>
                            <div class="text-[#a7a9be]">// = f(g(h(x)))</div>
                            <div class="mt-3 text-[#a7a9be]">// ç©ºé…åˆ— â†’ æ’ç­‰é–¢æ•°</div>
                            <div class="text-[#e7c7d4]">compose([])(x) === x</div>
                        </div>
                        <h3 class="text-lg font-bold text-[#e53170] mb-3 mt-6">åˆ¶ç´„æ¡ä»¶</h3>
                        <ul class="space-y-2 text-[#a7a9be]">
                            <li class="flex gap-2">
                                <span class="text-[#e53170]">â–¸</span>
                                <code class="text-[#e7c7d4]">-1000 â‰¤ x â‰¤ 1000</code>
                            </li>
                            <li class="flex gap-2">
                                <span class="text-[#e53170]">â–¸</span>
                                <code class="text-[#e7c7d4]">0 â‰¤ functions.length â‰¤ 1000</code>
                            </li>
                            <li class="flex gap-2">
                                <span class="text-[#e53170]">â–¸</span> å„é–¢æ•°ã¯æ•´æ•°â†’æ•´æ•°ã®å¤‰æ›
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-[#e53170] mb-3">å…¥å‡ºåŠ›ä¾‹</h3>
                        <div class="space-y-4">
                            <div class="bg-[#0f0e17] rounded-2xl p-4 border border-white/5">
                                <div class="text-xs text-[#a7a9be] mb-2 mono">Example 1</div>
                                <div class="mono text-sm text-[#e7c7d4]">
                                    functions = [x=&gt;x+1, x=&gt;x*x, x=&gt;2*x]
                                </div>
                                <div class="mono text-sm text-[#a7a9be]">x = 4</div>
                                <div class="mono text-sm text-[#fffffe] mt-2">
                                    // 2*4=8 â†’ 8Â²=64 â†’ 64+1=65
                                </div>
                                <div class="text-[#e53170] font-bold mono mt-1">Output: 65</div>
                            </div>
                            <div class="bg-[#0f0e17] rounded-2xl p-4 border border-white/5">
                                <div class="text-xs text-[#a7a9be] mb-2 mono">Example 2</div>
                                <div class="mono text-sm text-[#e7c7d4]">
                                    functions = [x=&gt;10*x, x=&gt;10*x, x=&gt;10*x]
                                </div>
                                <div class="mono text-sm text-[#a7a9be]">x = 1</div>
                                <div class="mono text-sm text-[#fffffe] mt-2">
                                    // 10*1=10 â†’ 10*10=100 â†’ 10*100=1000
                                </div>
                                <div class="text-[#e53170] font-bold mono mt-1">Output: 1000</div>
                            </div>
                            <div class="bg-[#0f0e17] rounded-2xl p-4 border border-white/5">
                                <div class="text-xs text-[#a7a9be] mb-2 mono">Example 3</div>
                                <div class="mono text-sm text-[#e7c7d4]">functions = []</div>
                                <div class="mono text-sm text-[#a7a9be]">x = 42</div>
                                <div class="mono text-sm text-[#fffffe] mt-2">
                                    // æ’ç­‰é–¢æ•° â†’ ãã®ã¾ã¾è¿”ã™
                                </div>
                                <div class="text-[#e53170] font-bold mono mt-1">Output: 42</div>
                            </div>
                        </div>
                        <div
                            class="bg-[#e53170]/10 border border-[#e53170]/30 rounded-2xl p-4 mt-4"
                        >
                            <div class="text-[#e53170] font-bold text-sm mb-1">ğŸ”‘ æ ¸å¿ƒã‚¢ã‚¤ãƒ‡ã‚¢</div>
                            <div class="text-[#e7c7d4] text-sm leading-relaxed">
                                <code class="bg-white/10 px-1 rounded">reduceRight</code> ã®åˆæœŸå€¤
                                <code class="bg-white/10 px-1 rounded">x</code> ãŒã€
                                ç©ºé…åˆ—æ™‚ã«æ’ç­‰é–¢æ•°ã¨ã—ã¦è‡ªç„¶ã«æ©Ÿèƒ½ã™ã‚‹ã€‚ç‰¹åˆ¥ãªåˆ†å²ãŒä¸è¦ã€‚
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- STEPS VISUALIZATION (React) -->
            <section id="steps" class="bg-[#1a1a2e] rounded-3xl p-8 mb-8 border border-white/5">
                <h2
                    class="text-3xl font-black text-[#fffffe] mb-2 pb-3 border-b border-[#e53170]/20"
                >
                    ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å¯è¦–åŒ–
                </h2>
                <p class="text-[#a7a9be] text-sm mb-6">
                    ä¾‹:
                    <code class="text-[#e7c7d4]"
                        >functions = [x=&gt;x+1, x=&gt;x*x, x=&gt;2*x], x = 4</code
                    >
                </p>
                <div id="react-root"></div>
            </section>

            <!-- CODE -->
            <section id="code" class="bg-[#1a1a2e] rounded-3xl p-8 mb-8 border border-white/5">
                <h2
                    class="text-3xl font-black text-[#fffffe] mb-6 pb-3 border-b border-[#e53170]/20"
                >
                    TypeScript å®Ÿè£…
                </h2>
                <pre
                    class="line-numbers rounded-2xl"
                    style="margin: 0"
                ><code class="language-typescript">type F = (x: number) => number;

/**
 * é–¢æ•°é…åˆ—ã®å³ã‹ã‚‰å·¦ã¸ã®åˆæˆã‚’è¿”ã™ã€‚
 * ç©ºé…åˆ—ã®å ´åˆã¯æ’ç­‰é–¢æ•°ã‚’è¿”ã™ã€‚
 *
 * @param functions - åˆæˆã™ã‚‹é–¢æ•°ã®é…åˆ—ï¼ˆå³ç«¯ã‹ã‚‰é †ã«é©ç”¨ï¼‰
 * @returns åˆæˆã•ã‚ŒãŸé–¢æ•°
 * @complexity Time: O(n) per call, Space: O(1)
 */
function compose(functions: readonly F[]): F {
    // reduceRight ã®åˆæœŸå€¤ x ãŒç©ºé…åˆ—æ™‚ã®æ’ç­‰é–¢æ•°ã‚’è‡ªç„¶ã«å®Ÿç¾ã™ã‚‹
    return function (x: number): number {
        return functions.reduceRight(
            (acc: number, fn: F): number => fn(acc),
            x
        );
    };
}

/**
 * const fn = compose([x => x + 1, x => x * x, x => 2 * x]);
 * fn(4); // 65  (2*4=8 â†’ 8Â²=64 â†’ 64+1=65)
 *
 * const id = compose([]);
 * id(42); // 42  (æ’ç­‰é–¢æ•°)
 */</code></pre>
            </section>

            <!-- FLOWCHART -->
            <section id="diagram" class="bg-[#1a1a2e] rounded-3xl p-8 mb-8 border border-white/5">
                <h2
                    class="text-3xl font-black text-[#fffffe] mb-6 pb-3 border-b border-[#e53170]/20"
                >
                    ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
                </h2>
                <div class="overflow-x-auto">
                    <svg
                        viewBox="0 0 800 1020"
                        style="max-width: 100%; height: auto"
                        role="img"
                        aria-label="Function Composition flowchart"
                    >
                        <defs>
                            <!--
            markerWidth / markerHeight ã¯ SVG ä»•æ§˜ä¸Šã®æ­£ã—ã„ camelCase å±æ€§åã€‚
            marker-width / marker-height (kebab) ã¯ãƒ–ãƒ©ã‚¦ã‚¶ãŒç„¡è¦–ã™ã‚‹ãŸã‚çŸ¢å°ãŒæç”»ã•ã‚Œãªã„ã€‚
          -->
                            <marker
                                id="arr"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                            </marker>
                            <marker
                                id="arrR"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#e53170" />
                            </marker>
                            <marker
                                id="arrB"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#7c3aed" />
                            </marker>
                        </defs>

                        <!-- â‘  START: compose ãŒå‘¼ã°ã‚Œã‚‹
             ellipse center=(400,55) rx=175 ry=36 â†’ top=19 bot=91 -->
                        <ellipse
                            cx="400"
                            cy="55"
                            rx="175"
                            ry="36"
                            fill="#1e0a12"
                            stroke="#e53170"
                            stroke-width="2"
                        />
                        <text
                            x="400"
                            y="55"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#e53170"
                            font-size="16"
                            font-weight="700"
                            font-family="DM Sans, sans-serif"
                        >
                            compose ãŒå‘¼ã°ã‚Œã‚‹
                        </text>

                        <!-- â‘ â†’â‘¡ ä¸‹å‘ãçŸ¢å° -->
                        <path
                            d="M400 91 L400 116"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arr)"
                        />

                        <!-- â‘¡ ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ç”Ÿæˆã—ã¦è¿”ã™
             rect x=230 y=117 w=340 h=46 â†’ center=(400,140) bot=163 -->
                        <rect
                            x="230"
                            y="117"
                            width="340"
                            height="46"
                            rx="12"
                            fill="#1a2340"
                            stroke="#7c3aed"
                            stroke-width="2"
                        />
                        <text
                            x="400"
                            y="140"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#c4b5fd"
                            font-size="15"
                            font-family="DM Sans, sans-serif"
                        >
                            ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ç”Ÿæˆã—ã¦è¿”ã™
                        </text>

                        <!-- â‘¡â†’â‘¢ ä¸‹å‘ãçŸ¢å° -->
                        <path
                            d="M400 163 L400 184"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arr)"
                        />

                        <!-- â‘¢ fn(x) ãŒå‘¼ã°ã‚Œã‚‹
             ellipse center=(400,220) rx=190 ry=38 â†’ top=182 bot=258 -->
                        <ellipse
                            cx="400"
                            cy="220"
                            rx="190"
                            ry="38"
                            fill="#1e0a12"
                            stroke="#e53170"
                            stroke-width="2"
                        />
                        <text
                            x="400"
                            y="220"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#e53170"
                            font-size="15"
                            font-weight="700"
                            font-family="DM Sans, sans-serif"
                        >
                            è¿”ã•ã‚ŒãŸ fn(x) ãŒå‘¼ã°ã‚Œã‚‹
                        </text>

                        <!-- â‘¢â†’â‘£ ä¸‹å‘ãçŸ¢å° -->
                        <path
                            d="M400 258 L400 286"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arr)"
                        />

                        <!-- â‘£ DIAMOND: functions ç©ºé…åˆ—ï¼Ÿ
             center=(400,360) hw=136 hh=74
             top=(400,286) bot=(400,434) L=(264,360) R=(536,360) -->
                        <polygon
                            points="400,286 536,360 400,434 264,360"
                            fill="#1c1a10"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="400"
                            y="350"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#fcd34d"
                            font-size="15"
                            font-family="DM Sans, sans-serif"
                        >
                            functions
                        </text>
                        <text
                            x="400"
                            y="372"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#fcd34d"
                            font-size="15"
                            font-family="DM Sans, sans-serif"
                        >
                            ç©ºé…åˆ—ï¼Ÿ
                        </text>

                        <!-- ã€Œã¯ã„ã€å³çŸ¢å°: R(536,360) â†’ identity box å·¦ç«¯(558,360) -->
                        <path
                            d="M536 360 L558 360"
                            stroke="#e53170"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrR)"
                        />
                        <text
                            x="546"
                            y="347"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#e53170"
                            font-size="13"
                            font-family="DM Sans, sans-serif"
                        >
                            ã¯ã„
                        </text>

                        <!-- identity box: x=558 y=336 w=190 h=48 â†’ center=(653,360) bot=384 -->
                        <rect
                            x="558"
                            y="336"
                            width="190"
                            height="48"
                            rx="10"
                            fill="#1e0a12"
                            stroke="#e53170"
                            stroke-width="2"
                        />
                        <text
                            x="653"
                            y="353"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#e7c7d4"
                            font-size="14"
                            font-family="DM Sans, sans-serif"
                        >
                            x ã‚’ãã®ã¾ã¾è¿”ã™
                        </text>
                        <text
                            x="653"
                            y="373"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#e53170"
                            font-size="12"
                            font-family="DM Mono, monospace"
                        >
                            // æ’ç­‰é–¢æ•°
                        </text>

                        <!-- identity â†’ result: å³å´ã‚’é€šã£ã¦ä¸‹ã¸ã€result æ¥•å††å³ç«¯ã¸åˆæµ (ç ´ç·š) -->
                        <path
                            d="M653 384 L653 900 L585 900"
                            stroke="#e53170"
                            stroke-width="2"
                            fill="none"
                            stroke-dasharray="6,4"
                            marker-end="url(#arrR)"
                        />

                        <!-- ã€Œã„ã„ãˆã€ä¸‹çŸ¢å°: bot(400,434) â†’ â‘¤ top(400,463) -->
                        <path
                            d="M400 434 L400 463"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arr)"
                        />
                        <text
                            x="416"
                            y="452"
                            text-anchor="start"
                            dominant-baseline="middle"
                            fill="#a7a9be"
                            font-size="13"
                            font-family="DM Sans, sans-serif"
                        >
                            ã„ã„ãˆ
                        </text>

                        <!-- â‘¤ reduceRight é–‹å§‹
             rect x=230 y=464 w=340 h=64 â†’ center=(400,496) bot=528 -->
                        <rect
                            x="230"
                            y="464"
                            width="340"
                            height="64"
                            rx="12"
                            fill="#0d1a33"
                            stroke="#7c3aed"
                            stroke-width="2"
                        />
                        <text
                            x="400"
                            y="488"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#c4b5fd"
                            font-size="15"
                            font-family="DM Mono, monospace"
                        >
                            reduceRight é–‹å§‹
                        </text>
                        <text
                            x="400"
                            y="514"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#a7a9be"
                            font-size="13"
                            font-family="DM Mono, monospace"
                        >
                            acc = xï¼ˆåˆæœŸå€¤ï¼‰
                        </text>

                        <!-- â‘¤ â†’ junction circle -->
                        <path d="M400 528 L400 552" stroke="#64748b" stroke-width="2" fill="none" />
                        <!-- ãƒ«ãƒ¼ãƒ—åˆæµç‚¹ (junction): (400,556) -->
                        <circle cx="400" cy="556" r="5" fill="#475569" />
                        <!-- junction â†’ â‘¥ top -->
                        <path
                            d="M400 561 L400 578"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arr)"
                        />

                        <!-- â‘¥ DIAMOND: ã¾ã é–¢æ•°ãŒæ®‹ã£ã¦ã„ã‚‹ï¼Ÿ
             center=(400,648) hw=136 hh=70
             top=(400,578) bot=(400,718) L=(264,648) R=(536,648) -->
                        <polygon
                            points="400,578 536,648 400,718 264,648"
                            fill="#1c1a10"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="400"
                            y="638"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#fcd34d"
                            font-size="15"
                            font-family="DM Sans, sans-serif"
                        >
                            ã¾ã é–¢æ•°ãŒ
                        </text>
                        <text
                            x="400"
                            y="660"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#fcd34d"
                            font-size="15"
                            font-family="DM Sans, sans-serif"
                        >
                            æ®‹ã£ã¦ã„ã‚‹ï¼Ÿ
                        </text>

                        <!-- ã€Œã¯ã„ã€å·¦çŸ¢å°: L(264,648) â†’ å·¦å¤–(20,648) â†’ ä¸‹(20,806) â†’ apply box å·¦ç«¯(30,806) -->
                        <path
                            d="M264 648 L05 648 L05 806 L30 806"
                            stroke="#7c3aed"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrB)"
                        />
                        <text
                            x="140"
                            y="636"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#7c3aed"
                            font-size="13"
                            font-family="DM Sans, sans-serif"
                        >
                            ã¯ã„
                        </text>

                        <!-- apply box: x=30 y=782 w=200 h=48 â†’ center=(130,806) bot=830 -->
                        <rect
                            x="30"
                            y="782"
                            width="200"
                            height="48"
                            rx="10"
                            fill="#0d1a33"
                            stroke="#7c3aed"
                            stroke-width="2"
                        />
                        <text
                            x="130"
                            y="806"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#c4b5fd"
                            font-size="14"
                            font-family="DM Mono, monospace"
                        >
                            acc = fn(acc)
                        </text>

                        <!-- ãƒ«ãƒ¼ãƒ—è¿”ã‚ŠçŸ¢å°: apply å³ç«¯(230,806) â†’ å³æŠ˜(250,806) â†’ ä¸Š(250,556) â†’ junction å·¦ç«¯(395,556) -->
                        <path
                            d="M230 806 L250 806 L250 556 L395 556"
                            stroke="#7c3aed"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrB)"
                        />
                        <!-- ã€Œæ¬¡ã®é–¢æ•°ã¸ã€ãƒ©ãƒ™ãƒ«: ãƒ«ãƒ¼ãƒ—ç¸¦ç·š(x=250)ã®å³ã€ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰å¢ƒç•Œã‚ˆã‚Šå†…å´ã«é…ç½® -->
                        <text
                            x="258"
                            y="693"
                            text-anchor="start"
                            dominant-baseline="middle"
                            fill="#7c3aed"
                            font-size="12"
                            font-family="DM Sans, sans-serif"
                        >
                            æ¬¡ã®é–¢æ•°ã¸
                        </text>

                        <!-- ã€Œã„ã„ãˆã€ä¸‹çŸ¢å°: bot(400,718) â†’ â‘¦ top(400,858) -->
                        <path
                            d="M400 718 L400 858"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arr)"
                        />
                        <text
                            x="416"
                            y="742"
                            text-anchor="start"
                            dominant-baseline="middle"
                            fill="#a7a9be"
                            font-size="13"
                            font-family="DM Sans, sans-serif"
                        >
                            ã„ã„ãˆ
                        </text>

                        <!-- â‘¦ RESULT: acc ã‚’è¿”ã™
             ellipse center=(400,900) rx=185 ry=42 â†’ top=858 right-edge=(585,900) -->
                        <ellipse
                            cx="400"
                            cy="900"
                            rx="185"
                            ry="42"
                            fill="#1e0a12"
                            stroke="#e53170"
                            stroke-width="2.5"
                        />
                        <text
                            x="400"
                            y="888"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#e53170"
                            font-size="16"
                            font-weight="700"
                            font-family="DM Sans, sans-serif"
                        >
                            acc ã‚’è¿”ã™
                        </text>
                        <text
                            x="400"
                            y="912"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            fill="#a7a9be"
                            font-size="12"
                            font-family="DM Mono, monospace"
                        >
                            // f(g(h(x))) ã®çµæœ
                        </text>
                    </svg>
                </div>
                <div class="mt-6 bg-[#0f0e17] rounded-2xl p-5 border border-white/5">
                    <p class="text-[#a7a9be] text-sm leading-relaxed">
                        <strong class="text-[#fffffe]">ãƒ•ãƒ­ãƒ¼è§£èª¬ï¼š</strong><br />
                        1.
                        <span class="text-[#c4b5fd]">compose</span>
                        ãŒå‘¼ã°ã‚Œã‚‹ã¨å³åº§ã«ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’è¿”ã™ï¼ˆO(1)ï¼‰<br />
                        2. è¿”ã•ã‚ŒãŸé–¢æ•°
                        <span class="text-[#e7c7d4] mono">fn(x)</span>
                        ãŒå‘¼ã°ã‚ŒãŸã¨ãå®Ÿéš›ã®è¨ˆç®—ãŒå§‹ã¾ã‚‹ï¼ˆO(n)ï¼‰<br />
                        3. ç©ºé…åˆ—ã®å ´åˆã¯ <span class="text-[#e53170]">reduceRight</span> ã®åˆæœŸå€¤ x
                        ãŒãã®ã¾ã¾è¿”ã‚‹ â†’ æ’ç­‰é–¢æ•°<br />
                        4. è¦ç´ ãŒã‚ã‚‹å ´åˆã¯å³ç«¯ã‹ã‚‰ fn ã‚’é †ã« acc ã«é©ç”¨ã—ã€æœ€çµ‚ acc ã‚’è¿”ã™
                    </p>
                </div>
            </section>

            <!-- COMPLEXITY -->
            <section
                id="complexity"
                class="bg-[#1a1a2e] rounded-3xl p-8 mb-8 border border-white/5"
            >
                <h2
                    class="text-3xl font-black text-[#fffffe] mb-6 pb-3 border-b border-[#e53170]/20"
                >
                    è¨ˆç®—é‡åˆ†æ
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-[#0f0e17] rounded-2xl p-6 border border-[#e53170]/20">
                        <div class="text-4xl font-black text-[#e53170] mono mb-1">O(n)</div>
                        <div class="text-[#a7a9be] text-sm">æ™‚é–“è¨ˆç®—é‡</div>
                        <div class="text-[#e7c7d4] text-xs mt-3 leading-relaxed">
                            n = é–¢æ•°é…åˆ—ã®é•·ã•ã€‚<br />composeå‘¼ã³å‡ºã—ã¯ O(1)ã€<br />è¿”ã•ã‚ŒãŸé–¢æ•°ã®å®Ÿè¡ŒãŒ
                            O(n)ã€‚
                        </div>
                    </div>
                    <div class="bg-[#0f0e17] rounded-2xl p-6 border border-[#7c3aed]/20">
                        <div class="text-4xl font-black text-[#c4b5fd] mono mb-1">O(1)</div>
                        <div class="text-[#a7a9be] text-sm">ç©ºé–“è¨ˆç®—é‡</div>
                        <div class="text-[#e7c7d4] text-xs mt-3 leading-relaxed">
                            ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãŒ functions ã¸ã®å‚ç…§ã‚’<br />1æœ¬ä¿æŒã™ã‚‹ã®ã¿ã€‚<br />é…åˆ—ã®ã‚³ãƒ”ãƒ¼ãªã—ã€‚
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm border-collapse">
                        <thead>
                            <tr class="border-b border-white/10">
                                <th class="text-left py-3 px-4 text-[#a7a9be] font-semibold">
                                    ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
                                </th>
                                <th class="text-center py-3 px-4 text-[#a7a9be] font-semibold">
                                    æ™‚é–“è¨ˆç®—é‡
                                </th>
                                <th class="text-center py-3 px-4 text-[#a7a9be] font-semibold">
                                    ç©ºé–“è¨ˆç®—é‡
                                </th>
                                <th class="text-center py-3 px-4 text-[#a7a9be] font-semibold">
                                    å‹å®‰å…¨æ€§
                                </th>
                                <th class="text-center py-3 px-4 text-[#a7a9be] font-semibold">
                                    å¯èª­æ€§
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-white/5 bg-[#e53170]/5">
                                <td class="py-3 px-4 text-[#e53170] font-bold">reduceRight âœ“</td>
                                <td class="py-3 px-4 text-center mono text-[#e7c7d4]">O(n)</td>
                                <td class="py-3 px-4 text-center mono text-[#e7c7d4]">O(1)</td>
                                <td class="py-3 px-4 text-center text-[#e7c7d4]">â­â­â­</td>
                                <td class="py-3 px-4 text-center text-[#e7c7d4]">â­â­â­</td>
                            </tr>
                            <tr class="border-b border-white/5">
                                <td class="py-3 px-4 text-[#a7a9be]">for ãƒ«ãƒ¼ãƒ—ï¼ˆå³â†’å·¦ï¼‰</td>
                                <td class="py-3 px-4 text-center mono text-[#a7a9be]">O(n)</td>
                                <td class="py-3 px-4 text-center mono text-[#a7a9be]">O(1)</td>
                                <td class="py-3 px-4 text-center text-[#a7a9be]">â­â­â­</td>
                                <td class="py-3 px-4 text-center text-[#a7a9be]">â­â­</td>
                            </tr>
                            <tr class="border-b border-white/5">
                                <td class="py-3 px-4 text-[#a7a9be]">å†å¸°</td>
                                <td class="py-3 px-4 text-center mono text-[#a7a9be]">O(n)</td>
                                <td class="py-3 px-4 text-center mono text-[#a7a9be]">O(n)</td>
                                <td class="py-3 px-4 text-center text-[#a7a9be]">â­â­</td>
                                <td class="py-3 px-4 text-center text-[#a7a9be]">â­â­</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            const stepsData = [
                {
                    step: 1,
                    title: 'å…¥åŠ›ç¢ºèª',
                    desc: 'functions = [x=>x+1, x=>x*x, x=>2*x] ã¨ x = 4 ã‚’å—ã‘å–ã‚‹ã€‚3ã¤ã®é–¢æ•°ãŒå³ã‹ã‚‰å·¦ã®é †ã«é©ç”¨ã•ã‚Œã‚‹ã€‚',
                    visual: {
                        type: 'init',
                        acc: 4,
                        fnIndex: null,
                        fns: ['x+1', 'x*x', '2*x'],
                        result: null,
                    },
                },
                {
                    step: 2,
                    title: 'reduceRight é–‹å§‹ / h(x) = 2*x',
                    desc: 'å³ç«¯ã®é–¢æ•° h(x) = 2*x ã‹ã‚‰é©ç”¨ã€‚acc = 4 â†’ h(4) = 2*4 = 8ã€‚',
                    visual: {
                        type: 'apply',
                        acc: 8,
                        fnIndex: 2,
                        fns: ['x+1', 'x*x', '2*x'],
                        label: '2 Ã— 4 = 8',
                        result: null,
                    },
                },
                {
                    step: 3,
                    title: 'g(acc) = acc*acc',
                    desc: 'æ¬¡ã®é–¢æ•° g(x) = x*x ã‚’é©ç”¨ã€‚acc = 8 â†’ g(8) = 8*8 = 64ã€‚',
                    visual: {
                        type: 'apply',
                        acc: 64,
                        fnIndex: 1,
                        fns: ['x+1', 'x*x', '2*x'],
                        label: '8 Ã— 8 = 64',
                        result: null,
                    },
                },
                {
                    step: 4,
                    title: 'f(acc) = acc+1',
                    desc: 'æœ€å¾Œã®é–¢æ•° f(x) = x+1 ã‚’é©ç”¨ã€‚acc = 64 â†’ f(64) = 64+1 = 65ã€‚',
                    visual: {
                        type: 'apply',
                        acc: 65,
                        fnIndex: 0,
                        fns: ['x+1', 'x*x', '2*x'],
                        label: '64 + 1 = 65',
                        result: null,
                    },
                },
                {
                    step: 5,
                    title: 'çµæœã‚’è¿”ã™',
                    desc: 'å…¨é–¢æ•°ã®é©ç”¨ãŒå®Œäº†ã€‚æœ€çµ‚çš„ãª acc = 65 ãŒè¿”ã•ã‚Œã‚‹ã€‚f(g(h(4))) = 65ã€‚',
                    visual: {
                        type: 'result',
                        acc: 65,
                        fnIndex: null,
                        fns: ['x+1', 'x*x', '2*x'],
                        result: 65,
                    },
                },
            ];

            function StepVisualization({ visual }) {
                const { type, acc, fnIndex, fns, label, result } = visual;
                const colors = ['#e53170', '#7c3aed', '#f59e0b'];
                const bgColors = ['#1e0a12', '#0d1030', '#1c1500'];

                return (
                    <svg
                        viewBox="0 0 580 220"
                        style={{ maxWidth: '100%', height: 'auto', marginTop: '24px' }}
                        aria-label={`Step visualization: ${label ? label : type === 'result' ? 'Final result' : 'Initial state'}. Accumulator is ${acc}.`}
                    >
                        <defs>
                            <marker
                                id="va"
                                markerWidth="8"
                                markerHeight="8"
                                refX="7"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L7,3 z" fill="#64748b" />
                            </marker>
                            <marker
                                id="vaR"
                                markerWidth="8"
                                markerHeight="8"
                                refX="7"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L7,3 z" fill="#e53170" />
                            </marker>
                        </defs>

                        {/* Function boxes */}
                        {fns.map((fn, i) => {
                            const x = 30 + i * 170;
                            const isActive = fnIndex === i;
                            const isDone = fnIndex !== null && i > fnIndex;
                            const color = colors[i];
                            const bg = bgColors[i];
                            return (
                                <g key={i}>
                                    <rect
                                        x={x}
                                        y="20"
                                        width="140"
                                        height="60"
                                        rx="10"
                                        fill={isActive ? bg : '#0f0e17'}
                                        stroke={isActive ? color : '#334155'}
                                        strokeWidth={isActive ? 2.5 : 1.5}
                                    />
                                    <text
                                        x={x + 70}
                                        y="45"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fill={isActive ? color : isDone ? '#475569' : '#64748b'}
                                        fontSize="11"
                                        fontFamily="DM Mono"
                                    >
                                        f{2 - i}(x)
                                    </text>
                                    <text
                                        x={x + 70}
                                        y="63"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fill={isActive ? '#fffffe' : isDone ? '#475569' : '#94a3b8'}
                                        fontSize="13"
                                        fontFamily="DM Mono"
                                        fontWeight={isActive ? '700' : '400'}
                                    >
                                        x =&gt; {fn}
                                    </text>
                                    {isActive && (
                                        <rect
                                            x={x}
                                            y="20"
                                            width="140"
                                            height="60"
                                            rx="10"
                                            fill="none"
                                            stroke={color}
                                            strokeWidth="1"
                                            opacity="0.4"
                                            style={{ filter: `drop-shadow(0 0 8px ${color})` }}
                                        />
                                    )}
                                </g>
                            );
                        })}

                        {/* Arrows between functions (Right to Left) */}
                        <path
                            d="M200 50 L170 50"
                            stroke="#334155"
                            strokeWidth="1.5"
                            fill="none"
                            markerEnd="url(#va)"
                        />
                        <path
                            d="M370 50 L340 50"
                            stroke="#334155"
                            strokeWidth="1.5"
                            fill="none"
                            markerEnd="url(#va)"
                        />

                        {/* Execution label */}
                        {type === 'apply' && label && (
                            <g>
                                <rect
                                    x="170"
                                    y="110"
                                    width="240"
                                    height="44"
                                    rx="10"
                                    fill="#1a2340"
                                    stroke="#7c3aed"
                                    strokeWidth="1.5"
                                />
                                <text
                                    x="290"
                                    y="132"
                                    textAnchor="middle"
                                    dominantBaseline="middle"
                                    fill="#c4b5fd"
                                    fontSize="16"
                                    fontFamily="DM Mono"
                                    fontWeight="700"
                                >
                                    {label}
                                </text>
                            </g>
                        )}

                        {/* acc badge */}
                        <g>
                            <rect
                                x="20"
                                y="160"
                                width="120"
                                height="44"
                                rx="10"
                                fill="#1e0a12"
                                stroke="#e53170"
                                strokeWidth="1.5"
                            />
                            <text
                                x="80"
                                y="178"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fill="#a7a9be"
                                fontSize="11"
                                fontFamily="DM Sans"
                            >
                                acc =
                            </text>
                            <text
                                x="80"
                                y="196"
                                textAnchor="middle"
                                dominantBaseline="middle"
                                fill="#e53170"
                                fontSize="18"
                                fontFamily="DM Mono"
                                fontWeight="700"
                            >
                                {acc}
                            </text>
                        </g>

                        {/* Result */}
                        {type === 'result' && (
                            <g>
                                <rect
                                    x="380"
                                    y="155"
                                    width="180"
                                    height="54"
                                    rx="12"
                                    fill="#1e0a12"
                                    stroke="#e53170"
                                    strokeWidth="2.5"
                                />
                                <text
                                    x="470"
                                    y="175"
                                    textAnchor="middle"
                                    dominantBaseline="middle"
                                    fill="#a7a9be"
                                    fontSize="12"
                                    fontFamily="DM Sans"
                                >
                                    æœ€çµ‚çµæœ
                                </text>
                                <text
                                    x="470"
                                    y="197"
                                    textAnchor="middle"
                                    dominantBaseline="middle"
                                    fill="#e53170"
                                    fontSize="22"
                                    fontFamily="DM Mono"
                                    fontWeight="900"
                                >
                                    {result}
                                </text>
                            </g>
                        )}

                        {/* Init state */}
                        {type === 'init' && (
                            <g>
                                <rect
                                    x="380"
                                    y="155"
                                    width="180"
                                    height="54"
                                    rx="12"
                                    fill="#0d1a33"
                                    stroke="#7c3aed"
                                    strokeWidth="1.5"
                                />
                                <text
                                    x="470"
                                    y="175"
                                    textAnchor="middle"
                                    dominantBaseline="middle"
                                    fill="#a7a9be"
                                    fontSize="12"
                                    fontFamily="DM Sans"
                                >
                                    åˆæœŸå€¤ x =
                                </text>
                                <text
                                    x="470"
                                    y="197"
                                    textAnchor="middle"
                                    dominantBaseline="middle"
                                    fill="#c4b5fd"
                                    fontSize="22"
                                    fontFamily="DM Mono"
                                    fontWeight="900"
                                >
                                    {acc}
                                </text>
                            </g>
                        )}
                    </svg>
                );
            }

            function StepViz() {
                const [activeStep, setActiveStep] = useState(1);
                const [isPlaying, setIsPlaying] = useState(false);
                const timerRef = useRef(null);

                useEffect(() => {
                    if (window.Prism) {
                        window.Prism.highlightAll();
                    }
                }, []); // Run only on mount to ensure code blocks are highlighted

                useEffect(() => {
                    if (isPlaying) {
                        timerRef.current = setTimeout(() => {
                            if (activeStep === stepsData.length) {
                                setActiveStep(1);
                                setIsPlaying(false);
                            } else {
                                setActiveStep((prev) => prev + 1);
                            }
                        }, 1800);
                    }
                    return () => {
                        if (timerRef.current) clearTimeout(timerRef.current);
                    };
                }, [isPlaying, activeStep]);

                const current = stepsData[activeStep - 1];

                const handlePlay = () => {
                    if (isPlaying) return;
                    setActiveStep(1);
                    setIsPlaying(true);
                };

                return (
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8">
                        {/* Left: step list */}
                        <div>
                            <h3 className="text-lg font-bold text-[#e53170] mb-4">ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§</h3>
                            <div className="space-y-2">
                                {stepsData.map((s) => {
                                    const isActive = activeStep === s.step;
                                    return (
                                        <button
                                            key={s.step}
                                            type="button"
                                            onClick={() => {
                                                setActiveStep(s.step);
                                                setIsPlaying(false);
                                            }}
                                            aria-current={isActive ? 'step' : undefined}
                                            className={[
                                                'w-full text-left rounded-xl border-2 transition-all cursor-pointer px-4 py-3',
                                                isActive
                                                    ? 'bg-[#1e0a12] border-[#e53170] shadow-[0_0_16px_rgba(229,49,112,0.3)]'
                                                    : 'bg-[#0f0e17] border-white/5 hover:border-[#e53170]/40',
                                            ].join(' ')}
                                        >
                                            <div
                                                className={[
                                                    'text-sm font-bold mono',
                                                    isActive ? 'text-[#e53170]' : 'text-[#a7a9be]',
                                                ].join(' ')}
                                            >
                                                Step {s.step}
                                            </div>
                                            <div
                                                className={[
                                                    'text-xs mt-0.5',
                                                    isActive ? 'text-[#e7c7d4]' : 'text-[#475569]',
                                                ].join(' ')}
                                            >
                                                {s.title}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Right: visualization */}
                        <div>
                            <div
                                className="rounded-2xl p-5 border border-[#e53170]/20 bg-[#0f0e17]"
                                aria-live="polite"
                                aria-atomic="true"
                            >
                                <div className="text-[#e53170] mono text-xs font-semibold mb-1">
                                    Step {current.step} / {stepsData.length}
                                </div>
                                <h3 className="text-lg font-bold text-[#fffffe] mt-0 mb-2">
                                    {current.title}
                                </h3>
                                <p className="text-[#a7a9be] text-sm leading-relaxed">
                                    {current.desc}
                                </p>
                            </div>

                            <StepVisualization visual={current.visual} />

                            <div className="flex flex-wrap justify-center gap-3 mt-4">
                                <button
                                    type="button"
                                    onClick={handlePlay}
                                    disabled={isPlaying}
                                    className="px-5 py-2.5 rounded-xl font-semibold text-white text-sm transition disabled:opacity-40 bg-[#e53170] hover:bg-[#c72a5f] hover:-translate-y-0.5"
                                    aria-label="Play animation"
                                >
                                    â–¶ Play
                                </button>
                                <button
                                    type="button"
                                    onClick={() => {
                                        setActiveStep((s) => Math.max(1, s - 1));
                                        setIsPlaying(false);
                                    }}
                                    disabled={activeStep === 1}
                                    className="px-5 py-2.5 rounded-xl font-semibold text-sm border border-white/10 text-[#a7a9be] hover:bg-white/5 transition disabled:opacity-30"
                                    aria-label="Previous step"
                                >
                                    â† Prev
                                </button>
                                <button
                                    type="button"
                                    onClick={() => {
                                        setActiveStep((s) => Math.min(stepsData.length, s + 1));
                                        setIsPlaying(false);
                                    }}
                                    disabled={activeStep === stepsData.length}
                                    className="px-5 py-2.5 rounded-xl font-semibold text-sm border border-white/10 text-[#a7a9be] hover:bg-white/5 transition disabled:opacity-30"
                                    aria-label="Next step"
                                >
                                    Next â†’
                                </button>
                                <button
                                    type="button"
                                    onClick={() => {
                                        setActiveStep(1);
                                        setIsPlaying(false);
                                    }}
                                    className="px-5 py-2.5 rounded-xl font-semibold text-sm border border-white/10 text-[#a7a9be] hover:bg-white/5 transition"
                                    aria-label="Reset steps"
                                >
                                    â†º Reset
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            const root = ReactDOM.createRoot(document.getElementById('react-root'));
            root.render(<StepViz />);
        </script>
    </body>
</html>
