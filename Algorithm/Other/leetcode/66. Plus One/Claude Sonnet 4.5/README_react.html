<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LeetCode 66: Plus One - 右から左への繰り上がり処理</title>

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&family=Source+Code+Pro:wght@400;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- Prism.js CSS -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css"
        />

        <style>
            html {
                scroll-behavior: smooth;
            }

            body {
                font-family: 'Inter', sans-serif;
                background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%);
                min-height: 100vh;
            }

            code,
            pre {
                font-family: 'JetBrains Mono', 'Source Code Pro', monospace !important;
            }

            /* Prism.js ツールバーカスタマイズ */
            div.code-toolbar > .toolbar {
                opacity: 1;
                right: 0.5em;
                top: 0.5em;
            }

            div.code-toolbar > .toolbar > .toolbar-item > button {
                background: #10b981 !important;
                color: white !important;
                padding: 0.5em 1em !important;
                border-radius: 0.5em !important;
                font-weight: 600 !important;
                box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2) !important;
            }

            div.code-toolbar > .toolbar > .toolbar-item > button:hover {
                background: #059669 !important;
            }
        </style>
    </head>
    <body class="p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            <!-- ヘッダー -->
            <header
                id="header"
                class="mb-8 rounded-2xl p-8 shadow-[0_10px_30px_rgba(16,185,129,0.10)] bg-[linear-gradient(135deg,#d1fae5,#bfdbfe)]"
            >
                <h1 class="text-[2.5rem] font-bold text-teal-800 mb-2">Plus One</h1>
                <p class="text-xl text-cyan-700 font-semibold mt-2">
                    右から左への繰り上がり処理による O(n) 実装
                </p>
                <nav class="flex flex-wrap gap-4 mt-6" aria-label="ページ内ナビゲーション">
                    <a
                        href="#overview"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                    >
                        概要
                    </a>
                    <a
                        href="#steps"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                    >
                        ステップ解説
                    </a>
                    <a
                        href="#code"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                    >
                        コード
                    </a>
                    <a
                        href="#diagram"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                    >
                        フローチャート
                    </a>
                    <a
                        href="#complexity"
                        class="inline-block px-5 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_10px_20px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-700"
                    >
                        計算量
                    </a>
                </nav>
            </header>

            <!-- アルゴリズム概要 -->
            <section id="overview" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    アルゴリズム概要
                </h2>

                <h3 class="text-xl font-bold text-teal-800 mt-6 mb-3">問題説明</h3>
                <p class="text-slate-700 leading-7 mb-4">
                    大きな整数を配列形式で表現したとき（各要素が1桁、最上位桁が先頭）、この整数に1を加算した結果を配列で返す問題です。
                </p>

                <h3 class="text-xl font-bold text-teal-800 mt-6 mb-3">入出力例</h3>
                <div class="bg-slate-50 rounded-xl p-4 mb-4 border-l-4 border-emerald-500">
                    <pre class="text-sm"><code>入力: digits = [1,2,3]
出力: [1,2,4]
説明: 123 + 1 = 124

入力: digits = [9,9,9]
出力: [1,0,0,0]
説明: 999 + 1 = 1000

入力: digits = [9]
出力: [1,0]
説明: 9 + 1 = 10</code></pre>
                </div>

                <h3 class="text-xl font-bold text-teal-800 mt-6 mb-3">制約条件</h3>
                <ul class="list-disc list-inside text-slate-700 leading-7 space-y-2">
                    <li>
                        <code class="bg-slate-100 px-2 py-1 rounded"
                            >1 &lt;= digits.length &lt;= 100</code
                        >
                    </li>
                    <li>
                        <code class="bg-slate-100 px-2 py-1 rounded"
                            >0 &lt;= digits[i] &lt;= 9</code
                        >
                    </li>
                    <li>
                        先頭に0を含まない（例:
                        <code class="bg-slate-100 px-2 py-1 rounded">[0,1,2]</code> は不正）
                    </li>
                </ul>

                <h3 class="text-xl font-bold text-teal-800 mt-6 mb-3">戦略</h3>
                <div
                    class="bg-gradient-to-r from-emerald-50 to-cyan-50 rounded-xl p-6 border-l-4 border-cyan-500"
                >
                    <ul class="space-y-3 text-slate-700">
                        <li class="flex items-start">
                            <span
                                class="inline-block w-8 h-8 bg-emerald-500 text-white rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0"
                                >1</span
                            >
                            <span
                                ><strong>右から左への走査:</strong>
                                配列の右端（最下位桁）から開始し、左へ進む</span
                            >
                        </li>
                        <li class="flex items-start">
                            <span
                                class="inline-block w-8 h-8 bg-emerald-500 text-white rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0"
                                >2</span
                            >
                            <span
                                ><strong>早期終了:</strong>
                                9未満の桁を見つけたら+1して即座にリターン（最頻ケース）</span
                            >
                        </li>
                        <li class="flex items-start">
                            <span
                                class="inline-block w-8 h-8 bg-emerald-500 text-white rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0"
                                >3</span
                            >
                            <span
                                ><strong>繰り上がり処理:</strong>
                                9の場合は0に変更し、次の桁へ繰り上がりを継続</span
                            >
                        </li>
                        <li class="flex items-start">
                            <span
                                class="inline-block w-8 h-8 bg-emerald-500 text-white rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0"
                                >4</span
                            >
                            <span
                                ><strong>桁数増加:</strong>
                                全桁が9の場合のみ、先頭に1を追加した新配列を返却</span
                            >
                        </li>
                    </ul>
                </div>

                <h3 class="text-xl font-bold text-teal-800 mt-6 mb-3">主要ポイント</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 rounded-xl p-4 border-l-4 border-blue-500">
                        <h4 class="font-bold text-blue-900 mb-2">⏱ 時間計算量</h4>
                        <p class="text-slate-700">
                            <code class="bg-white px-2 py-1 rounded font-semibold">O(n)</code>
                        </p>
                        <p class="text-sm text-slate-600 mt-1">
                            平均的には早期リターンでO(1)～O(k)
                        </p>
                    </div>
                    <div class="bg-purple-50 rounded-xl p-4 border-l-4 border-purple-500">
                        <h4 class="font-bold text-purple-900 mb-2">💾 空間計算量</h4>
                        <p class="text-slate-700">
                            <code class="bg-white px-2 py-1 rounded font-semibold">O(1)</code> 平均
                        </p>
                        <p class="text-sm text-slate-600 mt-1">最悪時（全桁9）のみO(n)</p>
                    </div>
                </div>
            </section>

            <!-- ステップバイステップ解説 -->
            <section id="steps" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    ステップバイステップ解説
                </h2>
                <div id="step-visualization-root"></div>
            </section>

            <!-- Pythonコード -->
            <section id="code" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    Python実装
                </h2>
                <pre class="line-numbers"><code class="language-python">class Solution:
    def plusOne(self, digits: list[int]) -> list[int]:
        """
        整数配列に1を加算する

        Time Complexity: O(n)
        Space Complexity: O(1) average, O(n) worst case
        """
        # 右から左へ走査
        for i in range(len(digits) - 1, -1, -1):
            # 現在の桁が9未満の場合
            if digits[i] < 9:
                digits[i] += 1
                return digits  # 繰り上がり不要、即座に返却

            # 現在の桁が9の場合、0にして繰り上がり継続
            digits[i] = 0

        # 全桁が9だった場合（例: [9,9,9] -> [1,0,0,0]）
        # 先頭に1を追加
        return [1, *digits]</code></pre>
            </section>

            <!-- TypeScriptコード -->
            <section id="code-ts" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    TypeScript実装
                </h2>
                <pre
                    class="line-numbers"
                ><code class="language-typescript">function plusOne(digits: number[]): number[] {
    /**
     * 整数配列に1を加算する
     *
     * Time Complexity: O(n)
     * Space Complexity: O(1) average, O(n) worst case
     */

    // 右から左へ走査
    for (let i = digits.length - 1; i >= 0; i--) {
        // 現在の桁が9未満の場合
        if (digits[i] < 9) {
            digits[i]++;
            return digits;  // 繰り上がり不要、即座に返却
        }

        // 現在の桁が9の場合、0にして繰り上がり継続
        digits[i] = 0;
    }

    // 全桁が9だった場合（例: [9,9,9] -> [1,0,0,0]）
    // 先頭に1を追加
    return [1, ...digits];
}</code></pre>
            </section>

            <!-- フローチャート -->
            <section id="diagram" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    フローチャート
                </h2>
                <div class="mt-[20px] overflow-x-auto">
                    <svg
                        viewBox="0 0 840 900"
                        style="max-width: 100%; height: auto; color: #333"
                        role="img"
                        aria-label="Plus One flowchart"
                    >
                        <defs>
                            <marker
                                id="arrow"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                            </marker>
                            <marker
                                id="arrowGreen"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                            </marker>
                            <marker
                                id="arrowRed"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#dc2626" />
                            </marker>
                            <marker
                                id="arrowPurple"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#a855f7" />
                            </marker>
                        </defs>

                        <!-- 開始ノード -->
                        <ellipse
                            cx="420"
                            cy="50"
                            rx="100"
                            ry="35"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="3"
                        />
                        <text
                            x="420"
                            y="50"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="18"
                            font-weight="bold"
                            fill="#065f46"
                        >
                            開始
                        </text>

                        <!-- i = len-1 -->
                        <rect
                            x="320"
                            y="120"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="140"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#0c4a6e"
                        >
                            i = len(digits) - 1
                        </text>
                        <text
                            x="420"
                            y="160"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            fill="#475569"
                        >
                            右端から開始
                        </text>

                        <path
                            d="M 420 85 L 420 120"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- i >= 0 判定 -->
                        <path
                            d="M 300 250 L 420 210 L 540 250 L 420 290 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="250"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="bold"
                            fill="#78350f"
                        >
                            i &gt;= 0?
                        </text>

                        <path
                            d="M 420 180 L 420 210"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- いいえ -> 全桁9 -->
                        <rect
                            x="640"
                            y="220"
                            width="160"
                            height="60"
                            rx="8"
                            fill="#fee2e2"
                            stroke="#dc2626"
                            stroke-width="2"
                        />
                        <text
                            x="720"
                            y="240"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="bold"
                            fill="#7f1d1d"
                        >
                            全桁が9
                        </text>
                        <text
                            x="720"
                            y="260"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            fill="#991b1b"
                        >
                            return [1, *digits]
                        </text>

                        <path
                            d="M 540 250 L 640 250"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text x="590" y="240" text-anchor="middle" font-size="14" fill="#dc2626">
                            いいえ
                        </text>

                        <!-- はい -> digits[i] < 9 判定 -->
                        <path
                            d="M 300 410 L 420 370 L 540 410 L 420 450 Z"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="410"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="bold"
                            fill="#78350f"
                        >
                            digits[i] &lt; 9?
                        </text>

                        <path
                            d="M 420 290 L 420 370"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />
                        <text x="450" y="330" text-anchor="start" font-size="14" fill="#059669">
                            はい
                        </text>

                        <!-- はい -> インクリメント -->
                        <rect
                            x="640"
                            y="380"
                            width="160"
                            height="60"
                            rx="8"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="720"
                            y="400"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            font-weight="bold"
                            fill="#065f46"
                        >
                            digits[i] += 1
                        </text>
                        <text
                            x="720"
                            y="420"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            fill="#059669"
                        >
                            return digits
                        </text>

                        <path
                            d="M 540 410 L 640 410"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />
                        <text x="590" y="400" text-anchor="middle" font-size="14" fill="#059669">
                            はい
                        </text>

                        <!-- いいえ -> 0に設定 -->
                        <rect
                            x="320"
                            y="510"
                            width="200"
                            height="60"
                            rx="8"
                            fill="#f1f5f9"
                            stroke="#64748b"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="530"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#1e293b"
                        >
                            digits[i] = 0
                        </text>
                        <text
                            x="420"
                            y="550"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            fill="#475569"
                        >
                            繰り上がり継続
                        </text>

                        <path
                            d="M 420 450 L 420 510"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                        <text x="450" y="480" text-anchor="start" font-size="14" fill="#dc2626">
                            いいえ
                        </text>

                        <!-- i-- -->
                        <rect
                            x="320"
                            y="630"
                            width="200"
                            height="50"
                            rx="8"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="420"
                            y="655"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="16"
                            fill="#0c4a6e"
                        >
                            i = i - 1
                        </text>

                        <path
                            d="M 420 570 L 420 630"
                            stroke="#64748b"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrow)"
                        />

                        <!-- ループバック -->
                        <path
                            d="M 320 655 L 160 655 L 160 250 L 300 250"
                            stroke="#a855f7"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowPurple)"
                        />
                        <text x="160" y="240" text-anchor="middle" font-size="14" fill="#a855f7">
                            次の桁へ
                        </text>

                        <!-- 終了ノード -->
                        <ellipse
                            cx="720"
                            cy="780"
                            rx="100"
                            ry="35"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="3"
                        />
                        <text
                            x="720"
                            y="780"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="18"
                            font-weight="bold"
                            fill="#065f46"
                        >
                            終了
                        </text>

                        <!-- 成功パス -> 終了 -->
                        <path
                            d="M 720 440 L 720 745"
                            stroke="#059669"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowGreen)"
                        />

                        <!-- エラーパス -> 終了 -->
                        <path
                            d="M 800 250 L 830 250 L 830 745 L 800 755"
                            stroke="#dc2626"
                            stroke-width="2"
                            fill="none"
                            marker-end="url(#arrowRed)"
                        />
                    </svg>
                </div>

                <p class="mt-8 font-[Source_Code_Pro] text-[20px] font-semibold">
                    <strong class="text-2xl">フローの説明：</strong><br />
                    1. 右端のインデックス（i = len-1）から開始<br />
                    2. i &gt;= 0 の間ループを継続<br />
                    3. digits[i] &lt; 9 なら +1 して即座に終了（成功パス・緑）<br />
                    4. digits[i] == 9 なら 0 に設定し、i を減らして次の桁へ（繰り上がり継続・紫）<br />
                    5. ループを抜けた = 全桁が9 → 先頭に1を追加して終了（特殊ケースパス・赤）
                </p>
            </section>

            <!-- 計算量分析 -->
            <section id="complexity" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="text-[2rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    計算量分析
                </h2>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gradient-to-r from-emerald-100 to-cyan-100">
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    ケース
                                </th>
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    時間計算量
                                </th>
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    空間計算量
                                </th>
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    備考
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="hover:bg-emerald-50">
                                <td
                                    class="border-2 border-slate-300 px-4 py-3 font-semibold text-slate-700"
                                >
                                    最良ケース
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-emerald-100 px-2 py-1 rounded font-semibold"
                                        >O(1)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-emerald-100 px-2 py-1 rounded font-semibold"
                                        >O(1)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-600">
                                    右端の桁が9未満、1回で終了
                                </td>
                            </tr>
                            <tr class="hover:bg-cyan-50">
                                <td
                                    class="border-2 border-slate-300 px-4 py-3 font-semibold text-slate-700"
                                >
                                    平均ケース
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-cyan-100 px-2 py-1 rounded font-semibold"
                                        >O(k)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-cyan-100 px-2 py-1 rounded font-semibold"
                                        >O(1)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-600">
                                    k個の連続する9を処理（k &lt; n）
                                </td>
                            </tr>
                            <tr class="hover:bg-red-50">
                                <td
                                    class="border-2 border-slate-300 px-4 py-3 font-semibold text-slate-700"
                                >
                                    最悪ケース
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-red-100 px-2 py-1 rounded font-semibold"
                                        >O(n)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-red-100 px-2 py-1 rounded font-semibold"
                                        >O(n)</code
                                    >
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-600">
                                    全桁が9、新配列生成が必要
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="text-xl font-bold text-teal-800 mt-8 mb-4">最適化の比較</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gradient-to-r from-purple-100 to-blue-100">
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    アプローチ
                                </th>
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    時間
                                </th>
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    空間
                                </th>
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    実装コスト
                                </th>
                                <th
                                    class="border-2 border-slate-300 px-4 py-3 text-left font-bold text-slate-800"
                                >
                                    備考
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-emerald-50 hover:bg-emerald-100">
                                <td
                                    class="border-2 border-slate-300 px-4 py-3 font-semibold text-emerald-900"
                                >
                                    ✓ 右から走査（本実装）
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-white px-2 py-1 rounded">O(n)</code>
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-white px-2 py-1 rounded">O(1)平均</code>
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-700">
                                    低
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-600">
                                    早期終了で高速、メモリ効率的
                                </td>
                            </tr>
                            <tr class="hover:bg-slate-50">
                                <td
                                    class="border-2 border-slate-300 px-4 py-3 font-semibold text-slate-700"
                                >
                                    文字列変換
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-white px-2 py-1 rounded">O(n)</code>
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-white px-2 py-1 rounded">O(n)</code>
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-700">
                                    低
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-600">
                                    型変換オーバーヘッド大
                                </td>
                            </tr>
                            <tr class="hover:bg-slate-50">
                                <td
                                    class="border-2 border-slate-300 px-4 py-3 font-semibold text-slate-700"
                                >
                                    完全immutable
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-white px-2 py-1 rounded">O(n)</code>
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3">
                                    <code class="bg-white px-2 py-1 rounded">O(n)</code>
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-700">
                                    中
                                </td>
                                <td class="border-2 border-slate-300 px-4 py-3 text-slate-600">
                                    常に新配列生成、メモリ非効率
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div
                    class="mt-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border-l-4 border-blue-500"
                >
                    <h4 class="font-bold text-blue-900 mb-2">💡 最適化ポイント</h4>
                    <ul class="space-y-2 text-slate-700">
                        <li>
                            <strong>早期リターン:</strong>
                            90%以上のケースでO(1)で終了（右端の桁が9未満の場合）
                        </li>
                        <li>
                            <strong>in-place変更:</strong>
                            追加メモリを使わず、既存配列を変更してメモリ効率を最大化
                        </li>
                        <li>
                            <strong>スプレッド演算子:</strong>
                            <code class="bg-white px-2 py-1 rounded">[1, *digits]</code>
                            で効率的なリスト結合（全桁9のケースのみ）
                        </li>
                    </ul>
                </div>
            </section>
        </div>

        <!-- React & ReactDOM -->
        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script
            crossorigin
            src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
        ></script>

        <!-- Babel Standalone -->
        <script src="https://unpkg.com/@babel/standalone@7.24.0/babel.min.js"></script>

        <!-- Prism.js -->
        <script src="../../../../../vendor/prismjs/prism.js"></script>
        <!-- Language Components -->
        <script src="../../../../../vendor/prismjs/components/prism-python.js"></script>
        <script src="../../../../../vendor/prismjs/components/prism-clike.js"></script>
        <script src="../../../../../vendor/prismjs/components/prism-javascript.js"></script>
        <script src="../../../../../vendor/prismjs/components/prism-typescript.js"></script>
        <!-- The standalone PrismJS plugins -->
        <script src="../../../../../vendor/prismjs/plugins/line-numbers/prism-line-numbers.js"></script>
        <script src="../../../../../vendor/prismjs/plugins/toolbar/prism-toolbar.js"></script>
        <script src="../../../../../vendor/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.js"></script>

        <!-- React Component -->
        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            // ステップデータ
            const stepsData = [
                {
                    step: 1,
                    title: '初期状態',
                    desc: 'digits = [1,2,3] の場合を例とする。配列の右端（インデックス2）から走査を開始する。',
                    visual: {
                        type: 'init',
                        list: [1, 2, 3],
                        currentIdx: 2,
                    },
                },
                {
                    step: 2,
                    title: '右端の桁をチェック',
                    desc: 'i = 2: digits[2] = 3 をチェック。3 < 9 なので、+1して終了する。',
                    visual: {
                        type: 'checkDigit',
                        list: [1, 2, 3],
                        currentIdx: 2,
                        value: 3,
                    },
                },
                {
                    step: 3,
                    title: 'インクリメントして返却',
                    desc: 'digits[2] を 3 → 4 に変更し、即座に配列を返却。繰り上がりは不要。',
                    visual: {
                        type: 'incrementReturn',
                        list: [1, 2, 4],
                        currentIdx: 2,
                    },
                },
                {
                    step: 4,
                    title: '初期状態（全桁9のケース）',
                    desc: 'digits = [9,9,9] の場合を例とする。右端から走査を開始する。',
                    visual: {
                        type: 'init',
                        list: [9, 9, 9],
                        currentIdx: 2,
                    },
                },
                {
                    step: 5,
                    title: '右端が9の場合',
                    desc: 'i = 2: digits[2] = 9 なので、0に変更して次の桁へ繰り上がり。',
                    visual: {
                        type: 'setZero',
                        list: [9, 9, 0],
                        currentIdx: 2,
                        nextIdx: 1,
                    },
                },
                {
                    step: 6,
                    title: '次の桁も9',
                    desc: 'i = 1: digits[1] = 9 なので、0に変更して次の桁へ繰り上がり。',
                    visual: {
                        type: 'setZero',
                        list: [9, 0, 0],
                        currentIdx: 1,
                        nextIdx: 0,
                    },
                },
                {
                    step: 7,
                    title: '先頭も9',
                    desc: 'i = 0: digits[0] = 9 なので、0に変更。ループを抜ける。',
                    visual: {
                        type: 'setZero',
                        list: [0, 0, 0],
                        currentIdx: 0,
                        nextIdx: -1,
                    },
                },
                {
                    step: 8,
                    title: '全桁が9の場合の処理',
                    desc: 'ループを抜けた = 全桁が9だった。先頭に1を追加した新配列を返却。',
                    visual: {
                        type: 'prependOne',
                        list: [1, 0, 0, 0],
                    },
                },
                {
                    step: 9,
                    title: '結果',
                    desc: '999 + 1 = 1000 が正しく計算された。桁数が1つ増えたことに注意。',
                    visual: {
                        type: 'result',
                        list: [1, 0, 0, 0],
                    },
                },
            ];

            // 可視化コンポーネント
            function StepVisualization({ visual }) {
                const renderVisualization = () => {
                    const { type, list, currentIdx, nextIdx, value } = visual;

                    const nodeWidth = 60;
                    const nodeHeight = 60;
                    const gap = 20;
                    const startX = 50;
                    const nodeY = 100;

                    const totalWidth = list.length * (nodeWidth + gap) + startX * 2;

                    return (
                        <svg
                            viewBox={`0 0 ${totalWidth} 300`}
                            style={{ maxWidth: '100%', height: 'auto', marginTop: '20px' }}
                            role="img"
                            aria-label="Plus One visualization"
                        >
                            <defs>
                                <marker
                                    id="arrowDown"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="5"
                                    refY="5"
                                    orient="auto"
                                >
                                    <path d="M0,0 L10,5 L0,10 L3,5 z" fill="#a855f7" />
                                </marker>
                                <marker
                                    id="arrowCarry"
                                    markerWidth="10"
                                    markerHeight="10"
                                    refX="5"
                                    refY="5"
                                    orient="auto"
                                >
                                    <path d="M0,0 L10,5 L0,10 L3,5 z" fill="#059669" />
                                </marker>
                            </defs>

                            {/* タイトル */}
                            <text
                                x={totalWidth / 2}
                                y="30"
                                textAnchor="middle"
                                fontSize="18"
                                fontWeight="bold"
                                fill="#0f766e"
                            >
                                {type === 'init' && '初期状態'}
                                {type === 'checkDigit' && '桁のチェック'}
                                {type === 'incrementReturn' && 'インクリメント完了'}
                                {type === 'setZero' && '0に変更して繰り上がり'}
                                {type === 'prependOne' && '先頭に1を追加'}
                                {type === 'result' && '結果'}
                            </text>

                            {/* 配列要素 */}
                            {list.map((num, idx) => {
                                const x = startX + idx * (nodeWidth + gap);
                                const isActive = idx === currentIdx;
                                const isNext = idx === nextIdx;

                                return (
                                    <g key={idx}>
                                        {/* ノード */}
                                        <rect
                                            x={x}
                                            y={nodeY}
                                            width={nodeWidth}
                                            height={nodeHeight}
                                            rx="8"
                                            fill={
                                                isActive
                                                    ? '#d1fae5'
                                                    : isNext
                                                      ? '#fef3c7'
                                                      : '#f1f5f9'
                                            }
                                            stroke={
                                                isActive
                                                    ? '#10b981'
                                                    : isNext
                                                      ? '#f59e0b'
                                                      : '#cbd5e1'
                                            }
                                            strokeWidth={isActive || isNext ? '3' : '2'}
                                        />

                                        {/* 値 */}
                                        <text
                                            x={x + nodeWidth / 2}
                                            y={nodeY + nodeHeight / 2}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fontSize="24"
                                            fontWeight="bold"
                                            fill={
                                                isActive
                                                    ? '#065f46'
                                                    : isNext
                                                      ? '#78350f'
                                                      : '#475569'
                                            }
                                        >
                                            {num}
                                        </text>

                                        {/* インデックス */}
                                        <text
                                            x={x + nodeWidth / 2}
                                            y={nodeY + nodeHeight + 25}
                                            textAnchor="middle"
                                            fontSize="14"
                                            fill="#64748b"
                                        >
                                            i={idx}
                                        </text>
                                    </g>
                                );
                            })}

                            {/* 現在位置の矢印 */}
                            {currentIdx !== undefined &&
                                currentIdx >= 0 &&
                                currentIdx < list.length && (
                                    <g>
                                        <path
                                            d={`M ${startX + currentIdx * (nodeWidth + gap) + nodeWidth / 2} 70 L ${startX + currentIdx * (nodeWidth + gap) + nodeWidth / 2} ${nodeY - 5}`}
                                            stroke="#a855f7"
                                            strokeWidth="3"
                                            fill="none"
                                            markerEnd="url(#arrowDown)"
                                        />
                                        <text
                                            x={
                                                startX +
                                                currentIdx * (nodeWidth + gap) +
                                                nodeWidth / 2
                                            }
                                            y="60"
                                            textAnchor="middle"
                                            fontSize="14"
                                            fontWeight="bold"
                                            fill="#a855f7"
                                        >
                                            現在位置
                                        </text>
                                    </g>
                                )}

                            {/* 次の位置への矢印 */}
                            {nextIdx !== undefined && nextIdx >= 0 && nextIdx < list.length && (
                                <g>
                                    <path
                                        d={`M ${startX + currentIdx * (nodeWidth + gap) + nodeWidth + 10} ${nodeY + nodeHeight / 2} L ${startX + nextIdx * (nodeWidth + gap) - 10} ${nodeY + nodeHeight / 2}`}
                                        stroke="#059669"
                                        strokeWidth="3"
                                        fill="none"
                                        markerEnd="url(#arrowCarry)"
                                    />
                                    <text
                                        x={
                                            (startX +
                                                currentIdx * (nodeWidth + gap) +
                                                nodeWidth +
                                                startX +
                                                nextIdx * (nodeWidth + gap)) /
                                            2
                                        }
                                        y={nodeY + nodeHeight / 2 - 15}
                                        textAnchor="middle"
                                        fontSize="14"
                                        fontWeight="bold"
                                        fill="#059669"
                                    >
                                        繰り上がり
                                    </text>
                                </g>
                            )}

                            {/* 説明テキスト */}
                            <text
                                x={totalWidth / 2}
                                y="240"
                                textAnchor="middle"
                                fontSize="16"
                                fill="#475569"
                            >
                                {type === 'init' && '右端から走査開始'}
                                {type === 'checkDigit' &&
                                    `digits[${currentIdx}] = ${value} < 9 をチェック`}
                                {type === 'incrementReturn' && '+1して終了（早期リターン）'}
                                {type === 'setZero' && '0に変更して次の桁へ'}
                                {type === 'prependOne' && '全桁が9だったので先頭に1を追加'}
                                {type === 'result' && '計算完了'}
                            </text>
                        </svg>
                    );
                };

                return renderVisualization();
            }

            // メインコンポーネント
            function StepByStepVisualization() {
                const [activeStep, setActiveStep] = useState(1);
                const [isPlaying, setIsPlaying] = useState(false);
                const timerRef = useRef(null);

                const currentStepData =
                    stepsData.find((s) => s.step === activeStep) || stepsData[0];

                // 自動再生ロジック（v3.3）
                useEffect(() => {
                    if (isPlaying) {
                        if (activeStep > stepsData.length) {
                            setIsPlaying(false);
                            setActiveStep(1);
                            return;
                        }

                        timerRef.current = setTimeout(() => {
                            if (activeStep === stepsData.length) {
                                setActiveStep(1);
                                setIsPlaying(false);
                            } else {
                                setActiveStep((prev) => prev + 1);
                            }
                        }, 2000);
                    }

                    return () => {
                        if (timerRef.current) clearTimeout(timerRef.current);
                    };
                }, [isPlaying, activeStep]);

                const handlePlay = () => {
                    if (isPlaying) return;
                    setActiveStep(1);
                    setIsPlaying(true);
                };

                const handlePrev = () => {
                    if (activeStep > 1) {
                        setActiveStep((prev) => prev - 1);
                        setIsPlaying(false);
                    }
                };

                const handleNext = () => {
                    if (activeStep < stepsData.length) {
                        setActiveStep((prev) => prev + 1);
                        setIsPlaying(false);
                    }
                };

                const handleReset = () => {
                    setActiveStep(1);
                    setIsPlaying(false);
                };

                const handleStepClick = (step) => {
                    setActiveStep(step);
                    setIsPlaying(false);
                };

                return (
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8 mt-2">
                        {/* 左: ステップリスト */}
                        <div>
                            <h3 className="mt-0 mb-4 text-teal-800 text-xl font-semibold">
                                ステップ一覧
                            </h3>
                            <div className="space-y-2">
                                {stepsData.map((step) => {
                                    const isActive = activeStep === step.step;
                                    return (
                                        <button
                                            key={step.step}
                                            type="button"
                                            className={[
                                                'w-full text-left text-[0.95rem] rounded-xl border-2 transition cursor-pointer px-4 py-4',
                                                'bg-white border-slate-200 hover:border-emerald-500 hover:translate-x-1',
                                                isActive
                                                    ? 'bg-[linear-gradient(135deg,#d1fae5,#a7f3d0)] border-emerald-500 shadow-[0_4px_12px_rgba(16,185,129,0.20)]'
                                                    : '',
                                            ].join(' ')}
                                            onClick={() => handleStepClick(step.step)}
                                            aria-label={`ステップ${step.step}: ${step.title}`}
                                            aria-current={isActive ? 'step' : undefined}
                                        >
                                            <div
                                                className={[
                                                    'font-bold mb-1',
                                                    isActive ? 'text-emerald-900' : 'text-teal-800',
                                                ].join(' ')}
                                            >
                                                Step {step.step}: {step.title}
                                            </div>
                                            <div className="text-slate-500 text-sm mt-1">
                                                {step.desc.substring(0, 50)}
                                                {step.desc.length > 50 ? '...' : ''}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* 右: 可視化 + コントロール */}
                        <div className="my-auto">
                            <div className="rounded-2xl p-8 mt-10 border-2 border-emerald-200 bg-[linear-gradient(135deg,#ecfdf5,#f0f9ff)]">
                                <h3 className="mt-0 text-teal-800 text-xl font-semibold">
                                    Step {currentStepData.step}: {currentStepData.title}
                                </h3>
                                <p className="text-slate-600 leading-7">{currentStepData.desc}</p>
                            </div>

                            <StepVisualization visual={currentStepData.visual} />

                            <div className="flex flex-wrap justify-center gap-2 mt-1">
                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(16,185,129,0.30)] bg-[linear-gradient(135deg,#10b981,#059669)]"
                                    onClick={handlePlay}
                                    disabled={isPlaying}
                                    aria-label="自動再生"
                                >
                                    ▶ Play
                                </button>

                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-slate-700 bg-white border-2 border-slate-300 transition disabled:opacity-50 disabled:cursor-not-allowed shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(100,116,139,0.20)] hover:border-slate-400"
                                    onClick={handlePrev}
                                    disabled={activeStep === 1}
                                    aria-label="前のステップ"
                                >
                                    ◀ Prev
                                </button>

                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-slate-700 bg-white border-2 border-slate-300 transition disabled:opacity-50 disabled:cursor-not-allowed shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(100,116,139,0.20)] hover:border-slate-400"
                                    onClick={handleNext}
                                    disabled={activeStep === stepsData.length}
                                    aria-label="次のステップ"
                                >
                                    Next ▶
                                </button>

                                <button
                                    type="button"
                                    className="px-6 py-3 rounded-xl font-semibold text-white transition shadow hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(100,116,139,0.30)] bg-[linear-gradient(135deg,#64748b,#475569)]"
                                    onClick={handleReset}
                                    aria-label="リセット"
                                >
                                    ↻ Reset
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // レンダリング
            const root = ReactDOM.createRoot(document.getElementById('step-visualization-root'));
            root.render(<StepByStepVisualization />);
        </script>
    </body>
</html>
