<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LeetCode 1204 Â· Last Person to Fit in the Bus</title>
        <script src="/vendor/react/react.development.js"></script>
        <script src="/vendor/react-dom/react-dom.development.js"></script>
        <script src="/vendor/babel/babel.min.js"></script>
        <script src="/vendor/tailwindcss/script.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&family=Noto+Sans+JP:wght@400;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
            rel="stylesheet"
        />
        <link
            href="/vendor/prismjs/plugins/line-numbers/prism-line-numbers.css"
            rel="stylesheet"
        />
        <link
            href="/vendor/prismjs/plugins/toolbar/prism-toolbar.css"
            rel="stylesheet"
        />
        <style>
            html {
                scroll-behavior: smooth;
            }
            body {
                font-family: 'Noto Sans JP', sans-serif;
            }
            .outfit {
                font-family: 'Outfit', sans-serif;
            }
            .mono {
                font-family: 'JetBrains Mono', monospace;
            }

            .code-toolbar > .toolbar {
                top: 0.6em;
                right: 0.8em;
                opacity: 1 !important;
            }
            .code-toolbar > .toolbar .toolbar-item a,
            .code-toolbar > .toolbar .toolbar-item button,
            .code-toolbar > .toolbar .toolbar-item span {
                background: #10b981 !important;
                color: white !important;
                border-radius: 6px !important;
                padding: 3px 10px !important;
                font-size: 12px !important;
                border: none !important;
                cursor: pointer !important;
                box-shadow: none !important;
                text-shadow: none !important;
            }
            .code-toolbar > .toolbar .toolbar-item button:hover,
            .code-toolbar > .toolbar .toolbar-item a:hover {
                background: #059669 !important;
                color: white !important;
            }
        </style>
    </head>
    <body class="bg-[linear-gradient(135deg,#f0fdf4_0%,#e0f2fe_100%)] min-h-screen p-4 md:p-8">
        <div class="max-w-5xl mx-auto">
            <!-- ===== HEADER ===== -->
            <header
                id="header"
                class="mb-8 rounded-2xl p-8 shadow-[0_10px_30px_rgba(16,185,129,0.12)] bg-[linear-gradient(135deg,#d1fae5,#bfdbfe)]"
            >
                <div class="flex items-center gap-3 mb-2">
                    <span class="bg-emerald-600 text-white text-sm font-bold px-3 py-1 rounded-full"
                        >LeetCode 1204</span
                    >
                    <span class="bg-sky-500 text-white text-sm font-bold px-3 py-1 rounded-full"
                        >Medium</span
                    >
                    <span class="bg-violet-500 text-white text-sm font-bold px-3 py-1 rounded-full"
                        >SQL / Pandas</span
                    >
                </div>
                <h1 class="outfit text-[2.2rem] font-extrabold text-teal-900 mb-1">
                    Last Person to Fit in the Bus
                </h1>
                <p class="text-lg text-cyan-700 font-semibold mt-1">
                    ç´¯ç©å’Œ + äºŒåˆ†æ¢ç´¢ ã«ã‚ˆã‚‹ O(N log N) å®Ÿè£…
                </p>
                <nav class="flex flex-wrap gap-3 mt-6">
                    <a
                        href="#overview"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-600 text-sm"
                        >æ¦‚è¦</a
                    >
                    <a
                        href="#steps"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-600 text-sm"
                        >ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬</a
                    >
                    <a
                        href="#code"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-600 text-sm"
                        >ã‚³ãƒ¼ãƒ‰</a
                    >
                    <a
                        href="#diagram"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-600 text-sm"
                        >ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</a
                    >
                    <a
                        href="#complexity"
                        class="inline-block px-4 py-2 font-semibold text-slate-700 no-underline rounded-lg border-2 border-slate-200 bg-white transition hover:shadow-[0_6px_16px_rgba(15,118,110,0.20)] hover:-translate-y-0.5 hover:bg-[linear-gradient(180deg,#e8fff6,#c8f1e1)] hover:border-teal-600 text-sm"
                        >è¨ˆç®—é‡</a
                    >
                </nav>
            </header>

            <!-- ===== OVERVIEW ===== -->
            <section id="overview" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="outfit text-[1.9rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¦‚è¦
                </h2>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                    <div
                        style="background: #d1fae5; color: #065f46"
                        class="rounded-xl p-3 text-center"
                    >
                        <div class="font-bold text-xs font-mono break-all leading-tight">
                            cumsum
                        </div>
                        <div class="text-xs mt-1">ç´¯ç©å’Œ</div>
                    </div>
                    <div
                        style="background: #bfdbfe; color: #1e40af"
                        class="rounded-xl p-3 text-center"
                    >
                        <div class="font-bold text-xs font-mono break-all leading-tight">
                            searchsorted
                        </div>
                        <div class="text-xs mt-1">äºŒåˆ†æ¢ç´¢</div>
                    </div>
                    <div
                        style="background: #fef3c7; color: #92400e"
                        class="rounded-xl p-3 text-center"
                    >
                        <div class="font-bold text-xs font-mono break-all leading-tight">
                            O(N log N)
                        </div>
                        <div class="text-xs mt-1">æ™‚é–“è¨ˆç®—é‡</div>
                    </div>
                    <div
                        style="background: #ede9fe; color: #5b21b6"
                        class="rounded-xl p-3 text-center"
                    >
                        <div class="font-bold text-xs font-mono break-all leading-tight">O(N)</div>
                        <div class="text-xs mt-1">ç©ºé–“è¨ˆç®—é‡</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="rounded-xl border-2 border-slate-100 p-5 bg-slate-50">
                        <h3 class="outfit font-bold text-slate-800 mb-3 text-base">ğŸ“¥ å…¥åŠ›ä¾‹</h3>
                        <div class="overflow-x-auto">
                            <table class="text-sm w-full border-collapse">
                                <thead>
                                    <tr class="bg-emerald-100 text-emerald-900">
                                        <th
                                            class="px-3 py-2 text-left border border-emerald-200 font-mono"
                                        >
                                            person_id
                                        </th>
                                        <th
                                            class="px-3 py-2 text-left border border-emerald-200 font-mono"
                                        >
                                            person_name
                                        </th>
                                        <th
                                            class="px-3 py-2 text-left border border-emerald-200 font-mono"
                                        >
                                            weight
                                        </th>
                                        <th
                                            class="px-3 py-2 text-left border border-emerald-200 font-mono"
                                        >
                                            turn
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border border-slate-200">
                                        <td class="px-3 py-1.5 border border-slate-200 mono">5</td>
                                        <td class="px-3 py-1.5 border border-slate-200">Alice</td>
                                        <td class="px-3 py-1.5 border border-slate-200">250</td>
                                        <td class="px-3 py-1.5 border border-slate-200">1</td>
                                    </tr>
                                    <tr class="bg-slate-50 border border-slate-200">
                                        <td class="px-3 py-1.5 border border-slate-200 mono">3</td>
                                        <td class="px-3 py-1.5 border border-slate-200">Alex</td>
                                        <td class="px-3 py-1.5 border border-slate-200">350</td>
                                        <td class="px-3 py-1.5 border border-slate-200">2</td>
                                    </tr>
                                    <tr
                                        class="bg-emerald-50 border border-emerald-200 font-semibold"
                                    >
                                        <td class="px-3 py-1.5 border border-emerald-200 mono">
                                            6
                                        </td>
                                        <td
                                            class="px-3 py-1.5 border border-emerald-200 text-emerald-800"
                                        >
                                            John Cena
                                        </td>
                                        <td class="px-3 py-1.5 border border-emerald-200">400</td>
                                        <td class="px-3 py-1.5 border border-emerald-200">3</td>
                                    </tr>
                                    <tr class="bg-red-50 border border-red-200 text-slate-400">
                                        <td class="px-3 py-1.5 border border-red-200 mono">2</td>
                                        <td class="px-3 py-1.5 border border-red-200">Marie</td>
                                        <td class="px-3 py-1.5 border border-red-200">200</td>
                                        <td class="px-3 py-1.5 border border-red-200">4</td>
                                    </tr>
                                    <tr class="bg-red-50 border border-red-200 text-slate-400">
                                        <td class="px-3 py-1.5 border border-red-200 mono">4</td>
                                        <td class="px-3 py-1.5 border border-red-200">Bob</td>
                                        <td class="px-3 py-1.5 border border-red-200">175</td>
                                        <td class="px-3 py-1.5 border border-red-200">5</td>
                                    </tr>
                                    <tr class="bg-red-50 border border-red-200 text-slate-400">
                                        <td class="px-3 py-1.5 border border-red-200 mono">1</td>
                                        <td class="px-3 py-1.5 border border-red-200">Winston</td>
                                        <td class="px-3 py-1.5 border border-red-200">500</td>
                                        <td class="px-3 py-1.5 border border-red-200">6</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="text-xs text-slate-500 mt-2">
                            ğŸŸ¢ ä¹—è»Šå¯èƒ½ &nbsp;/&nbsp; ğŸ”´ è¶…éã§ä¹—è»Šä¸å¯
                        </p>
                    </div>

                    <div class="rounded-xl border-2 border-slate-100 p-5 bg-slate-50">
                        <h3 class="outfit font-bold text-slate-800 mb-3 text-base">
                            ğŸ“¤ ç´¯ç©é‡é‡ãƒˆãƒ¬ãƒ¼ã‚¹
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="text-sm w-full border-collapse">
                                <thead>
                                    <tr class="bg-sky-100 text-sky-900">
                                        <th
                                            class="px-3 py-2 text-left border border-sky-200 font-mono"
                                        >
                                            turn
                                        </th>
                                        <th
                                            class="px-3 py-2 text-left border border-sky-200 font-mono"
                                        >
                                            name
                                        </th>
                                        <th
                                            class="px-3 py-2 text-left border border-sky-200 font-mono"
                                        >
                                            weight
                                        </th>
                                        <th
                                            class="px-3 py-2 text-left border border-sky-200 font-mono"
                                        >
                                            cum_w
                                        </th>
                                        <th class="px-3 py-2 text-center border border-sky-200">
                                            çŠ¶æ…‹
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border border-slate-200">
                                        <td class="px-3 py-1.5 border border-slate-200 mono">1</td>
                                        <td class="px-3 py-1.5 border border-slate-200">Alice</td>
                                        <td class="px-3 py-1.5 border border-slate-200">250</td>
                                        <td
                                            class="px-3 py-1.5 border border-slate-200 font-bold mono"
                                        >
                                            250
                                        </td>
                                        <td class="px-3 py-1.5 border border-slate-200 text-center">
                                            âœ…
                                        </td>
                                    </tr>
                                    <tr class="bg-slate-50">
                                        <td class="px-3 py-1.5 border border-slate-200 mono">2</td>
                                        <td class="px-3 py-1.5 border border-slate-200">Alex</td>
                                        <td class="px-3 py-1.5 border border-slate-200">350</td>
                                        <td
                                            class="px-3 py-1.5 border border-slate-200 font-bold mono"
                                        >
                                            600
                                        </td>
                                        <td class="px-3 py-1.5 border border-slate-200 text-center">
                                            âœ…
                                        </td>
                                    </tr>
                                    <tr class="bg-emerald-50">
                                        <td
                                            class="px-3 py-1.5 border border-emerald-200 mono font-bold"
                                        >
                                            3
                                        </td>
                                        <td
                                            class="px-3 py-1.5 border border-emerald-200 font-bold text-emerald-800"
                                        >
                                            John Cena
                                        </td>
                                        <td class="px-3 py-1.5 border border-emerald-200">400</td>
                                        <td
                                            class="px-3 py-1.5 border border-emerald-200 font-bold mono text-emerald-700"
                                        >
                                            1000
                                        </td>
                                        <td
                                            class="px-3 py-1.5 border border-emerald-200 text-center"
                                        >
                                            âœ…ğŸ†
                                        </td>
                                    </tr>
                                    <tr class="bg-red-50 text-slate-400">
                                        <td class="px-3 py-1.5 border border-red-200 mono">4</td>
                                        <td class="px-3 py-1.5 border border-red-200">Marie</td>
                                        <td class="px-3 py-1.5 border border-red-200">200</td>
                                        <td
                                            class="px-3 py-1.5 border border-red-200 font-bold mono text-red-500"
                                        >
                                            1200
                                        </td>
                                        <td class="px-3 py-1.5 border border-red-200 text-center">
                                            âŒ
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div
                            class="mt-3 px-4 py-3 bg-emerald-100 rounded-lg text-sm text-emerald-800 font-semibold"
                        >
                            ğŸ¯ å‡ºåŠ›: <span class="mono">John Cena</span>
                        </div>
                    </div>
                </div>

                <div class="mt-6 p-5 rounded-xl bg-amber-50 border-2 border-amber-200">
                    <h3 class="outfit font-bold text-amber-800 mb-2 text-base">
                        ğŸ”‘ è§£æ³•ã®æ ¸å¿ƒï¼šäºŒåˆ†æ¢ç´¢ãŒä½¿ãˆã‚‹ç†ç”±
                    </h3>
                    <p class="text-sm text-slate-700 leading-7">
                        å…¨ã¦ã®
                        <span class="mono font-bold">weight &gt; 0</span>
                        ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€<span class="mono font-bold">cumsum</span>ï¼ˆç´¯ç©å’Œï¼‰ã¯
                        <span class="text-emerald-700 font-bold">å˜èª¿å¢—åŠ </span> ãŒç¢ºå®šã—ã¾ã™ã€‚
                        å˜èª¿å¢—åŠ åˆ—ã«å¯¾ã—ã¦ã¯
                        <span class="text-sky-700 font-bold">np.searchsorted</span> ã«ã‚ˆã‚‹äºŒåˆ†æ¢ç´¢
                        <span class="mono">O(log N)</span> ãŒé©ç”¨ã§ãã€ ç·šå½¢æ¢ç´¢
                        <span class="mono">O(N)</span> ã‹ã‚‰é«˜é€ŸåŒ–ã§ãã¾ã™ã€‚
                    </p>
                </div>
            </section>

            <!-- ===== STEPS (React) ===== -->
            <section id="steps" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="outfit text-[1.9rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬
                </h2>
                <div id="steps-root"></div>
            </section>

            <!-- ===== CODE ===== -->
            <section id="code" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="outfit text-[1.9rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    Python / pandas å®Ÿè£…
                </h2>

                <div class="mb-4 flex gap-3 flex-wrap">
                    <span
                        class="px-3 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-800 mono"
                        >æ”¹å–„æ¡ˆâ‘  numpy + searchsorted</span
                    >
                    <span
                        class="px-3 py-1 rounded-full text-xs font-bold bg-sky-100 text-sky-800 mono"
                        >Beats ~95%</span
                    >
                </div>

                <pre class="line-numbers"><code class="language-python">import pandas as pd
import numpy as np

def last_passenger(queue: pd.DataFrame) -> pd.DataFrame:
    """
    turn(1ã€œN ã®é€£ç¶šæ•´æ•°)ã‚’ 0-indexed ã®é…åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦ç›´æ¥åˆ©ç”¨ã€‚
    ã‚½ãƒ¼ãƒˆã‚’ O(N log N) argsort â†’ O(N) ç›´æ¥é…ç½®ã«ç½®æ›ã—ã€
    ç·šå½¢æ¢ç´¢ã‚’ O(log N) searchsorted ã«ç½®æ›ã™ã‚‹ã€‚

    Returns:
        pd.DataFrame: åˆ— ['person_name'] ã® 1 è¡Œ
    """
    n = len(queue)

    # numpy é…åˆ—ã«ä¸€æ‹¬å¤‰æ›ï¼ˆpandas ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æ’é™¤ï¼‰
    turns   = queue['turn'].to_numpy() - 1    # 0-indexed ã«å¤‰æ›
    weights = queue['weight'].to_numpy()
    names   = queue['person_name'].to_numpy()

    # ğŸ”‘ turn ã‚’ç›´æ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦ä½¿ã„ O(N) ã§é…ç½®ï¼ˆargsort ä¸è¦ï¼‰
    weights_sorted = np.empty(n, dtype=np.int64)
    names_sorted   = np.empty(n, dtype=object)
    weights_sorted[turns] = weights
    names_sorted[turns]   = names

    # ç´¯ç©å’Œï¼ˆå˜èª¿å¢—åŠ ãŒç¢ºå®šï¼‰
    cum_w = weights_sorted.cumsum()           # O(N)

    # ğŸ”‘ searchsorted: å˜èª¿å¢—åŠ åˆ—ã¸ã®äºŒåˆ†æ¢ç´¢ O(log N)
    # side='right': 1000 ã‚ˆã‚Šå¤§ãããªã‚‹æœ€åˆã®ä½ç½® â†’ -1 ã§æœ€å¾Œã®æœ‰åŠ¹ä½ç½®
    last_pos = np.searchsorted(cum_w, 1000, side='right') - 1

    if last_pos < 0:
        return pd.DataFrame({'person_name': []})

    return pd.DataFrame({'person_name': [names_sorted[last_pos]]})


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# åˆ¥è§£: å¯èª­æ€§é‡è¦–ï¼ˆBeats ~83%ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def last_passenger_readable(queue: pd.DataFrame) -> pd.DataFrame:
    return (
        queue
        .sort_values('turn')                        # è¨ˆç®—ç”¨ã‚½ãƒ¼ãƒˆ
        .assign(cum_w=lambda df: df['weight'].cumsum())
        .loc[lambda df: df['cum_w'].le(1000), ['person_name']]
        .tail(1)
        .reset_index(drop=True)
    )</code></pre>

                <div class="mt-6">
                    <h3 class="outfit font-bold text-slate-800 mb-3 text-base">
                        SQL (PostgreSQL 16.6+)
                    </h3>
                    <pre
                        class="line-numbers"
                    ><code class="language-sql">WITH cum AS NOT MATERIALIZED (
  SELECT
    person_name,
    turn,
    SUM(weight) OVER (
      ORDER BY turn
      ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS cum_w
  FROM Queue
)
SELECT person_name
FROM cum
WHERE cum_w &lt;= 1000
ORDER BY cum_w DESC   -- å˜èª¿å¢—åŠ ã®ãŸã‚ turn DESC ã¨ç­‰ä¾¡ã€å†ã‚½ãƒ¼ãƒˆã‚’çœç•¥
LIMIT 1;</code></pre>
                </div>
            </section>

            <!-- ===== DIAGRAM ===== -->
            <section id="diagram" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="outfit text-[1.9rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    å‡¦ç†ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
                </h2>
                <div class="mt-5 overflow-x-auto">
                    <svg
                        viewBox="0 0 560 1060"
                        style="
                            max-width: 560px;
                            width: 100%;
                            height: auto;
                            display: block;
                            margin: 0 auto;
                        "
                        role="img"
                        aria-label="Last Person to Fit in the Bus flowchart"
                    >
                        <defs>
                            <marker
                                id="fc-arrow"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                            </marker>
                            <marker
                                id="fc-arrowGreen"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#059669" />
                            </marker>
                            <marker
                                id="fc-arrowBlue"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#0284c7" />
                            </marker>
                            <marker
                                id="fc-arrowAmber"
                                markerWidth="10"
                                markerHeight="10"
                                refX="9"
                                refY="3"
                                orient="auto"
                                markerUnits="strokeWidth"
                            >
                                <path d="M0,0 L0,6 L9,3 z" fill="#d97706" />
                            </marker>
                        </defs>

                        <!-- é–‹å§‹ -->
                        <ellipse
                            cx="280"
                            cy="48"
                            rx="110"
                            ry="28"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="280"
                            y="48"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            font-weight="bold"
                            fill="#065f46"
                        >
                            é–‹å§‹
                        </text>

                        <line
                            x1="280"
                            y1="76"
                            x2="280"
                            y2="103"
                            stroke="#64748b"
                            stroke-width="2"
                            marker-end="url(#fc-arrow)"
                        />

                        <!-- Step1: å…¥åŠ›DFå—å– -->
                        <rect
                            x="60"
                            y="108"
                            width="440"
                            height="60"
                            rx="10"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="280"
                            y="128"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="bold"
                            fill="#0c4a6e"
                        >
                            â‘  å…¥åŠ› DataFrame å—ã‘å–ã‚Š
                        </text>
                        <text
                            x="280"
                            y="150"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#0369a1"
                        >
                            Queue(person_id, person_name, weight, turn)
                        </text>

                        <line
                            x1="280"
                            y1="168"
                            x2="280"
                            y2="195"
                            stroke="#64748b"
                            stroke-width="2"
                            marker-end="url(#fc-arrow)"
                        />

                        <!-- Step2: numpyå¤‰æ› -->
                        <rect
                            x="60"
                            y="200"
                            width="440"
                            height="120"
                            rx="10"
                            fill="#f1f5f9"
                            stroke="#64748b"
                            stroke-width="2"
                        />
                        <text
                            x="280"
                            y="222"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="bold"
                            fill="#1e293b"
                        >
                            â‘¡ numpy é…åˆ—ã¸ä¸€æ‹¬å¤‰æ›
                        </text>
                        <line
                            x1="80"
                            y1="235"
                            x2="480"
                            y2="235"
                            stroke="#cbd5e1"
                            stroke-width="1"
                        />
                        <text
                            x="280"
                            y="255"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#475569"
                        >
                            turns = queue['turn'].to_numpy() - 1
                        </text>
                        <text
                            x="280"
                            y="277"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#475569"
                        >
                            weights = queue['weight'].to_numpy()
                        </text>
                        <text
                            x="280"
                            y="299"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#475569"
                        >
                            names = queue['person_name'].to_numpy()
                        </text>

                        <line
                            x1="280"
                            y1="320"
                            x2="280"
                            y2="347"
                            stroke="#64748b"
                            stroke-width="2"
                            marker-end="url(#fc-arrow)"
                        />

                        <!-- Step3: ç›´æ¥é…ç½® O(N) -->
                        <rect
                            x="60"
                            y="352"
                            width="440"
                            height="110"
                            rx="10"
                            fill="#fef3c7"
                            stroke="#d97706"
                            stroke-width="2"
                        />
                        <text
                            x="280"
                            y="374"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="bold"
                            fill="#92400e"
                        >
                            â‘¢ turn ã‚’ index ã¨ã—ã¦ç›´æ¥é…ç½® O(N)
                        </text>
                        <line
                            x1="80"
                            y1="387"
                            x2="480"
                            y2="387"
                            stroke="#fde68a"
                            stroke-width="1"
                        />
                        <text
                            x="280"
                            y="407"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#78350f"
                        >
                            weights_sorted[turns] = weights
                        </text>
                        <text
                            x="280"
                            y="429"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#78350f"
                        >
                            names_sorted[turns] = names
                        </text>
                        <text
                            x="280"
                            y="451"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="11"
                            fill="#b45309"
                        >
                            â€» argsort ä¸è¦ / ã‚½ãƒ¼ãƒˆ O(N log N) ã‚’ O(N) ã«å‰Šæ¸›
                        </text>

                        <line
                            x1="280"
                            y1="462"
                            x2="280"
                            y2="489"
                            stroke="#64748b"
                            stroke-width="2"
                            marker-end="url(#fc-arrow)"
                        />

                        <!-- Step4: cumsum -->
                        <rect
                            x="60"
                            y="494"
                            width="440"
                            height="80"
                            rx="10"
                            fill="#e0f2fe"
                            stroke="#0284c7"
                            stroke-width="2"
                        />
                        <text
                            x="280"
                            y="518"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="bold"
                            fill="#0c4a6e"
                        >
                            â‘£ ç´¯ç©å’Œã®è¨ˆç®— O(N)
                        </text>
                        <text
                            x="280"
                            y="542"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#0369a1"
                        >
                            cum_w = weights_sorted.cumsum()
                        </text>
                        <text
                            x="280"
                            y="562"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="11"
                            fill="#0369a1"
                        >
                            å˜èª¿å¢—åŠ ãŒç¢ºå®š â†’ äºŒåˆ†æ¢ç´¢é©ç”¨å¯èƒ½
                        </text>

                        <line
                            x1="280"
                            y1="574"
                            x2="280"
                            y2="601"
                            stroke="#64748b"
                            stroke-width="2"
                            marker-end="url(#fc-arrow)"
                        />

                        <!-- Step5: searchsorted -->
                        <rect
                            x="60"
                            y="606"
                            width="440"
                            height="110"
                            rx="10"
                            fill="#ede9fe"
                            stroke="#7c3aed"
                            stroke-width="2"
                        />
                        <text
                            x="280"
                            y="628"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="bold"
                            fill="#4c1d95"
                        >
                            â‘¤ äºŒåˆ†æ¢ç´¢ã§å¢ƒç•Œã‚’ O(log N) ç™ºè¦‹
                        </text>
                        <line
                            x1="80"
                            y1="641"
                            x2="480"
                            y2="641"
                            stroke="#c4b5fd"
                            stroke-width="1"
                        />
                        <text
                            x="280"
                            y="661"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#5b21b6"
                        >
                            pos = np.searchsorted(cum_w, 1000, side='right')
                        </text>
                        <text
                            x="280"
                            y="683"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#5b21b6"
                        >
                            last_pos = pos - 1
                        </text>
                        <text
                            x="280"
                            y="705"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="11"
                            fill="#6d28d9"
                        >
                            ä¾‹: [250,600,1000,1200,â€¦] â†’ pos=3 â†’ last_pos=2
                        </text>

                        <line
                            x1="280"
                            y1="716"
                            x2="280"
                            y2="743"
                            stroke="#059669"
                            stroke-width="2"
                            marker-end="url(#fc-arrowGreen)"
                        />

                        <!-- Step6: å‡ºåŠ› -->
                        <rect
                            x="60"
                            y="748"
                            width="440"
                            height="80"
                            rx="12"
                            fill="#d1fae5"
                            stroke="#059669"
                            stroke-width="2.5"
                        />
                        <text
                            x="280"
                            y="772"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="14"
                            font-weight="bold"
                            fill="#065f46"
                        >
                            â‘¥ è©²å½“äººç‰©åã‚’è¿”å´
                        </text>
                        <text
                            x="280"
                            y="796"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#047857"
                        >
                            names_sorted[last_pos] â†’ person_name
                        </text>

                        <line
                            x1="280"
                            y1="828"
                            x2="280"
                            y2="855"
                            stroke="#059669"
                            stroke-width="2"
                            marker-end="url(#fc-arrowGreen)"
                        />

                        <!-- çµ‚äº† -->
                        <ellipse
                            cx="280"
                            cy="883"
                            rx="110"
                            ry="28"
                            fill="#d1fae5"
                            stroke="#10b981"
                            stroke-width="2"
                        />
                        <text
                            x="280"
                            y="883"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="15"
                            font-weight="bold"
                            fill="#065f46"
                        >
                            çµ‚äº†
                        </text>

                        <!-- è¨ˆç®—é‡ã‚µãƒãƒª -->
                        <rect
                            x="60"
                            y="930"
                            width="440"
                            height="110"
                            rx="10"
                            fill="#f8fafc"
                            stroke="#cbd5e1"
                            stroke-width="1.5"
                            stroke-dasharray="6,3"
                        />
                        <text
                            x="280"
                            y="952"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="13"
                            font-weight="bold"
                            fill="#334155"
                        >
                            è¨ˆç®—é‡ã‚µãƒãƒª
                        </text>
                        <line
                            x1="80"
                            y1="965"
                            x2="480"
                            y2="965"
                            stroke="#e2e8f0"
                            stroke-width="1"
                        />
                        <text
                            x="280"
                            y="983"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="12"
                            fill="#64748b"
                        >
                            ç›´æ¥é…ç½® O(N) + cumsum O(N) + searchsorted O(log N)
                        </text>
                        <text
                            x="280"
                            y="1005"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="13"
                            font-weight="bold"
                            fill="#059669"
                        >
                            å…¨ä½“: O(N) â† æ—§ O(N log N) ã‹ã‚‰æ”¹å–„
                        </text>
                        <text
                            x="280"
                            y="1027"
                            text-anchor="middle"
                            dominant-baseline="middle"
                            font-size="11"
                            fill="#94a3b8"
                        >
                            â€» turn ãŒ 1ã€œN ã®é€£ç¶šæ•´æ•°ã¨ã„ã†åˆ¶ç´„ã‚’æœ€å¤§æ´»ç”¨
                        </text>
                    </svg>
                </div>

                <p class="mt-6 text-slate-700 leading-8 text-sm">
                    <strong class="text-lg text-teal-800">ãƒ•ãƒ­ãƒ¼ã®èª¬æ˜ï¼š</strong><br />
                    1. DataFrame ã‚’ numpy é…åˆ—ã«å¤‰æ›ã— pandas ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æ’é™¤ã—ã¾ã™ã€‚<br />
                    2. <span class="mono font-semibold">turn</span> ãŒ 1ã€œN
                    ã®é€£ç¶šæ•´æ•°ã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã€ç›´æ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦é…ç½®ï¼ˆO(N)ï¼‰ã™ã‚‹ã“ã¨ã§
                    argsort ã‚’ä¸è¦ã«ã—ã¾ã™ã€‚<br />
                    3. <span class="mono font-semibold">cumsum()</span> ã§å˜èª¿å¢—åŠ ãªç´¯ç©å’Œã‚’ O(N)
                    ã§ç”Ÿæˆã—ã¾ã™ã€‚<br />
                    4.
                    <span class="mono font-semibold">np.searchsorted(..., side='right') - 1</span>
                    ã§äºŒåˆ†æ¢ç´¢ O(log N) ã«ã‚ˆã‚Šæœ€å¾Œã«ä¹—ã‚Œã‚‹ä½ç½®ã‚’ç‰¹å®šã—ã¾ã™ã€‚<br />
                    5. å¯¾å¿œã™ã‚‹äººç‰©åã‚’è¿”å´ã—ã¾ã™ã€‚
                </p>
            </section>

            <!-- ===== COMPLEXITY ===== -->
            <section id="complexity" class="bg-white rounded-2xl p-8 mb-8 shadow">
                <h2
                    class="outfit text-[1.9rem] font-bold text-cyan-700 mb-4 pb-2 border-b-[3px] border-emerald-200"
                >
                    è¨ˆç®—é‡åˆ†æ
                </h2>

                <div class="overflow-x-auto">
                    <table class="text-sm w-full border-collapse">
                        <thead>
                            <tr class="bg-slate-100 text-slate-700">
                                <th class="px-4 py-3 text-left border border-slate-200 font-bold">
                                    å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—
                                </th>
                                <th class="px-4 py-3 text-center border border-slate-200 font-bold">
                                    æ—§å®Ÿè£…
                                </th>
                                <th class="px-4 py-3 text-center border border-slate-200 font-bold">
                                    æ”¹å–„å¾Œ
                                </th>
                                <th class="px-4 py-3 text-left border border-slate-200 font-bold">
                                    æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border border-slate-200">
                                <td class="px-4 py-3 border border-slate-200 font-mono text-xs">
                                    ã‚½ãƒ¼ãƒˆå‡¦ç†
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-amber-600 font-bold mono"
                                >
                                    O(N log N)<br /><span class="text-xs font-normal text-slate-500"
                                        >pandas sort_values</span
                                    >
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-emerald-700 font-bold mono"
                                >
                                    O(N)<br /><span class="text-xs font-normal text-slate-500"
                                        >ç›´æ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…ç½®</span
                                    >
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-xs text-slate-600"
                                >
                                    turn ãŒ 1ã€œN é€£ç¶šæ•´æ•°ã®åˆ¶ç´„ã‚’æ´»ç”¨
                                </td>
                            </tr>
                            <tr class="bg-slate-50 border border-slate-200">
                                <td class="px-4 py-3 border border-slate-200 font-mono text-xs">
                                    ç´¯ç©å’Œ
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-slate-600 font-bold mono"
                                >
                                    O(N)
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-emerald-700 font-bold mono"
                                >
                                    O(N)
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-xs text-slate-600"
                                >
                                    numpy cumsum ã§åŒç­‰ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰å‰Šæ¸›
                                </td>
                            </tr>
                            <tr class="border border-slate-200">
                                <td class="px-4 py-3 border border-slate-200 font-mono text-xs">
                                    æœ€çµ‚è¡Œã®æ¢ç´¢
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-amber-600 font-bold mono"
                                >
                                    O(N)<br /><span class="text-xs font-normal text-slate-500"
                                        >le(1000).tail(1) ç·šå½¢</span
                                    >
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-emerald-700 font-bold mono"
                                >
                                    O(log N)<br /><span class="text-xs font-normal text-slate-500"
                                        >searchsorted äºŒåˆ†æ¢ç´¢</span
                                    >
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-xs text-slate-600"
                                >
                                    å˜èª¿å¢—åŠ æ€§ã‚’åˆ©ç”¨ã—ãŸäºŒåˆ†æ¢ç´¢
                                </td>
                            </tr>
                            <tr class="bg-emerald-50 border border-emerald-200">
                                <td
                                    class="px-4 py-3 border border-emerald-200 font-bold text-emerald-900"
                                >
                                    åˆè¨ˆï¼ˆæ™‚é–“ï¼‰
                                </td>
                                <td
                                    class="px-4 py-3 border border-emerald-200 text-center text-amber-600 font-bold mono"
                                >
                                    O(N log N)
                                </td>
                                <td
                                    class="px-4 py-3 border border-emerald-200 text-center text-emerald-700 font-bold mono text-lg"
                                >
                                    O(N)
                                </td>
                                <td
                                    class="px-4 py-3 border border-emerald-200 text-xs text-emerald-800 font-semibold"
                                >
                                    ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ã‚½ãƒ¼ãƒˆã‚’å®Œå…¨ã«æ’é™¤
                                </td>
                            </tr>
                            <tr class="bg-slate-50 border border-slate-200">
                                <td class="px-4 py-3 border border-slate-200 font-bold">
                                    ç©ºé–“è¨ˆç®—é‡
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-slate-600 font-bold mono"
                                >
                                    O(N)
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-center text-emerald-700 font-bold mono"
                                >
                                    O(N)
                                </td>
                                <td
                                    class="px-4 py-3 border border-slate-200 text-xs text-slate-600"
                                >
                                    numpy é…åˆ— 3æœ¬ï¼ˆweights, names, cum_wï¼‰
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div
                        class="rounded-xl p-5 bg-[linear-gradient(135deg,#d1fae5,#a7f3d0)] border-2 border-emerald-300 text-center"
                    >
                        <div class="outfit text-3xl font-extrabold text-emerald-800 mb-1">O(N)</div>
                        <div class="text-sm text-emerald-700 font-semibold">æœ€çµ‚æ™‚é–“è¨ˆç®—é‡</div>
                        <div class="text-xs text-emerald-600 mt-1">æ—§ O(N log N) ã‹ã‚‰æ”¹å–„</div>
                    </div>
                    <div
                        class="rounded-xl p-5 bg-[linear-gradient(135deg,#bfdbfe,#93c5fd)] border-2 border-blue-300 text-center"
                    >
                        <div class="outfit text-3xl font-extrabold text-blue-800 mb-1">
                            O(log N)
                        </div>
                        <div class="text-sm text-blue-700 font-semibold">searchsorted æ¢ç´¢</div>
                        <div class="text-xs text-blue-600 mt-1">æ—§ O(N) ç·šå½¢æ¢ç´¢ã‹ã‚‰æ”¹å–„</div>
                    </div>
                    <div
                        class="rounded-xl p-5 bg-[linear-gradient(135deg,#fef3c7,#fde68a)] border-2 border-amber-300 text-center"
                    >
                        <div class="outfit text-3xl font-extrabold text-amber-800 mb-1">~95%</div>
                        <div class="text-sm text-amber-700 font-semibold">æ¨å®š Beats ã‚¹ã‚³ã‚¢</div>
                        <div class="text-xs text-amber-600 mt-1">æ—§ ~83% ã‹ã‚‰å¤§å¹…æ”¹å–„</div>
                    </div>
                </div>
            </section>
        </div>
        <!-- /max-w -->

        <!-- ===== REACT STEPS ===== -->
        <script type="text/babel">
            const { useState, useEffect, useRef } = React;

            const stepsData = [
                {
                    step: 1,
                    title: 'numpy é…åˆ—ã¸å¤‰æ›',
                    desc: 'pandas DataFrame ã‹ã‚‰ numpy é…åˆ—ã«ä¸€æ‹¬å¤‰æ›ã—ã¾ã™ã€‚pandas ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æ’é™¤ã—ã€ç´”ç²‹ãª C ãƒ¬ãƒ™ãƒ«ã®é…åˆ—æ“ä½œã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚turns ã¯ 1-indexed ãªã®ã§ -1 ã—ã¦ 0-indexed ã«ã—ã¾ã™ã€‚',
                    visual: {
                        type: 'array',
                        label: 'å¤‰æ›å¾Œ numpy é…åˆ—',
                        items: [
                            {
                                label: 'turns',
                                values: ['0', '1', '2', '3', '4', '5'],
                                color: '#0284c7',
                            },
                            {
                                label: 'weights',
                                values: ['250', '350', '400', '200', '175', '500'],
                                color: '#059669',
                            },
                            {
                                label: 'names',
                                values: ['Alice', 'Alex', 'John', 'Marie', 'Bob', 'Win..'],
                                color: '#7c3aed',
                            },
                        ],
                    },
                },
                {
                    step: 2,
                    title: 'ç›´æ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…ç½® O(N)',
                    desc: 'turn ãŒ 1ã€œN ã®é€£ç¶šæ•´æ•°ã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚turns[i] ã‚’ãã®ã¾ã¾é…åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦ä½¿ã„ã€O(N) ã®ç›´æ¥ä»£å…¥ã§ã‚½ãƒ¼ãƒˆæ¸ˆã¿é…åˆ—ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚argsortï¼ˆO(N log N)ï¼‰ã¯ä¸è¦ã§ã™ã€‚',
                    visual: {
                        type: 'mapping',
                        label: 'ç›´æ¥é…ç½®ã‚¤ãƒ¡ãƒ¼ã‚¸',
                        before: [
                            'Alice(t=1)',
                            'Alex(t=2)',
                            'John(t=3)',
                            'Marie(t=4)',
                            'Bob(t=5)',
                            'Win(t=6)',
                        ],
                        after: ['Alice', 'Alex', 'John', 'Marie', 'Bob', 'Winston'],
                    },
                },
                {
                    step: 3,
                    title: 'ç´¯ç©å’Œã®è¨ˆç®— cumsum',
                    desc: 'turn æ˜‡é †ã«ä¸¦ã‚“ã  weights_sorted ã« cumsum() ã‚’é©ç”¨ã—ã¾ã™ã€‚å…¨ weight > 0 ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€çµæœã¯å¿…ãšå˜èª¿å¢—åŠ ã«ãªã‚Šã¾ã™ã€‚ã“ã‚ŒãŒæ¬¡ã®äºŒåˆ†æ¢ç´¢ã‚’å¯èƒ½ã«ã™ã‚‹éµã§ã™ã€‚',
                    visual: {
                        type: 'cumsum',
                        label: 'ç´¯ç©å’Œ cum_w',
                        weights: [250, 350, 400, 200, 175, 500],
                        cumvals: [250, 600, 1000, 1200, 1375, 1875],
                        limit: 1000,
                    },
                },
                {
                    step: 4,
                    title: 'searchsorted ã§äºŒåˆ†æ¢ç´¢',
                    desc: "å˜èª¿å¢—åŠ ãª cum_w ã«å¯¾ã— np.searchsorted(cum_w, 1000, side='right') ã‚’é©ç”¨ã—ã¾ã™ã€‚side='right' ã¯ 1000 ã¨ç­‰ã—ã„å€¤ã®å³å´ä½ç½®ã‚’è¿”ã™ãŸã‚ã€-1 ã™ã‚‹ã“ã¨ã§ 1000 ä»¥ä¸‹ã®æœ€å¾Œã®ä½ç½®ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚",
                    visual: {
                        type: 'bsearch',
                        label: 'äºŒåˆ†æ¢ç´¢ã®å‹•ä½œ',
                        arr: [250, 600, 1000, 1200, 1375, 1875],
                        target: 1000,
                        result: 3,
                        lastPos: 2,
                    },
                },
                {
                    step: 5,
                    title: 'äººç‰©åã‚’è¿”å´',
                    desc: 'names_sorted[last_pos] ã§ç›´æ¥äººç‰©åã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€pd.DataFrame ã¨ã—ã¦è¿”å´ã—ã¾ã™ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ“ä½œã¯ O(1) ã§ã™ã€‚',
                    visual: {
                        type: 'output',
                        label: 'å‡ºåŠ›',
                        pos: 2,
                        name: 'John Cena',
                    },
                },
            ];

            function ArrayVisual({ data }) {
                return (
                    <div className="mt-4">
                        <div className="text-xs font-bold text-slate-500 mb-2">{data.label}</div>
                        <div className="space-y-2">
                            {data.items.map((row) => (
                                <div key={row.label} className="flex items-center gap-2">
                                    <div className="w-16 text-xs font-mono font-bold text-slate-600 text-right">
                                        {row.label}
                                    </div>
                                    <div className="flex gap-1">
                                        {row.values.map((v, i) => (
                                            <div
                                                key={i}
                                                className="w-12 h-10 flex items-center justify-center rounded-lg text-xs font-mono font-bold text-white shadow-sm"
                                                style={{ background: row.color }}
                                            >
                                                {v}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                            <div className="flex items-center gap-2">
                                <div className="w-16 text-xs text-slate-400 text-right">index</div>
                                <div className="flex gap-1">
                                    {[0, 1, 2, 3, 4, 5].map((i) => (
                                        <div
                                            key={i}
                                            className="w-12 h-6 flex items-center justify-center text-xs text-slate-400 font-mono"
                                        >
                                            {i}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function MappingVisual({ data }) {
                return (
                    <div className="mt-4">
                        <div className="text-xs font-bold text-slate-500 mb-3">{data.label}</div>
                        <div className="flex gap-4 items-center flex-wrap">
                            <div>
                                <div className="text-xs text-slate-400 mb-1">
                                    å…ƒã®é †åºï¼ˆæœªã‚½ãƒ¼ãƒˆï¼‰
                                </div>
                                <div className="flex flex-col gap-1">
                                    {data.before.map((v, i) => (
                                        <div
                                            key={i}
                                            className="px-3 py-1.5 bg-sky-100 text-sky-800 rounded text-xs font-mono"
                                        >
                                            {v}
                                        </div>
                                    ))}
                                </div>
                            </div>
                            <div className="text-2xl text-emerald-500 font-bold">â†’</div>
                            <div>
                                <div className="text-xs text-slate-400 mb-1">
                                    ç›´æ¥é…ç½®å¾Œï¼ˆturné †ï¼‰
                                </div>
                                <div className="flex flex-col gap-1">
                                    {data.after.map((v, i) => (
                                        <div
                                            key={i}
                                            className="px-3 py-1.5 bg-emerald-100 text-emerald-800 rounded text-xs font-mono"
                                        >
                                            [{i}] {v}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function CumsumVisual({ data }) {
                const lastIndex = data.cumvals.reduce(
                    (lastIdx, v, i) => (v <= data.limit ? i : lastIdx),
                    -1,
                );

                return (
                    <div className="mt-4">
                        <div className="text-xs font-bold text-slate-500 mb-2">{data.label}</div>
                        <div className="flex gap-1 flex-wrap">
                            {data.cumvals.map((v, i) => {
                                const ok = v <= data.limit;
                                return (
                                    <div
                                        key={i}
                                        className={[
                                            'flex flex-col items-center rounded-xl p-2 border-2 transition',
                                            ok
                                                ? i === lastIndex
                                                    ? 'bg-emerald-200 border-emerald-500'
                                                    : 'bg-emerald-50 border-emerald-300'
                                                : 'bg-red-50 border-red-300',
                                        ].join(' ')}
                                    >
                                        <div
                                            className={[
                                                'text-xs font-bold font-mono',
                                                ok ? 'text-emerald-800' : 'text-red-600',
                                            ].join(' ')}
                                        >
                                            {v}
                                        </div>
                                        <div className="text-[10px] text-slate-500 mt-0.5">
                                            +{data.weights[i]}
                                        </div>
                                        <div
                                            className={[
                                                'text-[10px] mt-0.5',
                                                ok ? 'text-emerald-600' : 'text-red-400',
                                            ].join(' ')}
                                        >
                                            {ok ? 'âœ…' : 'âŒ'}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="text-xs text-slate-500 mt-2">
                            ğŸ”‘ å˜èª¿å¢—åŠ  â†’ äºŒåˆ†æ¢ç´¢ãŒä½¿ãˆã‚‹ï¼
                        </div>
                    </div>
                );
            }

            function BsearchVisual({ data }) {
                return (
                    <div className="mt-4">
                        <div className="text-xs font-bold text-slate-500 mb-2">{data.label}</div>
                        <div className="flex gap-1 flex-wrap mb-3">
                            {data.arr.map((v, i) => (
                                <div
                                    key={i}
                                    className={[
                                        'flex flex-col items-center rounded-xl p-2 border-2 min-w-[52px]',
                                        i === data.lastPos
                                            ? 'bg-emerald-200 border-emerald-500'
                                            : i >= data.result
                                              ? 'bg-red-50 border-red-200'
                                              : 'bg-slate-50 border-slate-200',
                                    ].join(' ')}
                                >
                                    <div className="text-xs font-bold font-mono text-slate-700">
                                        {v}
                                    </div>
                                    <div className="text-[10px] text-slate-400">idx:{i}</div>
                                    {i === data.lastPos && (
                                        <div className="text-[10px] text-emerald-700 font-bold">
                                            â† ç­”ãˆ
                                        </div>
                                    )}
                                    {i === data.result && (
                                        <div className="text-[10px] text-amber-600">right</div>
                                    )}
                                </div>
                            ))}
                        </div>
                        <div className="text-xs font-mono bg-slate-100 rounded-lg p-3 space-y-1">
                            <div>
                                searchsorted([..], 1000, side='right'){' '}
                                <span className="text-amber-600">â†’ {data.result}</span>
                            </div>
                            <div>
                                last_pos = {data.result} - 1{' '}
                                <span className="text-emerald-700">= {data.lastPos}</span>
                            </div>
                        </div>
                    </div>
                );
            }

            function OutputVisual({ data }) {
                return (
                    <div className="mt-4">
                        <div className="text-xs font-bold text-slate-500 mb-2">{data.label}</div>
                        <div className="flex items-center gap-4">
                            <div className="font-mono text-sm text-slate-600 bg-slate-100 rounded-lg p-3">
                                names_sorted[
                                <span className="text-sky-600 font-bold">{data.pos}</span>]
                            </div>
                            <div className="text-2xl text-emerald-500">â†’</div>
                            <div className="px-6 py-4 rounded-2xl bg-emerald-100 border-2 border-emerald-400 text-center">
                                <div className="text-xl font-bold text-emerald-800 font-mono">
                                    {data.name}
                                </div>
                                <div className="text-xs text-emerald-600 mt-1">person_name</div>
                            </div>
                        </div>
                    </div>
                );
            }

            function StepVisualization({ visual }) {
                if (!visual) return null;
                return (
                    <div className="mt-4 rounded-xl border-2 border-slate-200 bg-slate-50 p-4">
                        {visual.type === 'array' && <ArrayVisual data={visual} />}
                        {visual.type === 'mapping' && <MappingVisual data={visual} />}
                        {visual.type === 'cumsum' && <CumsumVisual data={visual} />}
                        {visual.type === 'bsearch' && <BsearchVisual data={visual} />}
                        {visual.type === 'output' && <OutputVisual data={visual} />}
                    </div>
                );
            }

            function StepsApp() {
                const [activeStep, setActiveStep] = useState(1);
                const [isPlaying, setIsPlaying] = useState(false);
                const timerRef = useRef(null);

                const currentStepData = stepsData[activeStep - 1];

                useEffect(() => {
                    if (isPlaying) {
                        timerRef.current = setTimeout(() => {
                            if (activeStep === stepsData.length) {
                                setActiveStep(1);
                                setIsPlaying(false);
                            } else {
                                setActiveStep((prev) => prev + 1);
                            }
                        }, 2000);
                    }
                    return () => {
                        if (timerRef.current) clearTimeout(timerRef.current);
                    };
                }, [isPlaying, activeStep]);

                return (
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-8 mt-2">
                        <div>
                            <h3 className="mt-0 mb-4 text-teal-800 text-xl font-semibold outfit">
                                ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§
                            </h3>
                            <div className="space-y-2">
                                {stepsData.map((step) => {
                                    const isActive = activeStep === step.step;
                                    return (
                                        <button
                                            key={step.step}
                                            type="button"
                                            className={[
                                                'w-full text-left text-[0.95rem] rounded-xl border-2 transition cursor-pointer px-4 py-4',
                                                'bg-white border-slate-200 hover:border-emerald-500 hover:translate-x-1',
                                                isActive
                                                    ? 'bg-[linear-gradient(135deg,#d1fae5,#a7f3d0)] border-emerald-500 shadow-[0_4px_12px_rgba(16,185,129,0.20)]'
                                                    : '',
                                            ].join(' ')}
                                            onClick={() => {
                                                setActiveStep(step.step);
                                                setIsPlaying(false);
                                            }}
                                        >
                                            <div
                                                className={[
                                                    'font-bold mb-1',
                                                    isActive ? 'text-emerald-900' : 'text-teal-800',
                                                ].join(' ')}
                                            >
                                                Step {step.step}: {step.title}
                                            </div>
                                            <div className="text-slate-500 text-xs mt-1 font-mono">
                                                {step.desc.substring(0, 48)}
                                                {step.desc.length > 48 ? '...' : ''}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="my-auto">
                            <div className="rounded-2xl p-6 border-2 border-emerald-200 bg-[linear-gradient(135deg,#ecfdf5,#f0f9ff)]">
                                <h3 className="mt-0 text-teal-800 text-lg font-bold outfit">
                                    Step {currentStepData.step}: {currentStepData.title}
                                </h3>
                                <p className="text-slate-600 leading-7 text-sm mt-2">
                                    {currentStepData.desc}
                                </p>
                            </div>

                            <StepVisualization visual={currentStepData.visual} />

                            <div className="flex flex-wrap justify-center gap-2 mt-4">
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 bg-[linear-gradient(135deg,#10b981,#059669)] text-sm"
                                    onClick={() => setIsPlaying(true)}
                                    disabled={isPlaying}
                                >
                                    â–¶ Play
                                </button>
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 bg-[linear-gradient(135deg,#0ea5e9,#0284c7)] text-sm"
                                    onClick={() => {
                                        setActiveStep((s) => Math.max(1, s - 1));
                                        setIsPlaying(false);
                                    }}
                                    disabled={activeStep === 1}
                                >
                                    â—€ Prev
                                </button>
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-white transition disabled:opacity-50 shadow hover:-translate-y-0.5 bg-[linear-gradient(135deg,#0ea5e9,#0284c7)] text-sm"
                                    onClick={() => {
                                        setActiveStep((s) => Math.min(stepsData.length, s + 1));
                                        setIsPlaying(false);
                                    }}
                                    disabled={activeStep === stepsData.length}
                                >
                                    Next â–¶
                                </button>
                                <button
                                    type="button"
                                    className="px-5 py-2.5 rounded-xl font-semibold text-slate-700 transition shadow hover:-translate-y-0.5 bg-white border-2 border-slate-200 text-sm"
                                    onClick={() => {
                                        setActiveStep(1);
                                        setIsPlaying(false);
                                    }}
                                >
                                    â†º Reset
                                </button>
                            </div>

                            <div className="mt-3 text-center">
                                <div className="flex justify-center gap-1">
                                    {stepsData.map((s) => (
                                        <div
                                            key={s.step}
                                            className={[
                                                'w-2 h-2 rounded-full transition',
                                                activeStep === s.step
                                                    ? 'bg-emerald-500 w-6'
                                                    : 'bg-slate-200',
                                            ].join(' ')}
                                        />
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            ReactDOM.createRoot(document.getElementById('steps-root')).render(<StepsApp />);
        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    </body>
</html>
