åˆ¶ç´„ã‚’è€ƒæ…®ã—ã¦ã€**ã‚¨ãƒ©ãƒˆã‚¹ãƒ†ãƒã‚¹ã®ç¯©**ã§ 300,000 ä»¥ä¸‹ã®ç´ æ•°ã‚’ã‚ã‚‰ã‹ã˜ã‚å…¨ã¦æ±‚ã‚ã€å„è³ªå•ã«å¯¾ã—ã¦é«˜é€Ÿã« `O(1)` ã§åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

---

### âœ… JavaScriptã‚³ãƒ¼ãƒ‰ï¼ˆNode.jsç’°å¢ƒå‘ã‘ï¼‰

```javascript
const fs = require('fs');

// æ¨™æº–å…¥åŠ›ã‚’èª­ã¿è¾¼ã¿ï¼ˆNode.jså‘ã‘ï¼‰
const input = fs.readFileSync('/dev/stdin', 'utf8').trim().split('\n');

const Q = parseInt(input[0]);
const queries = input.slice(1).map(Number);

// ===== ã‚¨ãƒ©ãƒˆã‚¹ãƒ†ãƒã‚¹ã®ç¯© =====
const MAX = 300000;
const is_prime = new Array(MAX + 1).fill(true);
is_prime[0] = is_prime[1] = false;

for (let i = 2; i * i <= MAX; i++) {
    if (is_prime[i]) {
        for (let j = i * i; j <= MAX; j += i) {
            is_prime[j] = false;
        }
    }
}

// ===== è³ªå•ã«ç­”ãˆã‚‹ =====
for (let i = 0; i < Q; i++) {
    const x = queries[i];
    console.log(is_prime[x] ? 'Yes' : 'No');
}
```

---

### ğŸ” å®Ÿè¡Œæ–¹æ³•ï¼ˆNode.jsã®å ´åˆï¼‰

1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `prime_check.js` ã¨ã—ã¦ä¿å­˜
2. å…¥åŠ›ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ¸¡ã™å ´åˆï¼š
    ```bash
    node prime_check.js < input.txt
    ```

---

### ğŸ§  ãƒã‚¤ãƒ³ãƒˆè§£èª¬

- å…¥åŠ›ã®æ•°ãŒå¤šã„ãŸã‚ã€å„å›ã§ç´ æ•°åˆ¤å®šã™ã‚‹ã®ã§ã¯ãªãã€**äº‹å‰ã« 300,000 ä»¥ä¸‹ã®ã™ã¹ã¦ã®ç´ æ•°ã‚’æ±‚ã‚ã¦ãŠã**ã®ãŒåŠ¹ç‡çš„ã§ã™ã€‚
- `is_prime[x]` ã‚’ä½¿ãˆã°ã€å„è³ªå•ã« `O(1)` ã§ç­”ãˆã‚‰ã‚Œã‚‹ã®ã§ã€**å…¨ä½“ã§ O(N + âˆšN + Q)** ã®è¨ˆç®—é‡ã§æ¸ˆã¿ã¾ã™ã€‚
- `fs.readFileSync('/dev/stdin')` ã‚’ä½¿ã£ã¦æ¨™æº–å…¥åŠ›ã‚’å—ã‘å–ã‚‹ã®ã¯ Node.js ã§ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°çš„ãªå…¥åŠ›ã«å¯¾å¿œã™ã‚‹ãŸã‚ã§ã™ã€‚

---

### âœ… å…¥åŠ›ä¾‹ã§ã®å‹•ä½œç¢ºèª

å…¥åŠ›:

```
4
17
31
35
49
```

å‡ºåŠ›:

```
Yes
Yes
No
No
```

---

ã“ã® `for` ãƒ«ãƒ¼ãƒ—ã¯ã€**ã‚¨ãƒ©ãƒˆã‚¹ãƒ†ãƒã‚¹ã®ç¯©ï¼ˆãµã‚‹ã„ï¼‰** ã®ä¸­å¿ƒçš„ãªå‡¦ç†éƒ¨åˆ†ã§ã™ã€‚  
ä»¥ä¸‹ã«ã€**ä¸€è¡Œãšã¤ä¸å¯§ã«è§£èª¬**ã—ã¾ã™ã€‚

---

### ğŸ‘‡ å¯¾è±¡ã‚³ãƒ¼ãƒ‰ï¼š

```javascript
for (let i = 2; i * i <= MAX; i++) {
    if (is_prime[i]) {
        for (let j = i * i; j <= MAX; j += i) {
            is_prime[j] = false;
        }
    }
}
```

---

### ğŸ” è¡Œã”ã¨ã®èª¬æ˜

#### `for (let i = 2; i * i <= MAX; i++)`

- `i` ã¯ç¾åœ¨ã®ã€Œå€™è£œã¨ãªã‚‹ç´ æ•°ã€ã‚’è¡¨ã—ã¾ã™ã€‚
- ãƒ«ãƒ¼ãƒ—ã®ä¸Šé™ãŒ `i * i <= MAX` ãªã®ã¯ã€ä¾‹ãˆã° `MAX = 100` ãªã‚‰ã€10ã¾ã§èª¿ã¹ã‚Œã°ååˆ†ã ã‹ã‚‰ã§ã™ã€‚
    - ãªãœãªã‚‰ã€ãã‚Œä»¥ä¸Šã® `i` ã«å¯¾ã—ã¦ã¯ã€`i * i > MAX` ã¨ãªã‚Šã€ãã‚Œä»¥ä¸‹ã®å€æ•°ã¯ã™ã§ã«å‰ã®ãƒ«ãƒ¼ãƒ—ã§é™¤å»æ¸ˆã¿ã§ã™ã€‚

---

#### `if (is_prime[i])`

- ç¾åœ¨ã® `i` ãŒã¾ã ç´ æ•°ã¨åˆ¤å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚
- `i` ãŒã™ã§ã«ä»–ã®ç´ æ•°ã§å‰²ã‚Šåˆ‡ã‚Œã‚‹ï¼ˆï¼ç´ æ•°ã˜ã‚ƒãªã„ï¼‰ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—ã€‚

---

#### `for (let j = i * i; j <= MAX; j += i)`

- `i` ã®å€æ•°ã§ã‚ã‚‹ `j` ã‚’é †ã«è¦‹ã¦ã„ãã¾ã™ã€‚
- é–‹å§‹ãŒ `i * i` ã«ãªã£ã¦ã„ã‚‹ã®ã¯ã€`i * 2`, `i * 3`, ..., `i * (i - 1)` ã¯**ã™ã§ã«ãã‚Œã‚ˆã‚Šå°ã•ã„ç´ æ•°ã§æ¶ˆã•ã‚Œã¦ã„ã‚‹**ãŸã‚ã€ã“ã“ã‹ã‚‰å§‹ã‚ã‚Œã°ååˆ†ã ã‹ã‚‰ã§ã™ã€‚
    - ãŸã¨ãˆã° `i = 5` ã®ã¨ãã€`5 * 2 = 10` ã‚„ `5 * 3 = 15` ã¯ `i = 2` ã‚„ `i = 3` ã®æ™‚ç‚¹ã§ `false` ã«ã•ã‚Œã¦ã„ã‚‹ã€‚

---

#### `is_prime[j] = false;`

- `j` ã¯ `i` ã®å€æ•°ãªã®ã§ã€ç´ æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`false` ã«è¨­å®šã—ã¾ã™ã€‚
- ã“ã‚Œã«ã‚ˆã‚Šã€æœ€çµ‚çš„ã« `is_prime[x] === true` ã¨ãªã‚‹ `x` ã¯ **ç´ æ•°**ã ã‘ã«ãªã‚Šã¾ã™ã€‚

---

### âœ… ã“ã®ãƒ«ãƒ¼ãƒ—ã®åŠ¹æœ

ã“ã®ãƒ«ãƒ¼ãƒ—ã‚’é€šã™ã“ã¨ã§ã€`is_prime[0..MAX]` ã«ã€Œç´ æ•°ã‹ã©ã†ã‹ã®çœŸå½å€¤ã€ãŒã™ã¹ã¦æ­£ã—ãè¨­å®šã•ã‚Œã¾ã™ã€‚  
æ™‚é–“è¨ˆç®—é‡ã¯ãŠãŠã‚ˆã **O(N log log N)** ã¨éå¸¸ã«é«˜é€Ÿã§ã€Q=10,000ãƒ»Xâ‰¤300,000 ã®ã‚ˆã†ãªå¤§è¦æ¨¡ãªå•é¡Œã«ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚

---

### ğŸ“Œ ã¾ã¨ã‚

| å¤‰æ•°          | æ„å‘³                                        |
| ------------- | ------------------------------------------- |
| `i`           | ç´ æ•°ã®å€™è£œï¼ˆ2ã‹ã‚‰âˆšMAXã¾ã§ï¼‰                 |
| `j`           | `i` ã®å€æ•°ï¼ˆåˆæˆæ•°ï¼‰                        |
| `is_prime[x]` | x ãŒç´ æ•°ãªã‚‰ `true`ã€ãã†ã§ãªã‘ã‚Œã° `false` |

---

---

## âœ… 1. ãƒ•ã‚§ãƒ«ãƒãƒ¼ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹ç´ æ•°åˆ¤å®šï¼ˆa = 2 å›ºå®šï¼‰

### ğŸ” æ‰‹é †ã®è¦ç‚¹

- N ãŒ 1 ã‚ˆã‚Šå¤§ããã€ã‹ã¤ `a^(N-1) â‰¡ 1 (mod N)` ã§ã‚ã‚Œã°ã€N ã¯ç´ æ•°ã®å¯èƒ½æ€§ãŒé«˜ã„
- a ã¯å›ºå®šã§ `2`
- ç°¡æ˜“çš„ãªãƒ•ã‚§ãƒ«ãƒãƒ¼ãƒ†ã‚¹ãƒˆãªã®ã§ **æ“¬ç´ æ•°**ã‚’ç´ æ•°ã¨èª¤èªã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆä¾‹ï¼šã‚«ãƒ¼ãƒã‚¤ã‚±ãƒ«æ•°ï¼‰

---

### âœ… ãƒ•ã‚§ãƒ«ãƒãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆPHPï¼‰

```php
<?php
function fermat_test($n) {
    if ($n <= 1) return false;
    if ($n == 2) return true;
    if ($n % 2 == 0) return false;

    $a = 2;
    $res = mod_pow($a, $n - 1, $n);
    return $res === 1;
}

// é«˜é€Ÿç´¯ä¹—ï¼ˆç¹°ã‚Šè¿”ã—äºŒä¹—æ³•ï¼‰
function mod_pow($base, $exp, $mod) {
    $result = 1;
    while ($exp > 0) {
        if ($exp % 2 === 1) {
            $result = ($result * $base) % $mod;
        }
        $base = ($base * $base) % $mod;
        $exp = intdiv($exp, 2);
    }
    return $result;
}

// å…¥åŠ›å‡¦ç†
$Q = (int)trim(fgets(STDIN));
for ($i = 0; $i < $Q; $i++) {
    $x = (int)trim(fgets(STDIN));
    echo fermat_test($x) ? "Yes\n" : "No\n";
}
```

---

## âœ… 2. ãƒŸãƒ©ãƒ¼ãƒ»ãƒ©ãƒ“ãƒ³ç´ æ•°åˆ¤å®šæ³•ï¼ˆã‚ˆã‚Šé«˜ç²¾åº¦ãªãƒ†ã‚¹ãƒˆï¼‰

### ğŸ” ç‰¹å¾´

- ãƒ•ã‚§ãƒ«ãƒãƒ¼ãƒ†ã‚¹ãƒˆã‚’æ”¹è‰¯ã—ã€**ã‚«ãƒ¼ãƒã‚¤ã‚±ãƒ«æ•°**ã®èª¤åˆ¤å®šã‚‚å›é¿å¯èƒ½
- ä¸€èˆ¬ã« `a` ã‚’è¤‡æ•°ä½¿ã†ã“ã¨ã§ç²¾åº¦ã‚’é«˜ã‚ã¾ã™ï¼ˆã“ã“ã§ã¯ 2, 3, 5 ã‚’ä½¿ã†ï¼‰

---

### âœ… ãƒŸãƒ©ãƒ¼ãƒ»ãƒ©ãƒ“ãƒ³æ³• å®Ÿè£…ï¼ˆPHPï¼‰

```php
<?php
function is_prime_miller_rabin($n) {
    if ($n < 2) return false;
    if ($n === 2 || $n === 3) return true;
    if ($n % 2 === 0) return false;

    $d = $n - 1;
    $s = 0;
    while ($d % 2 === 0) {
        $d /= 2;
        $s++;
    }

    // ä»»æ„ã®åŸºæ•° aï¼ˆå°ã•ã„å€¤ã§ååˆ†ï¼‰
    $bases = [2, 3, 5];
    foreach ($bases as $a) {
        if ($a >= $n) continue;

        $x = mod_pow($a, $d, $n);
        if ($x == 1 || $x == $n - 1) continue;

        $is_composite = true;
        for ($r = 1; $r < $s; $r++) {
            $x = mod_pow($x, 2, $n);
            if ($x == $n - 1) {
                $is_composite = false;
                break;
            }
        }

        if ($is_composite) return false;
    }

    return true;
}

// ç¹°ã‚Šè¿”ã—äºŒä¹—æ³•
function mod_pow($base, $exp, $mod) {
    $result = 1;
    while ($exp > 0) {
        if ($exp % 2 === 1) {
            $result = ($result * $base) % $mod;
        }
        $base = ($base * $base) % $mod;
        $exp = intdiv($exp, 2);
    }
    return $result;
}

// å…¥åŠ›å‡¦ç†
$Q = (int)trim(fgets(STDIN));
for ($i = 0; $i < $Q; $i++) {
    $x = (int)trim(fgets(STDIN));
    echo is_prime_miller_rabin($x) ? "Yes\n" : "No\n";
}
```

---

## âœ… ç²¾åº¦ã¨ç”¨é€”ã®é•ã„

| åˆ¤å®šæ–¹æ³•           | ç²¾åº¦                   | å®Ÿè¡Œé€Ÿåº¦         | èª¬æ˜                               |
| ------------------ | ---------------------- | ---------------- | ---------------------------------- |
| ã‚¨ãƒ©ãƒˆã‚¹ãƒ†ãƒã‚¹ã®ç¯© | å®Œå…¨                   | é«˜é€Ÿï¼ˆO(1)åˆ¤å®šï¼‰ | äº‹å‰å‡¦ç†ã¯å¿…è¦ã ãŒæœ€é€Ÿãƒ»ç¢ºå®Ÿ       |
| ãƒ•ã‚§ãƒ«ãƒãƒ¼ãƒ†ã‚¹ãƒˆ   | ä¸­ï¼ˆæ“¬ç´ æ•°ã«å¼±ã„ï¼‰     | æ—©ã„             | ç°¡å˜ãªé«˜é€Ÿåˆ¤å®šã€èª¤åˆ¤å®šã®å¯èƒ½æ€§ã‚ã‚Š |
| ãƒŸãƒ©ãƒ¼ãƒ»ãƒ©ãƒ“ãƒ³æ³•   | é«˜ï¼ˆæ“¬ä¼¼ç´ æ•°ã«ã‚‚å¼·ã„ï¼‰ | å°‘ã—é…ã„         | æš—å·ãªã©ã§ã‚‚ä½¿ã‚ã‚Œã‚‹é«˜ç²¾åº¦æ‰‹æ³•     |

---
