<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>é›¨æ°´ãƒˆãƒ©ãƒƒãƒ—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #333;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 30px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .section {
                margin: 30px 0;
                padding: 25px;
                background: linear-gradient(145deg, #f8f9ff, #e6f3ff);
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                border-left: 5px solid #3498db;
            }

            .chart-container {
                background: white;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
                position: relative;
                overflow: hidden;
            }

            .chart-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12, #e74c3c);
            }

            .bar {
                display: inline-block;
                margin: 2px;
                position: relative;
                vertical-align: bottom;
                border-radius: 4px 4px 0 0;
                transition: all 0.3s ease;
            }

            .bar:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            .height-bar {
                background: linear-gradient(135deg, #34495e, #2c3e50);
            }

            .water {
                background: linear-gradient(135deg, #3498db, #2980b9);
                opacity: 0.8;
                animation: wave 2s ease-in-out infinite;
            }

            @keyframes wave {

                0%,
                100% {
                    opacity: 0.8;
                }

                50% {
                    opacity: 0.6;
                }
            }

            .pointer {
                position: absolute;
                bottom: -30px;
                transform: translateX(-50%);
                font-weight: bold;
                padding: 5px 10px;
                border-radius: 15px;
                font-size: 12px;
            }

            .left-pointer {
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white;
            }

            .right-pointer {
                background: linear-gradient(135deg, #2ecc71, #27ae60);
                color: white;
            }

            .values {
                margin: 20px 0;
                padding: 15px;
                background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
                border-radius: 10px;
                font-family: 'Courier New', monospace;
            }

            .step-info {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin: 20px 0;
            }

            .info-card {
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                color: white;
                font-weight: bold;
                transition: transform 0.3s ease;
            }

            .info-card:hover {
                transform: scale(1.05);
            }

            .left-info {
                background: linear-gradient(135deg, #e74c3c, #c0392b);
            }

            .right-info {
                background: linear-gradient(135deg, #2ecc71, #27ae60);
            }

            .water-info {
                background: linear-gradient(135deg, #3498db, #2980b9);
            }

            .controls {
                text-align: center;
                margin: 20px 0;
            }

            button {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 12px 25px;
                margin: 5px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 14px;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

            button:active {
                transform: translateY(0);
            }

            .algorithm-explanation {
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                border-radius: 15px;
                padding: 25px;
                margin: 20px 0;
                border-left: 5px solid #6c5ce7;
            }

            .complexity {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin: 20px 0;
            }

            .complexity-card {
                padding: 20px;
                border-radius: 15px;
                text-align: center;
                color: white;
                font-size: 1.2em;
            }

            .time-complexity {
                background: linear-gradient(135deg, #fd79a8, #e84393);
            }

            .space-complexity {
                background: linear-gradient(135deg, #00b894, #00a085);
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>ğŸŒ§ï¸ é›¨æ°´ãƒˆãƒ©ãƒƒãƒ—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</h1>

            <div class="section">
                <h2>ğŸ“Š ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å¯è¦–åŒ–</h2>
                <div class="chart-container" id="chart">
                    <!-- ã“ã“ã«å‹•çš„ã«ãƒãƒ£ãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
                <div class="controls">
                    <button onclick="resetAnimation()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                    <button onclick="nextStep()">â¡ï¸ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</button>
                    <button onclick="runFullAnimation()">ğŸ¬ å…¨ä½“å®Ÿè¡Œ</button>
                    <button onclick="changeExample()">ğŸ“ ä¾‹ã‚’å¤‰æ›´</button>
                </div>
                <div class="step-info">
                    <div class="info-card left-info">
                        <div>å·¦ãƒã‚¤ãƒ³ã‚¿</div>
                        <div id="leftPos">0</div>
                    </div>
                    <div class="info-card right-info">
                        <div>å³ãƒã‚¤ãƒ³ã‚¿</div>
                        <div id="rightPos">11</div>
                    </div>
                    <div class="info-card water-info">
                        <div>ç´¯ç©æ°´é‡</div>
                        <div id="waterTotal">0</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ“ˆ ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—è§£æ</h2>
                <div id="stepDetails">
                    <!-- ã“ã“ã«å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
Ã
            <div class="section">
                <h2>ğŸ§® ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è©³ç´°</h2>
                <div class="algorithm-explanation">
                    <h3>Two Pointer Approach ã®åŸç†</h3>
                    <p><strong>æ ¸å¿ƒæ¦‚å¿µ:</strong> å„ä½ç½®ã§æ°´ãŒãƒˆãƒ©ãƒƒãƒ—ã§ãã‚‹é‡ã¯ã€ãã®ä½ç½®ã®å·¦å´ã¨å³å´ã®æœ€å¤§é«˜åº¦ã®æœ€å°å€¤ã‹ã‚‰ç¾åœ¨ã®é«˜åº¦ã‚’å¼•ã„ãŸå€¤ã§ã™ã€‚</p>

                    <h4>ğŸ” å‡¦ç†ã®æµã‚Œ</h4>
                    <ol>
                        <li><strong>åˆæœŸåŒ–:</strong> å·¦å³ã®ãƒã‚¤ãƒ³ã‚¿ã‚’é…åˆ—ã®ä¸¡ç«¯ã«è¨­ç½®</li>
                        <li><strong>æ¯”è¼ƒ:</strong> å·¦å³ã®é«˜åº¦ã‚’æ¯”è¼ƒã—ã€ä½ã„æ–¹ã‚’å‡¦ç†å¯¾è±¡ã¨ã™ã‚‹</li>
                        <li><strong>æ›´æ–°:</strong> æœ€å¤§é«˜åº¦ã‚’æ›´æ–°ã™ã‚‹ã‹ã€æ°´é‡ã‚’è¨ˆç®—ã—ã¦åŠ ç®—</li>
                        <li><strong>ç§»å‹•:</strong> å‡¦ç†ã—ãŸãƒã‚¤ãƒ³ã‚¿ã‚’ä¸­å¤®ã«å‘ã‹ã£ã¦ç§»å‹•</li>
                        <li><strong>çµ‚äº†:</strong> å·¦å³ã®ãƒã‚¤ãƒ³ã‚¿ãŒäº¤å·®ã™ã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—</li>
                    </ol>

                    <h4>ğŸ’¡ ãªãœã“ã®æ–¹æ³•ãŒæ­£ã—ã„ã®ã‹ï¼Ÿ</h4>
                    <p>ä½ã„æ–¹ã®æœ€å¤§é«˜åº¦ã‚’åŸºæº–ã«ã™ã‚‹ã“ã¨ã§ã€ç¢ºå®Ÿã«æ°´ãŒãƒˆãƒ©ãƒƒãƒ—ã§ãã‚‹é‡ã‚’è¨ˆç®—ã§ãã¾ã™ã€‚é«˜ã„æ–¹ã®å´ã«ã¯å¿…ãšãã‚Œä»¥ä¸Šã®é«˜åº¦ãŒã‚ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä½ã„æ–¹ã®åˆ¶ç´„ãŒæ±ºå®šçš„ã«ãªã‚Šã¾ã™ã€‚</p>
                </div>
            </div>

            <div class="section">
                <h2>âš¡ è¨ˆç®—é‡è§£æ</h2>
                <div class="complexity">
                    <div class="complexity-card time-complexity">
                        <div>æ™‚é–“è¨ˆç®—é‡</div>
                        <div><strong>O(n)</strong></div>
                        <small>é…åˆ—ã‚’ä¸€åº¦ã ã‘èµ°æŸ»</small>
                    </div>
                    <div class="complexity-card space-complexity">
                        <div>ç©ºé–“è¨ˆç®—é‡</div>
                        <div><strong>O(1)</strong></div>
                        <small>å®šæ•°å€‹ã®å¤‰æ•°ã®ã¿</small>
                    </div>
                </div>

                <div class="algorithm-explanation">
                    <h3>ğŸ¯ æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
                    <ul>
                        <li><strong>å˜ä¸€ãƒ‘ã‚¹:</strong> é…åˆ—ã‚’ä¸€åº¦ã ã‘èµ°æŸ»ã™ã‚‹ã“ã¨ã§æœ€å°ã®æ™‚é–“è¨ˆç®—é‡ã‚’å®Ÿç¾</li>
                        <li><strong>å®šæ•°ç©ºé–“:</strong> è¿½åŠ ã®é…åˆ—ã‚’ä½¿ã‚ãšã€æ•°å€‹ã®å¤‰æ•°ã®ã¿ã§è§£æ±º</li>
                        <li><strong>æ—©æœŸçµ‚äº†:</strong> ç„¡é§„ãªè¨ˆç®—ã‚’é¿ã‘ã€åŠ¹ç‡çš„ãªå‡¦ç†</li>
                        <li><strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡:</strong> ç·šå½¢ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§CPUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨</li>
                    </ul>
                </div>
            </div>
        </div>

        <script>
            let examples = [
                {
                    name: "ä¾‹1: åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³",
                    data: [0, 1, 0, 2, 1, 0, 1, 3, 2, 1, 2, 1],
                    expected: 6
                },
                {
                    name: "ä¾‹2: è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³",
                    data: [4, 2, 0, 3, 2, 5],
                    expected: 9
                },
                {
                    name: "ä¾‹3: å˜èª¿å¢—åŠ ",
                    data: [1, 2, 3, 4, 5],
                    expected: 0
                },
                {
                    name: "ä¾‹4: å˜èª¿æ¸›å°‘",
                    data: [5, 4, 3, 2, 1],
                    expected: 0
                }
            ];

            let currentExample = 0;
            let currentStep = 0;
            let animationSteps = [];
            let isAnimating = false;

            function generateSteps(height) {
                let steps = [];
                let left = 0;
                let right = height.length - 1;
                let leftMax = 0;
                let rightMax = 0;
                let water = 0;
                let processedWater = new Array(height.length).fill(0);

                steps.push({
                    left, right, leftMax, rightMax, water,
                    processedWater: [...processedWater],
                    action: "ğŸš€ åˆæœŸåŒ–",
                    description: `é…åˆ—ã®ä¸¡ç«¯ã«ãƒã‚¤ãƒ³ã‚¿ã‚’è¨­ç½®`,
                    detail: `å·¦ãƒã‚¤ãƒ³ã‚¿(L) = ${left}, å³ãƒã‚¤ãƒ³ã‚¿(R) = ${right}`,
                    explanation: "Two Pointerã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®é–‹å§‹ç‚¹ã§ã™ã€‚å·¦å³ã‹ã‚‰åŒæ™‚ã«å‡¦ç†ã™ã‚‹ã“ã¨ã§åŠ¹ç‡çš„ã«è§£ã‚’æ±‚ã‚ã¾ã™ã€‚"
                });

                while (left < right) {
                    if (height[left] < height[right]) {
                        // å·¦å´ã‚’å‡¦ç†
                        if (height[left] >= leftMax) {
                            leftMax = height[left];
                            steps.push({
                                left, right, leftMax, rightMax, water,
                                processedWater: [...processedWater],
                                action: "ğŸ“ˆ å·¦å´æœ€å¤§å€¤æ›´æ–°",
                                description: `ä½ç½®${left}ã§å·¦å´æœ€å¤§é«˜åº¦ã‚’æ›´æ–°`,
                                detail: `height[${left}] = ${height[left]} â‰¥ leftMax(${leftMax - height[left] || 0}) â†’ leftMax = ${leftMax}`,
                                explanation: `ç¾åœ¨ã®é«˜åº¦ãŒå·¦å´ã®æœ€å¤§å€¤ä»¥ä¸Šãªã®ã§ã€å·¦å´æœ€å¤§å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã“ã®ä½ç½®ã§ã¯æ°´ã¯ãƒˆãƒ©ãƒƒãƒ—ã•ã‚Œã¾ã›ã‚“ã€‚`
                            });
                        } else {
                            let trapped = leftMax - height[left];
                            water += trapped;
                            processedWater[left] = trapped;
                            steps.push({
                                left, right, leftMax, rightMax, water,
                                processedWater: [...processedWater],
                                action: "ğŸ’§ å·¦å´ã§æ°´ã‚’ãƒˆãƒ©ãƒƒãƒ—",
                                description: `ä½ç½®${left}ã§${trapped}å˜ä½ã®æ°´ã‚’ãƒˆãƒ©ãƒƒãƒ—`,
                                detail: `leftMax(${leftMax}) - height[${left}](${height[left]}) = ${trapped}å˜ä½`,
                                explanation: `å·¦å´æœ€å¤§å€¤ã®æ–¹ãŒç¾åœ¨ã®é«˜åº¦ã‚ˆã‚Šé«˜ã„ãŸã‚ã€ãã®å·®åˆ†ã ã‘æ°´ãŒãƒˆãƒ©ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚å³å´ã«ã¯å¿…ãšleftMaxä»¥ä¸Šã®é«˜ã•ãŒã‚ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã¾ã™ã€‚`
                            });
                        }
                        left++;
                    } else {
                        // å³å´ã‚’å‡¦ç†
                        if (height[right] >= rightMax) {
                            rightMax = height[right];
                            steps.push({
                                left, right, leftMax, rightMax, water,
                                processedWater: [...processedWater],
                                action: "ğŸ“ˆ å³å´æœ€å¤§å€¤æ›´æ–°",
                                description: `ä½ç½®${right}ã§å³å´æœ€å¤§é«˜åº¦ã‚’æ›´æ–°`,
                                detail: `height[${right}] = ${height[right]} â‰¥ rightMax(${rightMax - height[right] || 0}) â†’ rightMax = ${rightMax}`,
                                explanation: `ç¾åœ¨ã®é«˜åº¦ãŒå³å´ã®æœ€å¤§å€¤ä»¥ä¸Šãªã®ã§ã€å³å´æœ€å¤§å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã“ã®ä½ç½®ã§ã¯æ°´ã¯ãƒˆãƒ©ãƒƒãƒ—ã•ã‚Œã¾ã›ã‚“ã€‚`
                            });
                        } else {
                            let trapped = rightMax - height[right];
                            water += trapped;
                            processedWater[right] = trapped;
                            steps.push({
                                left, right, leftMax, rightMax, water,
                                processedWater: [...processedWater],
                                action: "ğŸ’§ å³å´ã§æ°´ã‚’ãƒˆãƒ©ãƒƒãƒ—",
                                description: `ä½ç½®${right}ã§${trapped}å˜ä½ã®æ°´ã‚’ãƒˆãƒ©ãƒƒãƒ—`,
                                detail: `rightMax(${rightMax}) - height[${right}](${height[right]}) = ${trapped}å˜ä½`,
                                explanation: `å³å´æœ€å¤§å€¤ã®æ–¹ãŒç¾åœ¨ã®é«˜åº¦ã‚ˆã‚Šé«˜ã„ãŸã‚ã€ãã®å·®åˆ†ã ã‘æ°´ãŒãƒˆãƒ©ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚å·¦å´ã«ã¯å¿…ãšrightMaxä»¥ä¸Šã®é«˜ã•ãŒã‚ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã¾ã™ã€‚`
                            });
                        }
                        right--;
                    }
                }

                steps.push({
                    left, right, leftMax, rightMax, water,
                    processedWater: [...processedWater],
                    action: "âœ… å®Œäº†",
                    description: `ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Œäº†ï¼ç·æ°´é‡: ${water}å˜ä½`,
                    detail: `å·¦å³ã®ãƒã‚¤ãƒ³ã‚¿ãŒäº¤å·®(L=${left}, R=${right})ã—ãŸãŸã‚å‡¦ç†çµ‚äº†`,
                    explanation: `å…¨ã¦ã®ä½ç½®ã‚’å‡¦ç†ã—çµ‚ã‚ã‚Šã¾ã—ãŸã€‚æœ€çµ‚çš„ã«${water}å˜ä½ã®é›¨æ°´ãŒãƒˆãƒ©ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸã€‚`
                });

                return steps;
            }

            function renderChart(step = null) {
                const chart = document.getElementById('chart');
                const height = examples[currentExample].data;
                const maxHeight = Math.max(...height);
                const barWidth = Math.max(30, Math.min(60, 700 / height.length));

                let html = '<div style="position: relative; display: flex; align-items: end; justify-content: center; height: ' + (maxHeight * 25 + 80) + 'px; padding: 20px 0;">';

                // æ°´ã®é«˜ã•ã‚’äº‹å‰è¨ˆç®—
                let waterHeights = new Array(height.length).fill(0);
                if (step) {
                    for (let i = 0; i < height.length; i++) {
                        if (step.processedWater && step.processedWater[i] !== undefined) {
                            waterHeights[i] = step.processedWater[i];
                        }
                    }
                }

                for (let i = 0; i < height.length; i++) {
                    const barHeight = height[i] * 25;
                    const waterHeight = waterHeights[i] * 25;

                    // ç¾åœ¨å‡¦ç†ä¸­ã®ä½ç½®ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    let highlightClass = '';
                    if (step && (i === step.left || i === step.right)) {
                        highlightClass = 'style="box-shadow: 0 0 15px rgba(255, 193, 7, 0.8);"';
                    }

                    html += `
                    <div style="position: relative; margin: 0 2px; display: flex; flex-direction: column; align-items: center;">
                        <div style="position: absolute; top: -25px; font-size: 11px; color: #666; font-weight: bold;">${height[i]}</div>
                        <div class="bar height-bar" ${highlightClass} style="width: ${barWidth}px; height: ${barHeight}px; position: relative; z-index: 1;"></div>
                        ${waterHeight > 0 ? `<div class="bar water" style="position: absolute; bottom: 20px; width: ${barWidth}px; height: ${waterHeight}px; z-index: 2;"></div>` : ''}
                        <div style="position: absolute; bottom: -15px; font-size: 10px; font-weight: bold; color: #333;">${i}</div>
                `;

                    if (step && i === step.left && step.left <= step.right) {
                        html += `<div class="pointer left-pointer" style="bottom: -50px;">L:${step.left}</div>`;
                    }
                    if (step && i === step.right && step.left <= step.right) {
                        html += `<div class="pointer right-pointer" style="bottom: -50px;">R:${step.right}</div>`;
                    }

                    html += '</div>';
                }

                html += '</div>';
                chart.innerHTML = html;

                // å€¤ã®æ›´æ–°
                if (step) {
                    document.getElementById('leftPos').textContent = step.left;
                    document.getElementById('rightPos').textContent = step.right;
                    document.getElementById('waterTotal').textContent = step.water;

                    // ã‚¹ãƒ†ãƒƒãƒ—è©³ç´°ã®æ›´æ–°
                    updateStepDetails(step, currentStep);
                }
            }

            function updateStepDetails(step, stepIndex) {
                const stepDetails = document.getElementById('stepDetails');
                const height = examples[currentExample].data;

                // ç¾åœ¨ã®é…åˆ—çŠ¶æ…‹ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
                let arrayDisplay = '';
                for (let i = 0; i < height.length; i++) {
                    let cellStyle = 'padding: 8px; border: 2px solid #ddd; margin: 2px; display: inline-block; min-width: 30px; text-align: center; border-radius: 5px;';

                    if (i === step.left && step.left <= step.right) {
                        cellStyle += 'background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; font-weight: bold;';
                    } else if (i === step.right && step.left <= step.right) {
                        cellStyle += 'background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; font-weight: bold;';
                    } else if (step.processedWater && step.processedWater[i] > 0) {
                        cellStyle += 'background: linear-gradient(135deg, #3498db, #2980b9); color: white;';
                    } else {
                        cellStyle += 'background: #f8f9fa;';
                    }

                    arrayDisplay += `<span style="${cellStyle}">${height[i]}</span>`;
                }

                // æ°´ã®é‡ã®è¡¨ç¤º
                let waterDisplay = '';
                if (step.processedWater) {
                    for (let i = 0; i < height.length; i++) {
                        let cellStyle = 'padding: 8px; border: 2px solid #ddd; margin: 2px; display: inline-block; min-width: 30px; text-align: center; border-radius: 5px;';

                        if (step.processedWater[i] > 0) {
                            cellStyle += 'background: linear-gradient(135deg, #3498db, #2980b9); color: white; font-weight: bold;';
                            waterDisplay += `<span style="${cellStyle}">${step.processedWater[i]}</span>`;
                        } else {
                            cellStyle += 'background: #ecf0f1; color: #95a5a6;';
                            waterDisplay += `<span style="${cellStyle}">0</span>`;
                        }
                    }
                }

                stepDetails.innerHTML = `
                <div class="algorithm-explanation">
                    <h3>ã‚¹ãƒ†ãƒƒãƒ— ${stepIndex + 1}: ${step.action}</h3>
                    <p><strong>ğŸ¯ å‡¦ç†å†…å®¹:</strong> ${step.description}</p>
                    <p><strong>ğŸ“Š è©³ç´°:</strong> ${step.detail}</p>
                    <p><strong>ğŸ’¡ è§£èª¬:</strong> ${step.explanation}</p>
                    
                    <div style="margin: 20px 0;">
                        <h4>ğŸ“‹ é…åˆ—ã®çŠ¶æ…‹</h4>
                        <div style="margin: 10px 0;">
                            <strong>é«˜åº¦:</strong><br>
                            ${arrayDisplay}
                        </div>
                        <div style="margin: 10px 0;">
                            <strong>æ°´é‡:</strong><br>
                            ${waterDisplay}
                        </div>
                    </div>
                    
                    <div class="values">
                        <strong>ğŸ“ˆ ç¾åœ¨ã®å¤‰æ•°çŠ¶æ…‹:</strong><br>
                        ğŸ”´ Left = ${step.left} (${step.left < height.length ? `é«˜åº¦: ${height[step.left]}` : 'ç¯„å›²å¤–'})<br>
                        ğŸŸ¢ Right = ${step.right} (${step.right >= 0 ? `é«˜åº¦: ${height[step.right]}` : 'ç¯„å›²å¤–'})<br>
                        ğŸ“Š LeftMax = ${step.leftMax}<br>
                        ğŸ“Š RightMax = ${step.rightMax}<br>
                        ğŸ’§ ç´¯ç©æ°´é‡ = ${step.water} å˜ä½
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #f39c12;">
                        <strong>ğŸ¤” ãªãœã“ã®å‡¦ç†ï¼Ÿ</strong><br>
                        ${getStepRationale(step, height)}
                    </div>
                </div>
            `;
            }

            function getStepRationale(step, height) {
                if (step.action.includes('åˆæœŸåŒ–')) {
                    return 'Two Pointerã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã¯ã€é…åˆ—ã®ä¸¡ç«¯ã‹ã‚‰åŒæ™‚ã«å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š O(n) ã®æ™‚é–“è¨ˆç®—é‡ã§è§£ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚';
                } else if (step.action.includes('å·¦å´æœ€å¤§å€¤æ›´æ–°')) {
                    return `å·¦å´ã®ç¾åœ¨ä½ç½®ã®é«˜åº¦(${height[step.left]})ãŒã€ã“ã‚Œã¾ã§ã®å·¦å´æœ€å¤§å€¤ä»¥ä¸Šãªã®ã§ã€æœ€å¤§å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚å£ãŒé«˜ããªã£ãŸã®ã§ã€æ°´ã¯ã“ã“ã§ã¯æºœã¾ã‚Šã¾ã›ã‚“ã€‚`;
                } else if (step.action.includes('å³å´æœ€å¤§å€¤æ›´æ–°')) {
                    return `å³å´ã®ç¾åœ¨ä½ç½®ã®é«˜åº¦(${height[step.right]})ãŒã€ã“ã‚Œã¾ã§ã®å³å´æœ€å¤§å€¤ä»¥ä¸Šãªã®ã§ã€æœ€å¤§å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚å£ãŒé«˜ããªã£ãŸã®ã§ã€æ°´ã¯ã“ã“ã§ã¯æºœã¾ã‚Šã¾ã›ã‚“ã€‚`;
                } else if (step.action.includes('å·¦å´ã§æ°´ã‚’ãƒˆãƒ©ãƒƒãƒ—')) {
                    return `å·¦å´ã®é«˜åº¦(${height[step.left]})ãŒå·¦å´æœ€å¤§å€¤(${step.leftMax})ã‚ˆã‚Šä½ã„ãŸã‚ã€å·®åˆ†ã®æ°´ãŒãƒˆãƒ©ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚å³å´ã«ã¯ã‚ˆã‚Šé«˜ã„å£ãŒã‚ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ç¢ºå®Ÿã«æ°´ãŒæºœã¾ã‚Šã¾ã™ã€‚`;
                } else if (step.action.includes('å³å´ã§æ°´ã‚’ãƒˆãƒ©ãƒƒãƒ—')) {
                    return `å³å´ã®é«˜åº¦(${height[step.right]})ãŒå³å´æœ€å¤§å€¤(${step.rightMax})ã‚ˆã‚Šä½ã„ãŸã‚ã€å·®åˆ†ã®æ°´ãŒãƒˆãƒ©ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚å·¦å´ã«ã¯ã‚ˆã‚Šé«˜ã„å£ãŒã‚ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ç¢ºå®Ÿã«æ°´ãŒæºœã¾ã‚Šã¾ã™ã€‚`;
                } else if (step.action.includes('å®Œäº†')) {
                    return `å·¦å³ã®ãƒã‚¤ãƒ³ã‚¿ãŒäº¤å·®ã—ãŸãŸã‚ã€å…¨ã¦ã®ä½ç½®ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚å„ä½ç½®ã§ç¢ºå®Ÿã«ãƒˆãƒ©ãƒƒãƒ—ã§ãã‚‹æ°´ã®é‡ã‚’ç´¯ç©ã—ãŸçµæœãŒæœ€çµ‚ç­”ãˆã§ã™ã€‚`;
                }
                return '';
            }

            function resetAnimation() {
                currentStep = 0;
                animationSteps = generateSteps(examples[currentExample].data);
                renderChart(animationSteps[0]);
                isAnimating = false;
            }

            function nextStep() {
                if (currentStep < animationSteps.length - 1) {
                    currentStep++;
                    renderChart(animationSteps[currentStep]);
                }
            }

            function runFullAnimation() {
                if (isAnimating) return;
                isAnimating = true;

                let step = 0;
                const interval = setInterval(() => {
                    renderChart(animationSteps[step]);
                    step++;

                    if (step >= animationSteps.length) {
                        clearInterval(interval);
                        isAnimating = false;
                    }
                }, 1000);
            }

            function changeExample() {
                currentExample = (currentExample + 1) % examples.length;
                currentStep = 0;
                animationSteps = generateSteps(examples[currentExample].data);
                renderChart(animationSteps[0]);

                // ä¾‹ã®æƒ…å ±ã‚’æ›´æ–°
                updateExampleInfo();
            }

            function updateExampleInfo() {
                const chart = document.getElementById('chart');

                // æ—¢å­˜ã®ä¾‹æƒ…å ±ã‚’å‰Šé™¤
                const existingInfo = chart.parentNode.querySelector('.example-info');
                if (existingInfo) {
                    existingInfo.remove();
                }

                // æ–°ã—ã„ä¾‹æƒ…å ±ã‚’è¡¨ç¤º
                const exampleInfo = document.createElement('div');
                exampleInfo.className = 'values example-info';
                exampleInfo.style.marginBottom = '20px';
                exampleInfo.innerHTML = `
                <strong>${examples[currentExample].name}</strong><br>
                ğŸ“Š é…åˆ—: [${examples[currentExample].data.join(', ')}]<br>
                ğŸ¯ æœŸå¾…å€¤: ${examples[currentExample].expected}å˜ä½<br>
                ğŸ“ é…åˆ—é•·: ${examples[currentExample].data.length}
            `;
                chart.parentNode.insertBefore(exampleInfo, chart);
            }

            // åˆæœŸåŒ–
            window.onload = function () {
                animationSteps = generateSteps(examples[currentExample].data);
                updateExampleInfo();
                renderChart(animationSteps[0]);
            };
        </script>
    </body>

</html>