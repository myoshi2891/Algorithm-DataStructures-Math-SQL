<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>æ•°ç‹¬ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ¤œè¨¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 30px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            h2 {
                color: #34495e;
                border-left: 5px solid #3498db;
                padding-left: 15px;
                margin-top: 30px;
                font-size: 1.5em;
            }

            .comparison-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin: 20px 0;
            }

            .method-card {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                border: 2px solid #e9ecef;
                transition: all 0.3s ease;
            }

            .method-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }

            .method-card.bitmask {
                border-color: #28a745;
                background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
            }

            .method-card.set {
                border-color: #dc3545;
                background: linear-gradient(135deg, #fff8f8 0%, #f8e8e8 100%);
            }

            .sudoku-board {
                display: grid;
                grid-template-columns: repeat(9, 35px);
                grid-template-rows: repeat(9, 35px);
                gap: 1px;
                margin: 20px auto;
                width: fit-content;
                background: #2c3e50;
                padding: 10px;
                border-radius: 8px;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            }

            .cell {
                background: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 14px;
                border-radius: 2px;
                transition: all 0.3s ease;
            }

            .cell.empty {
                background: #ecf0f1;
                color: #bdc3c7;
            }

            .cell.current {
                background: #9b59b6;
                color: white;
                transform: scale(1.15);
                z-index: 10;
                box-shadow: 0 4px 12px rgba(155, 89, 182, 0.5);
            }

            .bitmask-visual {
                display: flex;
                flex-direction: column;
                gap: 15px;
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
            }

            .bit-row {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .bit-label {
                width: 80px;
                font-weight: bold;
                color: #2c3e50;
            }

            .bit-display {
                display: flex;
                gap: 2px;
            }

            .bit {
                width: 25px;
                height: 25px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                font-weight: bold;
                border-radius: 3px;
                transition: all 0.3s ease;
            }

            .bit.zero {
                background: #ecf0f1;
                color: #95a5a6;
            }

            .bit.one {
                background: #e74c3c;
                color: white;
                transform: scale(1.1);
                box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
            }

            .bit.new {
                background: #f39c12;
                color: white;
                animation: pulse 1s infinite;
            }

            @keyframes pulse {

                0%,
                100% {
                    transform: scale(1.1);
                }

                50% {
                    transform: scale(1.3);
                }
            }

            .operation-demo {
                background: white;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                border: 2px solid #3498db;
            }

            .operation-step {
                display: flex;
                align-items: center;
                gap: 15px;
                margin: 15px 0;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 8px;
                border-left: 4px solid #3498db;
            }

            .step-number {
                background: #3498db;
                color: white;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                flex-shrink: 0;
            }

            .controls {
                text-align: center;
                margin: 20px 0;
            }

            button {
                background: linear-gradient(45deg, #3498db, #2980b9);
                color: white;
                border: none;
                padding: 12px 24px;
                margin: 0 10px;
                border-radius: 25px;
                cursor: pointer;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            }

            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            }

            button:disabled {
                background: #bdc3c7;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            .performance-chart {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin: 20px 0;
            }

            .metric-card {
                background: white;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease;
            }

            .metric-card:hover {
                transform: translateY(-5px);
            }

            .metric-value {
                font-size: 2em;
                font-weight: bold;
                margin: 10px 0;
            }

            .metric-value.better {
                color: #27ae60;
            }

            .metric-value.worse {
                color: #e74c3c;
            }

            .code-section {
                background: #2d3748;
                color: #e2e8f0;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                overflow-x: auto;
            }

            .code-section pre {
                margin: 0;
                font-family: 'Courier New', monospace;
                line-height: 1.4;
            }

            .highlight-line {
                background: rgba(56, 178, 172, 0.2);
                padding: 2px 0;
                margin: 0 -20px;
                padding-left: 20px;
                padding-right: 20px;
            }

            .memory-visual {
                display: flex;
                justify-content: space-around;
                margin: 20px 0;
            }

            .memory-block {
                text-align: center;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }

            .memory-block.set-method {
                background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            }

            .memory-block.bitmask-method {
                background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            }

            .memory-bars {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin: 10px 0;
            }

            .memory-bar {
                height: 20px;
                border-radius: 10px;
                position: relative;
                overflow: hidden;
            }

            .memory-bar.set {
                background: #e74c3c;
                width: 100%;
            }

            .memory-bar.bitmask {
                background: #27ae60;
                width: 25%;
            }

            .status {
                text-align: center;
                padding: 15px;
                margin: 20px 0;
                border-radius: 10px;
                font-weight: bold;
                font-size: 1.1em;
            }

            .status.demo {
                background: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>ğŸ”¢ æ•°ç‹¬ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ¤œè¨¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æ</h1>

            <h2>ğŸ“Š Set vs ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ¯”è¼ƒ</h2>
            <div class="comparison-grid">
                <div class="method-card set">
                    <h3>ğŸ—‚ï¸ Setæ–¹å¼</h3>
                    <ul>
                        <li><strong>ãƒ‡ãƒ¼ã‚¿æ§‹é€ :</strong> 27å€‹ã®Set</li>
                        <li><strong>è¦ç´ :</strong> æ–‡å­—åˆ— ('1'-'9')</li>
                        <li><strong>ãƒ¡ãƒ¢ãƒª:</strong> ~2KB</li>
                        <li><strong>æ“ä½œ:</strong> has(), add()</li>
                        <li><strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥:</strong> åˆ†æ•£ã‚¢ã‚¯ã‚»ã‚¹</li>
                    </ul>
                </div>
                <div class="method-card bitmask">
                    <h3>ğŸ¯ ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ–¹å¼</h3>
                    <ul>
                        <li><strong>ãƒ‡ãƒ¼ã‚¿æ§‹é€ :</strong> 27å€‹ã®æ•´æ•°</li>
                        <li><strong>è¦ç´ :</strong> ãƒ“ãƒƒãƒˆ (0/1)</li>
                        <li><strong>ãƒ¡ãƒ¢ãƒª:</strong> ~108ãƒã‚¤ãƒˆ</li>
                        <li><strong>æ“ä½œ:</strong> &, |, <<< /li>
                        <li><strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥:</strong> é€£ç¶šã‚¢ã‚¯ã‚»ã‚¹</li>
                    </ul>
                </div>
            </div>

            <h2>ğŸ¯ ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯è¦–è¦šåŒ–ãƒ‡ãƒ¢</h2>
            <div class="controls">
                <button onclick="startBitmaskDemo()">ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ãƒ‡ãƒ¢é–‹å§‹</button>
                <button onclick="resetDemo()">ãƒªã‚»ãƒƒãƒˆ</button>
                <button onclick="showSpecificNumber()">æ•°å­—5ã®å‡¦ç†ã‚’è¡¨ç¤º</button>
            </div>

            <div class="sudoku-board" id="sudoku-board"></div>

            <div class="status" id="demo-status" style="display: none;"></div>

            <div class="bitmask-visual" id="bitmask-visual">
                <h3>ğŸ”¢ ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯çŠ¶æ…‹ï¼ˆæ•°å­—1-9å¯¾å¿œï¼‰</h3>
                <div class="bit-row">
                    <div class="bit-label">æ•°å­—ä½ç½®:</div>
                    <div class="bit-display">
                        <div class="bit zero">1</div>
                        <div class="bit zero">2</div>
                        <div class="bit zero">3</div>
                        <div class="bit zero">4</div>
                        <div class="bit zero">5</div>
                        <div class="bit zero">6</div>
                        <div class="bit zero">7</div>
                        <div class="bit zero">8</div>
                        <div class="bit zero">9</div>
                    </div>
                </div>
                <div class="bit-row">
                    <div class="bit-label">è¡Œ0:</div>
                    <div class="bit-display" id="row-0-bits">
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                    </div>
                </div>
                <div class="bit-row">
                    <div class="bit-label">åˆ—0:</div>
                    <div class="bit-display" id="col-0-bits">
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                    </div>
                </div>
                <div class="bit-row">
                    <div class="bit-label">ãƒœãƒƒã‚¯ã‚¹0:</div>
                    <div class="bit-display" id="box-0-bits">
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                        <div class="bit zero">0</div>
                    </div>
                </div>
            </div>

            <h2>âš™ï¸ ãƒ“ãƒƒãƒˆæ¼”ç®—è©³ç´°è§£æ</h2>
            <div class="operation-demo">
                <h3>æ•°å­—5ã®å‡¦ç†ä¾‹</h3>
                <div class="operation-step">
                    <div class="step-number">1</div>
                    <div>
                        <strong>æ•°å­—å¤‰æ›:</strong> '5' â†’ digit = 4 (0-8ç¯„å›²)<br>
                        <code>digit = int('5') - 1 = 4</code>
                    </div>
                </div>
                <div class="operation-step">
                    <div class="step-number">2</div>
                    <div>
                        <strong>ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ä½œæˆ:</strong> 1 << 4=16 (0b000010000)<br>
                            <code>bit_mask = 1 << 4 = 16</code>
                    </div>
                </div>
                <div class="operation-step">
                    <div class="step-number">3</div>
                    <div>
                        <strong>é‡è¤‡ãƒã‚§ãƒƒã‚¯:</strong> rows[i] & bit_mask<br>
                        <code>if (rows[0] & 16) != 0: # æ—¢ã«5ãŒå­˜åœ¨ã™ã‚‹ã‹ï¼Ÿ</code>
                    </div>
                </div>
                <div class="operation-step">
                    <div class="step-number">4</div>
                    <div>
                        <strong>ãƒ“ãƒƒãƒˆè¨­å®š:</strong> rows[i] |= bit_mask<br>
                        <code>rows[0] |= 16  # 5ã®ãƒ“ãƒƒãƒˆã‚’ç«‹ã¦ã‚‹</code>
                    </div>
                </div>
            </div>

            <h2>ğŸš€ æ€§èƒ½åˆ†æ</h2>
            <div class="performance-chart">
                <div class="metric-card">
                    <h4>å®Ÿè¡Œæ™‚é–“</h4>
                    <div class="metric-value better">-25%</div>
                    <p>ãƒ“ãƒƒãƒˆæ¼”ç®—ã«ã‚ˆã‚‹é«˜é€ŸåŒ–</p>
                </div>
                <div class="metric-card">
                    <h4>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</h4>
                    <div class="metric-value better">-75%</div>
                    <p>æ•´æ•°é…åˆ—ã«ã‚ˆã‚‹å‰Šæ¸›</p>
                </div>
                <div class="metric-card">
                    <h4>ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡</h4>
                    <div class="metric-value better">+40%</div>
                    <p>é€£ç¶šãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹</p>
                </div>
                <div class="metric-card">
                    <h4>åˆ†å²äºˆæ¸¬</h4>
                    <div class="metric-value better">+15%</div>
                    <p>å˜ç´”ãªæ¡ä»¶åˆ†å²</p>
                </div>
            </div>

            <h2>ğŸ’¾ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æ¯”è¼ƒ</h2>
            <div class="memory-visual">
                <div class="memory-block set-method">
                    <h4>Setæ–¹å¼</h4>
                    <div class="memory-bars">
                        <div class="memory-bar set"></div>
                        <div style="text-align: center; font-weight: bold;">~2KB</div>
                    </div>
                    <small>27å€‹ã®Set + æ–‡å­—åˆ—ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</small>
                </div>
                <div class="memory-block bitmask-method">
                    <h4>ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ–¹å¼</h4>
                    <div class="memory-bars">
                        <div class="memory-bar bitmask"></div>
                        <div style="text-align: center; font-weight: bold;">~108ãƒã‚¤ãƒˆ</div>
                    </div>
                    <small>27å€‹ã®æ•´æ•°ã®ã¿</small>
                </div>
            </div>

            <h2>ğŸ’» æœ€é©åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰è§£æ</h2>
            <div class="code-section">
                <pre><code># <span class="highlight-line">æœ€é©åŒ–ç‰ˆ: å˜ä¸€é…åˆ—ã§27å€‹ã®åˆ¶ç´„ã‚’ç®¡ç†</span>
masks: List[int] = [0] * 27  # [0-8]: rows, [9-17]: cols, [18-26]: boxes

for i in range(9):
    for j in range(9):
        if board[i][j] == '.':
            continue
        
        # <span class="highlight-line">ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å‡¦ç†ã§é–¢æ•°å‘¼ã³å‡ºã—ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›</span>
        bit: int = 1 << (int(board[i][j]) - 1)  # O(1)ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ä½œæˆ
        box_idx: int = 18 + (i // 3) * 3 + (j // 3)  # O(1)ãƒœãƒƒã‚¯ã‚¹è¨ˆç®—
        
        # <span class="highlight-line">3ã¤ã®åˆ¶ç´„ã‚’1ã¤ã®æ¡ä»¶æ–‡ã§åŒæ™‚ãƒã‚§ãƒƒã‚¯</span>
        if masks[i] & bit or masks[9 + j] & bit or masks[box_idx] & bit:
            return False  # O(1)é‡è¤‡æ¤œå‡º
        
        # <span class="highlight-line">3ã¤ã®ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’åŒæ™‚æ›´æ–°</span>
        masks[i] |= bit        # è¡Œã®ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ›´æ–°
        masks[9 + j] |= bit    # åˆ—ã®ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ›´æ–°  
        masks[box_idx] |= bit  # ãƒœãƒƒã‚¯ã‚¹ã®ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯æ›´æ–°</code></pre>
            </div>

            <h2>ğŸ” ãƒ“ãƒƒãƒˆæ¼”ç®—ã®åˆ©ç‚¹</h2>
            <div class="comparison-grid">
                <div class="method-card">
                    <h4>ğŸƒâ€â™‚ï¸ å‡¦ç†é€Ÿåº¦</h4>
                    <ul>
                        <li>CPUãƒã‚¤ãƒ†ã‚£ãƒ–å‘½ä»¤</li>
                        <li>1ã‚¯ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚¯ãƒ«ã§å®Ÿè¡Œ</li>
                        <li>åˆ†å²äºˆæ¸¬ãŒåŠ¹ç‡çš„</li>
                        <li>ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†ã«æœ€é©</li>
                    </ul>
                </div>
                <div class="method-card">
                    <h4>ğŸ’¾ ãƒ¡ãƒ¢ãƒªåŠ¹ç‡</h4>
                    <ul>
                        <li>é€£ç¶šãƒ¡ãƒ¢ãƒªé…ç½®</li>
                        <li>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã«åã¾ã‚‹</li>
                        <li>ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹å›æ•°å‰Šæ¸›</li>
                        <li>ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è² è·è»½æ¸›</li>
                    </ul>
                </div>
            </div>
        </div>

        <script>
            // ã‚µãƒ³ãƒ—ãƒ«ãƒœãƒ¼ãƒ‰
            const sampleBoard = [
                ["5", "3", ".", ".", "7", ".", ".", ".", "."],
                ["6", ".", ".", "1", "9", "5", ".", ".", "."],
                [".", "9", "8", ".", ".", ".", ".", "6", "."],
                ["8", ".", ".", ".", "6", ".", ".", ".", "3"],
                ["4", ".", ".", "8", ".", "3", ".", ".", "1"],
                ["7", ".", ".", ".", "2", ".", ".", ".", "6"],
                [".", "6", ".", ".", ".", ".", "2", "8", "."],
                [".", ".", ".", "4", "1", "9", ".", ".", "5"],
                [".", ".", ".", ".", "8", ".", ".", "7", "9"]
            ];

            let demoRunning = false;
            let masks = [0, 0, 0, 0, 0, 0, 0, 0, 0]; // è¡Œç”¨ï¼ˆå®Ÿéš›ã¯27å€‹å¿…è¦ï¼‰

            // ãƒœãƒ¼ãƒ‰ã‚’æç”»
            function renderBoard() {
                const board = document.getElementById('sudoku-board');
                board.innerHTML = '';

                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.id = `cell-${i}-${j}`;

                        if (sampleBoard[i][j] === '.') {
                            cell.className += ' empty';
                            cell.textContent = '';
                        } else {
                            cell.textContent = sampleBoard[i][j];
                        }

                        board.appendChild(cell);
                    }
                }
            }

            // ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯è¡¨ç¤ºã‚’æ›´æ–°
            function updateBitmaskDisplay(rowBits, colBits, boxBits, label) {
                const displays = ['row-0-bits', 'col-0-bits', 'box-0-bits'];
                const values = [rowBits, colBits, boxBits];

                displays.forEach((id, idx) => {
                    const container = document.getElementById(id);
                    if (container) {
                        const bits = container.querySelectorAll('.bit');
                        for (let i = 0; i < 9; i++) {
                            const bit = bits[i];
                            const isSet = (values[idx] & (1 << i)) !== 0;
                            bit.className = `bit ${isSet ? 'one' : 'zero'}`;
                            bit.textContent = isSet ? '1' : '0';
                        }
                    }
                });
            }

            // ç‰¹å®šã®æ•°å­—ã®å‡¦ç†ã‚’è¡¨ç¤º
            function showSpecificNumber() {
                const status = document.getElementById('demo-status');
                status.style.display = 'block';
                status.className = 'status demo';
                status.innerHTML = `
                <h4>æ•°å­—5ã®å‡¦ç†ä¾‹</h4>
                <p><strong>ã‚¹ãƒ†ãƒƒãƒ—1:</strong> '5' â†’ digit = 4</p>
                <p><strong>ã‚¹ãƒ†ãƒƒãƒ—2:</strong> bit_mask = 1 << 4 = 16 (0b000010000)</p>
                <p><strong>ã‚¹ãƒ†ãƒƒãƒ—3:</strong> é‡è¤‡ãƒã‚§ãƒƒã‚¯: mask & 16</p>
                <p><strong>ã‚¹ãƒ†ãƒƒãƒ—4:</strong> ãƒ“ãƒƒãƒˆè¨­å®š: mask |= 16</p>
            `;

                // ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆæ•°å­—5ã®ãƒ“ãƒƒãƒˆã‚’è¡¨ç¤ºï¼‰
                const bit5Mask = 1 << 4; // 16
                updateBitmaskDisplay(bit5Mask, bit5Mask, bit5Mask, 'æ•°å­—5');

                // è©²å½“ãƒ“ãƒƒãƒˆã‚’å¼·èª¿
                setTimeout(() => {
                    const containers = ['row-0-bits', 'col-0-bits', 'box-0-bits'];
                    containers.forEach(id => {
                        const container = document.getElementById(id);
                        if (container) {
                            const fifthBit = container.children[4]; // 5ç•ªç›®ã®ãƒ“ãƒƒãƒˆï¼ˆ0-indexedï¼‰
                            if (fifthBit) {
                                fifthBit.className = 'bit new';
                            }
                        }
                    });
                }, 1000);
            }

            // ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ãƒ‡ãƒ¢é–‹å§‹
            async function startBitmaskDemo() {
                if (demoRunning) return;

                demoRunning = true;
                const status = document.getElementById('demo-status');
                status.style.display = 'block';
                status.className = 'status demo';

                // åˆæœŸåŒ–
                let rowMasks = Array(9).fill(0);
                let colMasks = Array(9).fill(0);
                let boxMasks = Array(9).fill(0);

                status.textContent = 'ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ãƒ‡ãƒ¢é–‹å§‹: å„ã‚»ãƒ«ã‚’é †æ¬¡å‡¦ç†ä¸­...';

                for (let i = 0; i < 9 && demoRunning; i++) {
                    for (let j = 0; j < 9 && demoRunning; j++) {
                        const cell = sampleBoard[i][j];

                        // ç¾åœ¨ã®ã‚»ãƒ«ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                        clearHighlights();
                        highlightCell(i, j, 'current');

                        if (cell !== '.') {
                            const digit = parseInt(cell) - 1;
                            const bitMask = 1 << digit;
                            const boxIndex = Math.floor(i / 3) * 3 + Math.floor(j / 3);

                            status.innerHTML = `
                            <strong>å‡¦ç†ä¸­:</strong> ã‚»ãƒ«(${i + 1}, ${j + 1}) = "${cell}"<br>
                            <strong>digit:</strong> ${digit}, <strong>bit_mask:</strong> ${bitMask} (0b${bitMask.toString(2).padStart(9, '0')})<br>
                            <strong>é‡è¤‡ãƒã‚§ãƒƒã‚¯:</strong> è¡Œ&åˆ—&ãƒœãƒƒã‚¯ã‚¹
                        `;

                            // ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯çŠ¶æ…‹ã‚’æ›´æ–°è¡¨ç¤º
                            updateBitmaskDisplay(rowMasks[i], colMasks[j], boxMasks[boxIndex]);

                            // é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰
                            if ((rowMasks[i] & bitMask) || (colMasks[j] & bitMask) || (boxMasks[boxIndex] & bitMask)) {
                                status.innerHTML += '<br><span style="color: #e74c3c;">âŒ é‡è¤‡æ¤œå‡ºï¼</span>';
                            } else {
                                status.innerHTML += '<br><span style="color: #27ae60;">âœ… OK - ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’æ›´æ–°</span>';

                                // ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’æ›´æ–°
                                rowMasks[i] |= bitMask;
                                colMasks[j] |= bitMask;
                                boxMasks[boxIndex] |= bitMask;
                            }
                        } else {
                            status.textContent = `ã‚¹ã‚­ãƒƒãƒ—: ã‚»ãƒ«(${i + 1}, ${j + 1}) ã¯ç©ºã‚»ãƒ«`;
                        }

                        await new Promise(resolve => setTimeout(resolve, 800));
                    }
                }

                if (demoRunning) {
                    status.innerHTML = '<span style="color: #27ae60;">âœ… ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ãƒ‡ãƒ¢å®Œäº†ï¼å…¨ã¦ã®åˆ¶ç´„ãŒæº€ãŸã•ã‚Œã¦ã„ã¾ã™ã€‚</span>';
                }

                demoRunning = false;
            }

            // ãƒã‚¤ãƒ©ã‚¤ãƒˆé–¢é€£ã®é–¢æ•°
            function highlightCell(i, j, type) {
                const cell = document.getElementById(`cell-${i}-${j}`);
                if (cell) {
                    cell.className = cell.className.replace(/current/g, '').trim();
                    cell.className += ` ${type}`;
                }
            }

            function clearHighlights() {
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        const cell = document.getElementById(`cell-${i}-${j}`);
                        if (cell) {
                            cell.className = cell.className.replace(/current/g, '').trim();
                            if (sampleBoard[i][j] === '.') {
                                cell.className += ' empty';
                            }
                        }
                    }
                }
            }

            // ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
            function resetDemo() {
                demoRunning = false;
                clearHighlights();
                document.getElementById('demo-status').style.display = 'none';

                // ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
                const displays = ['row-0-bits', 'col-0-bits', 'box-0-bits'];
                displays.forEach(id => {
                    const container = document.getElementById(id);
                    if (container) {
                        const bits = container.querySelectorAll('.bit');
                        bits.forEach(bit => {
                            bit.className = 'bit zero';
                            bit.textContent = '0';
                        });
                    }
                });
            }

            // åˆæœŸåŒ–
            document.addEventListener('DOMContentLoaded', function () {
                renderBoard();
            });
        </script>
    </body>

</html>