---

## 🧠 1. 最大流（Maximum Flow）とは？

**問題の設定：**

* グラフの各辺には**容量**（流せる水の最大量）がある。
* \*\*始点（source）**から**終点（sink）\*\*へ、どれだけ多くのフロー（流量）を送れるかを求める。
* 条件：

  * 各辺の流量は容量以下。
  * 各中間ノードでは「入ってくる量 = 出ていく量」。

---

## 🚰 2. Ford-Fulkerson 法の概要

### 🔁 アルゴリズムの考え方

1. \*\*残余グラフ（residual graph）\*\*を使って、「まだ流せる」経路を探す。
2. 経路が見つかる限り、**流せる最小容量**だけ流す。
3. 残余グラフを更新し、上記を繰り返す。
4. 経路が見つからなくなったら終了 → 最大流。

---

## 📘 用語整理

| 用語                        | 意味                                                   |
| --------------------------- | ------------------------------------------------------ |
| 残余容量                    | 実際に流せる余力（容量 - 現在の流量）                  |
| 残余グラフ                  | 今の流れに基づいて「あとどれだけ流せるか」を示すグラフ |
| 増加経路（augmenting path） | source→sink まで、残余容量がすべて正のパス             |

---

## 🧩 3. Edmonds-Karp アルゴリズム（Ford-Fulkerson の BFS 版）

**問題点：**
Ford-Fulkerson の経路探索は DFS のため、経路選択が非効率になることがあります。

**改良：**
Edmonds-Karp 法では、\*\*BFS（幅優先探索）\*\*で「最短の増加経路」を選びます。
→ よって **時間計算量が O(V \* E²)** に改善。

---

## 🔄 Edmonds-Karp のステップ

### 初期状態

- flow = 0
- capacity\[u]\[v] = 各辺の容量

---

### ① 増加経路を BFS で探す

```text
source → ... → ... → sink の経路を残余容量 > 0 の辺のみ使って探索
```

---

### ② 最小残余容量を探す（pathFlow）

```text
pathFlow = 経路上の最小 capacity[u][v]
```

---

### ③ 流す・逆辺を作る（残余グラフ更新）

- capacity\[u]\[v] -= pathFlow
- capacity\[v]\[u] += pathFlow

→ 逆辺で「流れのキャンセル」が可能になる。

---

### ④ 流量を足す

- flow += pathFlow

---

### ⑤ 経路が無くなるまで繰り返す

- BFS で新しい増加経路が見つからなければ終了。

---

## 📈 4. 図による例（簡略化）

```
(1) --10--> (2) --10--> (4)
 |                       ^
 |                       |
 +----5----> (3) --15----+
```

- capacity\[1]\[2] = 10
- capacity\[1]\[3] = 5
- capacity\[2]\[4] = 10
- capacity\[3]\[4] = 15

---

### ステップ:

1. 経路: 1→2→4（flow: 10）
2. 経路: 1→3→4（flow: 5）
3. 合計最大流 = 15

---

## ⏱️ 時間計算量

- **1回のBFS探索コスト:** O(E)
- **探索回数（最大流の合計）:** O(E \* V) 回
- **全体:** O(V \* E²)

---

## ✅ メリットと用途

| 項目    | 内容                                                           |
| ------- | -------------------------------------------------------------- |
| 🔧 精度 | 厳密な最大流が求まる                                           |
| 💡 実装 | わかりやすく直感的                                             |
| ⚠️ 欠点 | 容量に小数がある場合、無限ループの可能性（Edmonds-Karpで解決） |

---

## 🎯 よくある応用例

- ネットワークの帯域計算
- 仕事の割り当て（最大マッチング）
- 交通・水道システムの最適設計
- 画像のセグメンテーション（graph cut）

---

## 📌 まとめ

| アルゴリズム   | 経路探索 | 計算量            | 特徴                         |
| -------------- | -------- | ----------------- | ---------------------------- |
| Ford-Fulkerson | DFS      | 非定数 (容量依存) | 容量が整数ならOK、小数で注意 |
| Edmonds-Karp   | BFS      | O(V \* E²)        | 安定して速い、競技向き       |

---
