---
## ğŸ§© å•é¡Œã®æ¦‚è¦ï¼ˆå†æ²ï¼‰

ä¸ãˆã‚‰ã‚ŒãŸ `N Ã— N` ã®ç›¤é¢ã«ã¯ã€1ã€œNã®æ•´æ•°ãŒ1ã¤ãšã¤é…ç½®ã•ã‚Œã¦ãŠã‚Šã€å„è¡Œãƒ»å„åˆ—ã«1ã¤ã ã‘ã‚ã‚Šã¾ã™ã€‚
ã“ã®çŠ¶æ…‹ã‹ã‚‰ã€**ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™çŠ¶æ…‹ã«ã™ã‚‹ãŸã‚ã®æœ€å°æ“ä½œå›æ•°**ã‚’æ±‚ã‚ã¾ã™ã€‚

> ã™ã¹ã¦ã®æ•´æ•° `k` ãŒã€Œ**è¡Œ `k`ï¼ˆä¸Šã‹ã‚‰kè¡Œç›®ï¼‰**ã€**åˆ— `k`ï¼ˆå·¦ã‹ã‚‰kåˆ—ç›®ï¼‰**ã€ã«ã‚ã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚

æ“ä½œã¨ã—ã¦è¨±ã•ã‚Œã‚‹ã®ã¯ï¼š

* éš£æ¥ã™ã‚‹ **è¡Œ**ã®äº¤æ›
* éš£æ¥ã™ã‚‹ **åˆ—**ã®äº¤æ›
---

## âœ… å…¥åŠ›ä¾‹

```plaintext
N = 4
ç›¤é¢:
0 0 2 0
3 0 0 0
0 0 0 4
0 1 0 0
```

### ğŸŸ¦ å›³ç¤ºï¼ˆå…ƒã®é…ç½®ï¼‰

```
   0  1  2  3   â† åˆ—
0 [ .  . â‘¡  . ]
1 [ â‘¢  .  .  . ]
2 [ .  .  . â‘£ ]
3 [ . â‘   .  . ]
â†‘ è¡Œ
```

- â‘¡ (2) ã¯ (0,2)
- â‘¢ (3) ã¯ (1,0)
- â‘£ (4) ã¯ (2,3)
- â‘  (1) ã¯ (3,1)

---

## ğŸ¯ æœ€çµ‚çš„ã«ç›®æŒ‡ã™ã¹ãé…ç½®

ã€Œæ•´æ•° `k` ãŒ `(k-1, k-1)` ã«å­˜åœ¨ã€

ã¤ã¾ã‚Šï¼š

```
   0  1  2  3
0 [ â‘   .  .  . ]
1 [ . â‘¡  .  . ]
2 [ .  . â‘¢  . ]
3 [ .  .  . â‘£ ]
```

---

## ğŸ” ã©ã†ã‚„ã£ã¦æ“ä½œã‚’æœ€å°åŒ–ã™ã‚‹ã‹ï¼Ÿ

è¡Œã¨åˆ—ã®é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆã‚‹ã“ã¨ã§ã€ä¸Šã®ç›®æ¨™ã®å½¢ã«ã—ãŸã„ã€‚
ã“ã®ã¨ãã€ä»¥ä¸‹ã‚’è€ƒãˆã¾ã™ï¼š

- **ç¾åœ¨ã®å„æ•°å€¤ã®è¡Œãƒ»åˆ—ç•ªå·ã‚’ãƒªã‚¹ãƒˆã«ã™ã‚‹**
- è¡Œã®é †åºãƒ»åˆ—ã®é †åºã‚’ãã‚Œãã‚Œç›®æ¨™ã«åˆã‚ã›ã‚‹ãŸã‚ã«å¿…è¦ãª **éš£æ¥ã‚¹ãƒ¯ãƒƒãƒ—ã®å›æ•°ï¼ˆ=è»¢å€’æ•°ï¼‰** ã‚’æ±‚ã‚ã‚‹

---

## ğŸ§® å„æ•°å€¤ã®ç¾åœ¨ä½ç½®

| æ•°å­— k | è¡Œ  | åˆ—  |
| ------ | --- | --- |
| 1      | 3   | 1   |
| 2      | 0   | 2   |
| 3      | 1   | 0   |
| 4      | 2   | 3   |

ãã‚Œãã‚Œ `(è¡Œ,åˆ—)` ã®é…åˆ—ã«ã™ã‚‹ã¨ï¼š

```ts
rowPerm = [3, 0, 1, 2]; // k=1ã€œ4 ã®è¡Œã®ç¾åœ¨ä½ç½®
colPerm = [1, 2, 0, 3]; // k=1ã€œ4 ã®åˆ—ã®ç¾åœ¨ä½ç½®
```

---

## ğŸ”ƒ ç›®æ¨™ï¼šrowPerm, colPerm ã‚’ \[0,1,2,3] ã«ã—ãŸã„

ã“ã®ä¸¦ã³ã‚’ `[0, 1, 2, 3]` ã«ã™ã‚‹ã«ã¯ã€Œä½•å›éš£æ¥è¦ç´ ã‚’ã‚¹ãƒ¯ãƒƒãƒ—ã™ã‚Œã°ã‚ˆã„ã‹ï¼Ÿã€

---

## ğŸ”¢ è»¢å€’æ•°ï¼ˆå›³ã§èª¬æ˜ï¼‰

### `rowPerm = [3, 0, 1, 2]`

ã“ã‚Œã‚’å›³ã§ã‚¹ãƒ¯ãƒƒãƒ—ã—ã¦æ•´åˆ—ï¼š

```
[3, 0, 1, 2]
â†’ swap(0,1): [0,3,1,2]  (1å›)
â†’ swap(1,2): [0,1,3,2]  (2å›ç›®)
â†’ swap(2,3): [0,1,2,3]  (3å›ç›®)
```

âœ”ï¸ è»¢å€’æ•° = 3

---

### `colPerm = [1, 2, 0, 3]`

```
[1, 2, 0, 3]
â†’ swap(1,2): [1,0,2,3]
â†’ swap(0,1): [0,1,2,3]
â†’ è¨ˆ 2å›
```

âœ”ï¸ è»¢å€’æ•° = 2

---

## âœ… çµæœ

æœ€å°æ“ä½œå›æ•°ï¼ˆ=æœ€å°ã‚¹ãƒ¯ãƒƒãƒ—å›æ•°ï¼‰
\= `è¡Œã®è»¢å€’æ•° 3 + åˆ—ã®è»¢å€’æ•° 2 = 5`

---

## ğŸ’¡ å›³ã¾ã¨ã‚

| ã‚¹ãƒ†ãƒƒãƒ— | é…åˆ—       | æ“ä½œå†…å®¹                |
| -------- | ---------- | ----------------------- |
| rowPerm  | \[3,0,1,2] | swap 3â†”0 â†’ 0â†”1 â†’ 1â†”2 |
| colPerm  | \[1,2,0,3] | swap 2â†”0 â†’ 1â†”0        |

---

## ğŸ“Œ è£œè¶³ï¼šãªãœè»¢å€’æ•°ã§OKï¼Ÿ

éš£æ¥ã‚¹ãƒ¯ãƒƒãƒ—ã ã‘ã§é †åˆ—ã‚’ä¸¦ã³æ›¿ãˆã‚‹ã¨ãã®**æœ€å°æ“ä½œå›æ•°ã¯è»¢å€’æ•°ã¨ç­‰ã—ã„**ã‹ã‚‰ã§ã™ã€‚

- ãŸã¨ãˆã° `[3, 1, 2]` â†’ `[1, 2, 3]` ã«ã™ã‚‹ã«ã¯
    - `3 â†” 1`ï¼ˆ1å›ï¼‰
    - `3 â†” 2`ï¼ˆ2å›ï¼‰
    - è¨ˆ 2å›ï¼ˆ= è»¢å€’æ•°ï¼‰

---

## ğŸ”š æœ€å¾Œã«

ã“ã®å•é¡Œã¯ä¸€è¦‹é›£ã—ãã†ã§ã™ãŒã€æœ¬è³ªã¯ **è¡Œãƒ»åˆ—ã®ä¸¦ã³ã‚’ç›®æ¨™é †åˆ—ã«ã™ã‚‹** ã“ã¨ã€‚
ãã—ã¦ãã‚Œã‚’**æœ€å°ã‚¹ãƒ¯ãƒƒãƒ—å›æ•°ï¼ˆ=è»¢å€’æ•°ï¼‰ã§å¤‰æ›ã™ã‚‹ã ã‘**ã§ã™ã€‚

---

ã“ã® `countInversions` é–¢æ•°ã¯ã€**Fenwick Treeï¼ˆBIT = Binary Indexed Treeï¼‰** ã‚’ä½¿ã£ã¦ **è»¢å€’æ•°ï¼ˆinversion countï¼‰** ã‚’åŠ¹ç‡çš„ã«æ•°ãˆã‚‹æ–¹æ³•ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã€æ¬¡ã®3ç‚¹ã«çµã£ã¦ **å›³ã¨ã¨ã‚‚ã«è©³ã—ãè§£èª¬**ã—ã¾ã™ã€‚

---

## ğŸ” ç›®æ¬¡

1. **è»¢å€’æ•°ã¨ã¯ï¼Ÿï¼ˆå®šç¾©ã¨ä¾‹ï¼‰**
2. **Fenwick Treeï¼ˆBITï¼‰ã¨ã¯ï¼Ÿï¼ˆå›³è§£ä»˜ãï¼‰**
3. **ã‚³ãƒ¼ãƒ‰è§£èª¬ï¼š`countInversions`ã®å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—**

---

## â‘  è»¢å€’æ•°ã¨ã¯ï¼Ÿ

é…åˆ—ã®ä¸­ã§ã€**å·¦å´ã«ã‚ã‚‹è¦ç´ ãŒå³å´ã®è¦ç´ ã‚ˆã‚Šå¤§ãã„**ã¨ãã€ãã‚Œã‚’ **è»¢å€’ï¼ˆinversionï¼‰** ã¨å‘¼ã³ã¾ã™ã€‚

### ä¾‹

```ts
arr = [3, 1, 2];
```

- `(3, 1)` â†’ è»¢å€’
- `(3, 2)` â†’ è»¢å€’

â¡ï¸ è»¢å€’æ•° = **2**

---

## â‘¡ Fenwick Treeï¼ˆBITï¼‰ã¨ã¯ï¼Ÿ

### âœ” ç›®çš„

- \*\*åŒºé–“å’Œï¼ˆéƒ¨åˆ†å’Œï¼‰\*\*ã‚’é«˜é€Ÿã«æ›´æ–°ãƒ»å–å¾—ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- ã“ã“ã§ã¯ã€\*\*ã€Œè‡ªåˆ†ã‚ˆã‚Šå°ã•ã„æ•°ãŒã€ã“ã‚Œã¾ã§ã«ä½•å€‹å‡ºã¦ããŸã‹ï¼Ÿã€\*\*ã‚’é«˜é€Ÿã«æ•°ãˆã‚‹ç”¨é€”ã§ä½¿ã„ã¾ã™ã€‚

---

### âœ” ä»•çµ„ã¿ï¼ˆå›³ã§è§£èª¬ï¼‰

Fenwick Treeã¯é…åˆ—ã«æœ¨æ§‹é€ ã‚’åŸ‹ã‚è¾¼ã‚“ã ã‚ˆã†ãªæ§‹é€ ã§ã€ä»¥ä¸‹ã®2æ“ä½œãŒ O(log N) ã§è¡Œãˆã¾ã™ã€‚

| æ“ä½œ        | å†…å®¹                                               |
| ----------- | -------------------------------------------------- |
| `update(i)` | ä½ç½® `i` ã« 1 ã‚’åŠ ç®—ï¼ˆ=è¦ç´ iãŒç™»å ´ã—ãŸã“ã¨ã‚’è¨˜éŒ²ï¼‰ |
| `query(i)`  | ä½ç½® `0~i` ã¾ã§ã®åˆè¨ˆï¼ˆ=ç™»å ´æ¸ˆã¿ã®è¦ç´ æ•°ï¼‰         |

---

### ğŸ§  ä½¿ç”¨ç›®çš„ï¼ˆã“ã®ã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦ï¼‰

- é…åˆ—ã‚’å¾Œã‚ã‹ã‚‰è¦‹ã¦ã„ãã€
    - ã€Œ**ä»Šè¦‹ã¦ã„ã‚‹è¦ç´  `arr[i]` ã‚ˆã‚Šå°ã•ã„æ•°ï¼ˆ= ã™ã§ã«å‡ºç¾æ¸ˆã¿ã®è¦ç´ ï¼‰ã®å€‹æ•°**ã€ã‚’ `query(arr[i] - 1)` ã§å–å¾—
    - ãã‚Œã‚’è»¢å€’æ•°ã«åŠ ç®—

- ãã—ã¦ã€è‡ªåˆ†è‡ªèº« `arr[i]` ã‚’ `update(arr[i])` ã§è¨˜éŒ²ã—ã¦ãŠã

---

## â‘¢ ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ã§ã®è§£èª¬

```ts
function countInversions(arr: number[]): number {
  const BIT: number[] = Array(N + 2).fill(0);
  let res = 0;
```

- `BIT` = Fenwick Treeã€‚ã‚µã‚¤ã‚ºã¯ N+2ï¼ˆå®‰å…¨ã®ãŸã‚+2ï¼‰
- `res` = è»¢å€’æ•°ã‚’æ ¼ç´ã™ã‚‹å¤‰æ•°

---

### `update(i)`

```ts
const update = (i: number) => {
    i++;
    while (i <= N + 1) {
        BIT[i]++;
        i += i & -i;
    }
};
```

- BITã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯1-basedã«ã™ã‚‹ãŸã‚ `i++`ã€‚
- `BIT[i]++` ã§ã‚«ã‚¦ãƒ³ãƒˆå¢—ã‚„ã™ã€‚
- `i += i & -i` ã¯ã€Œè¦ªãƒãƒ¼ãƒ‰ã€ã¸ç§»å‹•ã€‚

---

### `query(i)`

```ts
const query = (i: number): number => {
    i++;
    let sum = 0;
    while (i > 0) {
        sum += BIT[i];
        i -= i & -i;
    }
    return sum;
};
```

- 1ã€œiã¾ã§ã®åˆè¨ˆã‚’æ±‚ã‚ã‚‹ã€‚
- `i -= i & -i` ã¯ã€Œè¦ªãƒãƒ¼ãƒ‰ã«é¡ã‚‹ã€æ“ä½œã€‚

---

### ãƒ«ãƒ¼ãƒ—å‡¦ç†æœ¬ä½“

```ts
for (let i = arr.length - 1; i >= 0; i--) {
    res += query(arr[i] - 1); // è‡ªåˆ†ã‚ˆã‚Šå°ã•ã„è¦ç´ ã®æ•°
    update(arr[i]); // è‡ªåˆ†ã‚’è¨˜éŒ²
}

return res;
```

- å¾Œã‚ã‹ã‚‰è¦‹ã‚‹ã“ã¨ã§ã€ã€Œå³ã«ã‚ã‚‹å€¤ã¨æ¯”è¼ƒã™ã‚‹è»¢å€’ã€ã®ã‚«ã‚¦ãƒ³ãƒˆã«ãªã‚‹ã€‚
- `query(arr[i] - 1)` ã§ã€Œè‡ªåˆ†ã‚ˆã‚Šå°ã•ã„å€¤ãŒã©ã‚Œã ã‘ã™ã§ã«å‡ºã¦ããŸã‹ã€ã‚’å–å¾—ã€‚
- `update(arr[i])` ã§è‡ªåˆ†ã®å€¤ã‚’BITã«ç™»éŒ²ã€‚

---

## ğŸ§ª ä¾‹ã§ç¢ºèª

```ts
arr = [3, 1, 2]
å‡¦ç†é †ï¼šå³â†’å·¦ï¼ˆi = 2 â†’ 1 â†’ 0ï¼‰

i = 2 â†’ arr[2] = 2
  query(1) = 0 â‡’ è»¢å€’ãªã—
  update(2)

i = 1 â†’ arr[1] = 1
  query(0) = 0 â‡’ è»¢å€’ãªã—
  update(1)

i = 0 â†’ arr[0] = 3
  query(2) = 2 â‡’ 2ã¤è»¢å€’ï¼ˆ1,2ï¼‰
  update(3)

æœ€çµ‚ res = 2 âœ…
```

---

## ğŸ“Š è¨ˆç®—é‡

| å‡¦ç†                     | æ™‚é–“è¨ˆç®—é‡ |
| ------------------------ | ---------- |
| `update(i)` / `query(i)` | O(log N)   |
| å…¨ä½“                     | O(N log N) |

---

## ğŸ“Œ ã¾ã¨ã‚

| é …ç›®     | å†…å®¹                                                   |
| -------- | ------------------------------------------------------ |
| ç›®çš„     | éš£æ¥ã‚¹ãƒ¯ãƒƒãƒ—ã§æ•´åˆ—ã•ã›ã‚‹æœ€å°æ“ä½œå›æ•°ï¼ˆè»¢å€’æ•°ï¼‰ã‚’æ±‚ã‚ã‚‹ |
| ä½¿ç”¨æ§‹é€  | Fenwick Treeï¼ˆBITï¼‰                                    |
| å‡¦ç†å†…å®¹ | ã€Œå°ã•ã„æ•°ãŒå³ã«ã©ã‚Œã ã‘ã„ã‚‹ã‹ã€ã‚’æ•°ãˆã‚‹               |
| æ–¹å‘     | å³ã‹ã‚‰å·¦ã¸ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦æ›´æ–°                             |

---

| [æå‡ºæ—¥æ™‚](https://atcoder.jp/contests/tessoku-book/submissions/me?desc=true&orderBy=created) | å•é¡Œ                                                                               | ãƒ¦ãƒ¼ã‚¶                                            | è¨€èª                                                                                                        | [å¾—ç‚¹](https://atcoder.jp/contests/tessoku-book/submissions/me?desc=true&orderBy=score) | [ã‚³ãƒ¼ãƒ‰é•·](https://atcoder.jp/contests/tessoku-book/submissions/me?orderBy=source_length) | çµæœ   | [å®Ÿè¡Œæ™‚é–“](https://atcoder.jp/contests/tessoku-book/submissions/me?orderBy=time_consumption) | [ãƒ¡ãƒ¢ãƒª](https://atcoder.jp/contests/tessoku-book/submissions/me?orderBy=memory_consumption) |                                                                       |
| --------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- | ------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- | ------ | -------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- |
| 2025-06-29 17:07:27                                                                           | [A74 - Board Game](https://atcoder.jp/contests/tessoku-book/tasks/tessoku_book_bv) | [myoshizumi](https://atcoder.jp/users/myoshizumi) | [PHP (php 8.2.8)](https://atcoder.jp/contests/tessoku-book/submissions/me?f.Language=5016)                  | 1000                                                                                    | 2067 Byte                                                                                 | **AC** | 17 ms                                                                                        | 22300 KiB                                                                                    | [è©³ç´°](https://atcoder.jp/contests/tessoku-book/submissions/67181473) |
| 2025-06-29 17:04:25                                                                           | [A74 - Board Game](https://atcoder.jp/contests/tessoku-book/tasks/tessoku_book_bv) | [myoshizumi](https://atcoder.jp/users/myoshizumi) | [Go (go 1.20.6)](https://atcoder.jp/contests/tessoku-book/submissions/me?f.Language=5002)                   | 1000                                                                                    | 1532 Byte                                                                                 | **AC** | 1 ms                                                                                         | 1672 KiB                                                                                     | [è©³ç´°](https://atcoder.jp/contests/tessoku-book/submissions/67181426) |
| 2025-06-29 17:02:26                                                                           | [A74 - Board Game](https://atcoder.jp/contests/tessoku-book/tasks/tessoku_book_bv) | [myoshizumi](https://atcoder.jp/users/myoshizumi) | [Python (CPython 3.11.4)](https://atcoder.jp/contests/tessoku-book/submissions/me?f.Language=5055)          | 1000                                                                                    | 1400 Byte                                                                                 | **AC** | 13 ms                                                                                        | 9252 KiB                                                                                     | [è©³ç´°](https://atcoder.jp/contests/tessoku-book/submissions/67181382) |
| 2025-06-29 16:42:49                                                                           | [A74 - Board Game](https://atcoder.jp/contests/tessoku-book/tasks/tessoku_book_bv) | [myoshizumi](https://atcoder.jp/users/myoshizumi) | [TypeScript 5.1 (Node.js 18.16.1)](https://atcoder.jp/contests/tessoku-book/submissions/me?f.Language=5058) | 1000                                                                                    | 1564 Byte                                                                                 | **AC** | 41 ms                                                                                        | 43848 KiB                                                                                    | [è©³ç´°](https://atcoder.jp/contests/tessoku-book/submissions/67181017) |
| 2025-06-29 16:38:32                                                                           | [A74 - Board Game](https://atcoder.jp/contests/tessoku-book/tasks/tessoku_book_bv) | [myoshizumi](https://atcoder.jp/users/myoshizumi) | [JavaScript (Node.js 18.16.1)](https://atcoder.jp/contests/tessoku-book/submissions/me?f.Language=5009)     | 1000                                                                                    | 1621 Byte                                                                                 | **AC** | 44 ms                                                                                        | 43684 KiB                                                                                    | [è©³ç´°](https://atcoder.jp/contests/tessoku-book/submissions/67180939) |
